"use strict";const e={},t=["lastUsedAudioConfig","defaultAudioConfigText","padSpacedChainsWith"],n={lastUsedAudioConfig:"48000m16w",defaultAudioConfigText:"48kHz/16BIT MONO",restoreLastUsedAudioConfig:!0,retainSessionState:!0,spacedChainMode:!0,updateResampleChainsToList:!1,exportChainsAsPresets:!1,wavePanelHeight:128,attemptToFindCrossingPoint:!1,darkModeTheme:null,dePopClick:0,ditherExports:!1,embedCuePoints:!0,splitOutExistingSlicesOnJoin:!0,embedOrslData:!1,exportWithOtFile:!1,useNextEvenNumberedSliceAsLoopStartForOtFile:!1,importFileLimit:!0,normalizeContrast:!1,reverseEvenSamplesInChains:!1,padSpacedChainsWith:"last",pitchModifier:1,playWithPopMarker:0,showTouchModifierKeys:!1,showWelcomeModalOnLaunchIfListEmpty:!0,shiftClickForFileDownload:!1,skipMiniWaveformRender:!1,treatDualMonoStereoAsMono:!0,zipDownloads:!0,useDateNumberInPlaceOfFileName:!1},i=function(e){return"supportedSampleRates"===e?function(){let e=[8e3,48e3];try{new AudioContext({sampleRate:1}),e=[1,96e3]}catch(t){const n=t.toString().match(/\[(.*?)\]/g);n?.length&&(e=n[0].split(",").map((e=>+e.replace(/\D+/g,""))))}return e[1]=e[1]>96e3?96e3:e[1],e}
/*!
DigiChain v1.4.17-latest [ https://digichain.brianbar.net/ ]
<https://github.com/brian3kb/digichain>

(c) 2023 Brian Barnett <me [at] brianbar.net>
[ @brian3kb ]
Licensed under AGPLv3 <https://github.com/brian3kb/digichain/blob/main/LICENSE>

DigiChain bundled resources:
[MIT license] JSZip  : <https://github.com/Stuk/jszip/blob/main/LICENSE.markdown>
[MIT license] Pako : <https://github.com/nodeca/pako/blob/main/LICENSE>
[MIT license] msgpack-lite : <https://github.com/kawanet/msgpack-lite>
[MIT license] Modified version of Audiobuffer-to-wav : <https://github.com/Experience-Monks/audiobuffer-to-wav/blob/master/LICENSE.md>
[MIT license] Modified version of Audiobuffer-to-aiff : <https://github.com/hunjunior/audiobuffer-to-aiff/blob/master/LICENSE>

Brian referenced the following during development:
[BSD-3] MIDI-SDS, for how the Machine Drum stores audio data in syx files : <https://github.com/eh2k/uwedit/blob/master/core/MidiSDS.cpp> / <https://github.com/eh2k/uwedit/blob/master/LICENSE.txt>
[Unlicense] OctaChainer, how to read/write .ot binary files correctly : <https://github.com/KaiDrange/OctaChainer/blob/master/otwriter.cpp> / <https://github.com/KaiDrange/OctaChainer/blob/master/License.txt>
Tips and Tricks on drawing array buffers to the canvas element: <https://css-tricks.com/making-an-audio-waveform-visualizer-with-vanilla-javascript/>
[MIT License] Basic beat detection : https://github.com/JMPerez/beats-audio-api/blob/gh-pages/script.js / http://joesul.li/van/beat-detection-using-web-audio/
*/():n[e]},r=function(t,n){if(null==n||""===n)return delete e[t],void localStorage.removeItem(t);"object"!=typeof n?localStorage.setItem(t,n):localStorage.setItem(t,JSON.stringify(n))},a=new Proxy(e,{get:(e,n)=>(void 0===e[n]&&(e[n]=function(e){const n=localStorage.getItem(e);return null!==n?t.includes(e)?n:JSON.parse(n):i(e)}(n)),e[n]),set:(e,t,n)=>(e[t]=n,r(t,n),!0)});const o={pan:()=>0,playmode:e=>{switch(e){case 4096:return"gate";case 20480:return"group";case 28672:return"loop";default:return"oneshot"}},reverse:e=>24576===e,volume:()=>0,pitch:e=>(e||0!==e?Math.round(e/512/12):0)||0},s=(e,t,n,i=256)=>{if(!n)return t;const r=n.numberOfChannels>1;let a,o;for(let s=t??n.length;n.length>s;s--){if(s<e||s<t-i)return t;if(0==+n.getChannelData(0)[s].toFixed(4)||0===s){if(!1===r)return s;a=a||s,o=s}if((r&&0==+n.getChannelData(1)[s].toFixed(4)||0===s)&&o===s)return s}return a||t};function l(e,t){return{"fade.in":0,"fade.out":0,framecount:e.fc||e.e-e.s,gain:0,hikey:53+t,lokey:53+t,pan:o.pan(e.p),"pitch.keycenter":60,playmode:o.playmode(e.pm),reverse:o.reverse(e.r),sample:`${e.name||"slice_"+(t+1)}.wav`,"sample.end":e.e,"sample.start":e.s||0,transpose:o.pitch(e.st),tune:0}}function c(e,t=[],n=!1){const i=t.map((t=>({...t,fc:t.fc||t.e-t.s,e:s(t.s,t.e,t.buffer||e.buffer),name:(n?t.name||e.kitName:e.buffer?e.kitName:t.name)??""})));return{engine:{bendrange:8191,highpass:0,modulation:{aftertouch:{amount:16384,target:0},modwheel:{amount:16384,target:0},pitchbend:{amount:16384,target:0},velocity:{amount:16384,target:0}},params:Array.from({length:8}).fill(16384),playmode:"poly","portamento.amount":0,"portamento.type":32767,transpose:0,"tuning.root":0,"tuning.scale":0,"velocity.sensitivity":19660,volume:28505,width:0},envelope:{amp:{attack:0,decay:0,release:32767,sustain:32604},filter:{attack:0,decay:0,release:32767,sustain:32767}},fx:{active:!1,params:[22014,0,4423,0,0,32767,0,0],type:"z lowpass"},lfo:{active:!1,params:[14848,16384,19e3,16384,0,0,0,0],type:"tremolo"},octave:0,platform:"OP-XY",regions:i.map(l),type:"drum",version:4}}function f(e,t=3e3){const n=[...document.querySelectorAll("dialog")].find((e=>e.open))||document.body,i=document.createElement("div"),r=n.querySelectorAll(".toast");r.length>0&&r.forEach((e=>e.classList.add("fadeOutUp"))),i.classList.add("toast"),i.classList.add("fadeInDown"),i.innerHTML=e,n.appendChild(i),setTimeout((()=>{setTimeout((()=>i.remove()),500),i.classList.add("fadeOutUp")}),t)}async function u(e="message",t="",n={}){return"prompt"===e||"confirm"===e||"alert"===e?await new Promise((i=>{const r=document.querySelector("#dcDialog");r.innerHTML=`\n                <div class="content">\n                    <div class="prompt">${t}</div>\n                    <input\n                        style="display: ${"prompt"===e?"block":"none"};"\n                        type="${n.inputType??"text"}"\n                        class="prompt-input"\n                        value="${n.defaultValue??""}"\n                    >\n                    <div class="buttons-group">\n                        <button type="submit" class="prompt-ok">${n.okLabel??"OK"}</button>`+(n.centerLabel?`<button class="prompt-center button-outline" style="margin-left: 2rem;">${n.centerLabel}</button>`:"")+`<button class="prompt-cancel button-outline ${"alert"===e?"hidden":""}">${n.cancelLabel??"Cancel"}</button>\n                    </div>\n                </div>\n            `;const a=document.querySelector("#dcDialog .content .prompt-input"),o=document.querySelector("#dcDialog .content .prompt-cancel"),s=document.querySelector("#dcDialog .content .prompt-center"),l=document.querySelector("#dcDialog .content .prompt-ok");o.onclick=()=>{i(n.defaultValue??!1),r.close()},l.onclick=()=>{i("prompt"!==e||(a.value||"")),r.close()},s&&(s.onclick=()=>{i("prompt"===e?a.value||"":"center"),r.close()}),r.onkeydown=e=>{if("Escape"===e.code)return o.click();"Enter"===e.code&&setTimeout((()=>l.click()),100)},r.open||(r.showModal(),setTimeout((()=>"prompt"!==e?r.focus():(a.select(),void a.focus())),50))})):window.__TAURI__?await window.__TAURI__.dialog[e](t,n):await window[{message:"alert",ask:"prompt",confirm:"confirm",prompt:"prompt"}[e]](t)}function d(e,t){return{file:t?structuredClone(e.file):e.file,meta:t?structuredClone(e.meta):e.meta,buffer:{duration:e.buffer.duration,length:e.buffer.length,numberOfChannels:e.buffer.numberOfChannels,sampleRate:e.buffer.sampleRate,channel0:new Float32Array(e.buffer.getChannelData(0)),channel1:e.buffer.numberOfChannels>1&&new Float32Array(e.buffer.getChannelData(1))}}}function h(e,t,n=!1,i,r,a){let o=n?i.createBuffer(r,e.length,a):new Float32Array(e.length);if("S"===t&&e.numberOfChannels>1)for(let t=0;t<e.length;t++)(n?o.getChannelData(0):o)[t]=(e.getChannelData(0)[t]+e.getChannelData(1)[t])/2;else if("D"===t&&e.numberOfChannels>1)for(let t=0;t<e.length;t++)(n?o.getChannelData(0):o)[t]=(e.getChannelData(0)[t]-e.getChannelData(1)[t])/2;else{const i="R"===t&&e.numberOfChannels>1?1:0;for(let t=0;t<e.length;t++)(n?o.getChannelData(0):o)[t]=e.getChannelData(i)[t]}return o}function p(e,t,n,i,r){let a=0;t.forEach(((t,o)=>{const s=i?n:t.buffer.length;let l=h(t.buffer,t?.meta?.channel);if(r&&(o+1)%2==0)for(let t=0;t<s;t++)e.getChannelData(0)[a]=l[s-t]||0,a++;else for(let t=0;t<s;t++)e.getChannelData(0)[a]=l[t]||0,a++}))}function m(e,t,n,i,r){let a=0;t.forEach(((t,o)=>{const s=i?n:t.buffer.length;let l=[new Float32Array(t.buffer.length),new Float32Array(t.buffer.length)];for(let e=0;e<t.buffer.length;e++)l[0][e]=t.buffer.getChannelData(0)[e],l[1][e]=t.buffer.getChannelData(2===t.buffer.numberOfChannels?1:0)[e];if(r&&(o+1)%2==0)for(let t=0;t<s;t++)e.getChannelData(0)[a]=l[0][s-t]||0,e.getChannelData(1)[a]=l[1][s-t]||0,a++;else for(let t=0;t<s;t++)e.getChannelData(0)[a]=l[0][t]||0,e.getChannelData(1)[a]=l[1][t]||0,a++}))}function g(e,t){const n=e.length;if(!t||0===t)return e;const i=+t;for(let t=1;t<n-1;t++){const n=(e[t-1]+e[t+1])/2;Math.abs(e[t]-n)>i&&(e[t]=n)}return e}function b(e,t,n){const i=e.renderAt||n,r=new AudioContext({sampleRate:i,latencyHint:"interactive"});return digichain.bufferRateResampler({file:{sampleRate:i},meta:e,buffer:t},i,r)}function y(e,t,n,i,r,o=!1,l=!1,c=1,f=!1,u=!0,d=!1){const h=a.treatDualMonoStereoAsMono&&!t.editing&&!t.bypassStereoAsDualMono;let p;!t.editing&&t.renderAt&&(p=b(t,e,n),n=p.buffer.sampleRate,t=p.meta,e=p.buffer);let m,y=e.numberOfChannels,_=t?.float32||32===i?3:1;if(n*=c,t.channel&&1===r){if(y=1,"L"===t.channel&&(m=e.getChannelData(0)),"R"===t.channel&&(m=e.getChannelData(1)),"S"===t.channel){m=new Float32Array(e.length);for(let t=0;t<e.length;t++)m[t]=(e.getChannelData(0)[t]+e.getChannelData(1)[t])/2}if("D"===t.channel){m=new Float32Array(e.length);for(let t=0;t<e.length;t++)m[t]=(e.getChannelData(0)[t]-e.getChannelData(1)[t])/2}m=g(m,o)}else 2!==y||t.dualMono&&h?(y=1,m=g(e.getChannelData(0),o)):m=w(g(e.getChannelData(0),o),g(e.getChannelData(1),o));return l?function(e,t,n,i){let r=JSON.parse(JSON.stringify(i));function o(e){const t=e.numberOfChannels,n=e.sampleRate;let i;return i=2===t?w(e.getChannelData(0),e.getChannelData(1)):e.getChannelData(0),s(i,n,t)}function s(e,t,n){let i=2,o=e.length*i,s=o+8,c=4162+o-8,f=new ArrayBuffer(4162+e.length*i),u=new DataView(f);k(u,0,"FORM"),u.setInt32(4,c),k(u,8,"AIFF"),k(u,12,"COMM"),u.setInt32(16,18),u.setInt16(20,n),u.setInt32(22,e.length/n),u.setInt16(26,16),function(e,t,n=44100){const i=v(n);for(let n=0;n<10;n++)e.setUint8(t+n,i[n])}(u,28,t),k(u,38,"APPL"),u.setInt32(42,4100),k(u,46,"op-1"),l(u,r,50);let d=4146;k(u,d,"SSND"),u.setInt32(d+4,s),u.setInt32(d+8,0),u.setInt32(d+12,0),d+=16;const h=()=>a.ditherExports?(Math.random()-Math.random())/65536:0;for(let t=0;t<e.length;t++){const n=Math.max(-1,Math.min(1,e[t]+h()));u.setInt16(d,Math.round(32767*n)),d+=2}return{buffer:f,sampleRate:t}}function l(e,t,n){const i=JSON.stringify(t)+"\n",r=i.length%2==0?i:i+"\n";let a=4100-r.length-4;k(e,n,r),n+=r.length,a>0&&new Array(a).fill(32).forEach((t=>{e.setUint8(n,t),n++}))}return r.stereo=2===n,e.numberOfChannels?new DataView(o(e).buffer):s(e,t,n)}(m,n,y,function(e=[],t,n=!1,i=!1){const r=e?.length?{attack:new Array(24).fill(0),drum_version:2,dyna_env:[0,8192,0,8192,0,0,0,0],end:new Array(24).fill(0),fx_active:!1,fx_params:[8e3,8e3,8e3,8e3,8e3,8e3,8e3,8e3],fx_type:"delay",lfo_active:!1,lfo_params:[16e3,16e3,16e3,16e3,0,0,0,0],lfo_type:"tremolo",mtime:1682173750,name:"DigiChain Kit",octave:0,original_folder:"DigiChain",pan:new Array(24).fill(16384),pan_ab:new Array(24).fill(!1),pitch:new Array(24).fill(0),playmode:new Array(24).fill(12288),reverse:new Array(24).fill(8192),start:new Array(24).fill(0),stereo:2===t,type:"drum",volume:new Array(24).fill(8192)}:{adsr:[64,10746,32767,1e4,4e3,64,4e3,18021],base_freq:440,fade:0,fx_active:!1,fx_params:[8e3,8e3,8e3,8e3,8e3,8e3,8e3,8e3],fx_type:"delay",knobs:[0,0,0,8600,12e3,0,0,8192],lfo_active:!1,lfo_params:[16e3,0,0,16e3,0,0,0,0],lfo_type:"tremolo",mtime:1683144375,name:"DigiChain Sample",octave:0,original_folder:"DigiChain",stereo:2===t,synth_version:3,type:"sampler"};if(i)return r;const a=JSON.parse(JSON.stringify(r));if(!e?.length||0===e?.length)return a;const o=2147483646/(44100*(2===t?20:12)),l=e.map((e=>({p:e.p??16384,pab:e.pab||!1,st:(e.st>24576?24576:e.st<-24576?-24576:e.st)||0,pm:e.pm??12288,r:e.r??8192,s:Math.floor(e.s*o),e:Math.floor(s(e.s,e.e,n)*o)})));for(let e=0;e<24;e++){let t=l.shift();a.pan[e]=t.p,a.pan_ab[e]=t.pab,a.pitch[e]=t.st,a.playmode[e]=t.pm,a.reverse[e]=t.r,a.start[e]=t.s,a.end[e]=t.e,l.push(t)}return a}(t?.slices,y,e)):function(e,t,n,i,r,o,s,l=1,c=!1,f=!0,u=!1){const d=s&&Array.isArray(s)&&0!==s.length&&(s.length>1||1===s.length&&(0!==s[0].s||s[0].e<o));let h,p=r/8,m=i*p,g=[],b=36+e.length*p,y=44+e.length*p,v=0,w=d?1===l?s:s.map((e=>({n:e.n,s:Math.round(e.s/l),e:Math.round(e.e/l),l:e.l&&-1!==e.l?Math.round(e.l/l):-1}))):[];d&&(c&&(g=`{"sr": ${n}, "dcs":`+JSON.stringify(w)+"}",g=btoa(g),g=g.padEnd(g.length+g.length%4," "),y+=g.length+12,b+=g.length+12),f&&(v=12+24*s.length,y+=v,b+=v));h=new ArrayBuffer(y);let _=new DataView(h);k(_,0,"RIFF"),_.setUint32(4,b,!0),k(_,8,"WAVE"),k(_,12,"fmt "),_.setUint32(16,16,!0),_.setUint16(20,t,!0),_.setUint16(22,i,!0),_.setUint32(24,n,!0),_.setUint32(28,n*m,!0),_.setUint16(32,m,!0),_.setUint16(34,r,!0),k(_,36,"data"),_.setUint32(40,e.length*p,!0),16===r?function(e,t,n){const i=()=>a.ditherExports?(Math.random()-Math.random())/65536:0;for(let r=0;r<n.length;r++,t+=2){const a=Math.max(-1,Math.min(1,n[r]+i()));e.setInt16(t,a<0?32768*a:32767*a,!0)}}(_,44,e):24===r?function(e,t,n){const i=()=>a.ditherExports?(Math.random()-Math.random())/(1<<24):0;for(let r=0;r<n.length;r++,t+=3){const a=Math.floor(8388608*(n[r]+i())+.5);e.setInt24(t,a,!0)}}(_,44,e):8===r?function(e,t,n){const i=()=>a.ditherExports?(Math.random()-Math.random())/255:0;for(let r=0;r<n.length;r++,t++){const a=Math.floor(127*Math.max(-1,Math.min(1,n[r]+i()))+128);e.setInt8(t,a)}}(_,44,e):function(e,t,n){for(let i=0;i<n.length;i++,t+=4)e.setFloat32(t,n[i],!0)}(_,44,e);if(d&&(c&&(k(_,_.byteLength-(g.length+12)-v,"LIST"),_.setUint32(_.byteLength-(g.length+8)-v,g.length+4,!0),k(_,_.byteLength-(g.length+4)-v,"ISBJ"),k(_,_.byteLength-g.length-v,g)),f)){k(_,_.byteLength-v,"cue "),_.setUint32(_.byteLength-v+4,v-8,!0),_.setUint32(_.byteLength-v+8,s.length,!0);for(let e=0;e<s.length;e++){const t=12+24*e;_.setUint32(_.byteLength-v+t,e,!0),_.setUint32(_.byteLength-v+t+4,0,!0),k(_,_.byteLength-v+t+8,"data"),_.setUint32(_.byteLength-v+t+12,0,!0),_.setUint32(_.byteLength-v+t+16,0,!0),_.setUint32(_.byteLength-v+t+20,w[e].s,!0)}}return{buffer:h,sampleRate:n,slices:s&&w?s.map(((e,t)=>({...e,...w[t]||{}}))):[]}}(m,_,n,y,i,e.length,t?.slices,c,f,u,d)}function v(e){const t={8e3:[64,11,250,0,0,0,0,0,0,0],11025:[64,12,172,68,0,0,0,0,0,0],16e3:[64,12,250,0,0,0,0,0,0,0],22050:[64,13,172,68,0,0,0,0,0,0],32e3:[64,13,250,0,0,0,0,0,0,0],37800:[64,14,147,168,0,0,0,0,0,0],44056:[64,14,172,24,0,0,0,0,0,0],44100:[64,14,172,68,0,0,0,0,0,0],47250:[64,14,184,146,0,0,0,0,0,0],48e3:[64,14,187,128,0,0,0,0,0,0],5e4:[64,14,195,80,0,0,0,0,0,0],50400:[64,14,196,224,0,0,0,0,0,0],88200:[64,15,172,68,0,0,0,0,0,0],96e3:[64,15,187,128,0,0,0,0,0,0],176400:[64,16,172,68,0,0,0,0,0,0],192e3:[64,16,187,128,0,0,0,0,0,0],352800:[64,17,172,68,0,0,0,0,0,0],2822400:[64,20,172,68,0,0,0,0,0,0],5644800:[64,21,172,68,0,0,0,0,0,0]};if("number"==typeof e)return t[e]??!1;if(Array.isArray(e)&&10===e.length)for(let n in t)if(t[n].every(((t,n)=>t===e[n])))return+n}function w(e,t){for(var n=e.length+t.length,i=new Float32Array(n),r=0,a=0;r<n;)i[r++]=e[a],i[r++]=t[a],a++;return i}function k(e,t,n){for(let i=0;i<n.length;i++)e.setUint8(t+i,n.charCodeAt(i))}function _(e,t,n,i){if(this.fromSampleRate=+e,this.toSampleRate=+t,this.channels=0|n,"object"!=typeof i)throw new Error("inputBuffer is not an object.");if(!(i instanceof Array||i instanceof Float32Array||i instanceof Float64Array))throw new Error("inputBuffer is not an array or a float32 or a float64 array.");this.inputBuffer=i,this.initialize()}function S(e,t=""){return new Promise(((n,i)=>{const r=new window.OfflineAudioContext(2,1323e3,44100);r.oncomplete=function(e){const t=e.renderedBuffer,i=function(e){const t=[];return e.forEach(((n,i)=>{for(let r=1;i+r<e.length&&r<10;r++){const a={tempo:2646e3/(e[i+r].position-n.position),count:1};for(;a.tempo<90;)a.tempo*=2;for(;a.tempo>180;)a.tempo/=2;a.tempo=Math.round(a.tempo),t.some((e=>e.tempo===a.tempo?e.count++:0))||t.push(a)}})),t}(function(e){let t=22050,n=e[0].length/t,i=[];for(let r=0;r<n;r++){let n=0;for(let i=r*t;i<(r+1)*t;i++){let t=Math.max(Math.abs(e[0][i]),Math.abs(e[1][i]));(!n||t>n.volume)&&(n={position:i,volume:t})}i.push(n)}return i.sort(((e,t)=>t.volume-e.volume)),i=i.splice(0,.5*i.length),i.sort(((e,t)=>e.position-t.position)),i}([t.getChannelData(0),t.getChannelData(1)])).sort((function(e,t){return t.count-e.count})).splice(0,5);n({match:Math.round(i[1].tempo>i[0].tempo?i[1].tempo:i[0].tempo),alternatives:i})},function(e){const i=t.match(/(?:^|[\s-_])(\d+)(?![0-9])/g);if(i&&i[0]){const e=parseInt(i[0].replace(/[^0-9]/g,""));if(e&&e>0)return void n({match:e,alternatives:[]})}const a=r.createBufferSource();a.buffer=e;const o=r.createBiquadFilter();o.type="lowpass",o.frequency.value=150,o.Q.value=1,a.connect(o);const s=r.createBiquadFilter();s.type="highpass",s.frequency.value=100,s.Q.value=1,o.connect(s),s.connect(r.destination),a.start(0),r.startRendering()}(e)}))}function C(e="Loading",t){const n=document.getElementById("loadingText");if(!e)return n.textContent="Loading",void document.body.classList.remove("loading");n.textContent=e,document.body.classList.add("loading"),t&&setTimeout((()=>document.body.classList.remove("loading")),parseInt(t))}var E,x;DataView.prototype.setInt24=function(e,t,n){this.setInt8(e,255&t,n),this.setInt16(e+1,t>>8,n)},_.prototype.initialize=function(){if(!(this.fromSampleRate>0&&this.toSampleRate>0&&this.channels>0))throw new Error("Invalid settings specified for the resampler.");this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1,this.outputBuffer=this.inputBuffer):(this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.initializeBuffers())},_.prototype.compileLinearInterpolationFunction=function(){for(var e="var outputOffset = 0;    if (bufferLength > 0) {        var buffer = this.inputBuffer;        var weight = this.lastWeight;        var firstWeight = 0;        var secondWeight = 0;        var sourceOffset = 0;        var outputOffset = 0;        var outputBuffer = this.outputBuffer;        for (; weight < 1; weight += "+this.ratioWeight+") {            secondWeight = weight % 1;            firstWeight = 1 - secondWeight;",t=0;t<this.channels;++t)e+="outputBuffer[outputOffset++] = (this.lastOutput["+t+"] * firstWeight) + (buffer["+t+"] * secondWeight);";e+="}        weight -= 1;        for (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; sourceOffset < bufferLength;) {            secondWeight = weight % 1;            firstWeight = 1 - secondWeight;";for(t=0;t<this.channels;++t)e+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(t>0?" + "+t:"")+"] * firstWeight) + (buffer[sourceOffset + "+(this.channels+t)+"] * secondWeight);";e+="weight += "+this.ratioWeight+";            sourceOffset = Math.floor(weight) * "+this.channels+";        }";for(t=0;t<this.channels;++t)e+="this.lastOutput["+t+"] = buffer[sourceOffset++];";e+="this.lastWeight = weight % 1;    }    return outputOffset;",this.resampler=Function("bufferLength",e)},_.prototype.compileMultiTapFunction=function(){for(var e="var outputOffset = 0;    if (bufferLength > 0) {        var buffer = this.inputBuffer;        var weight = 0;",t=0;t<this.channels;++t)e+="var output"+t+" = 0;";for(e+="var actualPosition = 0;        var amountToNext = 0;        var alreadyProcessedTail = !this.tailExists;        this.tailExists = false;        var outputBuffer = this.outputBuffer;        var currentPosition = 0;        do {            if (alreadyProcessedTail) {                weight = "+this.ratioWeight+";",t=0;t<this.channels;++t)e+="output"+t+" = 0;";for(e+="}            else {                weight = this.lastWeight;",t=0;t<this.channels;++t)e+="output"+t+" = this.lastOutput["+t+"];";for(e+="alreadyProcessedTail = true;            }            while (weight > 0 && actualPosition < bufferLength) {                amountToNext = 1 + actualPosition - currentPosition;                if (weight >= amountToNext) {",t=0;t<this.channels;++t)e+="output"+t+" += buffer[actualPosition++] * amountToNext;";for(e+="currentPosition = actualPosition;                    weight -= amountToNext;                }                else {",t=0;t<this.channels;++t)e+="output"+t+" += buffer[actualPosition"+(t>0?" + "+t:"")+"] * weight;";for(e+="currentPosition += weight;                    weight = 0;                    break;                }            }            if (weight <= 0) {",t=0;t<this.channels;++t)e+="outputBuffer[outputOffset++] = output"+t+" / "+this.ratioWeight+";";for(e+="}            else {                this.lastWeight = weight;",t=0;t<this.channels;++t)e+="this.lastOutput["+t+"] = output"+t+";";e+="this.tailExists = true;                break;            }        } while (actualPosition < bufferLength);    }    return outputOffset;",this.resampler=Function("bufferLength",e)},_.prototype.bypassResampler=function(e){return e},_.prototype.initializeBuffers=function(){var e=Math.ceil(this.inputBuffer.length*this.toSampleRate/this.fromSampleRate/this.channels*1.0000004768371582)*this.channels+this.channels;try{this.outputBuffer=new Float32Array(e),this.lastOutput=new Float32Array(this.channels)}catch(e){this.outputBuffer=[],this.lastOutput=[]}},CanvasRenderingContext2D.prototype.clear=CanvasRenderingContext2D.prototype.clear||function(e){e&&(this.save(),this.setTransform(1,0,0,1,0,0)),this.clearRect(0,0,this.canvas.width,this.canvas.height),this.beginPath(),e&&this.restore()},Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;const t=this.parentElement,n=window.getComputedStyle(t,null),i=parseInt(n.getPropertyValue("border-top-width")),r=parseInt(n.getPropertyValue("border-left-width")),a=this.offsetTop-t.offsetTop<t.scrollTop,o=this.offsetTop-t.offsetTop+this.clientHeight-i>t.scrollTop+t.clientHeight,s=this.offsetLeft-t.offsetLeft<t.scrollLeft,l=this.offsetLeft-t.offsetLeft+this.clientWidth-r>t.scrollLeft+t.clientWidth,c=a&&!o;(a||o)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-i+this.clientHeight/2),(s||l)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-r+this.clientWidth/2),(a||o||s||l)&&!e&&this.scrollIntoView(c)})
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */,E=void 0,x=function(e){var t=(e,t,n,i)=>{let r=65535&e|0,a=e>>>16&65535|0,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{r=r+t[i++]|0,a=a+r|0}while(--o);r%=65521,a%=65521}return r|a<<16|0};const n=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var i=(e,t,i,r)=>{const a=n,o=r+i;e^=-1;for(let n=r;n<o;n++)e=e>>>8^a[255&(e^t[n])];return-1^e};const r=16209;var a=function(e,t){let n,i,a,o,s,l,c,f,u,d,h,p,m,g,b,y,v,w,k,_,S,C,E,x;const A=e.state;n=e.next_in,E=e.input,i=n+(e.avail_in-5),a=e.next_out,x=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=A.dmax,c=A.wsize,f=A.whave,u=A.wnext,d=A.window,h=A.hold,p=A.bits,m=A.lencode,g=A.distcode,b=(1<<A.lenbits)-1,y=(1<<A.distbits)-1;e:do{p<15&&(h+=E[n++]<<p,p+=8,h+=E[n++]<<p,p+=8),v=m[h&b];t:for(;;){if(w=v>>>24,h>>>=w,p-=w,w=v>>>16&255,0===w)x[a++]=65535&v;else{if(!(16&w)){if(0==(64&w)){v=m[(65535&v)+(h&(1<<w)-1)];continue t}if(32&w){A.mode=16191;break e}e.msg="invalid literal/length code",A.mode=r;break e}k=65535&v,w&=15,w&&(p<w&&(h+=E[n++]<<p,p+=8),k+=h&(1<<w)-1,h>>>=w,p-=w),p<15&&(h+=E[n++]<<p,p+=8,h+=E[n++]<<p,p+=8),v=g[h&y];n:for(;;){if(w=v>>>24,h>>>=w,p-=w,w=v>>>16&255,!(16&w)){if(0==(64&w)){v=g[(65535&v)+(h&(1<<w)-1)];continue n}e.msg="invalid distance code",A.mode=r;break e}if(_=65535&v,w&=15,p<w&&(h+=E[n++]<<p,p+=8,p<w&&(h+=E[n++]<<p,p+=8)),_+=h&(1<<w)-1,_>l){e.msg="invalid distance too far back",A.mode=r;break e}if(h>>>=w,p-=w,w=a-o,_>w){if(w=_-w,w>f&&A.sane){e.msg="invalid distance too far back",A.mode=r;break e}if(S=0,C=d,0===u){if(S+=c-w,w<k){k-=w;do{x[a++]=d[S++]}while(--w);S=a-_,C=x}}else if(u<w){if(S+=c+u-w,w-=u,w<k){k-=w;do{x[a++]=d[S++]}while(--w);if(S=0,u<k){w=u,k-=w;do{x[a++]=d[S++]}while(--w);S=a-_,C=x}}}else if(S+=u-w,w<k){k-=w;do{x[a++]=d[S++]}while(--w);S=a-_,C=x}for(;k>2;)x[a++]=C[S++],x[a++]=C[S++],x[a++]=C[S++],k-=3;k&&(x[a++]=C[S++],k>1&&(x[a++]=C[S++]))}else{S=a-_;do{x[a++]=x[S++],x[a++]=x[S++],x[a++]=x[S++],k-=3}while(k>2);k&&(x[a++]=x[S++],k>1&&(x[a++]=x[S++]))}break}}break}}while(n<i&&a<s);k=p>>3,n-=k,p-=k<<3,h&=(1<<p)-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<s?s-a+257:257-(a-s),A.hold=h,A.bits=p};const o=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),s=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),l=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),c=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var f=(e,t,n,i,r,a,f,u)=>{const d=u.bits;let h,p,m,g,b,y,v=0,w=0,k=0,_=0,S=0,C=0,E=0,x=0,A=0,D=0,R=null;const B=new Uint16Array(16),P=new Uint16Array(16);let O,L,I,T=null;for(v=0;v<=15;v++)B[v]=0;for(w=0;w<i;w++)B[t[n+w]]++;for(S=d,_=15;_>=1&&0===B[_];_--);if(S>_&&(S=_),0===_)return r[a++]=20971520,r[a++]=20971520,u.bits=1,0;for(k=1;k<_&&0===B[k];k++);for(S<k&&(S=k),x=1,v=1;v<=15;v++)if(x<<=1,x-=B[v],x<0)return-1;if(x>0&&(0===e||1!==_))return-1;for(P[1]=0,v=1;v<15;v++)P[v+1]=P[v]+B[v];for(w=0;w<i;w++)0!==t[n+w]&&(f[P[t[n+w]]++]=w);if(0===e?(R=T=f,y=20):1===e?(R=o,T=s,y=257):(R=l,T=c,y=0),D=0,w=0,v=k,b=a,C=S,E=0,m=-1,A=1<<S,g=A-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){O=v-E,f[w]+1<y?(L=0,I=f[w]):f[w]>=y?(L=T[f[w]-y],I=R[f[w]-y]):(L=96,I=0),h=1<<v-E,p=1<<C,k=p;do{p-=h,r[b+(D>>E)+p]=O<<24|L<<16|I|0}while(0!==p);for(h=1<<v-1;D&h;)h>>=1;if(0!==h?(D&=h-1,D+=h):D=0,w++,0==--B[v]){if(v===_)break;v=t[n+f[w]]}if(v>S&&(D&g)!==m){for(0===E&&(E=S),b+=k,C=v-E,x=1<<C;C+E<_&&(x-=B[C+E],!(x<=0));)C++,x<<=1;if(A+=1<<C,1===e&&A>852||2===e&&A>592)return 1;m=D&g,r[m]=S<<24|C<<16|b-a|0}}return 0!==D&&(r[b+D]=v-E<<24|64<<16|0),u.bits=S,0},u={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{Z_FINISH:d,Z_BLOCK:h,Z_TREES:p,Z_OK:m,Z_STREAM_END:g,Z_NEED_DICT:b,Z_STREAM_ERROR:y,Z_DATA_ERROR:v,Z_MEM_ERROR:w,Z_BUF_ERROR:k,Z_DEFLATED:_}=u,S=16180,C=16190,E=16191,x=16192,A=16194,D=16199,R=16200,B=16206,P=16209,O=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function L(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const I=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<S||t.mode>16211?1:0},T=e=>{if(I(e))return y;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=S,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,m},U=e=>{if(I(e))return y;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,T(e)},F=(e,t)=>{let n;if(I(e))return y;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?y:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,U(e))},$=(e,t)=>{if(!e)return y;const n=new L;e.state=n,n.strm=e,n.window=null,n.mode=S;const i=F(e,t);return i!==m&&(e.state=null),i};let M,N,z=!0;const K=e=>{if(z){M=new Int32Array(512),N=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(f(1,e.lens,0,288,M,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;f(2,e.lens,0,32,N,0,e.work,{bits:5}),z=!1}e.lencode=M,e.lenbits=9,e.distcode=N,e.distbits=5},W=(e,t,n,i)=>{let r;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>i&&(r=i),a.window.set(t.subarray(n-i,n-i+r),a.wnext),(i-=r)?(a.window.set(t.subarray(n-i,n),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0};var j={inflateReset:U,inflateReset2:F,inflateResetKeep:T,inflateInit:e=>$(e,15),inflateInit2:$,inflate:(e,n)=>{let r,o,s,l,c,u,L,T,U,F,$,M,N,z,j,q,Z,H,Y,J,G,V,X=0;const Q=new Uint8Array(4);let ee,te;const ne=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(I(e)||!e.output||!e.input&&0!==e.avail_in)return y;r=e.state,r.mode===E&&(r.mode=x),c=e.next_out,s=e.output,L=e.avail_out,l=e.next_in,o=e.input,u=e.avail_in,T=r.hold,U=r.bits,F=u,$=L,V=m;e:for(;;)switch(r.mode){case S:if(0===r.wrap){r.mode=x;break}for(;U<16;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}if(2&r.wrap&&35615===T){0===r.wbits&&(r.wbits=15),r.check=0,Q[0]=255&T,Q[1]=T>>>8&255,r.check=i(r.check,Q,2,0),T=0,U=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&T)<<8)+(T>>8))%31){e.msg="incorrect header check",r.mode=P;break}if((15&T)!==_){e.msg="unknown compression method",r.mode=P;break}if(T>>>=4,U-=4,G=8+(15&T),0===r.wbits&&(r.wbits=G),G>15||G>r.wbits){e.msg="invalid window size",r.mode=P;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&T?16189:E,T=0,U=0;break;case 16181:for(;U<16;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}if(r.flags=T,(255&r.flags)!==_){e.msg="unknown compression method",r.mode=P;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=P;break}r.head&&(r.head.text=T>>8&1),512&r.flags&&4&r.wrap&&(Q[0]=255&T,Q[1]=T>>>8&255,r.check=i(r.check,Q,2,0)),T=0,U=0,r.mode=16182;case 16182:for(;U<32;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}r.head&&(r.head.time=T),512&r.flags&&4&r.wrap&&(Q[0]=255&T,Q[1]=T>>>8&255,Q[2]=T>>>16&255,Q[3]=T>>>24&255,r.check=i(r.check,Q,4,0)),T=0,U=0,r.mode=16183;case 16183:for(;U<16;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}r.head&&(r.head.xflags=255&T,r.head.os=T>>8),512&r.flags&&4&r.wrap&&(Q[0]=255&T,Q[1]=T>>>8&255,r.check=i(r.check,Q,2,0)),T=0,U=0,r.mode=16184;case 16184:if(1024&r.flags){for(;U<16;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}r.length=T,r.head&&(r.head.extra_len=T),512&r.flags&&4&r.wrap&&(Q[0]=255&T,Q[1]=T>>>8&255,r.check=i(r.check,Q,2,0)),T=0,U=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(M=r.length,M>u&&(M=u),M&&(r.head&&(G=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(o.subarray(l,l+M),G)),512&r.flags&&4&r.wrap&&(r.check=i(r.check,o,M,l)),u-=M,l+=M,r.length-=M),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===u)break e;M=0;do{G=o[l+M++],r.head&&G&&r.length<65536&&(r.head.name+=String.fromCharCode(G))}while(G&&M<u);if(512&r.flags&&4&r.wrap&&(r.check=i(r.check,o,M,l)),u-=M,l+=M,G)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===u)break e;M=0;do{G=o[l+M++],r.head&&G&&r.length<65536&&(r.head.comment+=String.fromCharCode(G))}while(G&&M<u);if(512&r.flags&&4&r.wrap&&(r.check=i(r.check,o,M,l)),u-=M,l+=M,G)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;U<16;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}if(4&r.wrap&&T!==(65535&r.check)){e.msg="header crc mismatch",r.mode=P;break}T=0,U=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=E;break;case 16189:for(;U<32;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}e.adler=r.check=O(T),T=0,U=0,r.mode=C;case C:if(0===r.havedict)return e.next_out=c,e.avail_out=L,e.next_in=l,e.avail_in=u,r.hold=T,r.bits=U,b;e.adler=r.check=1,r.mode=E;case E:if(n===h||n===p)break e;case x:if(r.last){T>>>=7&U,U-=7&U,r.mode=B;break}for(;U<3;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}switch(r.last=1&T,T>>>=1,U-=1,3&T){case 0:r.mode=16193;break;case 1:if(K(r),r.mode=D,n===p){T>>>=2,U-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=P}T>>>=2,U-=2;break;case 16193:for(T>>>=7&U,U-=7&U;U<32;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}if((65535&T)!=(T>>>16^65535)){e.msg="invalid stored block lengths",r.mode=P;break}if(r.length=65535&T,T=0,U=0,r.mode=A,n===p)break e;case A:r.mode=16195;case 16195:if(M=r.length,M){if(M>u&&(M=u),M>L&&(M=L),0===M)break e;s.set(o.subarray(l,l+M),c),u-=M,l+=M,L-=M,c+=M,r.length-=M;break}r.mode=E;break;case 16196:for(;U<14;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}if(r.nlen=257+(31&T),T>>>=5,U-=5,r.ndist=1+(31&T),T>>>=5,U-=5,r.ncode=4+(15&T),T>>>=4,U-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=P;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;U<3;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}r.lens[ne[r.have++]]=7&T,T>>>=3,U-=3}for(;r.have<19;)r.lens[ne[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,ee={bits:r.lenbits},V=f(0,r.lens,0,19,r.lencode,0,r.work,ee),r.lenbits=ee.bits,V){e.msg="invalid code lengths set",r.mode=P;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;X=r.lencode[T&(1<<r.lenbits)-1],j=X>>>24,q=X>>>16&255,Z=65535&X,!(j<=U);){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}if(Z<16)T>>>=j,U-=j,r.lens[r.have++]=Z;else{if(16===Z){for(te=j+2;U<te;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}if(T>>>=j,U-=j,0===r.have){e.msg="invalid bit length repeat",r.mode=P;break}G=r.lens[r.have-1],M=3+(3&T),T>>>=2,U-=2}else if(17===Z){for(te=j+3;U<te;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}T>>>=j,U-=j,G=0,M=3+(7&T),T>>>=3,U-=3}else{for(te=j+7;U<te;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}T>>>=j,U-=j,G=0,M=11+(127&T),T>>>=7,U-=7}if(r.have+M>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=P;break}for(;M--;)r.lens[r.have++]=G}}if(r.mode===P)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=P;break}if(r.lenbits=9,ee={bits:r.lenbits},V=f(1,r.lens,0,r.nlen,r.lencode,0,r.work,ee),r.lenbits=ee.bits,V){e.msg="invalid literal/lengths set",r.mode=P;break}if(r.distbits=6,r.distcode=r.distdyn,ee={bits:r.distbits},V=f(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,ee),r.distbits=ee.bits,V){e.msg="invalid distances set",r.mode=P;break}if(r.mode=D,n===p)break e;case D:r.mode=R;case R:if(u>=6&&L>=258){e.next_out=c,e.avail_out=L,e.next_in=l,e.avail_in=u,r.hold=T,r.bits=U,a(e,$),c=e.next_out,s=e.output,L=e.avail_out,l=e.next_in,o=e.input,u=e.avail_in,T=r.hold,U=r.bits,r.mode===E&&(r.back=-1);break}for(r.back=0;X=r.lencode[T&(1<<r.lenbits)-1],j=X>>>24,q=X>>>16&255,Z=65535&X,!(j<=U);){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}if(q&&0==(240&q)){for(H=j,Y=q,J=Z;X=r.lencode[J+((T&(1<<H+Y)-1)>>H)],j=X>>>24,q=X>>>16&255,Z=65535&X,!(H+j<=U);){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}T>>>=H,U-=H,r.back+=H}if(T>>>=j,U-=j,r.back+=j,r.length=Z,0===q){r.mode=16205;break}if(32&q){r.back=-1,r.mode=E;break}if(64&q){e.msg="invalid literal/length code",r.mode=P;break}r.extra=15&q,r.mode=16201;case 16201:if(r.extra){for(te=r.extra;U<te;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}r.length+=T&(1<<r.extra)-1,T>>>=r.extra,U-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;X=r.distcode[T&(1<<r.distbits)-1],j=X>>>24,q=X>>>16&255,Z=65535&X,!(j<=U);){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}if(0==(240&q)){for(H=j,Y=q,J=Z;X=r.distcode[J+((T&(1<<H+Y)-1)>>H)],j=X>>>24,q=X>>>16&255,Z=65535&X,!(H+j<=U);){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}T>>>=H,U-=H,r.back+=H}if(T>>>=j,U-=j,r.back+=j,64&q){e.msg="invalid distance code",r.mode=P;break}r.offset=Z,r.extra=15&q,r.mode=16203;case 16203:if(r.extra){for(te=r.extra;U<te;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}r.offset+=T&(1<<r.extra)-1,T>>>=r.extra,U-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=P;break}r.mode=16204;case 16204:if(0===L)break e;if(M=$-L,r.offset>M){if(M=r.offset-M,M>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=P;break}M>r.wnext?(M-=r.wnext,N=r.wsize-M):N=r.wnext-M,M>r.length&&(M=r.length),z=r.window}else z=s,N=c-r.offset,M=r.length;M>L&&(M=L),L-=M,r.length-=M;do{s[c++]=z[N++]}while(--M);0===r.length&&(r.mode=R);break;case 16205:if(0===L)break e;s[c++]=r.length,L--,r.mode=R;break;case B:if(r.wrap){for(;U<32;){if(0===u)break e;u--,T|=o[l++]<<U,U+=8}if($-=L,e.total_out+=$,r.total+=$,4&r.wrap&&$&&(e.adler=r.check=r.flags?i(r.check,s,$,c-$):t(r.check,s,$,c-$)),$=L,4&r.wrap&&(r.flags?T:O(T))!==r.check){e.msg="incorrect data check",r.mode=P;break}T=0,U=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;U<32;){if(0===u)break e;u--,T+=o[l++]<<U,U+=8}if(4&r.wrap&&T!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=P;break}T=0,U=0}r.mode=16208;case 16208:V=g;break e;case P:V=v;break e;case 16210:return w;default:return y}return e.next_out=c,e.avail_out=L,e.next_in=l,e.avail_in=u,r.hold=T,r.bits=U,(r.wsize||$!==e.avail_out&&r.mode<P&&(r.mode<B||n!==d))&&W(e,e.output,e.next_out,$-e.avail_out),F-=e.avail_in,$-=e.avail_out,e.total_in+=F,e.total_out+=$,r.total+=$,4&r.wrap&&$&&(e.adler=r.check=r.flags?i(r.check,s,$,e.next_out-$):t(r.check,s,$,e.next_out-$)),e.data_type=r.bits+(r.last?64:0)+(r.mode===E?128:0)+(r.mode===D||r.mode===A?256:0),(0===F&&0===$||n===d)&&V===m&&(V=k),V},inflateEnd:e=>{if(I(e))return y;let t=e.state;return t.window&&(t.window=null),e.state=null,m},inflateGetHeader:(e,t)=>{if(I(e))return y;const n=e.state;return 0==(2&n.wrap)?y:(n.head=t,t.done=!1,m)},inflateSetDictionary:(e,n)=>{const i=n.length;let r,a,o;return I(e)?y:(r=e.state,0!==r.wrap&&r.mode!==C?y:r.mode===C&&(a=1,a=t(a,n,i,0),a!==r.check)?v:(o=W(e,n,i,i),o?(r.mode=16210,w):(r.havedict=1,m)))},inflateInfo:"pako inflate (from Nodeca project)"};const q=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Z=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)q(n,t)&&(e[t]=n[t])}}return e};let H=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){H=!1}const Y=new Uint8Array(256);for(let e=0;e<256;e++)Y[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Y[254]=Y[254]=1;var J=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,i,r,a,o=e.length,s=0;for(r=0;r<o;r++)n=e.charCodeAt(r),55296==(64512&n)&&r+1<o&&(i=e.charCodeAt(r+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,r=0;a<s;r++)n=e.charCodeAt(r),55296==(64512&n)&&r+1<o&&(i=e.charCodeAt(r+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},G=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,r;const a=new Array(2*n);for(r=0,i=0;i<n;){let t=e[i++];if(t<128){a[r++]=t;continue}let o=Y[t];if(o>4)a[r++]=65533,i+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&i<n;)t=t<<6|63&e[i++],o--;o>1?a[r++]=65533:t<65536?a[r++]=t:(t-=65536,a[r++]=55296|t>>10&1023,a[r++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&H)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n})(a,r)},V=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Y[e[n]]>t?n:t},X={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Q=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},ee=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const te=Object.prototype.toString,{Z_NO_FLUSH:ne,Z_FINISH:ie,Z_OK:re,Z_STREAM_END:ae,Z_NEED_DICT:oe,Z_STREAM_ERROR:se,Z_DATA_ERROR:le,Z_MEM_ERROR:ce}=u;function fe(e){this.options=Z({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;let n=j.inflateInit2(this.strm,t.windowBits);if(n!==re)throw new Error(X[n]);if(this.header=new ee,j.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=J(t.dictionary):"[object ArrayBuffer]"===te.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=j.inflateSetDictionary(this.strm,t.dictionary),n!==re)))throw new Error(X[n])}function ue(e,t){const n=new fe(t);if(n.push(e),n.err)throw n.msg||X[n.err];return n.result}fe.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let a,o,s;if(this.ended)return!1;for(o=t===~~t?t:!0===t?ie:ne,"[object ArrayBuffer]"===te.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),a=j.inflate(n,o),a===oe&&r&&(a=j.inflateSetDictionary(n,r),a===re?a=j.inflate(n,o):a===le&&(a=oe));n.avail_in>0&&a===ae&&n.state.wrap>0&&0!==e[n.next_in];)j.inflateReset(n),a=j.inflate(n,o);switch(a){case se:case le:case oe:case ce:return this.onEnd(a),this.ended=!0,!1}if(s=n.avail_out,n.next_out&&(0===n.avail_out||a===ae))if("string"===this.options.to){let e=V(n.output,n.next_out),t=n.next_out-e,r=G(n.output,e);n.next_out=t,n.avail_out=i-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(r)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==re||0!==s){if(a===ae)return a=j.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},fe.prototype.onData=function(e){this.chunks.push(e)},fe.prototype.onEnd=function(e){e===re&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=(e=>{let t=0;for(let n=0,i=e.length;n<i;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,i=0,r=e.length;t<r;t++){let r=e[t];n.set(r,i),i+=r.length}return n})(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var de=fe,he=ue,pe=function(e,t){return(t=t||{}).raw=!0,ue(e,t)},me=ue,ge=u,be={Inflate:de,inflate:he,inflateRaw:pe,ungzip:me,constants:ge};e.Inflate=de,e.constants=ge,e.default=be,e.inflate=he,e.inflateRaw=pe,e.ungzip=me,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?x(exports):"function"==typeof define&&define.amd?define(["exports"],x):x((E="undefined"!=typeof globalThis?globalThis:E||self).pako={});const A=document.getElementById("editPanel"),D=document.getElementById("editableItems"),R=document.getElementById("editorPanelContent"),B=document.getElementById("opExportPanel"),P=document.getElementById("opExportPanelContent"),O=document.querySelector(".right-buttons"),L=e=>e.replaceAll(/[\[\{<]/g,"(").replaceAll(/[\]\}>]/g,")").replaceAll(/[^a-zA-Z0-9\s#\-\(\)]/g,"-").replaceAll(/-{3,}/g,"-");let I,T,U=1,F={start:0,end:0,step:0,selStart:!0},$=!1,M=!1,N=[],z=[],K=Array.from({length:24}).map((e=>({})));function W(e){T=e}function j(e,t,n="sample",i=[],r,a){if(T=t,N=i,"sample"===n)return I&&I.meta&&(I.meta.editing=!1),I=e,U=1,F.end=a||I.buffer.length,F.start=r||0,F.step=I.buffer.length/(1024*U),F.selStart=!0,$=T.masterChannels>1,I.meta.editing=!0,void q();"opExport"===n&&(z.selected=!1,z.find((e=>e?.buffer?.channel0))&&z.forEach((e=>{if(!e?.buffer?.channel0)return;const t=T.audioCtx.createBuffer(e.buffer.numberOfChannels,e.buffer.length,T.masterSR);t.copyToChannel(e.buffer.channel0,0),2===e.buffer.numberOfChannels&&t.copyToChannel(e.buffer.channel1,1),e.buffer=t})),Q(),B.classList.add("show"),O.classList.add("fade"))}function q(){D.innerHTML=`\n      <div class="input-set">\n      <label for="editFileName" class="before-input">File Name</label>\n      <input type="text" onkeyup="digichain.editor.updateFile(event)" placeholder="Sample file name" id="editFileName" value="${se("",I,!0)}" readonly>\n      <button class="button-clear" onpointerdown="digichain.editor.toggleReadOnlyInput('editFileName')"><i class="gg-pen"></i></button>\n    </div><br>\n    <div class="input-set" style="display: ${I.meta.opKey?"none":"flex"};">\n    <label for="editFilePath" class="before-input">File Path</label>\n      <input type="text" onkeyup="digichain.editor.updateFile(event)" placeholder="File path of the sample (if known)" id="editFilePath" value="${I.file.path}" id="editFilePath" list="folderOptions" readonly>\n      <datalist id="folderOptions">\n        ${N.map((e=>'<option value="'+e+'">')).join("")}\n      </datalist>\n      <button class="button-clear" onpointerdown="digichain.editor.toggleReadOnlyInput('editFilePath')"><i class="gg-pen"></i></button>\n    </div>\n  `,ie(I),ue(),A.open||A.showModal(),re(),ae()}function Z(e){const t=z.find((t=>t.meta.opKeyId===e&&-1===t.meta.opKeyPosition)),n=z.find((t=>t.meta.opKeyId===e&&0===t.meta.opKeyPosition)),i=z.find((t=>t.meta.opKeyId===e&&1===t.meta.opKeyPosition));return{center:t,left:n,right:i,hasData:!!(t||n||i),length:Math.max(t?.buffer?.length??0,n?.buffer?.length??0,i?.buffer?.length??0)}}function H(e,t=[]){z.map(((n,i)=>!(n.meta.opKeyId!==e||!t.includes(n.meta.opKeyPosition))&&i)).filter((e=>!1!==e)).forEach((e=>z.splice(e,1))),Q()}function Y(){const e=z.reduce(((e,t)=>(e[t.meta.opKeyId]=e[t.meta.opKeyId]||0,e[t.meta.opKeyId]=e[t.meta.opKeyId]>t.buffer.length?e[t.meta.opKeyId]:t.buffer.length,e)),{});z.buffersLength=Object.keys(e).reduce(((t,n)=>t+e[n]),0),z.maxBuffersLength=z.buffersLength<882e3&&!z.xyMultiOut?882e3:21168e3,z.isXyOnly=z.buffersLength>882e3}async function J(e,t,n=-1){e?.target?.classList?.remove("drag-over"),-1!==n&&e.stopPropagation&&e?.stopPropagation();const i=e.buffer?e:digichain.lastSelectedFile();if(!i)return;if(i.meta.duration>20)return void await u("alert",`Skipping sample '${i.file.filename}' as it is ${i.meta.duration} seconds in length, samples must be less than 20 seconds.`);const r={...i,file:{...i.file},meta:{...i.meta}},a=b(r.meta,i.buffer,44100);a.file={...r.file,...a.file},a.meta.opKey={},a.meta.channel=a.buffer.numberOfChannels>1?"S":a.meta.channel,a.meta.opKeyId=t,a.meta.opKeyPosition=n,function(e,t,n){const i=z.findIndex((n=>n.meta.opKeyId===e&&n.meta.opKeyPosition===t));-1!==i?z[i]=n:z.push(n),Y()}(t,n,a),be(e,z,[a]),K[t].linkedTo=!1,a.meta.opPitch&&(K[t].st=a.meta.opPitch),a.meta.opPan&&(K[t].p=a.meta.opPan),a.meta.opPanAb&&(K[t].pab=a.meta.opPanAb),Q()}function G(e,t){const n=Z(t),i=se("",n?.center,!0),r=se("",n?.left,!0),a=se("",n?.right,!0);return`\n    <div class="op-key ${e} key-${t} ${z.selected===t?"selected":""}"\n         ondragenter="this.classList.add('drag-over')"\n         ondragleave="this.classList.remove('drag-over')"\n         data-has-data="${n.hasData?"1":"0"}"\n         onclick="digichain.editor.opKeySelected(event, ${t})"\n         >\n        <div class="left-a"\n           ondragenter="this.classList.add('drag-over')"\n           ondragleave="this.classList.remove('drag-over')"\n           ondrop="digichain.editor.dropOpKey(event, ${t}, 0)"\n           title="${r?r+".":""}"\n        >L</div>\n        <div class="center-c"\n           ondrop="digichain.editor.dropOpKey(event, ${t})"\n           title="${i?i+".":""}"\n        >${K[t].linkedTo?'<div class="op-key-linked"><i class="gg-link"></i> '+(+K[t].linkedTo+1)+"</div>":""}</div>\n        <div class="right-b"\n           ondragenter="this.classList.add('drag-over')"\n           ondragleave="this.classList.remove('drag-over')"\n           ondrop="digichain.editor.dropOpKey(event, ${t}, 1)"\n           title="${a?a+".":""}"\n        >R</div>\n    </div>\n  `}function V(){return z.kitName||`dc${(new Date).toJSON().replaceAll(/^\d{4}|\-|T|:|\.|\d{2}Z$/gi,"")}`}function X(e,t,n){return 0===e?.length?(z=[],z.selected=!1,K=Array.from({length:24}).map((e=>({})))):e&&t&&(z=e,z.selected=z.selected||!1,K=t),n?z.find((e=>e?.buffer?.channel0))?{samples:z,opDataConfig:K}:{opDataConfig:K,samples:z.map((e=>({...e,buffer:!!e.buffer&&{duration:e.buffer.duration,length:e.buffer.length,numberOfChannels:e.buffer.numberOfChannels,sampleRate:e.buffer.sampleRate,channel0:e.buffer.getChannelData(0),channel1:e.buffer.numberOfChannels>1&&e.buffer.getChannelData(1)}})))}:{samples:z,opDataConfig:K}}async function Q(e=!1){if(e){await u("confirm","Reset OP Export kit config?",{kind:"warning",okLabel:"Reset"})&&X([])}const t={black:[1,3,5,8,10,13,15,17,20,22],white:[0,2,4,6,7,9,11,12,14,16,18,19,21,23]},n=t.black.find((e=>e===z.selected));0===z.length?(z.buffersLength=0,z.maxBuffersLength=882e3):Y();const i=z.buffersLength>882e3||z.xyMultiOut;z.xyMultiOut=i,P.innerHTML=`\n    <div>\n        <div class="op-key-details">${function(){if(!1===z.selected||z.linkMode)return"";const e=Z(z.selected),t=K[z.selected],n=(t,n,i)=>`\n        <div class="op-key-detail-title">${i}\n        `+("center"!==t&&e[t]?`<div class="channel-options has-shift-mod" style="display: ${e[t].buffer.numberOfChannels>1?"block":"none"}">\n          <a title="Left channel" onclick="digichain.editor.changeChannel(event, 'L', '${t}')" class="${"L"===e[t].meta.channel?"selected":""} channel-option-L">L</a>\n          <a title="Sum to mono" onclick="digichain.editor.changeChannel(event, 'S', '${t}')" class="${"S"===e[t].meta.channel?"selected":""} channel-option-S">S</a>\n          <a title="Right channel" onclick="digichain.editor.changeChannel(event, 'R', '${t}')" class="${"R"===e[t].meta.channel?"selected":""} channel-option-R">R</a>\n          <a title="Difference between Left and Right channels" onclick="digichain.editor.changeChannel(event, 'D', '${t}')" class="${"D"===e[t].meta.channel?"selected":""} channel-option-D">D</a>\n          </div>`:"")+`</div>\n        <div class="op-key-detail op-key-details-${t}">\n            <span class="op-key-detail-name">${se("",e[t],!0)??""}</span>\n            <button ${e[t]?"":'disabled="disabled"'} title="Edit" onclick="digichain.editor.editOpSlice('${t}')" class="button-clear toggle-edit"><i class="gg-pen"></i></button>\n            <button ${e[t]?"":'disabled="disabled"'} title="Remove sample (double-click)." ondblclick="digichain.editor.removeOpKeyData(${z.selected}, [-1])" class="button-clear remove"><i class="gg-trash"></i></button>\n        </div>\n        <div class="op-key-spacer"></div>\n        `,i=()=>`\n        <div class="op-key-details-controls">\n            <span>Panning</span>\n            <div class="channel-options channel-options-stereo channel-options-stereo-opf ${t.pab?"op-pan-ab-true":""}" style="display: block; border: 1px solid #40392e;"\n               ondblclick="digichain.editor.changeOpParam({target:{value: 16384}}, 'p')"\n               >\n                  <input class="channel-balance" type="range" style="display: inline-block;"\n                  min="0" max="32768" onchange="digichain.editor.changeOpParam(event, 'p')" value="${t.p??16384}" />\n                  <div style="display: inline-block;">\n                    <span class="op-la"></span>\n                    <span class="op-rb"></span>\n                  </div>\n              </div>\n        </div>\n        \n        <div class="op-key-details-controls">\n            <a onclick="digichain.editor.changeOpParam(event, 'pab')" title="Only applicable to OP-1 Field Exports." style="padding-top: .75rem;">L/R  A/B Toggle</a>\n            <span></span>\n        </div>\n        <br>\n        <div class="op-key-details-controls">\n            <div class="slice-options input-set" style="width: 100%;">\n                  <label for="opPlayMode" class="before-input" style="margin-top: -.15rem;">Play Mode</label>\n                  <select name="opPlayMode" id="opPlayMode" onchange="digichain.editor.changeOpParam(event, 'pm')" style="width: 100%; color:inherit;">\n                    <option value="4096" ${4096==+t?.pm?"selected":""}>Gate</option>\n                    <option value="20480" ${20480==+t?.pm?"selected":""}>Group</option>\n                    <option value="28672" ${28672==+t?.pm?"selected":""}>Loop</option>\n                    <option value="12288" ${t.pm&&12288!=+t?.pm?"":"selected"}>One Shot</option>\n                  </select>\n            </div>\n        </div>\n        <div class="op-key-details-controls" style="margin-top: .5rem;">\n            <span style="margin-top: -.75rem;">Play Direction</span>\n            <button class="button button-outline" style="padding: 0 .75rem; min-width: 8rem;" onclick="digichain.editor.changeOpParam({target:{value: ${t.r&&8192!=+t?.r?8192:24576}}}, 'r')">${t.r&&8192!=+t?.r?"Reverse":"Forward"}</button>\n        </div>\n        `;return`\n    <div style="display: flex; justify-content: space-between;">\n        <h5>${z.selected+1} / 24</h5>\n        <div style="padding-right: .25rem; margin-top: -.5rem; opacity: .7;">\n            <button class="button-clear move-up" onclick="digichain.editor.opKeySelected(event, ${0===z.selected?23:z.selected-1})"><i class="gg-chevron-up-r has-shift-mod-i"></i></button>\n            <button class="button-clear move-down" onclick="digichain.editor.opKeySelected(event, ${23===z.selected?0:z.selected+1})"><i class="gg-chevron-down-r has-shift-mod-i"></i></button>\n        </div>\n    </div>\n    `+(t.linkedTo?`<div class="op-key-details-buttons">\n        <div class="op-key-detail-title">Samples Linked to Key ${+t.linkedTo+1}</div>\n    </div>\n    <div class="op-key-spacer"></div>`+i():`<div class="op-key-details-buttons">\n        ${n("center",0,"Main")}\n        ${n("left",0,"Left")}\n        ${n("right",0,"Right")}\n    </div>`+i())}()}</div>\n        <div class="op-keys row ${!1!==z.selected&&z.linkMode?"in-link-mode":""}" style="display: flex; flex-direction: ${n&&!z.linkMode?"row-reverse":"row"};">\n                <div class="white-keys float-right">${t.white.reduce(((e,t)=>e+G("white",t)),"")}</div>\n            <div class="black-keys float-right" style="${n&&!z.linkMode?"margin-left: .75rem;":""}">${t.black.reduce(((e,t)=>e+G("black",t)),"")}</div>\n        </div>\n        <div class="op-samples-length-bar" data-caption="${Math.floor(z.buffersLength/z.maxBuffersLength*100)}% (${Number(z.buffersLength/44100).toFixed(3)}s)">\n            <div class="fill" style="width: ${Math.floor(z.buffersLength/z.maxBuffersLength*100)}%;"></div>\n        </div>\n        <div class="op-buttons row" style="justify-content: space-between;">\n            <button style="padding: 0 .75rem;"\n            title="Toggle building the kit as a single audio sample or as multiple audio sample files in the created XY preset. \n\nNote: If the combined samples length is greater than 20 seconds, Field export will be disabled and XY multi file ouput enabled by default."\n            class="button float-right button-outline" onclick="digichain.editor.toggleOpExportSetting(event, 'xyMultiOut')" ${z.isXyOnly?'disabled="disabled"':""}>XY ${i?"Multi File":"Single File"}</button>\n            <button title="Toggle Link Selection Mode" onclick="digichain.editor.toggleOpExportSetting(event, 'linkMode')" class="button-clear toggle-link" style="opacity: ${z.linkMode?1:.2}; visibility: ${!1!==z.selected?"visible":"hidden"};"><i class="gg-link"></i></button>\n        </div>\n        <div class="op-buttons row">\n            <input type="text" placeholder="Kit Name" onblur="digichain.editor.toggleOpExportSetting(event, 'kitName')" value="${z.kitName??""}">\n            <button ondrop="digichain.splitAction(event, false, true, false, true)" title="Spreads a chain across the kit, this will replace any existing samples in the kit." class="button-outline op-chain-drop-zone">Drop Chain</button>\n        </div>\n        <div class="op-buttons row" style="justify-content: space-between;">\n            <button class="button float-right" onclick="digichain.editor.buildXyKit()">Build XY Kit</button>\n            <button class="button float-right" onclick="digichain.editor.buildOpKit()" ${z.isXyOnly?'disabled="disabled"':""}>Build Field Kit</button>\n            <span>&nbsp;</span>\n            <span>&nbsp;</span>\n            <button title="Clear Kit" class="float-right button-clear" style="opacity:.7;" onpointerdown="digichain.editor.renderOpExport(true)"><i class="gg-remove"></i></button>\n        </div>\n    </div>\n  `,T.storeState()}function ee(){const e=K.map(((e,t)=>{const n=Z(e.linkedTo||t);if(n.left=!!n.left&&h(n.left.buffer,n.left.meta.channel,!0,T.audioCtx,1,44100),n.right=!!n.right&&h(n.right.buffer,n.right.meta.channel,!0,T.audioCtx,1,44100),e.linkedTo)return{...e};if(!n.hasData)return{blank:!0,...e};let i=T.audioCtx.createBuffer(2,n.length||1,44100);for(let e=0;e<n.length;e++){const t=n.center?n.center.buffer.getChannelData(0)[e]:0,r=n.center?n.center.buffer.getChannelData(n.center.buffer.numberOfChannels-1)[e]:0,a=n.left?n.left.getChannelData(0)[e]:0,o=n.right?n.right.getChannelData(0)[e]:0;let s=0,l=0;s=n.center&&n.left?(t+a)/2:n.center?t:a,l=n.center&&n.right?(r+o)/2:n.center?r:o,i.getChannelData(0)[e]=s,i.getChannelData(1)[e]=l}return{samples:n,buffer:i,length:i.length,...e}}));return e.totalLength=e.reduce(((e,t)=>e+(t.length||0)),0),e}async function te(e,t){if(window.__TAURI__){const n=await e.arrayBuffer();await window.__TAURI__.fs.writeFile(t,n,{baseDir:window.__TAURI__.fs.BaseDirectory.Download,create:!0}),C(""),window.__TAURI__.dialog.message(`Saved to the Downloads folder as '${t}'.`)}else{const n=document.querySelector(".aif-link-hidden");n.href=URL.createObjectURL(e),n.setAttribute("download",t),C(""),n.click()}}function ne(e="aif",t){C("Building Field Kit");const n=function(){const e=ee();let t=-1;for(let n=0;n<e.length;n++)e[n].blank||e[n].linkedTo||(e[n].s=0===n||-1===t?0:e[t].e,e[n].e=e[n].s+e[n].length,t=n);for(let t=0;t<e.length;t++)if(e[t].blank&&(e[t].s=e.totalLength,e[t].e=e.totalLength),e[t].linkedTo){const n=+e[t].linkedTo;e[t].s=e[n].s,e[t].e=e[n].e,e[t].length=e[n].length}const n=T.audioCtx.createBuffer(2,e.totalLength,44100);return m(n,e.filter((e=>e.buffer))),{buffer:n,slices:e.map((e=>{const{buffer:t,samples:n,...i}=e;return i}))}}();t=t||z.kitName||V();const i={slices:n.slices.filter((e=>!e.blank)),renderAt:"aif"===e?"44100":T.targetSR},r=y(n.buffer,i,T.masterSR,16,2,!1,"aif"===e);let a=new window.Blob([r.buffer],{type:"aif"===e?"audio/aiff":"audio/wav"});if("wav"===e)return{buffer:n.buffer,blob:a,slices:r.slices||n.slices.filter((e=>!e.blank))};te(a,`${t}.aif`)}function ie(e){I=e===I?I:e;R.innerHTML=`\n<div class="slice-options input-set">\n  <label for="sliceSelection" class="before-input">Slice</label>\n  <select title="Choose a slice marker to edit." name="sliceSelection" id="sliceSelection" onchange="digichain.editor.sliceSelect(event);"></select>\n<div style="display: ${I.meta.opKey?"none":"inline-block"}; margin-top: .2rem; padding-left: .5rem;">\n  <button title="Update the slice marker start/end points." onpointerdown="digichain.editor.sliceUpdate(event);" class="button-outline">Update Slice</button>\n  <button title="Remove the current slice marker." onpointerdown="digichain.editor.sliceRemove(event);" class="button-outline">Remove Slice</button>\n  <button title="Add the current range as a new slice marker." onpointerdown="digichain.editor.sliceCreate(event);" class="button-outline">New Slice</button>\n</div>\n<div style="display:inline-block; margin-top: .2rem; padding-left: .5rem;">\n  <button title="Snap selections to zero crossings?" onpointerdown="digichain.editor.toggleSnapToZero(event);" class="button ${M?"":"button-outline"}">Snap to Zero</button>\n  <button title="Detect BPM from selection." onpointerdown="digichain.editor.detectBpm(event);" class="button button-clear"> BPM</button>\n</div>\n</div>\n<div class="above-waveform-buttons">\n  <div class="sample-selection-buttons text-align-left float-left">\n      <button title="Clicking on the waveform will set the selection start point." onpointerdown="digichain.editor.setSelStart(true);" class="button check btn-select-start">Start</button>\n    <button title="Clicking on the waveform will set the selection end point." onpointerdown="digichain.editor.setSelStart(false);" class="button-outline check btn-select-end">End</button>\n      <button title="Reset the waveform selection to the whole sample." onpointerdown="digichain.editor.resetSelectionPoints();" class="button-outline check">All</button>\n  </div>\n  <div class="channel-options editor-channel-options float-right" style="border: 0.1rem solid #d79c4e; display: ${I.buffer.numberOfChannels>1&&1===T.masterChannels||I.meta.opKey&&-1!==I.meta.opKeyPosition?"inline-block":"none"}">\n            <a title="Left channel" onpointerdown="digichain.editor.changeChannel(event, 'L')" class="${"L"===I.meta.channel?"selected":""} channel-option-L">L</a>\n            <a title="Sum to mono" onpointerdown="digichain.editor.changeChannel(event, 'S')" class="${"S"===I.meta.channel?"selected":""} channel-option-S">S</a>\n            <a title="Right channel" onpointerdown="digichain.editor.changeChannel(event, 'R')" class="${"R"===I.meta.channel?"selected":""} channel-option-R">R</a>\n            <a title="Difference between Left and Right channels" onpointerdown="digichain.editor.changeChannel(event, 'D')" class="${"D"===I.meta.channel?"selected":""} channel-option-D">D</a>\n  </div>\n</div>\n\n  <div class="playback-controls text-align-right float-left" style="position: absolute;">\n    <button title="Play selection" onpointerdown="digichain.editor.editorPlayFile(event);" class="button-clear check"><i class="gg-play-button"></i></button>\n    <button title="Loop playback of selection" onpointerdown="digichain.editor.editorPlayFile(event, true);" class="button-clear check"><i class="gg-repeat"></i></button>\n    <button title="Stop playback" onpointerdown="digichain.editor.editorPlayFile(event, false, true);" class="button-clear check"><i class="gg-play-stop"></i></button>\n  </div>\n  <div class="zoom-level text-align-right float-right">\n    <button title="Toggle waveform width / height zooming"  class="zoom-waveform-height button-outline check" onpointerdown="digichain.editor.zoomLevel('editor-height', 1)"><i class="gg-arrows-v"></i><span>${a.wavePanelHeight/128}x</span></button>\n    <button title="Zoom out waveform view." class="zoom-out button-outline check" style="width:2.5rem;" onpointerdown="digichain.editor.zoomLevel('editor', .5)">-</button>\n    <button title="Reset zoom level waveform view."  class="zoom-reset button-outline check" onpointerdown="digichain.editor.zoomLevel('editor', 1)">1x</button>\n    <button title="Zoom in on waveform view."  class="zoom-in button-outline check" style="width:2.5rem;" onpointerdown="digichain.editor.zoomLevel('editor', 2)">+</button>\n  </div>\n\n </div>\n  <div class="waveform-container" style="height: ${a.wavePanelHeight}px;">\n    <div>\n    ${Array.from(".".repeat(I.meta.opKey&&-1!==I.meta.opKeyPosition?1:Math.floor((T.masterChannels+I.buffer.numberOfChannels)/2))).reduce(((e,t)=>e+'\n  <canvas class="edit-panel-waveform"\n        oncontextmenu="return false;"\n        onpointerdown="digichain.editor.changeSelectionPoint(event)"\n        ></canvas>\n  '),"")}\n      <div id="editLines">\n        <div class="edit-line" style="height: ${a.wavePanelHeight}px; margin-top: -${a.wavePanelHeight+8}px;">\n            <div class="edit-line-spacer" style="height: ${a.wavePanelHeight}px;"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="sample-op-buttons show-sample-duration" data-sample-duration="${I.meta.duration}s">\n  <div class="edit-btn-group float-left">\n\n  <button title="Normalize the volume of the sample." class="normalize button button-outline" onclick="digichain.editor.normalize(event)">Normalize</button>\n\n  <button title="Reverses the sample playback" class="reverse button button-outline" onclick="digichain.editor.reverse(event)">Reverse</button>\n  <button title="Crop the sample to the selected area. Shift+Click to crop selection to a new sample. Shift+(Ctrl/Cmd)+Click to crop selection to a new sample and open the new sample in the editor." class="trim-right button button-outline has-ctrl-mod has-shift-mod" onclick="digichain.editor.truncate(event)">Crop</button>\n  <button title="Fade in the selected audio." class="fade-in button button-outline" onclick="digichain.editor.fade('in')">Fade In</button>\n  <button title="Silence the selected audio." class="silence button button-outline" onclick="digichain.editor.fade()">Silence</button>\n  <button title="Increase the gain of the selected audio. Shift+Click to Decrease the gain of the selected audio." class="sample-vol button button-outline has-shift-mod" onclick="digichain.editor.adjustGain(event, 1.1)"></button>\n  <button title="Remove the currently selected section of the sample. Shift+Click to paste at the current start position." class="invert-crop button button-outline has-shift-mod" onclick="digichain.editor.truncate(event, false, true, 0, true)"></button>\n  <button title="Fade out the selected audio." class="fade-out button button-outline" onclick="digichain.editor.fade('out')">Fade Out</button>\n</div>\n<div class="edit-btn-group float-right">\n    <div class="edit-pitch-btn-group pitch-semi-tones">\n    <button title="Lower pitch by 12 semi-tones" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, .5, 12)">-12</button>\n    <button title="Lower pitch by 1 semi-tone" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2**(-1/12), 1)">-1</button>\n    &nbsp;<a href="javascript:;" onclick="digichain.editor.togglePitchSemitoneCents(event, 'cent')" title="Click to toggle between semi-tones and cents."> Pitch (semitones) </a>&nbsp;\n    <button title="Increase pitch by 1 semi-tone" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2**(1/12), -1)">+1</button>\n    <button title="Increase pitch by 12 semi-tones" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2, -12)">+12</button>\n    </div>\n    <div class="edit-pitch-btn-group pitch-cents hide">\n    <button title="Lower pitch by 10 cents" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2**(-1/120), 1)">-10</button>\n    <button title="Lower pitch by 1 cent" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2**(-1/1200), 1)">-1</button>\n    &nbsp;<a href="javascript:;" onclick="digichain.editor.togglePitchSemitoneCents(event, 'semi')" title="Click to toggle between semi-tones and cents." style="display: inline-block; width: 13rem;"> Pitch (cents) </a>&nbsp;\n    <button title="Increase pitch by 1 cent" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2**(1/1200), 1)">+1</button>\n    <button title="Increase pitch by 10 cents" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2**(1/120), 1)">+10</button>\n    </div>\n    <br>\n      <button title="Trims any zero valued audio from the end of the sample. Shift+click to trim both left and right." class="trim-right button button-outline" onclick="digichain.editor.trimRight(event)">Trim Right</button>\n      <button class="trim-right button button-outline hide ${I.buffer.numberOfChannels>1?"":"hide"}" onclick="digichain.editor.interpolate(event)">Interpolate</button>\n  </div>\n</div>\n  <span class="edit-info">\n    Normalize, Silence, Louder, Quieter, Fade In, Fade Out, Crop, and Reverse affect the selected part of the sample; Trim Right and Pitch Adjustments affect the whole sample.<br>\n    Note: sample operations are destructive, applied immediately, no undo. Pitch adjustments are done via sample-rate, cumulative changes will affect sample quality.\n  </span>\n  <div class="file-nav-buttons" style="visibility: ${I.meta.opKey?"hidden":"visible"};">\n    <button title="Edit previous file" class="prev-file button button-clear check" onpointerdown="digichain.editor.changeSelectedFile(event, -1)">Prev</button>\n    <button title="Edit next file" class="next-file button button-clear check" onpointerdown="digichain.editor.changeSelectedFile(event, 1)">Next</button>\n  </div>\n  `}function re(){const e=document.querySelector("#sliceSelection"),t=digichain.getSlicesFromMetaFile(I);Array.isArray(t)&&(e.innerHTML=t.reduce(((e,t,n)=>e+`\n        <option value="${n}">${n+1}</option>\n    `),'<option value="-1">None</option>'));const n=t.findIndex((e=>e.s===F.start&&e.e===F.end));-1!==n&&(e.value=n)}function ae(e=1){const t=1024*e,n=document.querySelector(".edit-panel-waveform"),i=document.querySelectorAll(".edit-panel-waveform"),r=document.querySelector(".show-sample-duration");$&&I.meta.opKey&&-1===I.meta.opKeyPosition||$&&!I.meta.opKey?i.forEach(((n,r)=>{oe(I,n,r,{width:t,height:a.wavePanelHeight/i.length,multiplier:e})})):oe(I,n,-1,{width:t,height:a.wavePanelHeight,multiplier:e}),r&&(r.dataset.sampleDuration=`${I.meta.duration}s`)}function oe(e,t,n,i){let r,a=Math.floor(e.buffer.length/32);if(a=e.buffer.length>512?(a>4096?4096:a)*(2*(i?.multiplier||0)||1):e.buffer.length,a=a>e.buffer.length?e.buffer.length:a,r=0===n||1===n?e.buffer.getChannelData(n):h(e.buffer,Number.isInteger(n)?e.meta?.channel:n),e.buffer.numberOfChannels>1){let t=[];for(let n=0;n<e.buffer.length;n+=Math.floor(e.buffer.length/a))t.push((e.buffer.getChannelData(0)[n]-e.buffer.getChannelData(1)[n])/2);e.meta.dualMono=t.every((e=>0===e))}!function(e,t,n,i){const r=0;n.width=i?.width||150,n.height=i?.height||60;const a=n.getContext("2d");a.translate(0,n.offsetHeight/2+r);const o=n.offsetWidth,s=Math.floor(.85*n.offsetHeight),l=e.length/o;a.lineWidth=1,a.strokeStyle="#a8a8a8",a.beginPath(),a.moveTo(0,e[0]*s/2);for(let t=0;t<o;t++){const n=Math.floor(t*l),i=Math.floor((t+1)*l-1);let r=e[n],o=e[n];for(let t=n;t<i;t++)r=e[t]<r?e[t]:r,o=e[t]>o?e[t]:o;a.lineTo(t,r*s/2),a.lineTo(t,o*s/2)}a.stroke()}(r,e.meta.id,t,i)}function se(e,t,n,i){let r=t?`${t.file.name.replace(/\.[^.]*$/,"")}${t.meta?.dupeOf?"-d":""}${t.meta?.sliceNumber?"-s"+t.meta.sliceNumber:""}.wav`:e.replace(/\.syx$|\.wav$|\.aif$|\.flac$|\.webm$|\.m4a$|\.pti$/,"");return r=i&&t.file.path?`${t.file.path.replace(/\//gi,"-")}`+r:r,n?r.replace(/\.[^.]*$/,""):r}function le(e,t){const n=t.split("."),i=n.pop(),r=n.join("."),a=e.filter((e=>(e.file.name||e.file.filename).includes(r))).length;return a>0?`${r}-${a+1}.${i}`:t}function ce(){return Math.round(F.start/F.step)}function fe(){const e=Math.floor((F.end-F.start)/F.step),t=1024*U-ce();return e>t?t:e}function ue(){const e=document.querySelector("#editLines .edit-line"),t=fe()>=1024*U?1024*U:fe();e.style.marginLeft=`${ce()}px`,e.style.width=`${t}px`,e.classList[0==+(I.buffer.getChannelData(0)[F.start]??1).toFixed(4)?"add":"remove"]("start-is-zero-crossing"),e.classList[0==+(I.buffer.getChannelData(0)[F.end]??1).toFixed(4)?"add":"remove"]("end-is-zero-crossing"),F.start&&0!==F.start||e.classList.remove("start-is-zero-crossing"),F.end&&F.end!==I.buffer.length||e.classList.remove("end-is-zero-crossing")}function de(e=!1){if(M){if(e){for(let e=F.end??I.buffer.length;I.buffer.length>e;e--)if(0==+I.buffer.getChannelData(0)[e].toFixed(4)||0===e){F.end=e;break}}else for(let e=F.start??0;e<I.buffer.length;e++)if(0==+I.buffer.getChannelData(0)[e].toFixed(4)||e===I.buffer.length){F.start=e;break}F.start=F.start<0?0:F.start,F.end=F.end>I.buffer.length?I.buffer.length:F.end}}function he(){F.start=0,F.end=I.buffer.length,F.selStart=!0,ue()}function pe(e,t,n=!0,i=.003,r=!1){!n&&t&&(F.start=0,F.end=t.buffer.length),t=t||I,e.shiftKey&&(r=!0);let a=[],o=[0],s=t.buffer.length;for(let e=0;e<t.buffer.numberOfChannels;e++){a.push(t.buffer.length);let n=t.buffer.getChannelData(e);for(let r=t.buffer.length;r>0;r--)if(Math.abs(n[r])>i&&void 0!==n[r]&&null!==n[r]){a[e]=r+1;break}}if(s=+Math.max(...a),r){for(let e=0;e<t.buffer.numberOfChannels;e++){let n=t.buffer.getChannelData(e);for(let t=0;t<s;t++)if(Math.abs(n[t])>i&&void 0!==n[t]&&null!==n[t]){o[e]=t+1;break}}s-=+Math.max(...o)}const l=T.audioCtx.createBuffer(t.buffer.numberOfChannels,s,T.masterSR);let c=+Math.max(...o);for(let e=0;e<t.buffer.numberOfChannels;e++)for(let n=0;n<l.length;n++)l.getChannelData(e)[n]=t.buffer.getChannelData(e)[n+c];t.buffer=l,t.meta={...t.meta,length:l.length,duration:Number(l.length/T.masterSR).toFixed(3),startFrame:0,endFrame:l.length},t.meta.slices&&t.meta.slices.length>0&&(t.meta.slices=!1),n&&j(I,T,"sample",N),t.waveform=!1}async function me(e,t,n=!0,i=16,r=.1,a=.5){!n&&t&&(F.start=0,F.end=t.buffer.length);const o=(t=t||I).buffer.numberOfChannels,s=t.buffer.sampleRate,l=t.buffer.duration,c=r*a/i,f=Math.ceil(l*i),u=Math.ceil(f*s),d=T.audioCtx.createBuffer(o,u,T.masterSR);let h=0,p=0;for(;h<l;){const e=Math.floor(r*s),n=Math.min(e,u-p);for(let e=0;e<o;e++){const i=t.buffer.getChannelData(e),r=d.getChannelData(e);for(let e=0;e<n;e++){const t=Math.floor(h*s+e);t<i.length&&p+e<u&&(r[p+e]+=.5*i[t])}}h+=c,p+=n}await function(e){const t=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate),n=t.createBufferSource();n.buffer=e;const i=t.createConvolver();i.buffer=function(e){const t=3*e.sampleRate,n=e.createBuffer(2,t,e.sampleRate);for(let e=0;e<2;e++){let i=n.getChannelData(e);for(let e=0;e<t;e++)i[e]=(2*Math.random()-1)*(1-e/t)}return n}(t);const r=t.createDelay();r.delayTime.value=.3;const a=t.createGain();a.gain.value=.4,r.connect(a),a.connect(r);const o=t.createGain();return o.gain.value=.8,n.connect(i),i.connect(r),r.connect(o),o.connect(t.destination),n.start(),t.startRendering()}(d),t.buffer=d,t.meta={...t.meta,length:d.length,duration:Number(d.length/T.masterSR).toFixed(3),startFrame:0,endFrame:d.length},t.meta.slices&&t.meta.slices.length>0&&(t.meta.slices[t.meta.slices.length-1].e=t.buffer.length),n&&j(I,T,"sample",N),t.waveform=!1}function ge(e,t,n=!0,i,r=!1){!n&&t&&(F.start=0,F.end=t.buffer.length);const a=(t=t||I).buffer.length,o=i/a,s=T.audioCtx.createBuffer(t.buffer.numberOfChannels,i,T.masterSR);for(let e=0;e<t.buffer.numberOfChannels;e++)for(let n=0;n<i;n++){const i=n/o,r=Math.floor(i),l=Math.ceil(i),c=i-r;s.getChannelData(e)[n]=l>=a?t.buffer.getChannelData(e)[r]:(1-c)*t.buffer.getChannelData(e)[r]+c*t.buffer.getChannelData(e)[l]}if(r)return s;t.buffer=s,t.meta={...t.meta,length:s.length,duration:Number(s.length/T.masterSR).toFixed(3),startFrame:0,endFrame:s.length,note:!1,editing:!1,slices:!!t.meta.slices&&t.meta.slices.map((e=>({...e,n:e.n,s:Math.round(e.s*o),e:Math.round(e.e*o)})))},n&&(ae(U),F.end=Math.abs(Math.round(F.end*o)),F.start=Math.abs(Math.round(F.start*o)),F.step=t.buffer.length/(1024*U),ue(),t.waveform=!1)}function be(e,t=[],n=[],i=!1){let r={},a=[];i||(r={},a=t.map((e=>(r[e.meta.id]={path:e.file.path.split("/").map((e=>L(e))).join("/"),name:L(e.file.name.replace(/\.[^.]*$/,""))+(e.meta.note?`-${e.meta.note}`:"")},r[e.meta.id].joined=`${r[e.meta.id].path}${r[e.meta.id].name}`,{name:r[e.meta.id].joined,available:!0})))),n.forEach(((e,t)=>{if(e.file.origPath=e.file.origPath||e.file.path,e.file.origName=e.file.origName||e.file.name,i)e.file.path=e.file.origPath,e.file.name=e.file.origName;else{const t=r[e.meta.id],n=a.filter((e=>e.name===t.joined&&e.available));e.file.path=t.path,e.file.name=1===n.length?t.name:t.name+`-${n.length}`,n[0].available=!1}t===n.length-1&&C("")}))}const ye={updateFile:function(e){const t=e.target;t&&("editFileName"===t.id&&(I.file.name=t.value),"editFilePath"===t.id&&(I.file.path=t.value))},changeSelectedFile:function(e,t=1){const n=document.querySelector("#fileList tr.selected")?.[1===t?"nextElementSibling":"previousElementSibling"];n&&"TR"===n.tagName&&(digichain.handleRowClick({},n.dataset.id),digichain.showEditPanel({},n.dataset.id))},toggleReadOnlyInput:function(e){const t=document.getElementById(e);t.readOnly?t.removeAttribute("readonly"):t.setAttribute("readonly",!0)},togglePitchSemitoneCents:function(e,t){const n=document.querySelector(".pitch-semi-tones"),i=document.querySelector(".pitch-cents");n.classList["cent"===t?"add":"remove"]("hide"),i.classList["semi"===t?"add":"remove"]("hide")},zoomLevel:function(e,t){if("editor-height"===e){const e=a.wavePanelHeight/128;a.wavePanelHeight=e>=4?128:128*(e+1),t=U,ie(I),re()}if(e.startsWith("editor")){const n=document.querySelector("#editLines .edit-line");1!==t&&"editor-height"!==e&&(t*=U);const i=I.buffer.length/(1024*t);if(1024*t<1024||1024*t>32768||i<1)return f("Unable to zoom any further");ae(t),F.step=i,U=t,ue(),n.scrollIntoViewIfNeeded()}},changeSelectionPoint:function(e,t=!1){e.preventDefault();const n=JSON.parse(JSON.stringify(F)),i=1024*U;if(e.shiftKey||t||!F.selStart){let t=0;e.offsetX<=i&&e.offsetX>-1?t=Math.round(e.offsetX*F.step):e.offsetX>i&&(t=I.buffer.length),F.end=t,(e.ctrlKey||e.metaKey)&&(F.start=n.end),F.start=F.start>=F.end?F.end-1:F.start,de(!0)}else{let t=0;e.offsetX<=i&&e.offsetX>-1?t=Math.round(e.offsetX*F.step):e.offsetX>i&&(t=I.buffer.length),F.start=t,(e.ctrlKey||e.metaKey)&&(F.end=n.start),F.end=F.end<=F.start?F.start+1:F.end,de()}F.end=F.end>=I.buffer.length?I.buffer.length:F.end,F.start=F.start>=F.end?F.end-1:F.start,ue()},resetSelectionPoints:he,setSelStart:function(e){const t=document.querySelector(".btn-select-start"),n=document.querySelector(".btn-select-end");F.selStart=Math.abs(Math.round(e)),t.classList[e?"remove":"add"]("button-outline"),n.classList[e?"add":"remove"]("button-outline")},editorPlayFile:function e(t,n=!1,i=!1){let r=F.start/T.masterSR,a=F.end/T.masterSR-r;r=r<0?0:r,a=a>I.buffer.length?I.buffer.length:a,clearTimeout(e.nextLoop),!i&&A.open?(digichain.playFile({editor:!0,file:I,waveform:document.querySelector(".edit-panel-waveform"),loopSection:document.querySelector(".edit-line")},I.meta.id,!1,r,a),n&&(e.nextLoop=setTimeout((()=>e(t,n)),1e3*a))):digichain.stopPlayFile(t,I.meta.id)},adjustGain:function(e,t,n,i=!0){!i&&n&&(F.start=0,F.end=n.buffer.length),n=n||I,e.shiftKey&&(t=.9);let r=0;for(let e=0;e<n.buffer.numberOfChannels;e++)for(let i=F.start;i<F.end;i++)n.buffer.getChannelData(e)[i]&&(n.buffer.getChannelData(e)[i]=n.buffer.getChannelData(e)[i]*t),r=Math.max(Math.abs(e[i]),r);r=r||1,n.meta.peak=r,i&&ae(U),n.waveform=!1},normalize:function(e,t,n=!0,i=!1){!n&&t&&(F.start=0,F.end=t.buffer.length),t=t||I;let r=0;for(let e=0;e<t.buffer.numberOfChannels;e++){let n=t.buffer.getChannelData(e);for(let e=F.start;e<F.end;e++)r=Math.max(Math.abs(n[e]),r)}if(r=r||1,t.meta.peak=r,i)return r;for(let e=0;e<t.buffer.numberOfChannels;e++)for(let n=F.start;n<F.end;n++)t.buffer.getChannelData(e)[n]&&t.buffer.getChannelData(e)[n]/r!=0&&(t.buffer.getChannelData(e)[n]=t.buffer.getChannelData(e)[n]/r);n&&ae(U),t.waveform=!1},fade:function(e,t,n=!0,i=0,r=0,a=!1){!n&&t&&(F.start=i,F.end=r>0?r:t.buffer.length),(t=t||I).buffer.numberOfChannels,t.buffer.sampleRate;const o=F.end-F.start;for(let n=0;n<t.buffer.numberOfChannels;n++){let i=t.buffer.getChannelData(n);if("out"===e){a&&(i[F.end]=0);for(let e=F.start;e<F.end;e++)i[e]=i[e]*((o-(e-F.start))/o)}else if("in"===e){a&&(i[F.start]=0);for(let e=F.end;e>F.start;e--)i[e]=i[e]/((o-(e-F.end))/o)}else if("fuzz"===e)for(let e=F.start;e<F.end;e++){const t=i[e]>0?i[e]+.001:i[e]-.001,n=(o+e)/o/t*Math.random();i[e]=Math.abs(n)>1?t:n}else for(let e=F.end;e>F.start;e--)i[e]=0}n&&ae(U),t.waveform=!1},trimRight:pe,thresholdCondense:function(e,t,n=!0,i=.003,r=1){!n&&t&&(F.start=0,F.end=t.buffer.length),t=t||I;const a=T.audioCtx.createBuffer(t.buffer.numberOfChannels,t.buffer.length,T.masterSR);for(let e=0;e<t.buffer.numberOfChannels;e++){let n=t.buffer.getChannelData(e),o=F.start;for(let s=F.start;s<t.buffer.length;s++){const l=Math.abs(n[s-1>0?s-1:0]),c=Math.abs(n[s]),f=Math.abs(n[s+1<t.buffer.length?s+1:t.buffer.length]);(c>i&&c<r||0===f.toFixed(4)||0===l.toFixed(4))&&(a.getChannelData(e)[o]=n[s]<0?-c:c,o++)}}t.buffer=a,pe(e,t,n,0,!1)},truncate:function(e,t,n=!0,i=3,r=!1){let o;if(!n&&t&&(F.start=0,F.end=T.masterSR*i),t=t||I,e.shiftKey&&n&&!r&&(o=digichain.duplicate(e,t.meta.id,!0),t=o.item),e.shiftKey&&n&&r&&!A.clipboard)return;if(a.attemptToFindCrossingPoint)for(let e=F.start-Math.floor(F.start/4*3);e<F.end;e++)t.buffer.getChannelData(0)[F.end-e]!==F.start||t.buffer.numberOfChannels>1&&t.buffer.getChannelData(1)[F.end-e]!==F.start||(F.end=F.end-e);let s=F.end-F.start;if(s>t.buffer.length)return;const l=!(!r||e.shiftKey)&&T.audioCtx.createBuffer(t.buffer.numberOfChannels,s,T.masterSR);r&&(s=t.buffer.length-s),r&&e.shiftKey&&A.clipboard?.length&&(s=t.buffer.length+A.clipboard.length,F.end=F.start);const c=T.audioCtx.createBuffer(t.buffer.numberOfChannels,s,T.masterSR);for(let n=0;n<t.buffer.numberOfChannels;n++){let i=0;if(r){for(let e=0;e<F.start;e++)c.getChannelData(n)[i]=t.buffer.getChannelData(n)[e],i++;if(e.shiftKey){if(A.clipboard?.length)for(let e=0;e<A.clipboard.length;e++)c.getChannelData(n)[i]=A.clipboard.getChannelData(n)[e],i++}else{let e=0;for(let i=F.start;i<F.end;i++)l.getChannelData(n)[e]=t.buffer.getChannelData(n)[i],e++}for(let e=F.end;e<t.buffer.length;e++)c.getChannelData(n)[i]=t.buffer.getChannelData(n)[e],i++}else for(let e=F.start;e<F.end;e++)c.getChannelData(n)[i]=t.buffer.getChannelData(n)[e],i++}t.buffer=c,t.meta={...t.meta,length:c.length,duration:Number(c.length/T.masterSR).toFixed(3),startFrame:0,endFrame:c.length},t.meta.slices&&(t.meta.slices=!1),digichain.removeMetaFile(t.meta.id),n&&!o&&(r?j(I,T,"sample",N,F.start,e.shiftKey&&A.clipboard?.length?F.start+A.clipboard.length:F.start):j(I,T,"sample",N)),t.waveform=!1,o&&(o.editorCallback(t,o.fileIdx),e.ctrlKey||e.metaKey?(f(`Editing cropped duplicate, '${t.file.name}'`,5e3),j(t,T,"sample",N)):f(`Cropped duplicate saved to list as, '${t.file.name}'`,5e3)),r&&!e.shiftKey&&(A.clipboard=l)},interpolate:function(e,t,n=!0){!n&&t&&(F.start=0,F.end=t.buffer.length),t=t||I;const i=T.audioCtx.createBuffer(1,t.buffer.length,T.masterSR);for(let e=0;e<t.buffer.length;e++){const n=e+2<t.buffer.length?(t.buffer.getChannelData(e%2)[e]+t.buffer.getChannelData(e%2)[e+2])/2:t.buffer.getChannelData(e%2)[e];i.getChannelData(0)[e]=n}t.buffer=i,t.meta.channel="L",$=!1,n&&(t.meta.editing=!1,A.close(),digichain.stopPlayFile(!1,digichain.editor.getLastItem()),setTimeout((()=>digichain.showEditPanel(e,t.meta.id)),250)),t.waveform=!1},perSamplePitch:function(e,t,n,i,r=!0,a=1,o){(i||I).meta.editing=!0,e.shiftKey?ge(e,i,r,(i||I).buffer.length/t):function(e,t,n,i,r=!0,a=1,o){if((i=i||I).buffer.length<1024&&t>1)return f("Sample too small to be pitched up further.");const s=T.masterSR*t;let l;if(1!==a){l=T.audioCtx.createBuffer(i.buffer.numberOfChannels,i.buffer.length,T.masterSR);for(let e=0;e<i.buffer.numberOfChannels;e++)for(let t=0;t<i.buffer.length;t++)l.getChannelData(e)[t]=i.buffer.getChannelData(e)[t]/a}const c=y(l||i.buffer,{...i.meta,bypassStereoAsDualMono:!0},s,o||32,i.buffer.numberOfChannels,.4).buffer,u=new window.Blob([new DataView(c)],{type:"audio/wav"});(async()=>{let e=await fetch(URL.createObjectURL(u)),a=await e.arrayBuffer();await new AudioContext({sampleRate:s,latencyHint:"interactive"}).decodeAudioData(a,(e=>{let a,o,l;if(o=new _(s,T.masterSR,1,e.getChannelData(0)),o.resampler(o.inputBuffer.length),2===i.buffer.numberOfChannels&&(l=new _(s,T.masterSR,1,e.getChannelData(1)),l.resampler(l.inputBuffer.length)),a=T.audioCtx.createBuffer(i.buffer.numberOfChannels,o.outputBuffer.length,T.masterSR),2===i.buffer.numberOfChannels)for(let e=0;e<o.outputBuffer.length;e++)a.getChannelData(0)[e]=o.outputBuffer[e],a.getChannelData(1)[e]=l.outputBuffer[e];else for(let e=0;e<o.outputBuffer.length;e++)a.getChannelData(0)[e]=o.outputBuffer[e];i.buffer=a,i.meta={...i.meta,opPitch:(i.meta.opPitch??0)+512*n,length:a.length,duration:Number(a.length/T.masterSR).toFixed(3),startFrame:0,endFrame:a.length,note:!1,editing:!1,slices:!!i.meta.slices&&i.meta.slices.map((e=>({...e,n:e.n,s:Math.round(e.s/t),e:Math.round(e.e/t)})))},r&&(ae(U),F.end=Math.abs(Math.round(F.end/t)),F.start=Math.abs(Math.round(F.start/t)),F.step=i.buffer.length/(1024*U),ue(),i.waveform=!1)}))})()}(0,t,n,i,r,a,o)},double:function(e,t,n=!1,i=!0){!i&&t&&(F.start=0,F.end=t.buffer.length),t=t||I;const r=T.audioCtx.createBuffer(t.buffer.numberOfChannels,2*t.buffer.length,T.masterSR);for(let e=0;e<t.buffer.numberOfChannels;e++){let i=0;for(let n=F.start;n<F.end;n++)r.getChannelData(e)[i]=t.buffer.getChannelData(e)[n],i++;let a=t.buffer.getChannelData(e).slice(F.start,F.end);n&&(a=a.reverse());for(let t=F.start;t<F.end;t++)r.getChannelData(e)[i]=a[t],i++}t.buffer=r,t.meta={...t.meta,length:r.length,duration:Number(r.length/T.masterSR).toFixed(3),startFrame:0,endFrame:r.length},t.meta.slices&&(t.meta.slices=!1),t.meta.op1Json&&(t.meta.op1Json=!1),i&&j(I,T,"sample",N),t.waveform=!1},stretch:ge,paulStretch:me,roughStretch:function(e,t,n=!0,i=2,r=!1){!n&&t&&(F.start=0,F.end=t.buffer.length),t=t||I;let a=4*T.masterSR;a=a>t.buffer.length/16?Math.floor(t.buffer.length/16):a;let o=Math.floor(a/4),s=Math.ceil(t.buffer.length/o),l=[];for(let e=0;e<t.buffer.numberOfChannels;e++)l.push([]);for(let e=0;e<s;e++)for(let n=0;n<t.buffer.numberOfChannels;n++){const i=t.buffer.getChannelData(n).slice(e*o,e*o+a);let r=new Float32Array(i.length);for(let e=0;e<i.length;e++)r[e]=i[e],r[e]=r[e]>1?1:r[e],r[e]=r[e]<-1?-1:r[e];l[n].push(r)}const c=Math.round(t.buffer.length*i),f=T.audioCtx.createBuffer(t.buffer.numberOfChannels,c,T.masterSR);for(let e=0;e<s;e++){let n=e*(a/2);for(let i=0;i<t.buffer.numberOfChannels;i++)for(let t=0;t<l[i][e].length;t++)f.getChannelData(i)[n+t]?f.getChannelData(i)[n+t]=[n+t-2,n+t-1,n+t,n+t+1,n+t+2].reduce(((t,n)=>t+(f.getChannelData(i)[n]??0+l[i][e][n]??0)),0)/5:f.getChannelData(i)[n+t]=l[i][e][t]}if(r){let i=ge(e,t,n,f.length,!0);for(let e=0;e<f.numberOfChannels;e++){for(let t=0;t<f.length;t++)f.getChannelData(e)[t]=(f.getChannelData(e)[t]+i.getChannelData(e)[t])/2;const t=g(f.getChannelData(e),.4);f.copyToChannel(t,e)}}else for(let e=0;e<f.numberOfChannels;e++){const t=g(f.getChannelData(e),.4);f.copyToChannel(t,e)}t.buffer=f,t.meta={...t.meta,length:f.length,duration:Number(f.length/T.masterSR).toFixed(3),startFrame:0,endFrame:f.length},t.meta.slices&&t.meta.slices.length>0&&(t.meta.slices[t.meta.slices.length-1].e=t.buffer.length),n&&j(I,T,"sample",N),t.waveform=!1},nudgeCrossings:function(e,t,n=!0){!n&&t&&(F.start=0,F.end=t.buffer.length),t=t||I;for(let e=0;e<t.buffer.numberOfChannels;e++){let n=t.buffer.getChannelData(e);for(let i=F.start;i<F.end;i++)t.buffer.getChannelData(e)[i]=0===n[i]?.003:n[i]}t.meta={...t.meta},0===F.start&&F.end===t.buffer.length&&(t.meta.slices=!!t.meta.slices&&t.meta.slices.map((e=>({...e,n:e.n,s:F.end-e.e,e:F.end-e.s})))),n&&ae(U),t.waveform=!1},padWithZero:function(e,t,n=0,i=!0){!i&&t&&(F.start=0,F.end=t.buffer.length),t=t||I;const r=T.audioCtx.createBuffer(t.buffer.numberOfChannels,t.buffer.length+(0===n?2:+n),T.masterSR);for(let e=0;e<t.buffer.numberOfChannels;e++){let n=0,i=t.buffer.getChannelData(e).slice(F.start,F.end);r.getChannelData(e)[n]=0,n++;for(let t=F.start;t<F.end;t++)r.getChannelData(e)[n]=i[t],n++;r.getChannelData(e)[n]=0}t.buffer=r,t.meta={...t.meta,length:r.length,duration:Number(r.length/T.masterSR).toFixed(3),startFrame:0,endFrame:r.length},t.meta.slices&&(t.meta.slices=!1),t.meta.op1Json&&(t.meta.op1Json=!1),i&&j(I,T,"sample",N),t.waveform=!1},buildOpKit:ne,buildXyKit:function(){const e=z.kitName||V(),t=new JSZip;let n;if(C("Building XY Kit"),z.xyMultiOut){const i=ee();i.forEach(((n,i)=>{if(!n.blank){let t=`${n.buffer?i+1:+n.linkedTo+1}`;t=1===t.length?`0${t}`:t,n.name=`${e}${t}`,n.l=n.length}if(n.buffer){const e=y(n.buffer,{slices:!1,renderAt:T.targetSR},T.masterSR,16,2);let i=new window.Blob([e.buffer],{type:"audio/wav"});t.file(`${n.name}.wav`,i,{binary:!0}),n.s=0,n.e=n.buffer.length,n.fc=n.length||n.e}})),i.forEach((e=>{if(e.linkedTo){const t=+e.linkedTo;e.s=i[t].s,e.e=i[t].e,e.fc=i[t].fc}})),n=c({kitName:e},i.filter((e=>!e.blank)))}else{const{buffer:i,blob:r,slices:a}=ne("wav",e);n=c({buffer:i,kitName:e},a),t.file(`${e}.wav`,r,{binary:!0})}t.file("patch.json",JSON.stringify(n)),t.generateAsync({type:"blob"}).then((t=>{te(t,`${e}.preset.zip`)}))},dropOpKey:J,opKeySelected:function(e,t){if(z.linkMode){if(t===z.selected||K.some((e=>e.linkedTo===`${t}`)))return;K[t].linkedTo=K[t].linkedTo!==`${z.selected}`&&`${z.selected}`,H(t,[-1,0,1])}else z.selected=z.selected!==t&&t;Q()},editOpSlice:function(e){j(Z(z.selected)[e],T)},changeOpParam:function(e,t,n){const i=K[n||z.selected];e?.target?.value?i[t]=+e.target.value:(i[t]=!i[t],e.shiftKey&&"pab"===t&&K.forEach((e=>e.pab=i[t]))),Q()},removeOpKeyData:H,renderOpExport:Q,toggleOpExportSetting:function(e,t){if("kitName"===t){z[t]=e?.target?.value||"";const n={file:{path:"",name:z[t]},meta:{id:crypto.randomUUID()}};be(e,[n],[n]),z[t]=n.file.name,e.target.value=z[t]}else{if("linkMode"===t&&!Z(z.selected)?.hasData)return;z[t]=!z[t],Q()}},acceptDroppedChainItems:async function(e=[]){if(e.forEach(((e,t)=>{const n=`0${t+1}`.slice(-2);e.file.name=`Chain Slice ${n}.wav`})),e?.length&&e.length>24){const t=await u("prompt",`The dropped chain contains ${e.length} slices, please specify the slice number to start from to populate the kit`,{inputType:"number"});if(!1===t)return;let n=Math.abs(parseInt(t));n=n>e.length?e.length:n,e=e.slice(n)}const t=await u("confirm","Place samples in the Left, Center, or Right channel per key?",{cancelLabel:"Left",centerLabel:"Right",okLabel:"Center"}),n=!0===t?-1:!1===t?0:1;e.slice(0,24).forEach(((e,t)=>J(e,t,n))),Q()},sliceUpdate:function(e){const t=document.querySelector("#sliceSelection");if(-1==+t.value)return;const n=digichain.getSlicesFromMetaFile(I),i=n.at(+t.value);i.s=F.start,i.e=F.end,i.l=-1,digichain.removeMetaFile(I.meta.id),I.meta.slices=n},sliceCreate:function(e){const t=digichain.getSlicesFromMetaFile(I);t.push({n:"",s:F.start,e:F.end,l:-1}),digichain.removeMetaFile(I.meta.id),I.meta.slices=t,re(),document.querySelector("#sliceSelection").value=t.length>0?t.length-1:-1},sliceRemove:function(e){const t=document.querySelector("#sliceSelection");if(-1==+t.value)return;const n=digichain.getSlicesFromMetaFile(I);I.meta.slices=n.filter(((e,n)=>n!==+t.value)),digichain.removeMetaFile(I.meta.id),I.meta.slices=!!I.meta.slices.length&&I.meta.slices,t.value=-1,F.start=0,F.end=I.buffer.length,ue(),re()},sliceSelect:function(e){const t=document.querySelector("#sliceSelection"),n=document.querySelector("#editLines .edit-line");if(-1==+t.value)return he();const i=digichain.getSlicesFromMetaFile(I).at(+t.value);F.start=i.s,F.end=i.e,ue(),n.scrollIntoViewIfNeeded()},toggleSnapToZero:function(e){const t=e.target;M=!M,t.classList[M?"remove":"add"]("button-outline")},detectBpm:async function(e){const t=e.target,n=I.buffer.getChannelData(0).slice(F.start,F.end),i=T.audioCtx.createBuffer(1,n.length,T.masterSR);i.getChannelData(0).set(n);const r=await S(i);I.tempo=r?.match||!1,t.textContent=`${I.tempo||""} BPM`},changeChannel:function(e,t,n){if(void 0!==n)return Z(z.selected)[n].meta.channel=t,Q();I.meta.channel=t,q()},getLastItem:()=>I?.meta?.id,reverse:function(e,t,n=!0){if(!n&&t&&(F.start=0,F.end=t.buffer.length),t=t||I,e.shiftKey&&(e.ctrlKey||e.metaKey))return me(e,t,n);for(let e=0;e<t.buffer.numberOfChannels;e++){let n=t.buffer.getChannelData(e).slice(F.start,F.end).reverse(),i=0;for(let r=F.start;r<F.end;r++)t.buffer.getChannelData(e)[r]=n[i],i++}t.meta={...t.meta},0===F.start&&F.end===t.buffer.length&&(t.meta.slices=!!t.meta.slices&&t.meta.slices.map((e=>({...e,n:e.n,s:F.end-e.e,e:F.end-e.s})))),n&&ae(U),t.waveform=!1},shift:function(e,t,n=!0){!n&&t&&(F.start=0,F.end=t.buffer.length),t=t||I;for(let e=0;e<t.buffer.numberOfChannels;e++){let n=t.buffer.getChannelData(e).slice(0),i=Math.floor(F.end/2);for(let r=F.start;r<F.end;r++)t.buffer.getChannelData(e)[r]=n[i],i++,i=i>F.end?0:i}t.meta={...t.meta},0===F.start&&F.end===t.buffer.length&&(t.meta.slices=!!t.meta.slices&&t.meta.slices.map((e=>({...e,n:e.n,s:F.end-e.e,e:F.end-e.s})))),n&&ae(U),t.waveform=!1},invert:function(e,t,n=!0){!n&&t&&(F.start=0,F.end=t.buffer.length),t=t||I;for(let e=0;e<t.buffer.numberOfChannels;e++){const n=t.buffer.getChannelData(e);for(let e=F.start;e<F.end;e++)n[e]=-n[e]}n&&ae(U),t.waveform=!1},flipChannels:function(e,t,n=!0){if(!n&&t&&(F.start=0,F.end=t.buffer.length),1===(t=t||I).buffer.numberOfChannels)return;const i=new Float32Array(t.buffer.getChannelData(0)),r=new Float32Array(t.buffer.getChannelData(1));t.buffer.copyToChannel(i,1),t.buffer.copyToChannel(r,0),n&&ae(U),t.waveform=!1},serialize:function(e,t,n=!0,i="LR"){!n&&t&&(F.start=0,F.end=t.buffer.length),t=t||I;const r=T.audioCtx.createBuffer(1,t.buffer.length*i.split("").length,T.masterSR);let a=0;i.split("").forEach((e=>{const n=h(t.buffer,e);for(let e=F.start;e<F.end;e++)r.getChannelData(0)[a]=n[e],a++})),t.buffer=r,t.meta={...t.meta,length:r.length,duration:Number(r.length/T.masterSR).toFixed(3),startFrame:0,endFrame:r.length},t.meta.slices&&(t.meta.slices=!1),t.meta.op1Json&&(t.meta.op1Json=!1),n&&j(I,T,"sample",N),t.waveform=!1},deserialize:function(e,t,n=!0,i="LR"){!n&&t&&(F.start=0,F.end=Math.floor(t.buffer.length/i.split("").length)),t=t||I;const r=T.audioCtx.createBuffer(2,F.end,T.masterSR);let a=0;i.split("").forEach(((e,n)=>{const i=t.buffer.getChannelData(0);for(let e=F.start;e<F.end;e++)r.getChannelData(n)[e]=i[a],a++})),t.buffer=r,t.meta={...t.meta,length:r.length,duration:Number(r.length/T.masterSR).toFixed(3),startFrame:0,endFrame:r.length},t.meta.slices&&(t.meta.slices=!1),t.meta.op1Json&&(t.meta.op1Json=!1),n&&j(I,T,"sample",N),t.waveform=!1},sanitizeName:be};
/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=e()}}((function(){return function e(t,n,i){function r(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[o]={exports:{}};t[o][0].call(f.exports,(function(e){var n=t[o][1][e];return r(n||e)}),f,f.exports,e,t,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){var i=e("./utils"),r=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t,n,r,o,s,l,c,f=[],u=0,d=e.length,h=d,p="string"!==i.getTypeOf(e);u<e.length;)h=d-u,p?(t=e[u++],n=u<d?e[u++]:0,r=u<d?e[u++]:0):(t=e.charCodeAt(u++),n=u<d?e.charCodeAt(u++):0,r=u<d?e.charCodeAt(u++):0),o=t>>2,s=(3&t)<<4|n>>4,l=h>1?(15&n)<<2|r>>6:64,c=h>2?63&r:64,f.push(a.charAt(o)+a.charAt(s)+a.charAt(l)+a.charAt(c));return f.join("")},n.decode=function(e){var t,n,i,o,s,l,c=0,f=0,u="data:";if(e.substr(0,5)===u)throw new Error("Invalid base64 input, it looks like a data url.");var d,h=3*(e=e.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(e.charAt(e.length-1)===a.charAt(64)&&h--,e.charAt(e.length-2)===a.charAt(64)&&h--,h%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=r.uint8array?new Uint8Array(0|h):new Array(0|h);c<e.length;)t=a.indexOf(e.charAt(c++))<<2|(o=a.indexOf(e.charAt(c++)))>>4,n=(15&o)<<4|(s=a.indexOf(e.charAt(c++)))>>2,i=(3&s)<<6|(l=a.indexOf(e.charAt(c++))),d[f++]=t,64!==s&&(d[f++]=n),64!==l&&(d[f++]=i);return d}},{"./support":30,"./utils":32}],2:[function(e,t,n){var i=e("./external"),r=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),o=e("./stream/DataLengthProbe");function s(e,t,n,i,r){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=i,this.compressedContent=r}s.prototype={getContentWorker:function(){var e=new r(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new r(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},s.createWorkerFrom=function(e,t,n){return e.pipe(new a).pipe(new o("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new o("compressedSize")).withStreamInfo("compression",t)},t.exports=s},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,n){var i=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,n){var i=e("./utils");var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==i.getTypeOf(e)?function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}(0|t,e,e.length,0):function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t.charCodeAt(s))];return-1^e}(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,t,n){var i=null;i="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:i}},{lie:37}],7:[function(e,t,n){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=e("pako"),a=e("./utils"),o=e("./stream/GenericWorker"),s=i?"uint8array":"array";function l(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}n.magic="\b\0",a.inherits(l,o),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(a.transformTo(s,e.data),!1)},l.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},n.compressWorker=function(e){return new l("Deflate",e)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,n){var i=e("../utils"),r=e("../stream/GenericWorker"),a=e("../utf8"),o=e("../crc32"),s=e("../signature"),l=function(e,t){var n,i="";for(n=0;n<t;n++)i+=String.fromCharCode(255&e),e>>>=8;return i},c=function(e,t,n,r,c,f){var u,d,h=e.file,p=e.compression,m=f!==a.utf8encode,g=i.transformTo("string",f(h.name)),b=i.transformTo("string",a.utf8encode(h.name)),y=h.comment,v=i.transformTo("string",f(y)),w=i.transformTo("string",a.utf8encode(y)),k=b.length!==h.name.length,_=w.length!==y.length,S="",C="",E="",x=h.dir,A=h.date,D={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(D.crc32=e.crc32,D.compressedSize=e.compressedSize,D.uncompressedSize=e.uncompressedSize);var R=0;t&&(R|=8),m||!k&&!_||(R|=2048);var B,P,O,L=0,I=0;x&&(L|=16),"UNIX"===c?(I=798,L|=(B=h.unixPermissions,P=x,O=B,B||(O=P?16893:33204),(65535&O)<<16)):(I=20,L|=63&(h.dosPermissions||0)),u=A.getUTCHours(),u<<=6,u|=A.getUTCMinutes(),u<<=5,u|=A.getUTCSeconds()/2,d=A.getUTCFullYear()-1980,d<<=4,d|=A.getUTCMonth()+1,d<<=5,d|=A.getUTCDate(),k&&(C=l(1,1)+l(o(g),4)+b,S+="up"+l(C.length,2)+C),_&&(E=l(1,1)+l(o(v),4)+w,S+="uc"+l(E.length,2)+E);var T="";return T+="\n\0",T+=l(R,2),T+=p.magic,T+=l(u,2),T+=l(d,2),T+=l(D.crc32,4),T+=l(D.compressedSize,4),T+=l(D.uncompressedSize,4),T+=l(g.length,2),T+=l(S.length,2),{fileRecord:s.LOCAL_FILE_HEADER+T+g+S,dirRecord:s.CENTRAL_FILE_HEADER+l(I,2)+T+l(v.length,2)+"\0\0\0\0"+l(L,4)+l(r,4)+g+S+v}},f=function(e){return s.DATA_DESCRIPTOR+l(e.crc32,4)+l(e.compressedSize,4)+l(e.uncompressedSize,4)};function u(e,t,n,i){r.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(u,r),u.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,r.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-i-1))/n:100}}))},u.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=c(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=c(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:f(e),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e,r=function(e,t,n,r,a){var o=i.transformTo("string",a(r));return s.CENTRAL_DIRECTORY_END+"\0\0\0\0"+l(e,2)+l(e,2)+l(t,4)+l(n,4)+l(o.length,2)+o}(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},u.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(e){var t=this._sources;if(!r.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},u.prototype.lock=function(){r.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,n){var i=e("../compressions"),r=e("./ZipFileWorker");n.generateWorker=function(e,t,n){var a=new r(t.streamFiles,n,t.platform,t.encodeFileName),o=0;try{e.forEach((function(e,n){o++;var r=function(e,t){var n=e||t,r=i[n];if(!r)throw new Error(n+" is not a valid compression method !");return r}(n.options.compression,t.compression),s=n.options.compressionOptions||t.compressionOptions||{},l=n.dir,c=n.date;n._compressWorker(r,s).withStreamInfo("file",{name:e,dir:l,date:c,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(a)})),a.entriesCount=o}catch(e){a.error(e)}return a}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,n){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new i;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}i.prototype=e("./object"),i.prototype.loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.10.1",i.loadAsync=function(e,t){return(new i).loadAsync(e,t)},i.external=e("./external"),t.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,n){var i=e("./utils"),r=e("./external"),a=e("./utf8"),o=e("./zipEntries"),s=e("./stream/Crc32Probe"),l=e("./nodejsUtils");function c(e){return new r.Promise((function(t,n){var i=e.decompressed.getContentWorker().pipe(new s);i.on("error",(function(e){n(e)})).on("end",(function(){i.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var n=this;return t=i.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(e)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var n=new o(t);return n.load(e),n})).then((function(e){var n=[r.Promise.resolve(e)],i=e.files;if(t.checkCRC32)for(var a=0;a<i.length;a++)n.push(c(i[a]));return r.Promise.all(n)})).then((function(e){for(var r=e.shift(),a=r.files,o=0;o<a.length;o++){var s=a[o],l=s.fileNameStr,c=i.resolve(s.fileNameStr);n.file(c,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:t.createFolders}),s.dir||(n.file(c).unsafeOriginalName=l)}return r.zipComment.length&&(n.comment=r.zipComment),n}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,n){var i=e("../utils"),r=e("../stream/GenericWorker");function a(e,t){r.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}i.inherits(a,r),a.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},a.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,n){var i=e("readable-stream").Readable;function r(e,t,n){i.call(this,t),this._helper=e;var r=this;e.on("data",(function(e,t){r.push(e)||r._helper.pause(),n&&n(t)})).on("error",(function(e){r.emit("error",e)})).on("end",(function(){r.push(null)}))}e("../utils").inherits(r,i),r.prototype._read=function(){this._helper.resume()},t.exports=r},{"../utils":32,"readable-stream":16}],14:[function(e,t,n){t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,n){var i=e("./utf8"),r=e("./utils"),a=e("./stream/GenericWorker"),o=e("./stream/StreamHelper"),s=e("./defaults"),l=e("./compressedObject"),c=e("./zipObject"),f=e("./generate"),u=e("./nodejsUtils"),d=e("./nodejs/NodejsStreamInputAdapter"),h=function(e,t,n){var i,o=r.getTypeOf(t),f=r.extend(n||{},s);f.date=f.date||new Date,null!==f.compression&&(f.compression=f.compression.toUpperCase()),"string"==typeof f.unixPermissions&&(f.unixPermissions=parseInt(f.unixPermissions,8)),f.unixPermissions&&16384&f.unixPermissions&&(f.dir=!0),f.dosPermissions&&16&f.dosPermissions&&(f.dir=!0),f.dir&&(e=m(e)),f.createFolders&&(i=p(e))&&g.call(this,i,!0);var h="string"===o&&!1===f.binary&&!1===f.base64;n&&void 0!==n.binary||(f.binary=!h),(t instanceof l&&0===t.uncompressedSize||f.dir||!t||0===t.length)&&(f.base64=!1,f.binary=!0,t="",f.compression="STORE",o="string");var b=null;b=t instanceof l||t instanceof a?t:u.isNode&&u.isStream(t)?new d(e,t):r.prepareContent(e,t,f.binary,f.optimizedBinaryString,f.base64);var y=new c(e,b,f);this.files[e]=y},p=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},m=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},g=function(e,t){return t=void 0!==t?t:s.createFolders,e=m(e),this.files[e]||h.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function b(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,i;for(t in this.files)i=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,i)},filter:function(e){var t=[];return this.forEach((function(n,i){e(n,i)&&t.push(i)})),t},file:function(e,t,n){if(1===arguments.length){if(b(e)){var i=e;return this.filter((function(e,t){return!t.dir&&i.test(e)}))}var r=this.files[this.root+e];return r&&!r.dir?r:null}return e=this.root+e,h.call(this,e,t,n),this},folder:function(e){if(!e)return this;if(b(e))return this.filter((function(t,n){return n.dir&&e.test(t)}));var t=this.root+e,n=g.call(this,t),i=this.clone();return i.root=n.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter((function(t,n){return n.name.slice(0,e.length)===e})),i=0;i<n.length;i++)delete this.files[n[i].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if((n=r.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");r.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var s=n.comment||this.comment||"";t=f.generateWorker(this,n,s)}catch(e){(t=new a("error")).error(e)}return new o(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=y},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,n){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,n){var i=e("./DataReader");function r(e){i.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(r,i),r.prototype.byteAt=function(e){return this.data[this.zero+e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),r=e.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===t&&this.data[a+1]===n&&this.data[a+2]===i&&this.data[a+3]===r)return a-this.zero;return-1},r.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),r=e.charCodeAt(3),a=this.readData(4);return t===a[0]&&n===a[1]&&i===a[2]&&r===a[3]},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./DataReader":18}],18:[function(e,t,n){var i=e("../utils");function r(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=r},{"../utils":32}],19:[function(e,t,n){var i=e("./Uint8ArrayReader");function r(e){i.call(this,e)}e("../utils").inherits(r,i),r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,n){var i=e("./DataReader");function r(e){i.call(this,e)}e("../utils").inherits(r,i),r.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},r.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./DataReader":18}],21:[function(e,t,n){var i=e("./ArrayReader");function r(e){i.call(this,e)}e("../utils").inherits(r,i),r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,n){var i=e("../utils"),r=e("../support"),a=e("./ArrayReader"),o=e("./StringReader"),s=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=i.getTypeOf(e);return i.checkSupport(t),"string"!==t||r.uint8array?"nodebuffer"===t?new s(e):r.uint8array?new l(i.transformTo("uint8array",e)):new a(i.transformTo("array",e)):new o(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,n){var i=e("./GenericWorker"),r=e("../utils");function a(e){i.call(this,"ConvertWorker to "+e),this.destType=e}r.inherits(a,i),a.prototype.processChunk=function(e){this.push({data:r.transformTo(this.destType,e.data),meta:e.meta})},t.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,n){var i=e("./GenericWorker"),r=e("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,i),a.prototype.processChunk=function(e){this.streamInfo.crc32=r(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,n){var i=e("../utils"),r=e("./GenericWorker");function a(e){r.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}i.inherits(a,r),a.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}r.prototype.processChunk.call(this,e)},t.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,n){var i=e("../utils"),r=e("./GenericWorker");function a(e){r.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=i.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}i.inherits(a,r),a.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,n){function i(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=i},{}],29:[function(e,t,n){var i=e("../utils"),r=e("./ConvertWorker"),a=e("./GenericWorker"),o=e("../base64"),s=e("../support"),l=e("../external"),c=null;if(s.nodestream)try{c=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function f(e,t){return new l.Promise((function(n,r){var a=[],s=e._internalType,l=e._outputType,c=e._mimeType;e.on("data",(function(e,n){a.push(e),t&&t(n)})).on("error",(function(e){a=[],r(e)})).on("end",(function(){try{var e=function(e,t,n){switch(e){case"blob":return i.newBlob(i.transformTo("arraybuffer",t),n);case"base64":return o.encode(t);default:return i.transformTo(e,t)}}(l,function(e,t){var n,i=0,r=null,a=0;for(n=0;n<t.length;n++)a+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(r=new Uint8Array(a),n=0;n<t.length;n++)r.set(t[n],i),i+=t[n].length;return r;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(s,a),c);n(e)}catch(e){r(e)}a=[]})).resume()}))}function u(e,t,n){var o=t;switch(t){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=t,this._mimeType=n,i.checkSupport(o),this._worker=e.pipe(new r(o)),e.lock()}catch(e){this._worker=new a("error"),this._worker.error(e)}}u.prototype={accumulate:function(e){return f(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,(function(e){t.call(n,e.data,e.meta)})):this._worker.on(e,(function(){i.delay(t,arguments,n)})),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var i=new ArrayBuffer(0);try{n.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(i),n.blob=0===r.getBlob("application/zip").size}catch(e){n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch(e){n.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,n){for(var i=e("./utils"),r=e("./support"),a=e("./nodejsUtils"),o=e("./stream/GenericWorker"),s=new Array(256),l=0;l<256;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1;function c(){o.call(this,"utf-8 decode"),this.leftOver=null}function f(){o.call(this,"utf-8 encode")}n.utf8encode=function(e){return r.nodebuffer?a.newBufferFrom(e,"utf-8"):function(e){var t,n,i,a,o,s=e.length,l=0;for(a=0;a<s;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=r.uint8array?new Uint8Array(l):new Array(l),o=0,a=0;o<l;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t}(e)},n.utf8decode=function(e){return r.nodebuffer?i.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,n,r,a,o=e.length,l=new Array(2*o);for(n=0,t=0;t<o;)if((r=e[t++])<128)l[n++]=r;else if((a=s[r])>4)l[n++]=65533,t+=a-1;else{for(r&=2===a?31:3===a?15:7;a>1&&t<o;)r=r<<6|63&e[t++],a--;a>1?l[n++]=65533:r<65536?l[n++]=r:(r-=65536,l[n++]=55296|r>>10&1023,l[n++]=56320|1023&r)}return l.length!==n&&(l.subarray?l=l.subarray(0,n):l.length=n),i.applyFromCharCode(l)}(e=i.transformTo(r.uint8array?"uint8array":"array",e))},i.inherits(c,o),c.prototype.processChunk=function(e){var t=i.transformTo(r.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var a=t;(t=new Uint8Array(a.length+this.leftOver.length)).set(this.leftOver,0),t.set(a,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var o=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+s[e[n]]>t?n:t}(t),l=t;o!==t.length&&(r.uint8array?(l=t.subarray(0,o),this.leftOver=t.subarray(o,t.length)):(l=t.slice(0,o),this.leftOver=t.slice(o,t.length))),this.push({data:n.utf8decode(l),meta:e.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=c,i.inherits(f,o),f.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,n){var i=e("./support"),r=e("./base64"),a=e("./nodejsUtils"),o=e("./external");function s(e){return e}function l(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}e("setimmediate"),n.newBlob=function(e,t){n.checkSupport("blob");try{return new Blob([e],{type:t})}catch(n){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(e),i.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(e,t,n){var i=[],r=0,a=e.length;if(a<=n)return String.fromCharCode.apply(null,e);for(;r<a;)"array"===t||"nodebuffer"===t?i.push(String.fromCharCode.apply(null,e.slice(r,Math.min(r+n,a)))):i.push(String.fromCharCode.apply(null,e.subarray(r,Math.min(r+n,a)))),r+=n;return i.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,a.allocBuffer(1)).length}catch(e){return!1}}()}};function f(e){var t=65536,i=n.getTypeOf(e),r=!0;if("uint8array"===i?r=c.applyCanBeUsed.uint8array:"nodebuffer"===i&&(r=c.applyCanBeUsed.nodebuffer),r)for(;t>1;)try{return c.stringifyByChunk(e,i,t)}catch(e){t=Math.floor(t/2)}return c.stringifyByChar(e)}function u(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}n.applyFromCharCode=f;var d={};d.string={string:s,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return d.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,a.allocBuffer(e.length))}},d.array={string:f,array:s,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return a.newBufferFrom(e)}},d.arraybuffer={string:function(e){return f(new Uint8Array(e))},array:function(e){return u(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:s,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return a.newBufferFrom(new Uint8Array(e))}},d.uint8array={string:f,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:s,nodebuffer:function(e){return a.newBufferFrom(e)}},d.nodebuffer={string:f,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return d.nodebuffer.uint8array(e).buffer},uint8array:function(e){return u(e,new Uint8Array(e.length))},nodebuffer:s},n.transformTo=function(e,t){if(t||(t=""),!e)return t;n.checkSupport(e);var i=n.getTypeOf(t);return d[i][e](t)},n.resolve=function(e){for(var t=e.split("/"),n=[],i=0;i<t.length;i++){var r=t[i];"."===r||""===r&&0!==i&&i!==t.length-1||(".."===r?n.pop():n.push(r))}return n.join("/")},n.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":i.nodebuffer&&a.isBuffer(e)?"nodebuffer":i.uint8array&&e instanceof Uint8Array?"uint8array":i.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(e){if(!i[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t,n,i="";for(n=0;n<(e||"").length;n++)i+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return i},n.delay=function(e,t,n){setImmediate((function(){e.apply(n||null,t||[])}))},n.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},n.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},n.prepareContent=function(e,t,a,s,c){var f=o.Promise.resolve(t).then((function(e){return i.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new o.Promise((function(t,n){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(e){n(e.target.error)},i.readAsArrayBuffer(e)})):e}));return f.then((function(t){var f,u=n.getTypeOf(t);return u?("arraybuffer"===u?t=n.transformTo("uint8array",t):"string"===u&&(c?t=r.decode(t):a&&!0!==s&&(t=l(f=t,i.uint8array?new Uint8Array(f.length):new Array(f.length)))),t):o.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,n){var i=e("./reader/readerFor"),r=e("./utils"),a=e("./signature"),o=e("./zipEntry"),s=e("./support");function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(t)+", expected "+r.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4)===t;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=s.uint8array?"uint8array":"array",n=r.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,i=this.zip64EndOfCentralSize-44;0<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=t-n;if(i>0)this.isSignature(t,a.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(e){this.reader=i(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,t,n){var i=e("./reader/readerFor"),r=e("./utils"),a=e("./compressedObject"),o=e("./crc32"),s=e("./utf8"),l=e("./compressions"),c=e("./support");function f(e,t){this.options=e,this.loadOptions=t}f.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(Object.prototype.hasOwnProperty.call(l,t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=i(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,n,i,r=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<r;)t=e.readInt(2),n=e.readInt(2),i=e.readData(n),this.extraFields[t]={id:t,length:n,value:i};e.setIndex(r)},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=r.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var a=r.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=i(e.value);return 1!==t.readInt(1)||o(this.fileName)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=i(e.value);return 1!==t.readInt(1)||o(this.fileComment)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null}},t.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,n){var i=e("./stream/StreamHelper"),r=e("./stream/DataWorker"),a=e("./utf8"),o=e("./compressedObject"),s=e("./stream/GenericWorker"),l=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};l.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var r="string"===(n=e.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker();var o=!this._dataBinary;o&&!r&&(t=t.pipe(new a.Utf8EncodeWorker)),!o&&r&&(t=t.pipe(new a.Utf8DecodeWorker))}catch(e){(t=new s("error")).error(e)}return new i(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof s?this._data:new r(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<c.length;u++)l.prototype[c[u]]=f;t.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,n){(function(e){var n,i,r=e.MutationObserver||e.WebKitMutationObserver;if(r){var a=0,o=new r(f),s=e.document.createTextNode("");o.observe(s,{characterData:!0}),n=function(){s.data=a=++a%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){f(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(f,0)};else{var l=new e.MessageChannel;l.port1.onmessage=f,n=function(){l.port2.postMessage(0)}}var c=[];function f(){var e,t;i=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}i=!1}t.exports=function(e){1!==c.push(e)||i||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,n){var i=e("immediate");function r(){}var a={},o=["REJECTED"],s=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==r&&h(this,e)}function f(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(e,t,n){i((function(){var i;try{i=t(n)}catch(t){return a.reject(e,t)}i===e?a.reject(e,new TypeError("Cannot resolve promise with itself")):a.resolve(e,i)}))}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function h(e,t){var n=!1;function i(t){n||(n=!0,a.reject(e,t))}function r(t){n||(n=!0,a.resolve(e,t))}var o=p((function(){t(r,i)}));"error"===o.status&&i(o.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=c,c.prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){throw n}))}))},c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(r);this.state!==l?u(n,this.state===s?e:t,this.outcome):this.queue.push(new f(n,e,t));return n},f.prototype.callFulfilled=function(e){a.resolve(this.promise,e)},f.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},f.prototype.callRejected=function(e){a.reject(this.promise,e)},f.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},a.resolve=function(e,t){var n=p(d,t);if("error"===n.status)return a.reject(e,n.value);var i=n.value;if(i)h(e,i);else{e.state=s,e.outcome=t;for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callFulfilled(t)}return e},a.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},c.resolve=function(e){if(e instanceof this)return e;return a.resolve(new this(r),e)},c.reject=function(e){var t=new this(r);return a.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);var o=new Array(n),s=0,l=-1,c=new this(r);for(;++l<n;)f(e[l],l);return c;function f(e,r){t.resolve(e).then((function(e){o[r]=e,++s!==n||i||(i=!0,a.resolve(c,o))}),(function(e){i||(i=!0,a.reject(c,e))}))}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);var o=-1,s=new this(r);for(;++o<n;)l=e[o],t.resolve(l).then((function(e){i||(i=!0,a.resolve(s,e))}),(function(e){i||(i=!0,a.reject(s,e))}));var l;return s}},{immediate:36}],38:[function(e,t,n){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,n){var i=e("./zlib/deflate"),r=e("./utils/common"),a=e("./utils/strings"),o=e("./zlib/messages"),s=e("./zlib/zstream"),l=Object.prototype.toString,c=0,f=-1,u=0,d=8;function h(e){if(!(this instanceof h))return new h(e);this.options=r.assign({level:f,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==c)throw new Error(o[n]);if(t.header&&i.deflateSetHeader(this.strm,t.header),t.dictionary){var p;if(p="string"==typeof t.dictionary?a.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=i.deflateSetDictionary(this.strm,p))!==c)throw new Error(o[n]);this._dict_set=!0}}function p(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}h.prototype.push=function(e,t){var n,o,s=this.strm,f=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=a.string2buf(e):"[object ArrayBuffer]"===l.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new r.Buf8(f),s.next_out=0,s.avail_out=f),1!==(n=i.deflate(s,o))&&n!==c)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(a.buf2binstring(r.shrinkBuf(s.output,s.next_out))):this.onData(r.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===o?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c):2!==o||(this.onEnd(c),s.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=h,n.deflate=p,n.deflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},n.gzip=function(e,t){return(t=t||{}).gzip=!0,p(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,n){var i=e("./zlib/inflate"),r=e("./utils/common"),a=e("./utils/strings"),o=e("./zlib/constants"),s=e("./zlib/messages"),l=e("./zlib/zstream"),c=e("./zlib/gzheader"),f=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(s[n]);this.header=new c,i.inflateGetHeader(this.strm,this.header)}function d(e,t){var n=new u(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}u.prototype.push=function(e,t){var n,s,l,c,u,d,h=this.strm,p=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?h.input=a.binstring2buf(e):"[object ArrayBuffer]"===f.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new r.Buf8(p),h.next_out=0,h.avail_out=p),(n=i.inflate(h,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&m&&(d="string"==typeof m?a.string2buf(m):"[object ArrayBuffer]"===f.call(m)?new Uint8Array(m):m,n=i.inflateSetDictionary(this.strm,d)),n===o.Z_BUF_ERROR&&!0===g&&(n=o.Z_OK,g=!1),n!==o.Z_STREAM_END&&n!==o.Z_OK)return this.onEnd(n),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&n!==o.Z_STREAM_END&&(0!==h.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(h.output,h.next_out),c=h.next_out-l,u=a.buf2string(h.output,l),h.next_out=c,h.avail_out=p-c,c&&r.arraySet(h.output,h.output,l,c,0),this.onData(u)):this.onData(r.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(g=!0)}while((h.avail_in>0||0===h.avail_out)&&n!==o.Z_STREAM_END);return n===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),h.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=u,n.inflate=d,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},n.ungzip=d},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,n){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var a=0;a<i;a++)e[r+a]=t[n+a]},flattenChunks:function(e){var t,n,i,r,a,o;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(o=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)a=e[t],o.set(a,r),r+=a.length;return o}},a={arraySet:function(e,t,n,i,r){for(var a=0;a<i;a++)e[r+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(i)},{}],42:[function(e,t,n){var i=e("./common"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var o=new i.Buf8(256),s=0;s<256;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function l(e,t){if(t<65537&&(e.subarray&&a||!e.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}o[254]=o[254]=1,n.string2buf=function(e){var t,n,r,a,o,s=e.length,l=0;for(a=0;a<s;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(l),o=0,a=0;o<l;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},n.buf2binstring=function(e){return l(e,e.length)},n.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,i,r,a,s=t||e.length,c=new Array(2*s);for(i=0,n=0;n<s;)if((r=e[n++])<128)c[i++]=r;else if((a=o[r])>4)c[i++]=65533,n+=a-1;else{for(r&=2===a?31:3===a?15:7;a>1&&n<s;)r=r<<6|63&e[n++],a--;a>1?c[i++]=65533:r<65536?c[i++]=r:(r-=65536,c[i++]=55296|r>>10&1023,c[i++]=56320|1023&r)}return l(c,i)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+o[e[n]]>t?n:t}},{"./common":41}],43:[function(e,t,n){t.exports=function(e,t,n,i){for(var r=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(r=r+t[i++]|0)|0}while(--o);r%=65521,a%=65521}return r|a<<16|0}},{}],44:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,n){var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,r){var a=i,o=r+n;e^=-1;for(var s=r;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},{}],46:[function(e,t,n){var i,r=e("../utils/common"),a=e("./trees"),o=e("./adler32"),s=e("./crc32"),l=e("./messages"),c=0,f=4,u=0,d=-2,h=-1,p=4,m=2,g=8,b=9,y=286,v=30,w=19,k=2*y+1,_=15,S=3,C=258,E=C+S+1,x=42,A=103,D=113,R=666,B=1,P=2,O=3,L=4;function I(e,t){return e.msg=l[t],t}function T(e){return(e<<1)-(e>4?9:0)}function U(e){for(var t=e.length;--t>=0;)e[t]=0}function F(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(r.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function $(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,F(e.strm)}function M(e,t){e.pending_buf[e.pending++]=t}function N(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function z(e,t){var n,i,r=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-E?e.strstart-(e.w_size-E):0,c=e.window,f=e.w_mask,u=e.prev,d=e.strstart+C,h=c[a+o-1],p=c[a+o];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(n=t)+o]===p&&c[n+o-1]===h&&c[n]===c[a]&&c[++n]===c[a+1]){a+=2,n++;do{}while(c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&a<d);if(i=C-(d-a),a=d-C,i>o){if(e.match_start=t,o=i,i>=s)break;h=c[a+o-1],p=c[a+o]}}}while((t=u[t&f])>l&&0!=--r);return o<=e.lookahead?o:e.lookahead}function K(e){var t,n,i,a,l,c,f,u,d,h,p=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-E)){r.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=p?i-p:0}while(--n);t=n=p;do{i=e.prev[--t],e.prev[t]=i>=p?i-p:0}while(--n);a+=p}if(0===e.strm.avail_in)break;if(c=e.strm,f=e.window,u=e.strstart+e.lookahead,d=a,h=void 0,(h=c.avail_in)>d&&(h=d),n=0===h?0:(c.avail_in-=h,r.arraySet(f,c.input,c.next_in,h,u),1===c.state.wrap?c.adler=o(c.adler,f,h,u):2===c.state.wrap&&(c.adler=s(c.adler,f,h,u)),c.next_in+=h,c.total_in+=h,h),e.lookahead+=n,e.lookahead+e.insert>=S)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+S-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<S)););}while(e.lookahead<E&&0!==e.strm.avail_in)}function W(e,t){for(var n,i;;){if(e.lookahead<E){if(K(e),e.lookahead<E&&t===c)return B;if(0===e.lookahead)break}if(n=0,e.lookahead>=S&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+S-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-E&&(e.match_length=z(e,n)),e.match_length>=S)if(i=a._tr_tally(e,e.strstart-e.match_start,e.match_length-S),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=S){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+S-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&($(e,!1),0===e.strm.avail_out))return B}return e.insert=e.strstart<S-1?e.strstart:S-1,t===f?($(e,!0),0===e.strm.avail_out?O:L):e.last_lit&&($(e,!1),0===e.strm.avail_out)?B:P}function j(e,t){for(var n,i,r;;){if(e.lookahead<E){if(K(e),e.lookahead<E&&t===c)return B;if(0===e.lookahead)break}if(n=0,e.lookahead>=S&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+S-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=S-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-E&&(e.match_length=z(e,n),e.match_length<=5&&(1===e.strategy||e.match_length===S&&e.strstart-e.match_start>4096)&&(e.match_length=S-1)),e.prev_length>=S&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-S,i=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-S),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+S-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=S-1,e.strstart++,i&&($(e,!1),0===e.strm.avail_out))return B}else if(e.match_available){if((i=a._tr_tally(e,0,e.window[e.strstart-1]))&&$(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return B}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<S-1?e.strstart:S-1,t===f?($(e,!0),0===e.strm.avail_out?O:L):e.last_lit&&($(e,!1),0===e.strm.avail_out)?B:P}function q(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function Z(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*k),this.dyn_dtree=new r.Buf16(2*(2*v+1)),this.bl_tree=new r.Buf16(2*(2*w+1)),U(this.dyn_ltree),U(this.dyn_dtree),U(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(_+1),this.heap=new r.Buf16(2*y+1),U(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*y+1),U(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function H(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=m,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?x:D,e.adler=2===t.wrap?0:1,t.last_flush=c,a._tr_init(t),u):I(e,d)}function Y(e){var t,n=H(e);return n===u&&((t=e.state).window_size=2*t.w_size,U(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=S-1,t.match_available=0,t.ins_h=0),n}function J(e,t,n,i,a,o){if(!e)return d;var s=1;if(t===h&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),a<1||a>b||n!==g||i<8||i>15||t<0||t>9||o<0||o>p)return I(e,d);8===i&&(i=9);var l=new Z;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+S-1)/S),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=n,Y(e)}i=[new q(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(K(e),0===e.lookahead&&t===c)return B;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,$(e,!1),0===e.strm.avail_out))return B;if(e.strstart-e.block_start>=e.w_size-E&&($(e,!1),0===e.strm.avail_out))return B}return e.insert=0,t===f?($(e,!0),0===e.strm.avail_out?O:L):(e.strstart>e.block_start&&($(e,!1),e.strm.avail_out),B)})),new q(4,4,8,4,W),new q(4,5,16,8,W),new q(4,6,32,32,W),new q(4,4,16,16,j),new q(8,16,32,32,j),new q(8,16,128,128,j),new q(8,32,128,256,j),new q(32,128,258,1024,j),new q(32,258,258,4096,j)],n.deflateInit=function(e,t){return J(e,t,g,15,8,0)},n.deflateInit2=J,n.deflateReset=Y,n.deflateResetKeep=H,n.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?d:(e.state.gzhead=t,u):d},n.deflate=function(e,t){var n,r,o,l;if(!e||!e.state||t>5||t<0)return e?I(e,d):d;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===R&&t!==f)return I(e,0===e.avail_out?-5:d);if(r.strm=e,n=r.last_flush,r.last_flush=t,r.status===x)if(2===r.wrap)e.adler=0,M(r,31),M(r,139),M(r,8),r.gzhead?(M(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),M(r,255&r.gzhead.time),M(r,r.gzhead.time>>8&255),M(r,r.gzhead.time>>16&255),M(r,r.gzhead.time>>24&255),M(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),M(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(M(r,255&r.gzhead.extra.length),M(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=s(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(M(r,0),M(r,0),M(r,0),M(r,0),M(r,0),M(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),M(r,3),r.status=D);else{var h=g+(r.w_bits-8<<4)<<8;h|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(h|=32),h+=31-h%31,r.status=D,N(r,h),0!==r.strstart&&(N(r,e.adler>>>16),N(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(o=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>o&&(e.adler=s(e.adler,r.pending_buf,r.pending-o,o)),F(e),o=r.pending,r.pending!==r.pending_buf_size));)M(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>o&&(e.adler=s(e.adler,r.pending_buf,r.pending-o,o)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(e.adler=s(e.adler,r.pending_buf,r.pending-o,o)),F(e),o=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,M(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>o&&(e.adler=s(e.adler,r.pending_buf,r.pending-o,o)),0===l&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(e.adler=s(e.adler,r.pending_buf,r.pending-o,o)),F(e),o=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,M(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>o&&(e.adler=s(e.adler,r.pending_buf,r.pending-o,o)),0===l&&(r.status=A)}else r.status=A;if(r.status===A&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&F(e),r.pending+2<=r.pending_buf_size&&(M(r,255&e.adler),M(r,e.adler>>8&255),e.adler=0,r.status=D)):r.status=D),0!==r.pending){if(F(e),0===e.avail_out)return r.last_flush=-1,u}else if(0===e.avail_in&&T(t)<=T(n)&&t!==f)return I(e,-5);if(r.status===R&&0!==e.avail_in)return I(e,-5);if(0!==e.avail_in||0!==r.lookahead||t!==c&&r.status!==R){var p=2===r.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(K(e),0===e.lookahead)){if(t===c)return B;break}if(e.match_length=0,n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&($(e,!1),0===e.strm.avail_out))return B}return e.insert=0,t===f?($(e,!0),0===e.strm.avail_out?O:L):e.last_lit&&($(e,!1),0===e.strm.avail_out)?B:P}(r,t):3===r.strategy?function(e,t){for(var n,i,r,o,s=e.window;;){if(e.lookahead<=C){if(K(e),e.lookahead<=C&&t===c)return B;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=S&&e.strstart>0&&(i=s[r=e.strstart-1])===s[++r]&&i===s[++r]&&i===s[++r]){o=e.strstart+C;do{}while(i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&r<o);e.match_length=C-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=S?(n=a._tr_tally(e,1,e.match_length-S),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&($(e,!1),0===e.strm.avail_out))return B}return e.insert=0,t===f?($(e,!0),0===e.strm.avail_out?O:L):e.last_lit&&($(e,!1),0===e.strm.avail_out)?B:P}(r,t):i[r.level].func(r,t);if(p!==O&&p!==L||(r.status=R),p===B||p===O)return 0===e.avail_out&&(r.last_flush=-1),u;if(p===P&&(1===t?a._tr_align(r):5!==t&&(a._tr_stored_block(r,0,0,!1),3===t&&(U(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),F(e),0===e.avail_out))return r.last_flush=-1,u}return t!==f?u:r.wrap<=0?1:(2===r.wrap?(M(r,255&e.adler),M(r,e.adler>>8&255),M(r,e.adler>>16&255),M(r,e.adler>>24&255),M(r,255&e.total_in),M(r,e.total_in>>8&255),M(r,e.total_in>>16&255),M(r,e.total_in>>24&255)):(N(r,e.adler>>>16),N(r,65535&e.adler)),F(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?u:1)},n.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==x&&69!==t&&73!==t&&91!==t&&t!==A&&t!==D&&t!==R?I(e,d):(e.state=null,t===D?I(e,-3):u):d},n.deflateSetDictionary=function(e,t){var n,i,a,s,l,c,f,h,p=t.length;if(!e||!e.state)return d;if(2===(s=(n=e.state).wrap)||1===s&&n.status!==x||n.lookahead)return d;for(1===s&&(e.adler=o(e.adler,t,p,0)),n.wrap=0,p>=n.w_size&&(0===s&&(U(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new r.Buf8(n.w_size),r.arraySet(h,t,p-n.w_size,n.w_size,0),t=h,p=n.w_size),l=e.avail_in,c=e.next_in,f=e.input,e.avail_in=p,e.next_in=0,e.input=t,K(n);n.lookahead>=S;){i=n.strstart,a=n.lookahead-(S-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+S-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++}while(--a);n.strstart=i,n.lookahead=S-1,K(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=S-1,n.match_available=0,e.next_in=c,e.input=f,e.avail_in=l,n.wrap=s,u},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,n){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,n){t.exports=function(e,t){var n,i,r,a,o,s,l,c,f,u,d,h,p,m,g,b,y,v,w,k,_,S,C,E,x;n=e.state,i=e.next_in,E=e.input,r=i+(e.avail_in-5),a=e.next_out,x=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=n.dmax,c=n.wsize,f=n.whave,u=n.wnext,d=n.window,h=n.hold,p=n.bits,m=n.lencode,g=n.distcode,b=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(h+=E[i++]<<p,p+=8,h+=E[i++]<<p,p+=8),v=m[h&b];t:for(;;){if(h>>>=w=v>>>24,p-=w,0===(w=v>>>16&255))x[a++]=65535&v;else{if(!(16&w)){if(0==(64&w)){v=m[(65535&v)+(h&(1<<w)-1)];continue t}if(32&w){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}k=65535&v,(w&=15)&&(p<w&&(h+=E[i++]<<p,p+=8),k+=h&(1<<w)-1,h>>>=w,p-=w),p<15&&(h+=E[i++]<<p,p+=8,h+=E[i++]<<p,p+=8),v=g[h&y];n:for(;;){if(h>>>=w=v>>>24,p-=w,!(16&(w=v>>>16&255))){if(0==(64&w)){v=g[(65535&v)+(h&(1<<w)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(_=65535&v,p<(w&=15)&&(h+=E[i++]<<p,(p+=8)<w&&(h+=E[i++]<<p,p+=8)),(_+=h&(1<<w)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(h>>>=w,p-=w,_>(w=a-o)){if((w=_-w)>f&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(S=0,C=d,0===u){if(S+=c-w,w<k){k-=w;do{x[a++]=d[S++]}while(--w);S=a-_,C=x}}else if(u<w){if(S+=c+u-w,(w-=u)<k){k-=w;do{x[a++]=d[S++]}while(--w);if(S=0,u<k){k-=w=u;do{x[a++]=d[S++]}while(--w);S=a-_,C=x}}}else if(S+=u-w,w<k){k-=w;do{x[a++]=d[S++]}while(--w);S=a-_,C=x}for(;k>2;)x[a++]=C[S++],x[a++]=C[S++],x[a++]=C[S++],k-=3;k&&(x[a++]=C[S++],k>1&&(x[a++]=C[S++]))}else{S=a-_;do{x[a++]=x[S++],x[a++]=x[S++],x[a++]=x[S++],k-=3}while(k>2);k&&(x[a++]=x[S++],k>1&&(x[a++]=x[S++]))}break}}break}}while(i<r&&a<s);i-=k=p>>3,h&=(1<<(p-=k<<3))-1,e.next_in=i,e.next_out=a,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=a<s?s-a+257:257-(a-s),n.hold=h,n.bits=p}},{}],49:[function(e,t,n){var i=e("../utils/common"),r=e("./adler32"),a=e("./crc32"),o=e("./inffast"),s=e("./inftrees"),l=1,c=2,f=0,u=-2,d=1,h=12,p=30,m=852,g=592;function b(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=d,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(m),t.distcode=t.distdyn=new i.Buf32(g),t.sane=1,t.back=-1,f):u}function w(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,v(e)):u}function k(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?u:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,w(e))):u}function _(e,t){var n,i;return e?(i=new y,e.state=i,i.window=null,(n=k(e,t))!==f&&(e.state=null),n):u}var S,C,E=!0;function x(e){if(E){var t;for(S=new i.Buf32(512),C=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(l,e.lens,0,288,S,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(c,e.lens,0,32,C,0,e.work,{bits:5}),E=!1}e.lencode=S,e.lenbits=9,e.distcode=C,e.distbits=5}function A(e,t,n,r){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new i.Buf8(o.wsize)),r>=o.wsize?(i.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>r&&(a=r),i.arraySet(o.window,t,n-r,a,o.wnext),(r-=a)?(i.arraySet(o.window,t,n-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}n.inflateReset=w,n.inflateReset2=k,n.inflateResetKeep=v,n.inflateInit=function(e){return _(e,15)},n.inflateInit2=_,n.inflate=function(e,t){var n,m,g,y,v,w,k,_,S,C,E,D,R,B,P,O,L,I,T,U,F,$,M,N,z=0,K=new i.Buf8(4),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return u;(n=e.state).mode===h&&(n.mode=13),v=e.next_out,g=e.output,k=e.avail_out,y=e.next_in,m=e.input,w=e.avail_in,_=n.hold,S=n.bits,C=w,E=k,$=f;e:for(;;)switch(n.mode){case d:if(0===n.wrap){n.mode=13;break}for(;S<16;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}if(2&n.wrap&&35615===_){n.check=0,K[0]=255&_,K[1]=_>>>8&255,n.check=a(n.check,K,2,0),_=0,S=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",n.mode=p;break}if(8!=(15&_)){e.msg="unknown compression method",n.mode=p;break}if(S-=4,F=8+(15&(_>>>=4)),0===n.wbits)n.wbits=F;else if(F>n.wbits){e.msg="invalid window size",n.mode=p;break}n.dmax=1<<F,e.adler=n.check=1,n.mode=512&_?10:h,_=0,S=0;break;case 2:for(;S<16;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}if(n.flags=_,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=p;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=p;break}n.head&&(n.head.text=_>>8&1),512&n.flags&&(K[0]=255&_,K[1]=_>>>8&255,n.check=a(n.check,K,2,0)),_=0,S=0,n.mode=3;case 3:for(;S<32;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}n.head&&(n.head.time=_),512&n.flags&&(K[0]=255&_,K[1]=_>>>8&255,K[2]=_>>>16&255,K[3]=_>>>24&255,n.check=a(n.check,K,4,0)),_=0,S=0,n.mode=4;case 4:for(;S<16;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}n.head&&(n.head.xflags=255&_,n.head.os=_>>8),512&n.flags&&(K[0]=255&_,K[1]=_>>>8&255,n.check=a(n.check,K,2,0)),_=0,S=0,n.mode=5;case 5:if(1024&n.flags){for(;S<16;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}n.length=_,n.head&&(n.head.extra_len=_),512&n.flags&&(K[0]=255&_,K[1]=_>>>8&255,n.check=a(n.check,K,2,0)),_=0,S=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((D=n.length)>w&&(D=w),D&&(n.head&&(F=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,m,y,D,F)),512&n.flags&&(n.check=a(n.check,m,D,y)),w-=D,y+=D,n.length-=D),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===w)break e;D=0;do{F=m[y+D++],n.head&&F&&n.length<65536&&(n.head.name+=String.fromCharCode(F))}while(F&&D<w);if(512&n.flags&&(n.check=a(n.check,m,D,y)),w-=D,y+=D,F)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===w)break e;D=0;do{F=m[y+D++],n.head&&F&&n.length<65536&&(n.head.comment+=String.fromCharCode(F))}while(F&&D<w);if(512&n.flags&&(n.check=a(n.check,m,D,y)),w-=D,y+=D,F)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;S<16;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}if(_!==(65535&n.check)){e.msg="header crc mismatch",n.mode=p;break}_=0,S=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=h;break;case 10:for(;S<32;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}e.adler=n.check=b(_),_=0,S=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=v,e.avail_out=k,e.next_in=y,e.avail_in=w,n.hold=_,n.bits=S,2;e.adler=n.check=1,n.mode=h;case h:if(5===t||6===t)break e;case 13:if(n.last){_>>>=7&S,S-=7&S,n.mode=27;break}for(;S<3;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}switch(n.last=1&_,S-=1,3&(_>>>=1)){case 0:n.mode=14;break;case 1:if(x(n),n.mode=20,6===t){_>>>=2,S-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=p}_>>>=2,S-=2;break;case 14:for(_>>>=7&S,S-=7&S;S<32;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",n.mode=p;break}if(n.length=65535&_,_=0,S=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(D=n.length){if(D>w&&(D=w),D>k&&(D=k),0===D)break e;i.arraySet(g,m,y,D,v),w-=D,y+=D,k-=D,v+=D,n.length-=D;break}n.mode=h;break;case 17:for(;S<14;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}if(n.nlen=257+(31&_),_>>>=5,S-=5,n.ndist=1+(31&_),_>>>=5,S-=5,n.ncode=4+(15&_),_>>>=4,S-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=p;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;S<3;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}n.lens[W[n.have++]]=7&_,_>>>=3,S-=3}for(;n.have<19;)n.lens[W[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,M={bits:n.lenbits},$=s(0,n.lens,0,19,n.lencode,0,n.work,M),n.lenbits=M.bits,$){e.msg="invalid code lengths set",n.mode=p;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;O=(z=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,L=65535&z,!((P=z>>>24)<=S);){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}if(L<16)_>>>=P,S-=P,n.lens[n.have++]=L;else{if(16===L){for(N=P+2;S<N;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}if(_>>>=P,S-=P,0===n.have){e.msg="invalid bit length repeat",n.mode=p;break}F=n.lens[n.have-1],D=3+(3&_),_>>>=2,S-=2}else if(17===L){for(N=P+3;S<N;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}S-=P,F=0,D=3+(7&(_>>>=P)),_>>>=3,S-=3}else{for(N=P+7;S<N;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}S-=P,F=0,D=11+(127&(_>>>=P)),_>>>=7,S-=7}if(n.have+D>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=p;break}for(;D--;)n.lens[n.have++]=F}}if(n.mode===p)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=p;break}if(n.lenbits=9,M={bits:n.lenbits},$=s(l,n.lens,0,n.nlen,n.lencode,0,n.work,M),n.lenbits=M.bits,$){e.msg="invalid literal/lengths set",n.mode=p;break}if(n.distbits=6,n.distcode=n.distdyn,M={bits:n.distbits},$=s(c,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,M),n.distbits=M.bits,$){e.msg="invalid distances set",n.mode=p;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(w>=6&&k>=258){e.next_out=v,e.avail_out=k,e.next_in=y,e.avail_in=w,n.hold=_,n.bits=S,o(e,E),v=e.next_out,g=e.output,k=e.avail_out,y=e.next_in,m=e.input,w=e.avail_in,_=n.hold,S=n.bits,n.mode===h&&(n.back=-1);break}for(n.back=0;O=(z=n.lencode[_&(1<<n.lenbits)-1])>>>16&255,L=65535&z,!((P=z>>>24)<=S);){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}if(O&&0==(240&O)){for(I=P,T=O,U=L;O=(z=n.lencode[U+((_&(1<<I+T)-1)>>I)])>>>16&255,L=65535&z,!(I+(P=z>>>24)<=S);){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}_>>>=I,S-=I,n.back+=I}if(_>>>=P,S-=P,n.back+=P,n.length=L,0===O){n.mode=26;break}if(32&O){n.back=-1,n.mode=h;break}if(64&O){e.msg="invalid literal/length code",n.mode=p;break}n.extra=15&O,n.mode=22;case 22:if(n.extra){for(N=n.extra;S<N;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}n.length+=_&(1<<n.extra)-1,_>>>=n.extra,S-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;O=(z=n.distcode[_&(1<<n.distbits)-1])>>>16&255,L=65535&z,!((P=z>>>24)<=S);){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}if(0==(240&O)){for(I=P,T=O,U=L;O=(z=n.distcode[U+((_&(1<<I+T)-1)>>I)])>>>16&255,L=65535&z,!(I+(P=z>>>24)<=S);){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}_>>>=I,S-=I,n.back+=I}if(_>>>=P,S-=P,n.back+=P,64&O){e.msg="invalid distance code",n.mode=p;break}n.offset=L,n.extra=15&O,n.mode=24;case 24:if(n.extra){for(N=n.extra;S<N;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}n.offset+=_&(1<<n.extra)-1,_>>>=n.extra,S-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=p;break}n.mode=25;case 25:if(0===k)break e;if(D=E-k,n.offset>D){if((D=n.offset-D)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=p;break}D>n.wnext?(D-=n.wnext,R=n.wsize-D):R=n.wnext-D,D>n.length&&(D=n.length),B=n.window}else B=g,R=v-n.offset,D=n.length;D>k&&(D=k),k-=D,n.length-=D;do{g[v++]=B[R++]}while(--D);0===n.length&&(n.mode=21);break;case 26:if(0===k)break e;g[v++]=n.length,k--,n.mode=21;break;case 27:if(n.wrap){for(;S<32;){if(0===w)break e;w--,_|=m[y++]<<S,S+=8}if(E-=k,e.total_out+=E,n.total+=E,E&&(e.adler=n.check=n.flags?a(n.check,g,E,v-E):r(n.check,g,E,v-E)),E=k,(n.flags?_:b(_))!==n.check){e.msg="incorrect data check",n.mode=p;break}_=0,S=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;S<32;){if(0===w)break e;w--,_+=m[y++]<<S,S+=8}if(_!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=p;break}_=0,S=0}n.mode=29;case 29:$=1;break e;case p:$=-3;break e;case 31:return-4;default:return u}return e.next_out=v,e.avail_out=k,e.next_in=y,e.avail_in=w,n.hold=_,n.bits=S,(n.wsize||E!==e.avail_out&&n.mode<p&&(n.mode<27||4!==t))&&A(e,e.output,e.next_out,E-e.avail_out),C-=e.avail_in,E-=e.avail_out,e.total_in+=C,e.total_out+=E,n.total+=E,n.wrap&&E&&(e.adler=n.check=n.flags?a(n.check,g,E,e.next_out-E):r(n.check,g,E,e.next_out-E)),e.data_type=n.bits+(n.last?64:0)+(n.mode===h?128:0)+(20===n.mode||15===n.mode?256:0),(0===C&&0===E||4===t)&&$===f&&($=-5),$},n.inflateEnd=function(e){if(!e||!e.state)return u;var t=e.state;return t.window&&(t.window=null),e.state=null,f},n.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?u:(n.head=t,t.done=!1,f):u},n.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?u:11===n.mode&&r(1,t,i,0)!==n.check?-3:A(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,f):u},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,n){var i=e("../utils/common"),r=15,a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,c,f,u,d,h){var p,m,g,b,y,v,w,k,_,S=h.bits,C=0,E=0,x=0,A=0,D=0,R=0,B=0,P=0,O=0,L=0,I=null,T=0,U=new i.Buf16(16),F=new i.Buf16(16),$=null,M=0;for(C=0;C<=r;C++)U[C]=0;for(E=0;E<c;E++)U[t[n+E]]++;for(D=S,A=r;A>=1&&0===U[A];A--);if(D>A&&(D=A),0===A)return f[u++]=20971520,f[u++]=20971520,h.bits=1,0;for(x=1;x<A&&0===U[x];x++);for(D<x&&(D=x),P=1,C=1;C<=r;C++)if(P<<=1,(P-=U[C])<0)return-1;if(P>0&&(0===e||1!==A))return-1;for(F[1]=0,C=1;C<r;C++)F[C+1]=F[C]+U[C];for(E=0;E<c;E++)0!==t[n+E]&&(d[F[t[n+E]]++]=E);if(0===e?(I=$=d,v=19):1===e?(I=a,T-=257,$=o,M-=257,v=256):(I=s,$=l,v=-1),L=0,E=0,C=x,y=u,R=D,B=0,g=-1,b=(O=1<<D)-1,1===e&&O>852||2===e&&O>592)return 1;for(;;){w=C-B,d[E]<v?(k=0,_=d[E]):d[E]>v?(k=$[M+d[E]],_=I[T+d[E]]):(k=96,_=0),p=1<<C-B,x=m=1<<R;do{f[y+(L>>B)+(m-=p)]=w<<24|k<<16|_|0}while(0!==m);for(p=1<<C-1;L&p;)p>>=1;if(0!==p?(L&=p-1,L+=p):L=0,E++,0==--U[C]){if(C===A)break;C=t[n+d[E]]}if(C>D&&(L&b)!==g){for(0===B&&(B=D),y+=x,P=1<<(R=C-B);R+B<A&&!((P-=U[R+B])<=0);)R++,P<<=1;if(O+=1<<R,1===e&&O>852||2===e&&O>592)return 1;f[g=L&b]=D<<24|R<<16|y-u|0}}return 0!==L&&(f[y+L]=C-B<<24|64<<16|0),h.bits=D,0}},{"../utils/common":41}],51:[function(e,t,n){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,n){var i=e("../utils/common"),r=0,a=1;function o(e){for(var t=e.length;--t>=0;)e[t]=0}var s=0,l=29,c=256,f=c+1+l,u=30,d=19,h=2*f+1,p=15,m=16,g=7,b=256,y=16,v=17,w=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],_=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],E=new Array(2*(f+2));o(E);var x=new Array(2*u);o(x);var A=new Array(512);o(A);var D=new Array(256);o(D);var R=new Array(l);o(R);var B,P,O,L=new Array(u);function I(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function T(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function U(e){return e<256?A[e]:A[256+(e>>>7)]}function F(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function $(e,t,n){e.bi_valid>m-n?(e.bi_buf|=t<<e.bi_valid&65535,F(e,e.bi_buf),e.bi_buf=t>>m-e.bi_valid,e.bi_valid+=n-m):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function M(e,t,n){$(e,n[2*t],n[2*t+1])}function N(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function z(e,t,n){var i,r,a=new Array(p+1),o=0;for(i=1;i<=p;i++)a[i]=o=o+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=N(a[s]++,s))}}function K(e){var t;for(t=0;t<f;t++)e.dyn_ltree[2*t]=0;for(t=0;t<u;t++)e.dyn_dtree[2*t]=0;for(t=0;t<d;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*b]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function W(e){e.bi_valid>8?F(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function j(e,t,n,i){var r=2*t,a=2*n;return e[r]<e[a]||e[r]===e[a]&&i[t]<=i[n]}function q(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&j(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!j(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function Z(e,t,n){var i,r,a,o,s=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],r=e.pending_buf[e.l_buf+s],s++,0===i?M(e,r,t):(M(e,(a=D[r])+c+1,t),0!==(o=k[a])&&$(e,r-=R[a],o),M(e,a=U(--i),n),0!==(o=_[a])&&$(e,i-=L[a],o))}while(s<e.last_lit);M(e,b,t)}function H(e,t){var n,i,r,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=h,n=0;n<l;n++)0!==a[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(r=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=o[2*r+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)q(e,a,n);r=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],q(e,a,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,a[2*r]=a[2*n]+a[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,a[2*n+1]=a[2*i+1]=r,e.heap[1]=r++,q(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,a,o,s,l=t.dyn_tree,c=t.max_code,f=t.stat_desc.static_tree,u=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,m=t.stat_desc.extra_base,g=t.stat_desc.max_length,b=0;for(a=0;a<=p;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<h;n++)(a=l[2*l[2*(i=e.heap[n])+1]+1]+1)>g&&(a=g,b++),l[2*i+1]=a,i>c||(e.bl_count[a]++,o=0,i>=m&&(o=d[i-m]),s=l[2*i],e.opt_len+=s*(a+o),u&&(e.static_len+=s*(f[2*i+1]+o)));if(0!==b){do{for(a=g-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[g]--,b-=2}while(b>0);for(a=g;0!==a;a--)for(i=e.bl_count[a];0!==i;)(r=e.heap[--n])>c||(l[2*r+1]!==a&&(e.opt_len+=(a-l[2*r+1])*l[2*r],l[2*r+1]=a),i--)}}(e,t),z(a,c,e.bl_count)}function Y(e,t,n){var i,r,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=o,o=t[2*(i+1)+1],++s<l&&r===o||(s<c?e.bl_tree[2*r]+=s:0!==r?(r!==a&&e.bl_tree[2*r]++,e.bl_tree[2*y]++):s<=10?e.bl_tree[2*v]++:e.bl_tree[2*w]++,s=0,a=r,0===o?(l=138,c=3):r===o?(l=6,c=3):(l=7,c=4))}function J(e,t,n){var i,r,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),i=0;i<=n;i++)if(r=o,o=t[2*(i+1)+1],!(++s<l&&r===o)){if(s<c)do{M(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==a&&(M(e,r,e.bl_tree),s--),M(e,y,e.bl_tree),$(e,s-3,2)):s<=10?(M(e,v,e.bl_tree),$(e,s-3,3)):(M(e,w,e.bl_tree),$(e,s-11,7));s=0,a=r,0===o?(l=138,c=3):r===o?(l=6,c=3):(l=7,c=4)}}o(L);var G=!1;function V(e,t,n,r){$(e,(s<<1)+(r?1:0),3),function(e,t,n,r){W(e),F(e,n),F(e,~n),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}n._tr_init=function(e){G||(!function(){var e,t,n,i,r,a=new Array(p+1);for(n=0,i=0;i<l-1;i++)for(R[i]=n,e=0;e<1<<k[i];e++)D[n++]=i;for(D[n-1]=i,r=0,i=0;i<16;i++)for(L[i]=r,e=0;e<1<<_[i];e++)A[r++]=i;for(r>>=7;i<u;i++)for(L[i]=r<<7,e=0;e<1<<_[i]-7;e++)A[256+r++]=i;for(t=0;t<=p;t++)a[t]=0;for(e=0;e<=143;)E[2*e+1]=8,e++,a[8]++;for(;e<=255;)E[2*e+1]=9,e++,a[9]++;for(;e<=279;)E[2*e+1]=7,e++,a[7]++;for(;e<=287;)E[2*e+1]=8,e++,a[8]++;for(z(E,f+1,a),e=0;e<u;e++)x[2*e+1]=5,x[2*e]=N(e,5);B=new I(E,k,c+1,f,p),P=new I(x,_,0,u,p),O=new I(new Array(0),S,0,d,g)}(),G=!0),e.l_desc=new T(e.dyn_ltree,B),e.d_desc=new T(e.dyn_dtree,P),e.bl_desc=new T(e.bl_tree,O),e.bi_buf=0,e.bi_valid=0,K(e)},n._tr_stored_block=V,n._tr_flush_block=function(e,t,n,i){var o,s,l=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return r;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return a;for(t=32;t<c;t++)if(0!==e.dyn_ltree[2*t])return a;return r}(e)),H(e,e.l_desc),H(e,e.d_desc),l=function(e){var t;for(Y(e,e.dyn_ltree,e.l_desc.max_code),Y(e,e.dyn_dtree,e.d_desc.max_code),H(e,e.bl_desc),t=d-1;t>=3&&0===e.bl_tree[2*C[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),o=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=o&&(o=s)):o=s=n+5,n+4<=o&&-1!==t?V(e,t,n,i):4===e.strategy||s===o?($(e,2+(i?1:0),3),Z(e,E,x)):($(e,4+(i?1:0),3),function(e,t,n,i){var r;for($(e,t-257,5),$(e,n-1,5),$(e,i-4,4),r=0;r<i;r++)$(e,e.bl_tree[2*C[r]+1],3);J(e,e.dyn_ltree,t-1),J(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),Z(e,e.dyn_ltree,e.dyn_dtree)),K(e),i&&W(e)},n._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(D[n]+c+1)]++,e.dyn_dtree[2*U(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){$(e,2,3),M(e,b,E),function(e){16===e.bi_valid?(F(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,n){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,n){(function(e){!function(e,t){if(!e.setImmediate){var n,i,r,a,o,s=1,l={},c=!1,f=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?n=function(e){process.nextTick((function(){h(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((r=new MessageChannel).port1.onmessage=function(e){h(e.data)},n=function(e){r.port2.postMessage(e)}):f&&"onreadystatechange"in f.createElement("script")?(i=f.documentElement,n=function(e){var t=f.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):n=function(e){setTimeout(h,0,e)}:(a="setImmediate$"+Math.random()+"$",o=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&h(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),n=function(t){e.postMessage(a+t,"*")}),u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var r={callback:e,args:t};return l[s]=r,n(s),s++},u.clearImmediate=d}function d(e){delete l[e]}function h(e){if(c)setTimeout(h,0,e);else{var n=l[e];if(n){c=!0;try{!function(e){var n=e.callback,i=e.args;switch(i.length){case 0:n();break;case 1:n(i[0]);break;case 2:n(i[0],i[1]);break;case 3:n(i[0],i[1],i[2]);break;default:n.apply(t,i)}}(n)}finally{d(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)})),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).msgpack=e()}}((function(){return function e(t,n,i){function r(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[o]={exports:{}};t[o][0].call(f.exports,(function(e){var n=t[o][1][e];return r(n||e)}),f,f.exports,e,t,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){n.encode=e("./encode").encode,n.decode=e("./decode").decode,n.Encoder=e("./encoder").Encoder,n.Decoder=e("./decoder").Decoder,n.createCodec=e("./ext").createCodec,n.codec=e("./codec").codec},{"./codec":10,"./decode":12,"./decoder":13,"./encode":15,"./encoder":16,"./ext":20}],2:[function(e,t,n){(function(e){function n(e){return e&&e.isBuffer&&e}t.exports=n(void 0!==e&&e)||n(this.Buffer)||n("undefined"!=typeof window&&window.Buffer)||this.Buffer}).call(this,e("buffer").Buffer)},{buffer:29}],3:[function(e,t,n){n.copy=function(e,t,n,i){var r;n||(n=0),i||0===i||(i=this.length),t||(t=0);var a=i-n;if(e===this&&n<t&&t<i)for(r=a-1;r>=0;r--)e[r+t]=this[r+n];else for(r=0;r<a;r++)e[r+t]=this[r+n];return a},n.toString=function(e,t,n){var i=this,r=0|t;n||(n=i.length);for(var a="",o=0;r<n;)(o=i[r++])<128?a+=String.fromCharCode(o):(192==(224&o)?o=(31&o)<<6|63&i[r++]:224==(240&o)?o=(15&o)<<12|(63&i[r++])<<6|63&i[r++]:240==(248&o)&&(o=(7&o)<<18|(63&i[r++])<<12|(63&i[r++])<<6|63&i[r++]),o>=65536?(o-=65536,a+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):a+=String.fromCharCode(o));return a},n.write=function(e,t){for(var n=this,i=t||(t|=0),r=e.length,a=0,o=0;o<r;)(a=e.charCodeAt(o++))<128?n[i++]=a:a<2048?(n[i++]=192|a>>>6,n[i++]=128|63&a):a<55296||a>57343?(n[i++]=224|a>>>12,n[i++]=128|a>>>6&63,n[i++]=128|63&a):(a=65536+(a-55296<<10|e.charCodeAt(o++)-56320),n[i++]=240|a>>>18,n[i++]=128|a>>>12&63,n[i++]=128|a>>>6&63,n[i++]=128|63&a);return i-t}},{}],4:[function(e,t,n){function i(e){return new Array(e)}var r=e("./bufferish");(n=t.exports=i(0)).alloc=i,n.concat=r.concat,n.from=function(e){if(!r.isBuffer(e)&&r.isView(e))e=r.Uint8Array.from(e);else if(r.isArrayBuffer(e))e=new Uint8Array(e);else{if("string"==typeof e)return r.from.call(n,e);if("number"==typeof e)throw new TypeError('"value" argument must not be a number')}return Array.prototype.slice.call(e)}},{"./bufferish":8}],5:[function(e,t,n){function i(e){return new a(e)}var r=e("./bufferish"),a=r.global;(n=t.exports=r.hasBuffer?i(0):[]).alloc=r.hasBuffer&&a.alloc||i,n.concat=r.concat,n.from=function(e){if(!r.isBuffer(e)&&r.isView(e))e=r.Uint8Array.from(e);else if(r.isArrayBuffer(e))e=new Uint8Array(e);else{if("string"==typeof e)return r.from.call(n,e);if("number"==typeof e)throw new TypeError('"value" argument must not be a number')}return a.from&&1!==a.from.length?a.from(e):new a(e)}},{"./bufferish":8}],6:[function(e,t,n){function i(e,t,n,i){var s=o.isBuffer(this),l=o.isBuffer(e);if(s&&l)return this.copy(e,t,n,i);if(c||s||l||!o.isView(this)||!o.isView(e))return a.copy.call(this,e,t,n,i);var f=n||null!=i?r.call(this,n,i):this;return e.set(f,t),f.length}function r(e,t){var n=this.slice||!c&&this.subarray;if(n)return n.call(this,e,t);var r=o.alloc.call(this,t-e);return i.call(this,r,0,e,t),r}var a=e("./buffer-lite");n.copy=i,n.slice=r,n.toString=function(e,t,n){return(!l&&o.isBuffer(this)?this.toString:a.toString).apply(this,arguments)},n.write=function(e){return function(){return(this[e]||a[e]).apply(this,arguments)}}("write");var o=e("./bufferish"),s=o.global,l=o.hasBuffer&&"TYPED_ARRAY_SUPPORT"in s,c=l&&!s.TYPED_ARRAY_SUPPORT},{"./buffer-lite":3,"./bufferish":8}],7:[function(e,t,n){function i(e){return new Uint8Array(e)}var r=e("./bufferish");(n=t.exports=r.hasArrayBuffer?i(0):[]).alloc=i,n.concat=r.concat,n.from=function(e){if(r.isView(e)){var t=e.byteOffset,i=e.byteLength;(e=e.buffer).byteLength!==i&&(e.slice?e=e.slice(t,t+i):(e=new Uint8Array(e)).byteLength!==i&&(e=Array.prototype.slice.call(e,t,t+i)))}else{if("string"==typeof e)return r.from.call(n,e);if("number"==typeof e)throw new TypeError('"value" argument must not be a number')}return new Uint8Array(e)}},{"./bufferish":8}],8:[function(e,t,n){function i(e){return a(this).alloc(e)}function r(e){var t=3*e.length,n=i.call(this,t),r=b.write.call(n,e);return t!==r&&(n=b.slice.call(n,0,r)),n}function a(e){return d(e)?m:h(e)?g:u(e)?p:c?m:f?g:p}function o(){return!1}function s(e,t){return e="[object "+e+"]",function(n){return null!=n&&{}.toString.call(t?n[t]:n)===e}}var l=n.global=e("./buffer-global"),c=n.hasBuffer=l&&!!l.isBuffer,f=n.hasArrayBuffer="undefined"!=typeof ArrayBuffer,u=n.isArray=e("isarray");n.isArrayBuffer=f?function(e){return e instanceof ArrayBuffer||y(e)}:o;var d=n.isBuffer=c?l.isBuffer:o,h=n.isView=f?ArrayBuffer.isView||s("ArrayBuffer","buffer"):o;n.alloc=i,n.concat=function(e,t){t||(t=0,Array.prototype.forEach.call(e,(function(e){t+=e.length})));var r=this!==n&&this||e[0],a=i.call(r,t),o=0;return Array.prototype.forEach.call(e,(function(e){o+=b.copy.call(e,a,o)})),a},n.from=function(e){return"string"==typeof e?r.call(this,e):a(this).from(e)};var p=n.Array=e("./bufferish-array"),m=n.Buffer=e("./bufferish-buffer"),g=n.Uint8Array=e("./bufferish-uint8array"),b=n.prototype=e("./bufferish-proto"),y=s("ArrayBuffer")},{"./buffer-global":2,"./bufferish-array":4,"./bufferish-buffer":5,"./bufferish-proto":6,"./bufferish-uint8array":7,isarray:34}],9:[function(e,t,n){function i(e){return this instanceof i?(this.options=e,void this.init()):new i(e)}function r(e,t){return e&&t?function(){return e.apply(this,arguments),t.apply(this,arguments)}:e||t}function a(e){return new i(e)}var o=e("isarray");n.createCodec=a,n.install=function(e){for(var t in e)i.prototype[t]=r(i.prototype[t],e[t])},n.filter=function(e){return o(e)?function(e){function t(e,t){return t(e)}return e=e.slice(),function(n){return e.reduce(t,n)}}(e):e};var s=e("./bufferish");i.prototype.init=function(){var e=this.options;return e&&e.uint8array&&(this.bufferish=s.Uint8Array),this},n.preset=a({preset:!0})},{"./bufferish":8,isarray:34}],10:[function(e,t,n){e("./read-core"),e("./write-core"),n.codec={preset:e("./codec-base").preset}},{"./codec-base":9,"./read-core":22,"./write-core":25}],11:[function(e,t,n){function i(e){if(!(this instanceof i))return new i(e);if(e&&(this.options=e,e.codec)){var t=this.codec=e.codec;t.bufferish&&(this.bufferish=t.bufferish)}}n.DecodeBuffer=i;var r=e("./read-core").preset;e("./flex-buffer").FlexDecoder.mixin(i.prototype),i.prototype.codec=r,i.prototype.fetch=function(){return this.codec.decode(this)}},{"./flex-buffer":21,"./read-core":22}],12:[function(e,t,n){n.decode=function(e,t){var n=new i(t);return n.write(e),n.read()};var i=e("./decode-buffer").DecodeBuffer},{"./decode-buffer":11}],13:[function(e,t,n){function i(e){return this instanceof i?void a.call(this,e):new i(e)}n.Decoder=i;var r=e("event-lite"),a=e("./decode-buffer").DecodeBuffer;i.prototype=new a,r.mixin(i.prototype),i.prototype.decode=function(e){arguments.length&&this.write(e),this.flush()},i.prototype.push=function(e){this.emit("data",e)},i.prototype.end=function(e){this.decode(e),this.emit("end")}},{"./decode-buffer":11,"event-lite":31}],14:[function(e,t,n){function i(e){if(!(this instanceof i))return new i(e);if(e&&(this.options=e,e.codec)){var t=this.codec=e.codec;t.bufferish&&(this.bufferish=t.bufferish)}}n.EncodeBuffer=i;var r=e("./write-core").preset;e("./flex-buffer").FlexEncoder.mixin(i.prototype),i.prototype.codec=r,i.prototype.write=function(e){this.codec.encode(this,e)}},{"./flex-buffer":21,"./write-core":25}],15:[function(e,t,n){n.encode=function(e,t){var n=new i(t);return n.write(e),n.read()};var i=e("./encode-buffer").EncodeBuffer},{"./encode-buffer":14}],16:[function(e,t,n){function i(e){return this instanceof i?void a.call(this,e):new i(e)}n.Encoder=i;var r=e("event-lite"),a=e("./encode-buffer").EncodeBuffer;i.prototype=new a,r.mixin(i.prototype),i.prototype.encode=function(e){this.write(e),this.emit("data",this.read())},i.prototype.end=function(e){arguments.length&&this.encode(e),this.flush(),this.emit("end")}},{"./encode-buffer":14,"event-lite":31}],17:[function(e,t,n){n.ExtBuffer=function e(t,n){return this instanceof e?(this.buffer=i.from(t),void(this.type=n)):new e(t,n)};var i=e("./bufferish")},{"./bufferish":8}],18:[function(e,t,n){function i(t){return s||(s=e("./encode").encode),s(t)}function r(e){return e.valueOf()}function a(e){(e=RegExp.prototype.toString.call(e).split("/")).shift();var t=[e.pop()];return t.unshift(e.join("/")),t}function o(e){var t={};for(var n in u)t[n]=e[n];return t}n.setExtPackers=function(e){e.addExtPacker(14,Error,[o,i]),e.addExtPacker(1,EvalError,[o,i]),e.addExtPacker(2,RangeError,[o,i]),e.addExtPacker(3,ReferenceError,[o,i]),e.addExtPacker(4,SyntaxError,[o,i]),e.addExtPacker(5,TypeError,[o,i]),e.addExtPacker(6,URIError,[o,i]),e.addExtPacker(10,RegExp,[a,i]),e.addExtPacker(11,Boolean,[r,i]),e.addExtPacker(12,String,[r,i]),e.addExtPacker(13,Date,[Number,i]),e.addExtPacker(15,Number,[r,i]),"undefined"!=typeof Uint8Array&&(e.addExtPacker(17,Int8Array,f),e.addExtPacker(18,Uint8Array,f),e.addExtPacker(19,Int16Array,f),e.addExtPacker(20,Uint16Array,f),e.addExtPacker(21,Int32Array,f),e.addExtPacker(22,Uint32Array,f),e.addExtPacker(23,Float32Array,f),"undefined"!=typeof Float64Array&&e.addExtPacker(24,Float64Array,f),"undefined"!=typeof Uint8ClampedArray&&e.addExtPacker(25,Uint8ClampedArray,f),e.addExtPacker(26,ArrayBuffer,f),e.addExtPacker(29,DataView,f)),l.hasBuffer&&e.addExtPacker(27,c,l.from)};var s,l=e("./bufferish"),c=l.global,f=l.Uint8Array.from,u={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1}},{"./bufferish":8,"./encode":15}],19:[function(e,t,n){function i(t){return l||(l=e("./decode").decode),l(t)}function r(e){return RegExp.apply(null,e)}function a(e){return function(t){var n=new e;for(var i in u)n[i]=t[i];return n}}function o(e){return function(t){return new e(t)}}function s(e){return new Uint8Array(e).buffer}n.setExtUnpackers=function(e){e.addExtUnpacker(14,[i,a(Error)]),e.addExtUnpacker(1,[i,a(EvalError)]),e.addExtUnpacker(2,[i,a(RangeError)]),e.addExtUnpacker(3,[i,a(ReferenceError)]),e.addExtUnpacker(4,[i,a(SyntaxError)]),e.addExtUnpacker(5,[i,a(TypeError)]),e.addExtUnpacker(6,[i,a(URIError)]),e.addExtUnpacker(10,[i,r]),e.addExtUnpacker(11,[i,o(Boolean)]),e.addExtUnpacker(12,[i,o(String)]),e.addExtUnpacker(13,[i,o(Date)]),e.addExtUnpacker(15,[i,o(Number)]),"undefined"!=typeof Uint8Array&&(e.addExtUnpacker(17,o(Int8Array)),e.addExtUnpacker(18,o(Uint8Array)),e.addExtUnpacker(19,[s,o(Int16Array)]),e.addExtUnpacker(20,[s,o(Uint16Array)]),e.addExtUnpacker(21,[s,o(Int32Array)]),e.addExtUnpacker(22,[s,o(Uint32Array)]),e.addExtUnpacker(23,[s,o(Float32Array)]),"undefined"!=typeof Float64Array&&e.addExtUnpacker(24,[s,o(Float64Array)]),"undefined"!=typeof Uint8ClampedArray&&e.addExtUnpacker(25,o(Uint8ClampedArray)),e.addExtUnpacker(26,s),e.addExtUnpacker(29,[s,o(DataView)])),c.hasBuffer&&e.addExtUnpacker(27,o(f))};var l,c=e("./bufferish"),f=c.global,u={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1}},{"./bufferish":8,"./decode":12}],20:[function(e,t,n){e("./read-core"),e("./write-core"),n.createCodec=e("./codec-base").createCodec},{"./codec-base":9,"./read-core":22,"./write-core":25}],21:[function(e,t,n){function i(){if(!(this instanceof i))return new i}function r(){if(!(this instanceof r))return new r}function a(){throw new Error("method not implemented: write()")}function o(){throw new Error("method not implemented: fetch()")}function s(){return this.buffers&&this.buffers.length?(this.flush(),this.pull()):this.fetch()}function l(e){(this.buffers||(this.buffers=[])).push(e)}function c(){return(this.buffers||(this.buffers=[])).shift()}function f(e){return function(t){for(var n in e)t[n]=e[n];return t}}n.FlexDecoder=i,n.FlexEncoder=r;var u=e("./bufferish"),d=2048,h=65536,p="BUFFER_SHORTAGE";i.mixin=f({bufferish:u,write:function(e){var t=this.offset?u.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=t?e?this.bufferish.concat([t,e]):t:e,this.offset=0},fetch:o,flush:function(){for(;this.offset<this.buffer.length;){var e,t=this.offset;try{e=this.fetch()}catch(e){if(e&&e.message!=p)throw e;this.offset=t;break}this.push(e)}},push:l,pull:c,read:s,reserve:function(e){var t=this.offset,n=t+e;if(n>this.buffer.length)throw new Error(p);return this.offset=n,t},offset:0}),i.mixin(i.prototype),r.mixin=f({bufferish:u,write:a,fetch:function(){var e=this.start;if(e<this.offset){var t=this.start=this.offset;return u.prototype.slice.call(this.buffer,e,t)}},flush:function(){for(;this.start<this.offset;){var e=this.fetch();e&&this.push(e)}},push:l,pull:function(){var e=this.buffers||(this.buffers=[]),t=e.length>1?this.bufferish.concat(e):e[0];return e.length=0,t},read:s,reserve:function(e){var t=0|e;if(this.buffer){var n=this.buffer.length,i=0|this.offset,r=i+t;if(r<n)return this.offset=r,i;this.flush(),e=Math.max(e,Math.min(2*n,this.maxBufferSize))}return e=Math.max(e,this.minBufferSize),this.buffer=this.bufferish.alloc(e),this.start=0,this.offset=t,0},send:function(e){var t=e.length;if(t>this.minBufferSize)this.flush(),this.push(e);else{var n=this.reserve(t);u.prototype.copy.call(e,this.buffer,n)}},maxBufferSize:h,minBufferSize:d,offset:0,start:0}),r.mixin(r.prototype)},{"./bufferish":8}],22:[function(e,t,n){function i(){var e=this.options;return this.decode=function(e){var t=s.getReadToken(e);return function(e){var n=o(e),i=t[n];if(!i)throw new Error("Invalid type: "+(n?"0x"+n.toString(16):n));return i(e)}}(e),e&&e.preset&&a.setExtUnpackers(this),this}var r=e("./ext-buffer").ExtBuffer,a=e("./ext-unpacker"),o=e("./read-format").readUint8,s=e("./read-token"),l=e("./codec-base");l.install({addExtUnpacker:function(e,t){(this.extUnpackers||(this.extUnpackers=[]))[e]=l.filter(t)},getExtUnpacker:function(e){return(this.extUnpackers||(this.extUnpackers=[]))[e]||function(t){return new r(t,e)}},init:i}),n.preset=i.call(l.preset)},{"./codec-base":9,"./ext-buffer":17,"./ext-unpacker":19,"./read-format":23,"./read-token":24}],23:[function(e,t,n){function i(e,t){var n,i={},r=new Array(t),a=new Array(t),o=e.codec.decode;for(n=0;n<t;n++)r[n]=o(e),a[n]=o(e);for(n=0;n<t;n++)i[r[n]]=a[n];return i}function r(e,t){var n,i=new Map,r=new Array(t),a=new Array(t),o=e.codec.decode;for(n=0;n<t;n++)r[n]=o(e),a[n]=o(e);for(n=0;n<t;n++)i.set(r[n],a[n]);return i}function a(e,t){for(var n=new Array(t),i=e.codec.decode,r=0;r<t;r++)n[r]=i(e);return n}function o(e,t){var n=e.reserve(t),i=n+t;return D.toString.call(e.buffer,"utf-8",n,i)}function s(e,t){var n=e.reserve(t),i=n+t,r=D.slice.call(e.buffer,n,i);return A.from(r)}function l(e,t){var n=e.reserve(t),i=n+t,r=D.slice.call(e.buffer,n,i);return A.Uint8Array.from(r).buffer}function c(e,t){var n=e.reserve(t+1),i=e.buffer[n++],r=n+t,a=e.codec.getExtUnpacker(i);if(!a)throw new Error("Invalid ext type: "+(i?"0x"+i.toString(16):i));return a(D.slice.call(e.buffer,n,r))}function f(e){var t=e.reserve(1);return e.buffer[t]}function u(e){var t=e.reserve(1),n=e.buffer[t];return 128&n?n-256:n}function d(e){var t=e.reserve(2),n=e.buffer;return n[t++]<<8|n[t]}function h(e){var t=e.reserve(2),n=e.buffer,i=n[t++]<<8|n[t];return 32768&i?i-65536:i}function p(e){var t=e.reserve(4),n=e.buffer;return 16777216*n[t++]+(n[t++]<<16)+(n[t++]<<8)+n[t]}function m(e){var t=e.reserve(4),n=e.buffer;return n[t++]<<24|n[t++]<<16|n[t++]<<8|n[t]}function g(e,t){return function(n){var i=n.reserve(e);return t.call(n.buffer,i,B)}}function b(e){return new E(this,e).toNumber()}function y(e){return new x(this,e).toNumber()}function v(e){return new E(this,e)}function w(e){return new x(this,e)}function k(e){return S.read(this,e,!1,23,4)}function _(e){return S.read(this,e,!1,52,8)}var S=e("ieee754"),C=e("int64-buffer"),E=C.Uint64BE,x=C.Int64BE;n.getReadFormat=function(e){var t=A.hasArrayBuffer&&e&&e.binarraybuffer,n=e&&e.int64;return{map:R&&e&&e.usemap?r:i,array:a,str:o,bin:t?l:s,ext:c,uint8:f,uint16:d,uint32:p,uint64:g(8,n?v:b),int8:u,int16:h,int32:m,int64:g(8,n?w:y),float32:g(4,k),float64:g(8,_)}},n.readUint8=f;var A=e("./bufferish"),D=e("./bufferish-proto"),R="undefined"!=typeof Map,B=!0},{"./bufferish":8,"./bufferish-proto":6,ieee754:32,"int64-buffer":33}],24:[function(e,t,n){function i(e){var t,n=new Array(256);for(t=0;t<=127;t++)n[t]=r(t);for(t=128;t<=143;t++)n[t]=o(t-128,e.map);for(t=144;t<=159;t++)n[t]=o(t-144,e.array);for(t=160;t<=191;t++)n[t]=o(t-160,e.str);for(n[192]=r(null),n[193]=null,n[194]=r(!1),n[195]=r(!0),n[196]=a(e.uint8,e.bin),n[197]=a(e.uint16,e.bin),n[198]=a(e.uint32,e.bin),n[199]=a(e.uint8,e.ext),n[200]=a(e.uint16,e.ext),n[201]=a(e.uint32,e.ext),n[202]=e.float32,n[203]=e.float64,n[204]=e.uint8,n[205]=e.uint16,n[206]=e.uint32,n[207]=e.uint64,n[208]=e.int8,n[209]=e.int16,n[210]=e.int32,n[211]=e.int64,n[212]=o(1,e.ext),n[213]=o(2,e.ext),n[214]=o(4,e.ext),n[215]=o(8,e.ext),n[216]=o(16,e.ext),n[217]=a(e.uint8,e.str),n[218]=a(e.uint16,e.str),n[219]=a(e.uint32,e.str),n[220]=a(e.uint16,e.array),n[221]=a(e.uint32,e.array),n[222]=a(e.uint16,e.map),n[223]=a(e.uint32,e.map),t=224;t<=255;t++)n[t]=r(t-256);return n}function r(e){return function(){return e}}function a(e,t){return function(n){var i=e(n);return t(n,i)}}function o(e,t){return function(n){return t(n,e)}}var s=e("./read-format");n.getReadToken=function(e){var t=s.getReadFormat(e);return e&&e.useraw?function(e){var t,n=i(e).slice();for(n[217]=n[196],n[218]=n[197],n[219]=n[198],t=160;t<=191;t++)n[t]=o(t-160,e.bin);return n}(t):i(t)}},{"./read-format":23}],25:[function(e,t,n){function i(){var e=this.options;return this.encode=function(e){var t=o.getWriteType(e);return function(e,n){var i=t[typeof n];if(!i)throw new Error('Unsupported type "'+typeof n+'": '+n);i(e,n)}}(e),e&&e.preset&&a.setExtPackers(this),this}var r=e("./ext-buffer").ExtBuffer,a=e("./ext-packer"),o=e("./write-type"),s=e("./codec-base");s.install({addExtPacker:function(e,t,n){function i(t){return n&&(t=n(t)),new r(t,e)}n=s.filter(n);var a=t.name;a&&"Object"!==a?(this.extPackers||(this.extPackers={}))[a]=i:(this.extEncoderList||(this.extEncoderList=[])).unshift([t,i])},getExtPacker:function(e){var t=this.extPackers||(this.extPackers={}),n=e.constructor,i=n&&n.name&&t[n.name];if(i)return i;for(var r=this.extEncoderList||(this.extEncoderList=[]),a=r.length,o=0;o<a;o++){var s=r[o];if(n===s[0])return s[1]}},init:i}),n.preset=i.call(s.preset)},{"./codec-base":9,"./ext-buffer":17,"./ext-packer":18,"./write-type":27}],26:[function(e,t,n){function i(){var e=g.slice();return e[196]=r(196),e[197]=a(197),e[198]=o(198),e[199]=r(199),e[200]=a(200),e[201]=o(201),e[202]=s(202,4,w.writeFloatBE||f,!0),e[203]=s(203,8,w.writeDoubleBE||u,!0),e[204]=r(204),e[205]=a(205),e[206]=o(206),e[207]=s(207,8,l),e[208]=r(208),e[209]=a(209),e[210]=o(210),e[211]=s(211,8,c),e[217]=r(217),e[218]=a(218),e[219]=o(219),e[220]=a(220),e[221]=o(221),e[222]=a(222),e[223]=o(223),e}function r(e){return function(t,n){var i=t.reserve(2),r=t.buffer;r[i++]=e,r[i]=n}}function a(e){return function(t,n){var i=t.reserve(3),r=t.buffer;r[i++]=e,r[i++]=n>>>8,r[i]=n}}function o(e){return function(t,n){var i=t.reserve(5),r=t.buffer;r[i++]=e,r[i++]=n>>>24,r[i++]=n>>>16,r[i++]=n>>>8,r[i]=n}}function s(e,t,n,i){return function(r,a){var o=r.reserve(t+1);r.buffer[o++]=e,n.call(r.buffer,a,o,i)}}function l(e,t){new p(this,t,e)}function c(e,t){new m(this,t,e)}function f(e,t){d.write(this,e,t,!1,23,4)}function u(e,t){d.write(this,e,t,!1,52,8)}var d=e("ieee754"),h=e("int64-buffer"),p=h.Uint64BE,m=h.Int64BE,g=e("./write-uint8").uint8,b=e("./bufferish"),y=b.global,v=b.hasBuffer&&"TYPED_ARRAY_SUPPORT"in y&&!y.TYPED_ARRAY_SUPPORT,w=b.hasBuffer&&y.prototype||{};n.getWriteToken=function(e){return e&&e.uint8array?function(){var e=i();return e[202]=s(202,4,f),e[203]=s(203,8,u),e}():v||b.hasBuffer&&e&&e.safe?function(){var e=g.slice();return e[196]=s(196,1,y.prototype.writeUInt8),e[197]=s(197,2,y.prototype.writeUInt16BE),e[198]=s(198,4,y.prototype.writeUInt32BE),e[199]=s(199,1,y.prototype.writeUInt8),e[200]=s(200,2,y.prototype.writeUInt16BE),e[201]=s(201,4,y.prototype.writeUInt32BE),e[202]=s(202,4,y.prototype.writeFloatBE),e[203]=s(203,8,y.prototype.writeDoubleBE),e[204]=s(204,1,y.prototype.writeUInt8),e[205]=s(205,2,y.prototype.writeUInt16BE),e[206]=s(206,4,y.prototype.writeUInt32BE),e[207]=s(207,8,l),e[208]=s(208,1,y.prototype.writeInt8),e[209]=s(209,2,y.prototype.writeInt16BE),e[210]=s(210,4,y.prototype.writeInt32BE),e[211]=s(211,8,c),e[217]=s(217,1,y.prototype.writeUInt8),e[218]=s(218,2,y.prototype.writeUInt16BE),e[219]=s(219,4,y.prototype.writeUInt32BE),e[220]=s(220,2,y.prototype.writeUInt16BE),e[221]=s(221,4,y.prototype.writeUInt32BE),e[222]=s(222,2,y.prototype.writeUInt16BE),e[223]=s(223,4,y.prototype.writeUInt32BE),e}():i()}},{"./bufferish":8,"./write-uint8":28,ieee754:32,"int64-buffer":33}],27:[function(e,t,n){var i=e("isarray"),r=e("int64-buffer"),a=r.Uint64BE,o=r.Int64BE,s=e("./bufferish"),l=e("./bufferish-proto"),c=e("./write-token"),f=e("./write-uint8").uint8,u=e("./ext-buffer").ExtBuffer,d="undefined"!=typeof Uint8Array,h="undefined"!=typeof Map,p=[];p[1]=212,p[2]=213,p[4]=214,p[8]=215,p[16]=216,n.getWriteType=function(e){function t(e,t){if(null===t)return n(e,t);if(v(t))return w(e,t);if(i(t))return function(e,t){var n=t.length,i=n<16?144+n:n<=65535?220:221;g[i](e,n);for(var r=e.codec.encode,a=0;a<n;a++)r(e,t[a])}(e,t);if(a.isUint64BE(t))return function(e,t){g[207](e,t.toArray())}(e,t);if(o.isInt64BE(t))return function(e,t){g[211](e,t.toArray())}(e,t);var r=e.codec.getExtPacker(t);return r&&(t=r(t)),t instanceof u?function(e,t){var n=t.buffer,i=n.length,r=p[i]||(i<255?199:i<=65535?200:201);g[r](e,i),f[t.type](e),e.send(n)}(e,t):void k(e,t)}function n(e,t){g[192](e,t)}function r(e,t){var n=t.length;g[n<255?196:n<=65535?197:198](e,n),e.send(t)}function m(e,t){var n=Object.keys(t),i=n.length;g[i<16?128+i:i<=65535?222:223](e,i);var r=e.codec.encode;n.forEach((function(n){r(e,n),r(e,t[n])}))}var g=c.getWriteToken(e),b=e&&e.useraw,y=d&&e&&e.binarraybuffer,v=y?s.isArrayBuffer:s.isBuffer,w=y?function(e,t){r(e,new Uint8Array(t))}:r,k=h&&e&&e.usemap?function(e,t){if(!(t instanceof Map))return m(e,t);var n=t.size;g[n<16?128+n:n<=65535?222:223](e,n);var i=e.codec.encode;t.forEach((function(t,n,r){i(e,n),i(e,t)}))}:m,_={boolean:function(e,t){g[t?195:194](e,t)},function:n,number:function(e,t){var n=0|t;return t!==n?void g[203](e,t):void g[-32<=n&&n<=127?255&n:0<=n?n<=255?204:n<=65535?205:206:-128<=n?208:-32768<=n?209:210](e,n)},object:b?function(e,n){return v(n)?function(e,t){var n=t.length,i=n<32?160+n:n<=65535?218:219;g[i](e,n),e.send(t)}(e,n):void t(e,n)}:t,string:function(e){return function(t,n){var i=n.length,r=5+3*i;t.offset=t.reserve(r);var a=t.buffer,o=e(i),s=t.offset+o;i=l.write.call(a,n,s);var c=e(i);if(o!==c){var f=s+c-o,u=s+i;l.copy.call(a,a,f,s,u)}g[1===c?160+i:c<=3?215+c:219](t,i),t.offset+=i}}(b?function(e){return e<32?1:e<=65535?3:5}:function(e){return e<32?1:e<=255?2:e<=65535?3:5}),symbol:n,undefined:n};return _}},{"./bufferish":8,"./bufferish-proto":6,"./ext-buffer":17,"./write-token":26,"./write-uint8":28,"int64-buffer":33,isarray:34}],28:[function(e,t,n){function i(e){return function(t){var n=t.reserve(1);t.buffer[n]=e}}for(var r=n.uint8=new Array(256),a=0;a<=255;a++)r[a]=i(a)},{}],29:[function(e,t,n){(function(t){function i(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function r(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=a.prototype:(null===e&&(e=new a(t)),e.length=t),e}function a(e,t,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return o(this,e,t,n)}function o(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),a.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=a.prototype):e=c(e,t),e}(e,t,n,i):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|u(t,n);e=r(e,i);var o=e.write(t,n);return o!==i&&(e=e.slice(0,o)),e}(e,t,n):function(e,t){if(a.isBuffer(t)){var n=0|f(t.length);return 0===(e=r(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?r(e,0):c(e,t);if("Buffer"===t.type&&z(t.data))return c(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(s(t),e=r(e,t<0?0:0|f(t)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function c(e,t){var n=t.length<0?0:0|f(t.length);e=r(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function f(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function u(e,t){if(a.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return F(e).length;default:if(i)return U(e).length;t=(""+t).toLowerCase(),i=!0}}function d(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return E(this,t,n);case"base64":return _(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function h(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function p(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=a.from(t,i)),a.isBuffer(t))return 0===t.length?-1:m(e,t,n,i,r);if("number"==typeof t)return t&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,i,r){function a(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var o,s=1,l=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;s=2,l/=2,c/=2,n/=2}if(r){var f=-1;for(o=n;o<l;o++)if(a(e,o)===a(t,-1===f?0:o-f)){if(-1===f&&(f=o),o-f+1===c)return f*s}else-1!==f&&(o-=o-f),f=-1}else for(n+c>l&&(n=l-c),o=n;o>=0;o--){for(var u=!0,d=0;d<c;d++)if(a(e,o+d)!==a(t,d)){u=!1;break}if(u)return o}return-1}function g(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");i>a/2&&(i=a/2);for(var o=0;o<i;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function b(e,t,n,i){return $(U(t,e.length-n),e,n,i)}function y(e,t,n,i){return $(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function v(e,t,n,i){return y(e,t,n,i)}function w(e,t,n,i){return $(F(t),e,n,i)}function k(e,t,n,i){return $(function(e,t){for(var n,i,r,a=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),i=n>>8,r=n%256,a.push(r),a.push(i);return a}(t,e.length-n),e,n,i)}function _(e,t,n){return 0===t&&n===e.length?M.fromByteArray(e):M.fromByteArray(e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var a,o,s,l,c=e[r],f=null,u=c>239?4:c>223?3:c>191?2:1;if(r+u<=n)switch(u){case 1:c<128&&(f=c);break;case 2:128==(192&(a=e[r+1]))&&((l=(31&c)<<6|63&a)>127&&(f=l));break;case 3:a=e[r+1],o=e[r+2],128==(192&a)&&128==(192&o)&&((l=(15&c)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(f=l));break;case 4:a=e[r+1],o=e[r+2],s=e[r+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&((l=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(f=l))}null===f?(f=65533,u=1):f>65535&&(f-=65536,i.push(f>>>10&1023|55296),f=56320|1023&f),i.push(f),r+=u}return function(e){var t=e.length;if(t<=K)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=K));return n}(i)}function C(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function E(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function x(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",a=t;a<n;++a)r+=T(e[a]);return r}function A(e,t,n){for(var i=e.slice(t,n),r="",a=0;a<i.length;a+=2)r+=String.fromCharCode(i[a]+256*i[a+1]);return r}function D(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,i,r,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function B(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,a=Math.min(e.length-n,2);r<a;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function P(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,a=Math.min(e.length-n,4);r<a;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function O(e,t,n,i,r,a){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function L(e,t,n,i,r){return r||O(e,0,n,4),N.write(e,t,n,i,23,4),n+4}function I(e,t,n,i,r){return r||O(e,0,n,8),N.write(e,t,n,i,52,8),n+8}function T(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){t=t||1/0;for(var n,i=e.length,r=null,a=[],o=0;o<i;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===i){(t-=3)>-1&&a.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&a.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function F(e){return M.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(W,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function $(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}var M=e("base64-js"),N=e("ieee754"),z=e("isarray");n.Buffer=a,n.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},n.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),n.kMaxLength=i(),a.poolSize=8192,a._augment=function(e){return e.__proto__=a.prototype,e},a.from=function(e,t,n){return o(null,e,t,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(e,t,n){return function(e,t,n,i){return s(t),t<=0?r(e,t):void 0!==n?"string"==typeof i?r(e,t).fill(n,i):r(e,t).fill(n):r(e,t)}(null,e,t,n)},a.allocUnsafe=function(e){return l(null,e)},a.allocUnsafeSlow=function(e){return l(null,e)},a.isBuffer=function(e){return!(null==e||!e._isBuffer)},a.compare=function(e,t){if(!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!z(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=a.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var o=e[n];if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},a.byteLength=u,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)h(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},a.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):d.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},a.prototype.compare=function(e,t,n,i,r){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(i>>>=0),s=(n>>>=0)-(t>>>=0),l=Math.min(o,s),c=this.slice(i,r),f=e.slice(t,n),u=0;u<l;++u)if(c[u]!==f[u]){o=c[u],s=f[u];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return p(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return p(this,e,t,n,!1)},a.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return g(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return y(this,e,t,n);case"latin1":case"binary":return v(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var K=4096;a.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),a.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=a.prototype;else{var r=t-e;n=new a(r,void 0);for(var o=0;o<r;++o)n[o]=this[o+e]}return n},a.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var i=this[e],r=1,a=0;++a<t&&(r*=256);)i+=this[e+a]*r;return i},a.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},a.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var i=this[e],r=1,a=0;++a<t&&(r*=256);)i+=this[e+a]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},a.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var i=t,r=1,a=this[e+--i];i>0&&(r*=256);)a+=this[e+--i]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*t)),a},a.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),N.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),N.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),N.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),N.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,a=0;for(this[t]=255&e;++a<n&&(r*=256);)this[t+a]=e/r&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,a=1;for(this[t+r]=255&e;--r>=0&&(a*=256);)this[t+r]=e/a&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,255,0),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):P(this,e,t,!0),t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},a.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);R(this,e,t,n,r-1,-r)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},a.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);R(this,e,t,n,r-1,-r)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,127,-128),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},a.prototype.writeFloatLE=function(e,t,n){return L(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return L(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return I(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return I(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,o=i-n;if(this===e&&n<t&&t<i)for(r=o-1;r>=0;--r)e[r+t]=this[r+n];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},a.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!a.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=a.isBuffer(e)?e:U(new a(e,i).toString()),l=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%l]}return this};var W=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":30,ieee754:32,isarray:34}],30:[function(e,t,n){function i(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function r(e){return o[e>>18&63]+o[e>>12&63]+o[e>>6&63]+o[63&e]}function a(e,t,n){for(var i,a=[],o=t;o<n;o+=3)i=(e[o]<<16)+(e[o+1]<<8)+e[o+2],a.push(r(i));return a.join("")}n.byteLength=function(e){return 3*e.length/4-i(e)},n.toByteArray=function(e){var t,n,r,a,o,c,f=e.length;o=i(e),c=new l(3*f/4-o),r=o>0?f-4:f;var u=0;for(t=0,n=0;t<r;t+=4,n+=3)a=s[e.charCodeAt(t)]<<18|s[e.charCodeAt(t+1)]<<12|s[e.charCodeAt(t+2)]<<6|s[e.charCodeAt(t+3)],c[u++]=a>>16&255,c[u++]=a>>8&255,c[u++]=255&a;return 2===o?(a=s[e.charCodeAt(t)]<<2|s[e.charCodeAt(t+1)]>>4,c[u++]=255&a):1===o&&(a=s[e.charCodeAt(t)]<<10|s[e.charCodeAt(t+1)]<<4|s[e.charCodeAt(t+2)]>>2,c[u++]=a>>8&255,c[u++]=255&a),c},n.fromByteArray=function(e){for(var t,n=e.length,i=n%3,r="",s=[],l=16383,c=0,f=n-i;c<f;c+=l)s.push(a(e,c,c+l>f?f:c+l));return 1===i?(t=e[n-1],r+=o[t>>2],r+=o[t<<4&63],r+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],r+=o[t>>10],r+=o[t>>4&63],r+=o[t<<2&63],r+="="),s.push(r),s.join("")};for(var o=[],s=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0;f<64;++f)o[f]=c[f],s[c.charCodeAt(f)]=f;s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},{}],31:[function(e,t,n){!function(e){function n(e){for(var t in o)e[t]=o[t];return e}function i(e,t){var n,o=this;if(arguments.length){if(t){if(n=r(o,e,!0)){if(n=n.filter((function(e){return e!==t&&e.originalListener!==t})),!n.length)return i.call(o,e);o[a][e]=n}}else if((n=o[a])&&(delete n[e],!Object.keys(n).length))return i.call(o)}else delete o[a];return o}function r(e,t,n){if(!n||e[a]){var i=e[a]||(e[a]={});return i[t]||(i[t]=[])}}void 0!==t&&(t.exports=e);var a="listeners",o={on:function(e,t){return r(this,e).push(t),this},once:function(e,t){function n(){i.call(a,e,n),t.apply(this,arguments)}var a=this;return n.originalListener=t,r(a,e).push(n),a},off:i,emit:function(e,t){var n=this,i=r(n,e,!0);if(!i)return!1;var a=arguments.length;if(1===a)i.forEach((function(e){e.call(n)}));else if(2===a)i.forEach((function(e){e.call(n,t)}));else{var o=Array.prototype.slice.call(arguments,1);i.forEach((function(e){e.apply(n,o)}))}return!!i.length}};n(e.prototype),e.mixin=n}((function e(){if(!(this instanceof e))return new e}))},{}],32:[function(e,t,n){n.read=function(e,t,n,i,r){var a,o,s=8*r-i-1,l=(1<<s)-1,c=l>>1,f=-7,u=n?r-1:0,d=n?-1:1,h=e[t+u];for(u+=d,a=h&(1<<-f)-1,h>>=-f,f+=s;f>0;a=256*a+e[t+u],u+=d,f-=8);for(o=a&(1<<-f)-1,a>>=-f,f+=i;f>0;o=256*o+e[t+u],u+=d,f-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,i),a-=c}return(h?-1:1)*o*Math.pow(2,a-i)},n.write=function(e,t,n,i,r,a){var o,s,l,c=8*a-r-1,f=(1<<c)-1,u=f>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=i?0:a-1,p=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=f):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(o++,l/=2),o+u>=f?(s=0,o=f):o+u>=1?(s=(t*l-1)*Math.pow(2,r),o+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,r),o=0));r>=8;e[n+h]=255&s,h+=p,s/=256,r-=8);for(o=o<<r|s,c+=r;c>0;e[n+h]=255&o,h+=p,o/=256,c-=8);e[n+h-p]|=128*m}},{}],33:[function(e,t,n){(function(e){!function(t){function n(e,n,v){function _(e,t,n,i){return this instanceof _?function(e,t,n,i,r){if(g&&b&&(t instanceof b&&(t=new g(t)),i instanceof b&&(i=new g(i))),!(t||n||i||h))return void(e.buffer=l(y,0));if(!o(t,n)){r=n,i=t,n=0,t=new(h||Array)(8)}e.buffer=t,e.offset=n|=0,p!==typeof i&&("string"==typeof i?function(e,t,n,i){var r=0,a=n.length,o=0,s=0;"-"===n[0]&&r++;for(var l=r;r<a;){var c=parseInt(n[r++],i);if(!(c>=0))break;s=s*i+c,o=o*i+Math.floor(s/w),s%=w}l&&(o=~o,s?s=w-s:o++),C(e,t+x,o),C(e,t+A,s)}(t,n,i,r||10):o(i,r)?s(t,n,i,r):"number"==typeof r?(C(t,n+x,i),C(t,n+A,r)):i>0?O(t,n,i):i<0?L(t,n,i):s(t,n,y,0))}(this,e,t,n,i):new _(e,t,n,i)}function S(){var e=this.buffer,t=this.offset,n=E(e,t+x),i=E(e,t+A);return v||(n|=0),n?n*w+i:i}function C(e,t,n){e[t+P]=255&n,n>>=8,e[t+B]=255&n,n>>=8,e[t+R]=255&n,n>>=8,e[t+D]=255&n}function E(e,t){return e[t+D]*k+(e[t+R]<<16)+(e[t+B]<<8)+e[t+P]}var x=n?0:4,A=n?4:0,D=n?0:3,R=n?1:2,B=n?2:1,P=n?3:0,O=n?c:u,L=n?f:d,I=_.prototype,T="is"+e,U="_"+T;return I.buffer=void 0,I.offset=0,I[U]=!0,I.toNumber=S,I.toString=function(e){var t=this.buffer,n=this.offset,i=E(t,n+x),r=E(t,n+A),a="",o=!v&&2147483648&i;for(o&&(i=~i,r=w-r),e=e||10;;){var s=i%e*w+r;if(i=Math.floor(i/e),r=Math.floor(s/e),a=(s%e).toString(e)+a,!i&&!r)break}return o&&(a="-"+a),a},I.toJSON=S,I.toArray=i,m&&(I.toBuffer=r),g&&(I.toArrayBuffer=a),_[T]=function(e){return!(!e||!e[U])},t[e]=_,_}function i(e){var t=this.buffer,n=this.offset;return h=null,!1!==e&&0===n&&8===t.length&&v(t)?t:l(t,n)}function r(t){var n=this.buffer,i=this.offset;if(h=m,!1!==t&&0===i&&8===n.length&&e.isBuffer(n))return n;var r=new m(8);return s(r,0,n,i),r}function a(e){var t=this.buffer,n=this.offset,i=t.buffer;if(h=g,!1!==e&&0===n&&i instanceof b&&8===i.byteLength)return i;var r=new g(8);return s(r,0,t,n),r.buffer}function o(e,t){var n=e&&e.length;return t|=0,n&&t+8<=n&&"string"!=typeof e[t]}function s(e,t,n,i){t|=0,i|=0;for(var r=0;r<8;r++)e[t++]=255&n[i++]}function l(e,t){return Array.prototype.slice.call(e,t,t+8)}function c(e,t,n){for(var i=t+8;i>t;)e[--i]=255&n,n/=256}function f(e,t,n){var i=t+8;for(n++;i>t;)e[--i]=255&-n^255,n/=256}function u(e,t,n){for(var i=t+8;t<i;)e[t++]=255&n,n/=256}function d(e,t,n){var i=t+8;for(n++;t<i;)e[t++]=255&-n^255,n/=256}var h,p="undefined",m=p!==typeof e&&e,g=p!==typeof Uint8Array&&Uint8Array,b=p!==typeof ArrayBuffer&&ArrayBuffer,y=[0,0,0,0,0,0,0,0],v=Array.isArray||function(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)},w=4294967296,k=16777216;n("Uint64BE",!0,!0),n("Int64BE",!0,!1),n("Uint64LE",!1,!0),n("Int64LE",!1,!1)}("object"==typeof n&&"string"!=typeof n.nodeName?n:this||{})}).call(this,e("buffer").Buffer)},{buffer:29}],34:[function(e,t,n){var i={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},{}]},{},[1])(1)}));const ve=document.getElementById("uploadInput"),we=document.getElementById("fileList"),ke=document.getElementById("infoIndicator"),_e=["syx","wav","flac","aif","webm","m4a","pti","mp3"],Se=[0,4,8,16,32,64,128],Ce=750;let Ee,xe,Ae,De,Re,Be,Pe=48e3,Oe=48e3,Le=16,Ie=1,Te="w",Ue=!1,Fe=0,$e=[],Me=[],Ne=[],ze=[],Ke=[],We=[],je="",qe=0,Ze=[],He=[],Ye=0,Je=Array.from(Se),Ge=!0,Ve=0,Xe={shiftKey:!1,ctrlKey:!1};async function Qe(){if(Ae&&Ae.sampleRate===Pe&&"closed"!==Ae.state||(Ae=new AudioContext({sampleRate:Pe,latencyHint:"interactive"}),W({audioCtx:Ae,masterSR:Pe,masterChannels:Ie,masterBitDepth:Le})),"suspended"===Ae.state)return await Ae.resume()}function et(e=[]){e.forEach(((e,t)=>Tt(document.querySelector(`.master-slices .sel-${t}`),e,!0))),Ut({shiftKey:!1,target:document.querySelector('.master-slices [class*="sel-"].check:not(.button-outline)')},e[+document.querySelector('.master-slices [class*="sel-"].check:not(.button-outline)')?.dataset?.sel??0])}async function tt(e="",t=!1){const n=document.getElementById("exportSettingsPanel"),i=document.getElementById("audioConfigOptions"),r=document.getElementById("audioValuesFromCommonSelect"),o=(r?.selectedOptions??[])[0]?.dataset?.device,s=[48e3,"m",16,"w",...Se];let l=e?e.match(/^\d+|[ms]|\d+|[wa]/g):s;l=11===l.length?l:s;let c=e&&11===l.length?{sr:+l[0],c:l[1],bd:+l[2],f:l[3],go:l.slice(4)}:{sr:+document.getElementById("settingsSampleRate").value,c:1==+document.getElementById("channelsGroup").dataset.channels?"m":"s",bd:+document.getElementById("bitDepthGroup").dataset.bitDepth,f:document.getElementById("targetContainerGroup").dataset.container,go:[0,...[...document.querySelectorAll(".acoSliceGridOption")].map((e=>+e.value))]},d=+(document.getElementById("settingsWorkingSampleRate")?.value||localStorage.getItem("workingSampleRate")||48e3);try{a.ditherExports=JSON.parse(document.getElementById("ditherGroup").dataset.dither)}catch(e){}if(r&&(vt("exportWithOtFile","ot"===o,!0),r.value="none"),"a"===c.f&&(c.sr=44100,c.bd=16),c.sr<a.supportedSampleRates[0]||c.sr>a.supportedSampleRates[1])return f(`ERROR: The sample rate ${c.sr}Hz is not supported by your browser.\n\nPlease select a sample rate between ${a.supportedSampleRates[0]}Hz and ${a.supportedSampleRates[1]}Hz`,8e3),!1;if(d<a.supportedSampleRates[0]||d>a.supportedSampleRates[1])return f(`ERROR: The sample rate ${d}Hz is not supported by your browser.\n\nPlease select a sample rate between ${a.supportedSampleRates[0]}Hz and ${a.supportedSampleRates[1]}Hz`,8e3),!1;if($e.length>0&&d!==Pe){if(!await u("confirm","Frequently changing audio working sample rate can degrade the audio quality, particularly in the transients and higher frequencies.\n\n Do you want to continue?",{kind:"warning",okLabel:"Continue"}))return!1}C("Configuring");const h=`${"a"===c.f?"AIF ":""}${c.sr/1e3}kHz/${c.bd}BIT ${"m"===c.c?"MONO":"STEREO"}`;i.value=h;const p=`${c.sr}${c.c}${c.bd}${c.f}${c.go.join("-")}`;a.lastUsedAudioConfig=p,localStorage.setItem("workingSampleRate",`${d}`);let m=!1;if(d===Pe||t||(m=!0),Pe=d,Oe=c.sr,Le=c.bd,Ie="m"===c.c?1:2,Te=c.f,Je=c.go.map((e=>+e)),document.body.dataset.targetSr=Oe,document.body.dataset.workingSr=d,et(Je),!t){const e=Qe();e&&await e}Fe=0,Fe="opz"===o?12:Fe,Fe="op1f"===o?20:Fe,wt(!1,Fe||0),W({audioCtx:Ae,masterSR:Pe,masterChannels:Ie,masterBitDepth:Le}),o&&(a.exportChainsAsPresets=!1,"xy"===o?St({device:"xy",length:24}):"tv"===o?St({device:"tv",length:84}):(_t("exportChainsAsPresets",".toggle-preset-bundling-xy"),_t("exportChainsAsPresets",".toggle-preset-bundling-tv"),a.spacedChainMode="dt"===o,kt())),$e.length>0&&$e.filter((e=>e.buffer.numberOfChannels>1)).forEach((e=>e.waveform=!1)),m&&($e=$e.map((e=>it(e)))),n.open&&n.close(),en()}function nt(){return"closed"===Ae.state?(C(""),f("ERROR: The Audio Context has been closed, please refresh the browser tab.",3e4),!0):(["interrupted","suspended"].includes(Ae.state)&&Ae.resume(),!1)}function it(e,t,n){let i,r,a=e.buffer.channel0||e.buffer.getChannelData(0),o=2===e.buffer.numberOfChannels&&(e.buffer.channel1||e.buffer.getChannelData(1));if(t=t||Pe,e.buffer.sampleRate!==t){let s,l;s=new _(e.buffer.sampleRate,t,1,a),s.resampler(s.inputBuffer.length),2===e.buffer.numberOfChannels&&(l=new _(e.buffer.sampleRate,t,1,o),l.resampler(l.inputBuffer.length)),i=(n??Ae).createBuffer(e.buffer.numberOfChannels,s.outputBuffer.length,t),i.copyToChannel(s.outputBuffer,0),2===e.buffer.numberOfChannels&&i.copyToChannel(l.outputBuffer,1),Array.isArray(e.meta.slices)&&(r=e.meta.slices.map((n=>({...n,s:Math.round(n.s/e.buffer.sampleRate*t),e:n.e===e.buffer.length?Math.round(s.outputBuffer.length):Math.round(n.e/e.buffer.sampleRate*t),l:n.l&&n.l>-1?Math.round(n.l/e.buffer.sampleRate*t):-1}))))}else i=(n??Ae).createBuffer(e.buffer.numberOfChannels,e.buffer.length,t),i.copyToChannel(a,0),2===e.buffer.numberOfChannels&&i.copyToChannel(o,1);return{file:e.file,meta:{...e.meta,slices:Array.isArray(r)?r:e.meta.slices||!1,length:i.length,duration:Number(i.length/t).toFixed(3)},buffer:i}}ze.getByFileName=function(e){let t=this.find((t=>t.name.replace(/\.[^.]*$/,"")===e.replace(/\.[^.]*$/,"")));return!t&&e.endsWith(".flac")&&(t=this.find((t=>e.includes(`(${t.name})`)))),"---sliceToTransientCached---"!==e||t||(t={uuid:crypto.randomUUID(),name:"---sliceToTransientCached---",sliceCount:0,slices:[]},ze.push(t)),t},ze.getByFile=function(e){if(e.meta.slicedFrom)return!1;const t=this.find((t=>t.name.replace(/\.[^.]*$/,"")===e.file.name.replace(/\.[^.]*$/,"")));if(t)return t;if(e.meta.op1Json&&e.meta.op1Json.start){let t=e.meta.op1Json.start.map(((t,n)=>({startPoint:t,endPoint:e.meta.op1Json.end[n],p:e.meta.op1Json.pan[n],pab:e.meta.op1Json.pan_ab[n],st:e.meta.op1Json.pitch[n]}))).reduce(((e,t)=>(e?.pos&&e.pos>-1?t.endPoint>e.pos&&(e.result.push(t),e.pos=t.endPoint):(e.pos=e.pos??t.endPoint,e.result.push(t)),e)),{result:[]}).result;return{uuid:e.meta.uuid,name:e.file.name,path:e.file.path,cssClass:"is-op-file",sliceCount:t.length,slices:t}}return e.meta.customSlices?{uuid:e.meta.uuid,name:e.file.name,path:e.file.path,cssClass:"is-dc-file",sliceCount:e.meta.customSlices.sliceCount,slices:e.meta.customSlices.slices}:e.meta.slices?{uuid:e.meta.uuid,name:e.file.name,path:e.file.path,cssClass:"is-dc-file",otLoop:e.meta.otLoop??0,otLoopStart:e.meta.otLoopStart??0,sliceCount:e.meta.slices.length,slices:e.meta.slices.map((e=>({startPoint:e.s,endPoint:e.e,loopPoint:e.l??-1,name:e.n||e.name||"",p:e.p??16384,pab:e.pab??!1,st:e.st??0})))}:void 0},ze.getByFileInDcFormat=function(e){return("---sliceToTransientCached---"===e?ze.getByFileName("---sliceToTransientCached---"):ze.getByFile(e)||{slices:[]}).slices.map((e=>{let t={s:e.startPoint,e:e.endPoint,l:e.loopPoint,n:e.name||""};return["p","pab","st"].forEach((n=>{e[n]||(t[n]=e[n])})),t}))},ze.removeSelected=function(){$e.forEach((e=>{const t=this.findIndex((t=>t===this.getByFileName(e.file.name)));e.meta.checked&&-1!==t&&this.splice(t,1)}))},ze.removeByName=function(e){const t=this.findIndex((t=>t===this.getByFileName(e)));-1!==t&&(this.splice(t,1),Me=Me.filter((e=>e!==t)))};const rt=e=>$e.find((t=>t.meta.id===e)),at=e=>$e.findIndex((t=>t.meta.id===e)),ot=(e,t="#masterList")=>document.querySelector(`${t} tr[data-id="${e}"]`),st=()=>{const e=document.getElementById("allOptionsPanel"),t=document.getElementById("toggleOptionsButton");e.classList.contains("hidden")?e.classList.remove("hidden"):e.classList.add("hidden"),e.classList.contains("hidden")?t.classList.add("collapsed"):t.classList.remove("collapsed")},lt=()=>{Ge=!Ge,en(!0)};function ct(e=!1){const t=We.filter((e=>!e.used)).length;return e?t:t>0}function ft(){const e=document.querySelector(".chain-name-toggle"),t=document.getElementById("chainFileNameListPanel").querySelector(".content"),n=We.sort(((e,t)=>e.used-t.used)).reduce(((e,t,n)=>e+`\n        <tr>\n        <td\n            class="chain-file-name-option ${t.used?"used":""}"\n            onpointerdown="digichain.changeChainName(event, ${n})"\n        >${t.name} </td>\n        <td>\n        <button title="Remove this name from the list." class="remove-chain float-right button-clear" onpointerdown="digichain.changeChainName(event, ${n}, 'remove')"><i class="gg-remove"></i></button>\n        <button title="Reset this name so it can be reused for a sample chain name." class="reuse-chain p-0 float-right button-clear ${t.used?"":"hidden"}" onpointerdown="digichain.changeChainName(event, ${n}, 'reuse')"><i class="gg-undo"></i></button>\n        </td>\n        </tr>\n`),"");e.dataset.count=`${ct()?ct(!0):""}`,e.classList[e.dataset.count?"remove":"add"]("fade"),t.innerHTML=`\n    <div class="row">\n      <div class="column mh-60vh">\n          <table>\n              <tr>\n                  <th class="p-0"><h5>Sample Chain Names</h5></th>\n                  <th class="p-0"><button title="Remove all names from the list." class="remove-chain float-right button-clear" style="transform: translateX(-0.5rem);" onpointerdown="digichain.changeChainName(event, -1, 'remove-all')"><i class="gg-remove"></i></button></th>\n              </tr>\n              <tbody>\n                  ${n}\n              </tbody>\n          </table>\n      </div>\n    </div>\n    <div style="padding-top:1rem;">\n        <button title="Generates a list of filenames based on the folder path of the files in the list. This will replace all other names in the sample names list." class="button-outline float-left" onpointerdown="digichain.generateChainNames()">Generate</button>\n        <button title="Add a name to use for sample chains, if the list is empty, or all the names have already been used, the DigiChain default naming convention will be used. (Names must be unique, caps are ignored.)" class="button float-right" onpointerdown="digichain.changeChainName(event)">Add Name</button>\n    </div>\n    `}function ut(e){const t=document.getElementById("splitOptions");t.open&&t.close(),Bt(e,De.dataset.id)}const dt=(e,t,n="sample")=>{let i,r;"opExport"===n?(He=$e.filter((e=>e.meta.checked)),i=He):(t&&"opExport"!==n&&(De=ot(t)),r=[...new Set($e.map((e=>e.file.path)))],i=rt(t||De.dataset.id)),j(i,{audioCtx:Ae,masterSR:Pe,targetSR:Oe,masterChannels:Ie,masterBitDepth:Le,storeState:()=>pn(!0)},n,r)};function ht(){return document.querySelector("#opExportPanel.show")}async function pt(e,t,n,i,r){let o,s,l,c=se("",e,!1,!0);if(c="a"===Te?c.replace(".wav",".aif"):c,e.meta.slices=e.meta.slices||ze.getByFileInDcFormat(e),o=y(e.buffer,{...e.meta,renderAt:!!i&&Oe},Pe,r||Le,Ie,a.dePopClick,n&&1===a.pitchModifier,a.pitchModifier,Ue,a.embedCuePoints,a.embedOrslData),s=o.sampleRate,o=o.buffer,l=new window.Blob([new DataView(o)],{type:n&&1===a.pitchModifier?"audio/aiff":"audio/wav"}),1!==a.pitchModifier){let t=await fetch(URL.createObjectURL(l)),c=await t.arrayBuffer(),f=await Ae.decodeAudioData(c),u={...e.meta};u.slices=u.slices.map((e=>({...e,n:e.n,s:Math.round(e.s/a.pitchModifier),e:Math.round(e.e/a.pitchModifier),l:-1===(!e.l||e.l)?-1:Math.round(e.l/a.pitchModifier)}))),o=y(f,{...u,renderAt:!!i&&Oe},Pe,r||Le,Ie,a.dePopClick,n,1,Ue,a.embedCuePoints,a.embedOrslData),s=o.sampleRate,o=o.buffer,l=new window.Blob([new DataView(o)],{type:n?"audio/aiff":"audio/wav"})}return t.href=URL.createObjectURL(l),t.setAttribute("download",c),{blob:l,sampleRate:s}}async function mt(e,t=!1,n={}){const i=ot(e).querySelector(".wav-link-hidden"),r=ot(e).querySelector(".meta-link-hidden"),o=rt(e),s="a"===Te,{blob:l}=await pt(o,i,s,!0);let c=await rn(o.meta.slices??[],o,o.file.name,r);if(t&&(!a.shiftClickForFileDownload||a.shiftClickForFileDownload&&n.shiftKey))if(window.__TAURI__){const e=await l.arrayBuffer();if(await window.__TAURI__.fs.writeFile(o.file.name,e,{baseDir:window.__TAURI__.fs.BaseDirectory.Download,create:!0}),c&&c.blob){const e=await c.blob.arrayBuffer();await window.__TAURI__.fs.writeFile(c.name,e,{baseDir:window.__TAURI__.fs.BaseDirectory.Download,create:!0})}C(""),window.__TAURI__.dialog.message(`Saved to the Downloads folder as '${o.file.name}'.`)}else i.click(),c&&r.click();return[i,r]}function gt(e,t=!1){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const n=$e.filter((e=>e.meta.checked));n.forEach(((i,r)=>{ye.double(e,i,t,!1),r===n.length-1&&C("")})),en()}),250)}function bt(){if(a.showWelcomeModalOnLaunchIfListEmpty&&0===Me.length){const e=document.querySelector("#welcomePanelMd"),t=document.querySelector("#tipElement"),n=Math.floor(Math.random()*t.children.length+1);[...t.children].forEach(((e,t)=>e.style.display=t+1===n?"block":"none")),e.open||e.showModal()}}function yt(e,t){const n={2:1,4:2,8:3};if([.25,.5,1,2,4,8].includes(+e)){if(a.pitchModifier=+e,ke.textContent=1===a.pitchModifier?"":`All exported samples will be pitched up ${n[a.pitchModifier]} octave${a.pitchModifier>2?"s":""}`,t)return;Jt(),Ct()}return e}function vt(e,t,n){void 0!==t&&"boolean"!=typeof t||(a[e]=void 0===t?!a[e]:t),"darkModeTheme"===e&&document.body.classList[a.darkModeTheme?"remove":"add"]("light"),"normalizeContrast"===e&&document.body.classList[a.normalizeContrast?"add":"remove"]("normalize-contrast"),"retainSessionState"===e&&(a.retainSessionState?hn(!0):mn()),"showTouchModifierKeys"===e&&document.querySelector(".touch-buttons").classList[a.showTouchModifierKeys?"remove":"add"]("hidden"),"playWithPopMarker"===e&&(a.playWithPopMarker=t,$e.forEach((e=>e.meta.peak=void 0))),"deClick"===e&&(a.dePopClick=t),"padSpacedChainsWith"===e&&(a.padSpacedChainsWith=t),"skipMiniWaveformRender"===e&&en(),"splitOutExistingSlicesOnJoin"===e&&Jt(),n||Ct()}function wt(e,t){const n=document.querySelector(".toggle-seconds-per-file"),i=document.querySelector(".toggle-seconds-per-file span");(e.ctrlKey||e.metaKey||Xe.ctrlKey)&&(t=async function(e,t,n=!1){let i=t;return n||(i=await u("prompt",`Change max seconds per file "${t}" to what new value?`,{defaultValue:t})),i&&!isNaN(i)&&(i=Math.abs(Math.ceil(+i)),Fe=+i,e.textContent=i),+i}(i,Fe)||t),Fe=void 0!==t?t:0===Fe?2===Ie?20:12:0,0===Fe?(n.classList.remove("on"),i.innerText="off"):(n.classList.add("on"),i.innerText=`${Fe}s`,Ut({shiftKey:!1,target:document.querySelector(".slice-grid-off")},0),a.spacedChainMode&&kt(!0)),Jt()}function kt(e){const t=document.querySelector("button.dl-spaced"),n=document.querySelector("button.dl-chain"),i=document.querySelector(".toggle-spaced-chain-mode");e&&(a.spacedChainMode=!a.spacedChainMode),i.classList[a.spacedChainMode?"remove":"add"]("fade"),t.style.display=a.spacedChainMode?"block":"none",n.style.display=a.spacedChainMode?"none":"block",a.spacedChainMode&&a.exportChainsAsPresets&&St(!1)}function _t(e,t,n,i){const r=document.querySelector(t);n&&(a[e]=void 0===i?!a[e]:i),r?.classList[a[e]?"remove":"add"]("fade")}function St(e){!a.exportChainsAsPresets&&a.spacedChainMode&&kt(!0);const t=e.device===a.exportChainsAsPresets?.device?void 0:e;document.querySelectorAll("button[class^=toggle-preset-bundling]").forEach((e=>e.classList.add("fade"))),_t("exportChainsAsPresets",`.toggle-preset-bundling-${e.device}`,a.exportChainsAsPresets!==e,t),Jt()}function Ct(e="settings"){const t=document.querySelector("#exportSettingsPanel"),n=document.querySelector("#exportSettingsPanel .content");t.dataset.page=e;let i=`\n      <div class="export-options">\n          <span class="${"about"!==e&&e?"":"active"}" onpointerdown="digichain.showExportSettingsPanel('about')">About</span>\n          <span class="${"audio"===e?"active":""}" onpointerdown="digichain.showExportSettingsPanel('audio')">Audio Config</span>\n          <span class="${"session"!==e&&e?"":"active"}" onpointerdown="digichain.showExportSettingsPanel('session')">Session</span>\n          <span class="${"settings"===e?"active":""}" onpointerdown="digichain.showExportSettingsPanel('settings')">Settings</span>\n      </div>\n    `;switch(e){case"settings":i+=`\n      <span class="settings-info">All settings here will persist when the app re-opens.</span>\n      <table style="padding-top:0;">\n      <thead>\n      <tr>\n      <th width="68%"></th>\n      <th></th>\n    </tr>\n    </thead>\n      <tbody>\n      <tr>\n      <td><span>Pitch up exported files by octave &nbsp;&nbsp;&nbsp;</span></td>\n      <td>    <button onpointerdown="digichain.pitchExports(1)" class="check ${1===a.pitchModifier?"button":"button-outline"}">OFF</button>\n      <button onpointerdown="digichain.pitchExports(2)" class="check ${2===a.pitchModifier?"button":"button-outline"}">1</button>\n      <button onpointerdown="digichain.pitchExports(4)" class="check ${4===a.pitchModifier?"button":"button-outline"}">2</button>\n      <button onpointerdown="digichain.pitchExports(8)" class="check ${8===a.pitchModifier?"button":"button-outline"}">3</button><br></td>\n    </tr>\n    <tr>\n    <td><span>Reverse all even samples in a chain? &nbsp;&nbsp;&nbsp;</span></td>\n    <td><button onpointerdown="digichain.toggleSetting('reverseEvenSamplesInChains')"\n     title="When enabled, all even samples in chains will be reversed (back-to-back mode)."\n     class="check ${a.reverseEvenSamplesInChains?"button":"button-outline"}">${a.reverseEvenSamplesInChains?"YES":"NO"}</button></td>\n    </tr>\n    <tr>\n    <td><span>Pad spaced chains with?&nbsp;&nbsp;&nbsp;</span></td>\n    <td>\n    <button title="Pads spaced chains with the last sample of the chain." onpointerdown="digichain.toggleSetting('padSpacedChainsWith', 'last')" class="check ${"last"===a.padSpacedChainsWith?"button":"button-outline"}">Last</button>\n    <button title="Pads spaced chains with silent slices." onpointerdown="digichain.toggleSetting('padSpacedChainsWith', 'silence')" class="check ${"silence"===a.padSpacedChainsWith?"button":"button-outline"}">Blnk</button>\n    <button title="Pads spaced chains with a random sample from within the chain." onpointerdown="digichain.toggleSetting('padSpacedChainsWith', 'random')" class="check ${"random"===a.padSpacedChainsWith?"button":"button-outline"}">Rand</button>\n    <button title="Pads spaced chains with a reversed repeat of the sample within the chain at the offset position from the start." onpointerdown="digichain.toggleSetting('padSpacedChainsWith', 'repeat')" class="check ${"repeat"===a.padSpacedChainsWith?"button":"button-outline"}">Rcsr</button>\n    </td>\n    </tr>\n    <tr>\n    <td><span>Restore the last used Sample Rate/Bit Depth/Channel? &nbsp;&nbsp;&nbsp;</span></td>\n    <td><button onpointerdown="digichain.toggleSetting('restoreLastUsedAudioConfig')" class="check ${a.restoreLastUsedAudioConfig?"button":"button-outline"}">${a.restoreLastUsedAudioConfig?"YES":"NO"}</button></td>\n    </tr>\n    <tr>\n    <td><span>Retain session data between browser refreshes? &nbsp;&nbsp;&nbsp;</span></td>\n    <td><button onpointerdown="digichain.toggleSetting('retainSessionState')" class="check ${a.retainSessionState?"button":"button-outline"}">${a.retainSessionState?"YES":"NO"}</button></td>\n    </tr>\n      <tr>\n      <td><span>Play pop markers when playing back samples?&nbsp;&nbsp;&nbsp;</span></td>\n      <td>\n      <button onpointerdown="digichain.toggleSetting('playWithPopMarker', 0)" class="check ${0===a.playWithPopMarker?"button":"button-outline"}">OFF</button>\n      <button title="0db prevents DT normalization." onpointerdown="digichain.toggleSetting('playWithPopMarker', 1)" class="check ${1===a.playWithPopMarker?"button":"button-outline"}">0db</button>\n      <button title="Peak sets pop to loudest sample peak." onpointerdown="digichain.toggleSetting('playWithPopMarker', 2)" class="check ${2===a.playWithPopMarker?"button":"button-outline"}">Peak</button>\n      </td>\n      </tr>\n      <tr>\n        <td><span>Use a Date Number in place of a file name for exported chain files?&nbsp;&nbsp;&nbsp;</span></td>\n        <td><button title="When set to NO, the first filename in the chain will be used to name the chain, if set to YES, the epoch number at the time of processing will be used. " onpointerdown="digichain.toggleSetting('useDateNumberInPlaceOfFileName')" class="check ${a.useDateNumberInPlaceOfFileName?"button":"button-outline"}">${a.useDateNumberInPlaceOfFileName?"YES":"NO"}</button>\n       </td>\n    </tr>\n      <tr>\n        <td><span>Try to match start/end sample when cropping/truncating?&nbsp;&nbsp;&nbsp;</span></td>\n        <td><button title="Could give shorter length samples than specified but can help\n       reduce clicks on looping cropped/truncated samples" onpointerdown="digichain.toggleSetting('attemptToFindCrossingPoint')" class="check ${a.attemptToFindCrossingPoint?"button":"button-outline"}">${a.attemptToFindCrossingPoint?"YES":"NO"}</button>\n       </td>\n    </tr>\n    <tr>\n      <td><span>De-click exported samples?<br>Helps when importing non-wav files of a different<br>sample rate than the export file, or small buffered audio interfaces. &nbsp;&nbsp;&nbsp;</span></td>\n      <td>\n      <button onpointerdown="digichain.toggleSetting('deClick', 0)" class="check ${0==+a.dePopClick?"button":"button-outline"}">OFF</button>\n      <button onpointerdown="digichain.toggleSetting('deClick', 0.1)" class="check ${.1==+a.dePopClick?"button":"button-outline"}">&gt;10%</button>\n      <button onpointerdown="digichain.toggleSetting('deClick', 0.2)" class="check ${.2==+a.dePopClick?"button":"button-outline"}">&gt;20%</button>\n      <button onpointerdown="digichain.toggleSetting('deClick', 0.3)" class="check ${.3==+a.dePopClick?"button":"button-outline"}">&gt;30%</button>\n      <button onpointerdown="digichain.toggleSetting('deClick', 0.4)" class="check ${.4==+a.dePopClick?"button":"button-outline"}">&gt;40%</button>\n      <button onpointerdown="digichain.toggleSetting('deClick', 0.5)" class="check ${.5==+a.dePopClick?"button":"button-outline"}">&gt;50%</button>\n      <button onpointerdown="digichain.toggleSetting('deClick', 0.75)" class="check ${.75==+a.dePopClick?"button":"button-outline"}">&gt;75%</button>\n      </td>\n    </tr>\n    <tr style="${window.__TAURI__?"display: none;":""}">\n    <td><span>Download multi-file/joined downloads as one zip file? &nbsp;&nbsp;&nbsp;</span></td>\n    <td><button onpointerdown="digichain.toggleSetting('zipDownloads')" class="check ${a.zipDownloads?"button":"button-outline"}">${a.zipDownloads?"YES":"NO"}</button></td>\n    </tr>\n    <tr>\n    <td><span>When exporting stereo, export dual mono files as mono? &nbsp;&nbsp;&nbsp;</span></td>\n    <td><button title="Often, stereo files are just the same mono audio data on both channels, if this is the case, export the file as mono." onpointerdown="digichain.toggleSetting('treatDualMonoStereoAsMono')" class="check ${a.treatDualMonoStereoAsMono?"button":"button-outline"}">${a.treatDualMonoStereoAsMono?"YES":"NO"}</button></td>\n    </tr>\n    <tr style="display: none;">\n    <td><span>Embed slice information in exported wav files?&nbsp;&nbsp;&nbsp;</span></td>\n    <td><button title="Embed the slice information into the wav file in DigiChain format, this includes start, end points and the source file name for the slice." onpointerdown="digichain.toggleSetting('embedSliceData')" class="check button-outline">NO</button></td>\n    </tr>\n    <tr>\n    <td><span>Embed slice information as CUE points in exported wav files?&nbsp;&nbsp;&nbsp;</span></td>\n    <td><button title="Embed slice data as wav CUE point markers, compatible with DirtyWave M8 slice sampler. The end points will extend to the start point of the next sample, or the end of the wav file for the last slice." onpointerdown="digichain.toggleSetting('embedCuePoints')" class="check ${a.embedCuePoints?"button":"button-outline"}">${a.embedCuePoints?"YES":"NO"}</button></td>\n    </tr>\n    <tr>\n    <td><span>Treat slice data in files as distinct files on join?&nbsp;&nbsp;&nbsp;</span></td>\n    <td><button title="If a file already has slice information, when set to YES these slices will be treated as files when creating chains, if set to NO, per file slice data will be discarded." onpointerdown="digichain.toggleSetting('splitOutExistingSlicesOnJoin')" class="check ${a.splitOutExistingSlicesOnJoin?"button":"button-outline"}">${a.splitOutExistingSlicesOnJoin?"YES":"NO"}</button></td>\n    </tr>\n    \x3c!--<tr>\n    <td><span>Embed slice information as Lofi-12 XT points in exported wav files?<br>(Applied only to 12/24 kHz wav exports) &nbsp;&nbsp;&nbsp;</span></td>\n    <td><button title="Embed slice data in wav file header in the Sonicware custom format for the Lofi-12 XT sampler." onpointerdown="digichain.toggleSetting('embedOrslData')" class="check ${a.embedOrslData?"button":"button-outline"}">${a.embedOrslData?"YES":"NO"}</button></td>\n    </tr>--\x3e\n    <tr>\n    <td><span>Create accompanying .ot metadata file?<br>(Applied only to 44.1 kHz 16/24 [non-aif] audio contexts) &nbsp;&nbsp;&nbsp;</span></td>\n    <td><button onpointerdown="digichain.toggleSetting('exportWithOtFile')" class="check ${a.exportWithOtFile?"button":"button-outline"}">${a.exportWithOtFile?"YES":"NO"}</button></td>\n    </tr>\n    <tr>\n    <td><span>Use even numbered slices as loop point of prev slice on .ot exports?<br>(Applied only to .ot files created during chain creation) &nbsp;&nbsp;&nbsp;</span></td>\n    <td><button onpointerdown="digichain.toggleSetting('useNextEvenNumberedSliceAsLoopStartForOtFile')" class="check ${a.useNextEvenNumberedSliceAsLoopStartForOtFile?"button":"button-outline"}">${a.useNextEvenNumberedSliceAsLoopStartForOtFile?"YES":"NO"}</button></td>\n    </tr>\n    <tr>\n    <td><span>Limit imports to maximum of 750 files?&nbsp;&nbsp;&nbsp;</span></td>\n    <td><button title="Enforces a limit of 750 files per import, to help prevent crashes on nested folders of many files - disabling may result in slow-downs or timeouts." onpointerdown="digichain.toggleSetting('importFileLimit')" class="check ${a.importFileLimit?"button":"button-outline"}">${a.importFileLimit?"YES":"NO"}</button></td>\n    </tr>\n    <tr>\n    <td><span>Skip rendering the mini audio waveform in the list?&nbsp;&nbsp;&nbsp;</span></td>\n    <td><button title="When processing large lists of files, skiping the renderings of the waveform can improve the responsiveness of the browse as no canvas element per row will be rendered." onpointerdown="digichain.toggleSetting('skipMiniWaveformRender')" class="check ${a.skipMiniWaveformRender?"button":"button-outline"}">${a.skipMiniWaveformRender?"YES":"NO"}</button></td>\n    </tr>\n    <tr>\n    <td><span>Show Shift/Ctrl modifier touch buttons?&nbsp;&nbsp;&nbsp;</span></td>\n    <td><button onpointerdown="digichain.toggleSetting('showTouchModifierKeys')" class="check ${a.showTouchModifierKeys?"button":"button-outline"}">${a.showTouchModifierKeys?"YES":"NO"}</button></td>\n    </tr>\n    <tr>\n    <td><span>Shift+Click to download single files from the list?&nbsp;&nbsp;&nbsp;</span></td>\n    <td><button onpointerdown="digichain.toggleSetting('shiftClickForFileDownload')" class="check ${a.shiftClickForFileDownload?"button":"button-outline"}">${a.shiftClickForFileDownload?"YES":"NO"}</button></td>\n    </tr>\n    <tr>\n    <td><span>Use Dark theme as the default? (No = Light theme)&nbsp;&nbsp;&nbsp;</span></td>\n    <td><button onpointerdown="digichain.toggleSetting('darkModeTheme')" class="check ${a.darkModeTheme?"button":"button-outline"}">${a.darkModeTheme?"YES":"NO"}</button></td>\n    </tr>\n    <tr>\n    <td><span>Normalize text/waveform color contrast? &nbsp;&nbsp;&nbsp;</span></td>\n    <td><button onpointerdown="digichain.toggleSetting('normalizeContrast')" class="check ${a.normalizeContrast?"button":"button-outline"}">${a.normalizeContrast?"YES":"NO"}</button></td>\n    </tr>\n    <tr>\n    <td><span>Show the welcome panel at launch? &nbsp;&nbsp;&nbsp;</span></td>\n    <td><button title="The welcome panel will show at launch if the list is empty."\n              onpointerdown="digichain.toggleSetting('showWelcomeModalOnLaunchIfListEmpty')" class="check ${a.showWelcomeModalOnLaunchIfListEmpty?"button":"button-outline"}">${a.showWelcomeModalOnLaunchIfListEmpty?"YES":"NO"}</button></td>\n    </tr>\n    </tbody>\n    </table>\n    `;break;case"audio":i+=`\n      <table style="padding-top:0;" id="settingAudioConfig">\n      <thead>\n      <tr>\n      <th style="border: none;"></th>\n      <th style="border: none;"></th>\n    </tr>\n    </thead>\n      <tbody>\n        <tr>\n          <td style="border: none;"><span>Working Sample Rate (Hz)&nbsp;&nbsp;&nbsp;</span></td>\n          <td style="border: none;">\n              <div class="input-set" id="settingsWorkingSampleRateGroup" style="display: flex; align-items: flex-start;">\n                  <input type="number" placeholder="Sample Rate between ${a.supportedSampleRates.toString()}Hz"\n                  onfocus="(() => {this.placeholder = this.value; this.value = '';})()"\n                  onblur="(() => { this.value = this.value || this.placeholder; this.placeholder = this.dataset.placeholder;})()"\n                  id="settingsWorkingSampleRate" value="${Pe}" data-sample-rate="${Pe}" list="commonSR"\n                  data-placeholder="Sample Rate between ${a.supportedSampleRates.toString()}"\n                  min="${a.supportedSampleRates[0]}" max="${a.supportedSampleRates[1]}">\n                  <datalist id="commonSR">\n                    ${[12e3,24e3,32e3,44100,48e3].map((e=>'<option value="'+e+'">')).join("")}\n                  </datalist>\n                  <button title="Restore currently active working sample rate" class="button-clear" onpointerdown="(() => {const i = document.getElementById('settingsWorkingSampleRate'); i.value = i.dataset.sampleRate;})()"><i class="gg-undo"></i></button>\n              </div>\n          </td>\n      </tr>\n        <tr><td colspan="2"><span><small>Caution: Changing the working sample rate will resample any files currently in the list to the specified sample rate.</small></span><br><br></td></tr>\n      <tr>\n          <td style="border: none;"><span style="padding-top: 1rem; display: block;">Target Sample Rate (Hz)&nbsp;&nbsp;&nbsp;</span></td>\n          <td style="border: none;">\n              <div class="input-set ${"a"===Te?"disabled":""}" id="settingsSampleRateGroup" style="display: flex; align-items: flex-start; padding-top: .5rem;">\n                  <input type="number" placeholder="Sample Rate between ${a.supportedSampleRates.toString()}Hz"\n                  ${"a"===Te?'disabled="disabled"':""}\n                  onfocus="(() => {this.placeholder = this.value; this.value = '';})()"\n                  onblur="(() => { this.value = this.value || this.placeholder; this.placeholder = this.dataset.placeholder;})()"\n                  id="settingsSampleRate" value="${Oe}" data-sample-rate="${Oe}" list="commonSR"\n                  data-placeholder="Sample Rate between ${a.supportedSampleRates.toString()}"\n                  min="${a.supportedSampleRates[0]}" max="${a.supportedSampleRates[1]}">\n                  <datalist id="commonSR">\n                    ${[12e3,24e3,32e3,44100,48e3].map((e=>'<option value="'+e+'">')).join("")}\n                  </datalist>\n                  <button title="Restore currently active sample rate" class="button-clear" onpointerdown="(() => {const i = document.getElementById('settingsSampleRate'); i.value = i.dataset.sampleRate;})()"><i class="gg-undo"></i></button>\n              </div>\n          </td>\n      </tr>\n      <tr><td colspan="2" style="padding-top: 1.5rem;"></td></tr>\n    \n      <tr>\n      <td><span>Bit Depth&nbsp;&nbsp;&nbsp;</span></td>\n      <td>\n      <div style="padding: 1.5rem 0;" class="${"a"===Te?"disabled":""}" id="bitDepthGroup" data-bit-depth="${Le}" onclick="((event, el) => {\n          el.dataset.bitDepth = event.target.dataset.bitDepth || el.dataset.bitDepth;\n      el.querySelectorAll('button').forEach(b => b.classList = b.dataset.bitDepth === el.dataset.bitDepth ? 'check button' : 'check button-outline');\n      document.getElementById('ditherGroup').classList[+el.dataset.bitDepth === 32 ? 'add': 'remove']('disabled');\n      })(event, this);">\n          <button id="acoBitDepth8" data-bit-depth="8" class="check button${8!==Le?"-outline":""}">8 Bit</button>\n          <button id="acoBitDepth16" data-bit-depth="16" class="check button${16!==Le?"-outline":""}">16 Bit</button>\n          <button id="acoBitDepth24" data-bit-depth="24" class="check button${24!==Le?"-outline":""}">24 Bit</button>\n         <button id="acoBitDepth32" data-bit-depth="32" class="check button${32!==Le?"-outline":""}">32 Bit</button>\n     </div>\n      </td>\n      </tr>\n      <tr>\n      <td><span>Dither 8/16/24 Bit Exports&nbsp;&nbsp;&nbsp;</span></td>\n      <td>\n      <div style="padding: 1.5rem 0;" class="${32===Le?"disabled":""}" data-dither="${a.ditherExports}" id="ditherGroup" onclick="((event, el) => {\n          el.dataset.dither = event.target.dataset.dither || el.dataset.dither;\n      el.querySelectorAll('button').forEach(b => b.classList = b.dataset.dither === el.dataset.dither ? 'check button' : 'check button-outline');\n      })(event, this);">\n          <button id="acoDitherNo" data-dither="false" class="check button${a.ditherExports&&32!==Le?"-outline":""}">NO</button>\n          <button id="acoDitherYes" data-dither="true" class="check button${a.ditherExports&&32!==Le?"":"-outline"}">YES</button>\n     </div>\n      </td>\n      </tr>\n      <tr>\n          <td><span>Channels&nbsp;&nbsp;&nbsp;</span></td>\n          <td>\n            <div style="padding: 1.5rem 0;" id="channelsGroup" data-channels="${Ie}" onclick="((event, el) => {\n          el.dataset.channels = event.target.dataset.channels || el.dataset.channels;\n      el.querySelectorAll('button').forEach(b => b.classList = b.dataset.channels === el.dataset.channels ? 'check button' : 'check button-outline')\n      })(event, this);">\n            <button id="acoChannelm" data-channels="1" class="check button${1!==Ie?"-outline":""}">MONO</button>\n              <button id="acoChannels" data-channels="2" class="check button${2!==Ie?"-outline":""}">STEREO</button>\n              </div>\n          </td>\n      </tr>\n    \n      <tr>\n          <td style="border: none;"><span>Container&nbsp;&nbsp;&nbsp;</span></td>\n          <td style="border: none;">\n            <div style="padding: 1.5rem 0;" id="targetContainerGroup" data-container="${Te}" onclick="((event, el) => {\n          el.dataset.container = event.target.dataset.container || el.dataset.container;\n      el.querySelectorAll('button').forEach(b => b.classList = b.dataset.container === el.dataset.container ? 'check button' : 'check button-outline');\n      if (el.dataset.container === 'a') {\n          document.getElementById('acoBitDepth16').click();\n          document.getElementById('bitDepthGroup').classList.add('disabled');\n          document.getElementById('settingsSampleRate').value = 44100;\n          document.getElementById('settingsSampleRate').disabled = true;\n          document.getElementById('settingsSampleRateGroup').classList.add('disabled');\n      } else {\n            document.getElementById('bitDepthGroup').classList.remove('disabled');\n            document.getElementById('settingsSampleRate').disabled = false\n            document.getElementById('settingsSampleRateGroup').classList.remove('disabled');\n      }\n      })(event, this);">\n            <button id="acoContainerw" data-container="w" class="check button${"w"===Te?"":"-outline"}">WAV</button>\n              <button id="acoContainera" data-container="a" class="check button${"a"===Te?"":"-outline"}">AIF</button>\n              </div>\n          </td>\n      </tr>\n        <tr><td colspan="3"><span><small>Note: Choosing AIF will set the sample rate to 44100 and the bit depth to 16 bit.</small></span><br><br></td></tr>\n    \n      <tr>\n    \n      <tr>\n        <td><span>Slice Grid Options&nbsp;&nbsp;&nbsp;</span></td>\n        <td>\n            <div id="sliceGridGroup">\n               ${[1,2,3,4,5,6].map(((e,t)=>'<input id="gridSize'+e+'" placeholder="" type="number" class="acoSliceGridOption" onfocus="(() => {this.placeholder = this.value; this.value = \'\';})()" onblur="(() => { this.value = this.value || this.placeholder;})()" list="commonGridSizes" value="'+Je[t+1]+'">')).join("")}\n               <datalist id="commonGridSizes">\n                    ${[2,4,8,10,12,15,16,24,30,32,48,60,64,128].map((e=>'<option value="'+e+'">')).join("")}\n               </datalist>\n            </div>\n        </td>\n      </tr>\n    \n      <td style="border-bottom: none;">\n        <a class="button" style="margin: 2.5rem 2rem;" onpointerdown="digichain.changeAudioConfig()">Apply Audio Settings</a>\n      </td>\n      <td style="border-bottom: none;">\n        <select id="audioValuesFromCommonSelect" class="btn-audio-config" style="margin: 0 2rem; max-width: 25rem; float: right;" onchange="digichain.setAudioOptionsFromCommonConfig(event)">\n            <option value="none" disabled selected>Common Configurations</option>\n            <option value="48000m16w0-4-8-16-32-64-128" data-device="dt">Digitakt</option>\n            <option value="48000s16w0-4-8-16-32-64-128" data-device="dt">Digitakt II</option>\n            <option value="44100s16w0-4-8-16-32-64-128" data-device="m8">Dirtywave M8</option>\n            <option value="48000m16w0-8-10-12-15-30-60" data-device="dt">Model:Samples</option>\n            <option value="44100s16w0-4-8-16-32-48-64" data-device="ot">Octatrack (16bit)</option>\n            <option value="44100s24w0-4-8-16-32-48-64" data-device="ot">Octatrack (24bit)</option>\n            <option value="44100s16a0-4-8-12-16-20-24" data-device="op1f">OP-1 Field</option>\n            <option value="44100m16a0-4-8-12-16-20-24" data-device="opz">OP-1 / OP-Z</option>\n            <option value="44100s16w0-4-8-12-16-20-24" data-device="xy">OP-XY</option>\n            <option value="44100m16w0-4-8-16-24-32-48" data-device="pt">Polyend Tracker</option>\n            <option value="44100s16w0-4-8-16-24-32-48" data-device="pt">Polyend Tracker Mini</option>\n            <option value="48000m16w0-8-10-12-15-30-60" data-device="dt">Rytm</option>\n            <option value="12000m16w0-2-4-8-10-12-15">Sonicware Lofi-12 XT 12kHz</option>\n            <option value="24000m16w0-2-4-8-10-12-15">Sonicware Lofi-12 XT 24kHz</option>\n            <option value="46875m16w0-3-4-6-8-9-12">TE EP-133 / EP-1320 (mono)</option>\n            <option value="46875s16w0-3-4-6-8-9-12">TE EP-133 / EP-1320 (stereo)</option>\n            <option value="48000s16w0-4-8-12-24-48-84" data-device="tv">Tonverk (16bit)</option>\n            <option value="48000s24w0-4-8-12-24-48-84" data-device="tv">Tonverk (24bit)</option>\n        </select>\n      </td>\n      </tr>\n      <tr><td colspan="2"  style="border: none;">&nbsp;</td></tr>\n    </tbody>\n    </table>\n    `;break;case"session":i+='\n              <br>\n              <span>Export the current list and audio configuration to a DigiChain session file.</span>\n              <table id="settingSession">\n              <thead>\n              <tr>\n              <th style="width: 38%;"></th>\n              <th></th>\n              </tr>\n              </thead>\n                  <tbody>\n                  <tr>\n                      <td style="border: none;"><span style="padding-top: 1rem; display: block;">Session File Name&nbsp;&nbsp;&nbsp;</span></td>\n                      <td style="border: none;">\n                          <div class="input-set" style="display: flex; align-items: flex-start; padding-top: .5rem;">\n                              <input type="text" id="sessionFileName" value="digichain_session">\n                          </div>\n                      </td>\n                  </tr>\n                  <tr><td colspan="2" style="padding-top: 1.5rem;"></td></tr>\n                \n                  <tr>\n                  <td><span>Include Unselected List Items?&nbsp;&nbsp;&nbsp;</span></td>\n                  <td>\n                  <div id="sessionIncludeUnselected" style="padding: 1.5rem 0;" data-session-unselected="yes" onclick="((event, el) => {\n                      el.dataset.sessionUnselected = event.target.dataset.sessionUnselected || el.dataset.sessionUnselected;\n                  el.querySelectorAll(\'button\').forEach(b => b.classList = b.dataset.sessionUnselected === el.dataset.sessionUnselected ? \'check button\' : \'check button-outline\');\n                  })(event, this);">\n                      <button data-session-unselected="no" class="check button-outline">No</button>\n                      <button data-session-unselected="yes" class="check button">Yes</button>\n                 </div>\n                  </td>\n                  </tr>\n            </tbody>\n            </table>\n            <a class="button" style="margin-left: 2rem;" onclick="digichain.saveSessionUiCall()">Export Session to File</a>\n            ';break;default:i+=`\n              <h3 style="padding-top: 2rem;">DigiChain (${document.querySelector("meta[name=version]").content})</h3>\n              <p>${document.querySelector("meta[name=description]").content.replaceAll("--","<br>")}</p>\n              <p class="float-left"><a href="https://github.com/brian3kb/digichain/releases/tag/v1.5.0" target="_blank">Change log</a></p>\n              <p class="float-right"><a href="https://brianbar.net/" target="_blank">Brian Barnett</a>\n              (<a href="https://github.com/brian3kb" target="_blank">brian3kb</a>) </p>\n            `}n.innerHTML=i,document.getElementById("opExportPanel").classList.remove("show"),t.open||t.showModal()}function Et(e,t,n=!1){return h(e,t,n,Ae,Ie,Pe)}function xt(){const e=document.getElementById("mergePanel"),t=document.getElementById("mergePanelContent");if(Ke=$e.filter((e=>e.meta.checked)).map((e=>(e.meta.pan=e.meta.pan||"C",e))),Ke.length<2)return f("Merge requires more than one file to be selected.");t.innerHTML='\n   <div class="row">\n   <div class="column mh-60vh">\n     <table id="mergeList">\n      <thead>\n        <tr>\n        <th>Filename</th>\n        <th>Duration</th>\n        <th>Mono Channel Choice</th>\n        <th>Panning</th>\n        </tr>\n      </thead>\n    <tbody>\n'+Ke.map((e=>Vt(e,"merge"))).join("")+'</tbody>\n   </table>\n </div>\n</div>\n<span class="merge-info">Merging flattens each source sample to mono based on the mixdown choice and pans that mono file hard left/right or centers. If you want to retain a stereo files stereo field in the merge, duplicate it first and choose its L/R mix.</span>\n<button class="float-right" onclick="digichain.performMergeUiCall()">Merge Files</button>\n',e.open||e.showModal()}function At(){const e=document.getElementById("mergePanel"),t=document.getElementById("mergePanelContent");if(Ke=$e.filter((e=>e.meta.checked)).map((e=>(e.meta.pan=e.meta.pan||"C",e))),Ke.length<2)return f("Blend requires more than one file to be selected.");t.innerHTML='\n   <div class="row">\n   <div class="column mh-60vh">\n     <table id="mergeList">\n      <thead>\n        <tr>\n        <th>Filename</th>\n        <th>Duration</th>\n        <th>Mono Channel Choice</th>\n        </tr>\n      </thead>\n    <tbody>\n'+Ke.map((e=>Vt(e,"blend"))).join("")+`</tbody>\n   </table>\n </div>\n</div>\n<div class="row" style="padding-left: 1rem; padding-top: 2rem;">\n<label for="blendLength">Blend length: </label>\n<select class="btn-audio-config" style="max-width: 100px;margin-left: 1rem;margin-top: -.75rem;" name="blendLength" id="blendLength">\n${[16,32,64,128,256,512,1024,2048,4096].reduce(((e,t)=>e+'<option value="'+t+'"'+(64===t?'selected="selected">':">")+t+"</option>"),"")}\n</select>\n</div>\n<span class="merge-info">EXPERIMENTAL: Blend interpolates between the selected samples by the number of steps specified. Works best when the selected files are approximately the same durations.</span>\n<button class="float-right" onclick="digichain.performBlendUiCall()">Blend Files</button>\n`,e.open||e.showModal()}function Dt(){const e=crypto.randomUUID(),t=Ae.createBuffer(Ie,8,Pe);for(let e=0;e<Ie;e++)for(let n=0;n<t.length;n++)t.getChannelData(e)[n]=0;return{file:{lastModified:Date.now(),name:le($e,"blank.wav"),filename:"blank.wav",path:"",size:0},buffer:t,meta:{length:t.length,duration:Number(t.length/Pe).toFixed(3),startFrame:0,endFrame:t.length,checked:!0,id:e,channel:t.numberOfChannels>1?"L":"",dualMono:!1,slices:!1,note:""}}}async function Rt(e,t=!1,n=[],i=0,r=!1,o=!1){if(0!==$e.length){(r||a.updateResampleChainsToList||e.shiftKey||Xe.shiftKey)&&!a.exportChainsAsPresets&&(r=!0);try{const s=document.getElementById("getJoined");((a.zipDownloads||window.__TAURI__)&&!r||a.exportChainsAsPresets)&&$e.filter((e=>e.meta.checked)).length>1&&(o=o||new JSZip);let l,f,u,h=n.length>0?n:$e.filter((e=>e.meta.checked));if(0===n.length&&a.splitOutExistingSlicesOnJoin){const e=[];for(h.forEach(((t,n)=>!!t.meta?.slices?.length&&e.push(n)));e.length>0;){const t=e.pop(),n=h[t],i=$t({},n.meta.id,!1,"ot",[],!1,!0);h.splice(t,1,...i)}}if(0===n.length&&"xy"===a.exportChainsAsPresets?.device){const e=[];for(h.forEach(((t,n)=>+(t.meta?.duration??0)>=20&&e.push(n)));e.length>0;){const t=e.pop(),n=d(h[t],!0);delete n.meta.slices,n.meta.duration="20.000",n.buffer.channel0=n.buffer.channel0.slice(0,20*Pe),n.buffer.channel1&&(n.buffer.channel1=n.buffer.channel1.slice(0,20*Pe)),n.buffer.length=n.buffer.channel0.length,h.splice(t,1,...n)}}let g=0,b=a.exportChainsAsPresets&&(Ye>a.exportChainsAsPresets.length||!Ye)?a.exportChainsAsPresets.length:Ye;if(0===Fe){if(l=h.splice(0,b>0?b:h.length),n=Array.from(h),h=[...l],t&&0!==b&&0!==h.length)for(;h.length!==b;)switch(a.padSpacedChainsWith){case"random":h.push(h[Math.floor(Math.random()*h.length)]);break;case"repeat":const e=Ft({},h[h.length-l.length],!1,!0);await ye.reverse({},e,!1),h.push(e);break;case"silence":h.push(Dt());break;default:h.push(h[h.length-1])}u=h.reduce(((e,t)=>e>t.buffer.length?e:t.buffer.length),0),g=h.reduce(((e,n)=>e+=t?u:n.buffer.length),0)}else{h=h.filter((e=>e.meta.duration<Fe));let e="a"===Te||"xy"===a.exportChainsAsPresets?.device?a.exportChainsAsPresets?.length||24:0===Ye?64:Ye;const t=h.reduce(((t,n)=>(t.duration+ +n.meta.duration<=Fe*a.pitchModifier&&t.processed.length<e?(t.duration=t.duration+ +n.meta.duration,t.totalLength=t.totalLength+ +n.meta.length,t.processed.push(n)):t.skipped.push(n),t)),{duration:0,totalLength:0,processed:[],skipped:[]});g=t.totalLength,n=t.skipped,h=t.processed}f=[];let v=0;for(let e=0;e<h.length;e++){const n=h[e].meta.slices||ze.getByFileInDcFormat(h[e]);if(n.length&&a.splitOutExistingSlicesOnJoin)if(f.length>0){const e=JSON.parse(JSON.stringify(n));e.forEach((e=>{e.s=e.s+v,e.e=e.e+v})),f=[...f,...e]}else f=[...f,...n];else f.push({s:v,e:v+(t?u:+h[e].buffer.length),n:h[e].file.name,p:h[e].meta.opPan??16384,pab:h[e].meta.opPanAb??!1,st:h[e].meta.opPitch??0});v+=t?u:+h[e].buffer.length}f.forEach((e=>{e.s=e.s>g?g:e.s,e.e=e.e>g?g:e.e})),f=f.filter((e=>e.s<e.e));const w=h[0].file.path?`${(h[0].file.path||"").replace(/\//gi,"-")}`:"",k=`${i+1}`.padStart(`${qe}`.length,"0"),_=ct()?function(e){const t=document.querySelector(".chain-name-toggle");let n=We.filter((e=>!e.used))[0];return n.used=!0,t.dataset.count=`${ct()?ct(!0):""}`,t.classList[t.dataset.count?"remove":"add"]("fade"),n.name}(h.length):a.useDateNumberInPlaceOfFileName?`${w}dc-${t?"sp-":""}${Date.now()}-${k}--${h.length}`:`${w}dc-${t?"sp-":""}${se("",h[0],!0)}-${k}--${h.length}`;if(a.exportChainsAsPresets){const e=[],t="xy"===a.exportChainsAsPresets.device?`${function(e=""){return L(e.replace(/\.[^.]*$/,""))}(_).substring(0,14)}${k}`.replaceAll(/([-.])/gi,""):_;if(h.forEach(((n,i)=>{if(n.buffer.channel0&&(n=it(n)),n.buffer){const i=y(n.buffer,{...n.meta,renderAt:Oe},Pe,Le,Ie,a.dePopClick,!1,a.pitchModifier,!1,!1,!1);let r=new window.Blob([i.buffer],{type:"audio/wav"});const s=le(h.filter((e=>e!==n)),n?.file?.name?.replace(/\.wav$/i,"a"===Te?".aif":".wav")||n.name).replace(/(\s-\s|\s)/g,"-");"xy"===a.exportChainsAsPresets.device?o.file(`${t}.preset/${s}`,r,{binary:!0}):o.file(`${t}/${s}`,r,{binary:!0}),e.push({s:0,e:n.buffer.length,l:n.buffer.length,buffer:n.buffer,name:s})}})),"xy"===a.exportChainsAsPresets.device){const n=c({},e.map((e=>(e.name=e.name.replace(/\.(wav|aif)$/i,""),e))),!0);o.file(`${t}.preset/patch.json`,JSON.stringify(n))}else{const n=function(e="",t=[]){return`# ELEKTRON MULTI-SAMPLE MAPPING FORMAT\nversion = 0\nname = '${e}'\n\n`+t.map(((e,t)=>`[[key-zones]]\npitch = ${24+t}\nkey-center = ${24+t}.0\n\n[[key-zones.velocity-layers]]\nvelocity = 0.49411765\nstrategy = 'Forward'\n\n[[key-zones.velocity-layers.sample-slots]]\nsample = '${e.name}'`)).join("\n\n")}(t,e);o.file(`${t}/${t}.elmulti`,n)}}else{const e=Ae.createBuffer(Ie,g,Pe);for(let t=0;t<Ie;t++)for(let n=0;n<g;n++)e.getChannelData(t)[n]=0;1===Ie&&p(e,h,u,t,a.reverseEvenSamplesInChains),2===Ie&&m(e,h,u,t,a.reverseEvenSamplesInChains);const n={file:{name:`${_}.wav`},buffer:e,meta:{slices:f}};if(r){const e=await pt(n,s,!1,!1,8===Le?8:32),t=new FileReader;t.readAsArrayBuffer(e.blob),t.fileCount=i,t.onload=async t=>{const i=t.target.result.slice(0);await(Pe!==(e.sampleRate||Pe)?new AudioContext({sampleRate:e.sampleRate,latencyHint:"interactive"}):Ae).decodeAudioData(t.target.result,(t=>{sn(t,i,{lastModified:(new Date).getTime(),name:n.file.name,embedSliceData:Ue,sampleRate:e.sampleRate||Pe,channels:t.numberOfChannels,size:(8===Le?8:32)*(e.sampleRate||Pe)*(t.length/(e.sampleRate||Pe))/8*t.numberOfChannels/1024,type:"audio/wav"},"",!0,!1),en()}))}}else{const e="a"===Te;if(o){const t=await pt(n,s,e,!0);n.file.name="a"===Te?n.file.name.replace(".wav",".aif"):n.file.name,o.file(n.file.name,t.blob,{binary:!0});let i=await rn(n.meta.slices??[],n,n.file.name);i&&o.file(i.name,i.blob,{binary:!0})}else{await pt(n,s,e,!0),s.click(),await rn(n.meta.slices??[],n,n.file.name,s)&&s.click()}}}if(n.length>0)i++,Rt(e,t,n,i,r,o);else{if(o){const e=`digichain_${Date.now()}.zip`;window.__TAURI__?o.generateAsync({type:"uint8array"}).then((async t=>{await window.__TAURI__.fs.writeFile(e,t,{baseDir:window.__TAURI__.fs.BaseDirectory.Download,create:!0}),C(""),window.__TAURI__.dialog.message(`Saved to the Downloads folder as '${e}'.`)})):o.generateAsync({type:"blob"}).then((t=>{document.getElementById("getJoined");s.href=URL.createObjectURL(t),s.setAttribute("download",e),s.click(),C("")}))}en()}}catch(e){let t="An unexpected error was encountered while building the sample chain(s).";e&&(t+=`\n\n "${e.toString?e.toString():JSON.stringify(e)}"`),C("Unexpected Error",3e3),f(t,15e3),console.log(e)}}}const Bt=(e,t)=>{const n=rt(t||De?.dataset?.id);if(!n)return;try{n?.source?.stop()}catch(e){}if(n.meta.playing&&!0!==n.meta.playing){const[e,t]=n.meta.playing.split("_");window["clear"+e](+t),n.meta.playing=!1,n.playHead?.remove(),n.playHead=!1}n.waveform?.classList?.remove("playing"),!0===n.meta.playing&&(n.meta.playing=!1);let i=n.playHead||n.waveform?.parentElement?.querySelector(".play-head")||!1;i&&i?.remove()},Pt=(e,t,n,i=0,r)=>{const o=rt(t||De.dataset.id)||!(!e.editor||!e.file)&&e.file;let s,l=e?.editor?e.waveform:!(!o.waveform||"BUTTON"===o.waveform.nodeName)&&o.waveform;n=n||e.shiftKey||Xe.shiftKey||!1,Bt(!1,t||o.meta.id);if(nt())return;o.source=Ae.createBufferSource();let c=o.meta.channel&&1===Ie?Et(o.buffer,o.meta.channel,!0):o.buffer;if(a.playWithPopMarker&&!e?.editor){const t=Ae.createBuffer(1,8,Pe),n=Ae.createBuffer(c.numberOfChannels,c.length+2*t.length,Pe),i=t.getChannelData(0);let r;r=2===a.playWithPopMarker?o.meta.peak??ye.normalize(e,o,!1,!0):1,new Array(t.length).fill(0).forEach(((e,n)=>t.getChannelData(0)[n]=r));for(let e=0;e<c.numberOfChannels;e++){const r=c.getChannelData(e);n.copyToChannel(i,e),n.copyToChannel(r,e,t.length),n.copyToChannel(i,e,t.length+r.length)}c=n}o.source.buffer=c,o.source.connect(Ae.destination),o.source.loop=n,t&&!e?.editor&&e.target&&e.target!==o.waveform&&(o.waveform="CANVAS"===o.waveform?.tagName?o.waveform:e.target,l=!(!o.waveform||"BUTTON"===o.waveform.nodeName)&&o.waveform),t&&l&&(s=document.createElement("span"),s.classList.add("play-head"),s.style.animationDuration=`${o.meta.duration}s`,e?.editor?(s.style.height=`${e.loopSection.style.height}`,s.style.animationDuration=`${r}s`,s.dataset.end=`${e.loopSection.style.width.replace("px","")}`,e.loopSection.appendChild(s)):l.parentElement.appendChild(s),l.playHead=s,o.playHead=s),o.source.start(0,i||0,r),t&&l&&(l?.classList?.add("playing"),l.playHead?(l.playHead.style.animationIterationCount=o.source.loop?"infinite":"unset",o.source.loop?o.meta.playing="Interval_"+setInterval((()=>{const e=o.waveform?.parentElement?.querySelector(".play-head");if(e){const t=e.cloneNode(!0);e.remove(),o.waveform.parentElement.appendChild(t)}else Bt(!1,o.meta.id)}),1e3*o.meta.duration):o.meta.playing="Timeout_"+setTimeout((()=>{Bt(!1,o.meta.id)}),1e3*o.meta.duration)):o.source.loop&&(o.meta.playing=o.source.loop||"Timeout_"+setTimeout((()=>{Bt(!1,o.meta.id)}),1e3*o.meta.duration)))},Ot=(e,t,n,i,r)=>{if(e.ctrlKey||e.metaKey||Xe.ctrlKey){const a=n/Pe;Pt(e,t,r,a,i/Pe-a)}};const Lt=(e,t,n=!1,i=!1)=>{try{const r=ot(t),a=ot(t).querySelector(".toggle-check"),o=rt(t);if(e.preventDefault(),!e.shiftKey&&!Xe.shiftKey||i)o.meta.checked=!o.meta.checked,a.classList[o.meta.checked?"remove":"add"]("button-outline"),r.classList[o.meta.checked?"add":"remove"]("checked"),!o.meta.checked&&n&&o.source?.stop();else{const n=at(Be.dataset.id),i=at(t),r=Math.min(n,i),a=Math.max(n,i);for(let t=r;t<=a;t++){const n=ot($e[t].meta.id),i=!(e.ctrlKey||e.metaKey||Xe.ctrlKey);$e[t].meta.checked=i,n.querySelector(".toggle-check").classList[i?"remove":"add"]("button-outline"),n.classList[i?"add":"remove"]("checked")}}je="",Jt()}catch(e){Jt()}},It=async(e,t,n,i=!0,r="#masterList")=>{ot(t,r).querySelector(".channel-option-"+n);const a=rt(t);if((e.shiftKey||Xe.shiftKey)&&i){const e={L:"audio from the Left channel",R:"audio from the Right channel",S:"Sum both channels of audio to mono",D:"Difference between Left and Right channels"};return await u("confirm",`Confirm setting all selected samples that are stereo to ${e[n]}?`)&&$e.filter((e=>e.meta.checked&&e.buffer.numberOfChannels>1)).forEach((e=>{e.meta.channel=n,a.waveform=!1})),!Xe.shiftKey&&document.body.classList.contains("shiftKey-down")&&document.body.classList.remove("shiftKey-down"),en()}if(a.meta.channel=n,"#masterList"===r)return a.waveform=!1,Qt(a);document.getElementById("mergePanel").open&&document.getElementById("blendLength")?At():xt()},Tt=async(e,t,n=!1)=>{let i=t;return n||(i=await u("prompt",`Temporarily change slice value "${t}" to what new value?`,{inputType:"number",defaultValue:t})),i&&!isNaN(i)&&(i=Math.abs(Math.ceil(+i)),Je[e.dataset.sel]=+i,e.textContent=i),+i},Ut=(e,t)=>{if(e.target){if(e.ctrlKey||e.metaKey||Xe.ctrlKey)return 0===t?(Se.forEach(((e,t)=>Tt(document.querySelector(`.master-slices .sel-${t}`),e,!0))),Je=Array.from(Se),Ut({shiftKey:!0},0)):Ut({shiftKey:!0},Tt(e.target,t));if(Ye=t,Je.forEach(((e,n)=>{const i=document.querySelector(`.master-slices .sel-${n}`);e===t?i.classList.remove("button-outline"):i.classList.add("button-outline")})),Jt(),0===t&&$e.forEach((e=>e.source?.stop())),e.shiftKey||Xe.shiftKey){$e.forEach((e=>e.meta.checked=!1));for(let n=0;n<(t<$e.length?t:$e.length);n++)Lt(e,$e[n].meta.id,!0,!0);en()}}},Ft=(e,t,n=!1,i=!1)=>{const r=t?.buffer?t:rt(t),a=at(t)+1,o={file:{...r.file}};o.buffer=new AudioBuffer({numberOfChannels:r.buffer.numberOfChannels,length:r.buffer.length,sampleRate:r.buffer.sampleRate});for(let e=0;e<r.buffer.numberOfChannels;e++){const t=r.buffer.getChannelData(e);o.buffer.getChannelData(e).set(t)}return o.meta=structuredClone(r.meta),o.waveform=!1,o.meta.playing=!1,o.meta.id=crypto.randomUUID(),o.file.name=le($e,o.file.name),n?(o.meta.editOf=t,{item:o,fileIdx:a,callback:(t,n)=>{$e.splice(e.shiftKey||Xe.shiftKey?$e.length:n,0,t),Me.push(t.meta.id),en()},editorCallback:(e,t)=>{$e.splice(t,0,e),Me.push(e.meta.id)}}):(o.meta.dupeOf=t,i?o:($e.splice(e.shiftKey||Xe.shiftKey?$e.length:a,0,o),Me.push(o.meta.id),void en()))};const $t=(e,t,n=!1,i="ot",r=[],a=!1,o=!1)=>{const s=rt(t),l=[];let c;if(c="transient"===i?ze.getByFileName("---sliceToTransientCached---"):"ot"===i?ze.getByFile(s):!!s.meta.customSlices&&s.meta.customSlices,c){if(a)return s.meta.slices=ze.getByFileInDcFormat("transient"===i?"---sliceToTransientCached---":s).filter(((e,t)=>!r.includes(t))),ze.removeByName("transient"===i?"---sliceToTransientCached---":s.file.filename),s.meta.slices=s.meta.slices.length>0&&s.meta.slices,s.meta.op1Json=!1,void qt(e,t);for(let e=0;e<c.sliceCount;e++){if(r.includes(e))continue;const t=c.slices[e].endPoint-c.slices[e].startPoint;if(t<5)continue;const i=Ae.createBuffer(s.buffer.numberOfChannels,t,Pe),a={},f=crypto.randomUUID();a.buffer=i,a.file={...s.file},c.slices[e].name&&(a.file.name=c.slices[e].name),a.meta={length:i.length,duration:Number(i.length/Pe).toFixed(3),startFrame:0,endFrame:i.length,checked:!0,id:f,sliceNumber:`${s.meta.sliceNumber?s.meta.sliceNumber+"-":""}${e+1}`,slicedFrom:s.meta.id,channel:i.numberOfChannels>1?"L":"",opPan:c.slices[e].p??16384,opPanAb:c.slices[e].pab??!1,opPitch:c.slices[e].st??0},a.meta.customSlices=!1,a.meta.op1Json=!1,a.meta.slices=!1,s.buffer.getChannelData(0).slice(c.slices[e].startPoint,c.slices[e].endPoint).forEach(((e,t)=>a.buffer.getChannelData(0)[t]=e)),2===s.buffer.numberOfChannels&&s.buffer.getChannelData(1).slice(c.slices[e].startPoint,c.slices[e].endPoint).forEach(((e,t)=>a.buffer.getChannelData(1)[t]=e)),n||o?l.push(a):$e.push(a),o||Me.push(f)}if(l.length){if(o)return l;ht()?ye.acceptDroppedChainItems(l):$e.splice(at(t)+1,0,...l)}en()}},Mt=(e,t,n,i=!1,r=[],a=!1)=>{const o=rt(t),s=o.buffer.length/n,l=[];if(a)return o.meta.slices=Array.from(".".repeat(n)).map(((e,t)=>({s:Math.round(o.buffer.length/n*t),e:Math.round(o.buffer.length/n*(t+1)),n:"",l:-1}))).filter(((e,t)=>!r.includes(t))),ze.removeByName(o.file.filename),o.meta.slices=o.meta.slices.length>0&&o.meta.slices,void qt(e,t);for(let e=0;e<n;e++){if(r.includes(e))continue;const t=Ae.createBuffer(o.buffer.numberOfChannels,s,o.buffer.sampleRate),n={},a=crypto.randomUUID();n.buffer=t,n.file={...o.file},n.meta={length:t.length,duration:Number(t.length/Pe).toFixed(3),startFrame:0,endFrame:t.length,checked:!0,id:a,sliceNumber:`${o.meta.sliceNumber?o.meta.sliceNumber+"-":""}${e+1}`,slicedFrom:o.meta.id,channel:t.numberOfChannels>1?"L":""},o.buffer.getChannelData(0).slice(e*s,e*s+s).forEach(((e,t)=>n.buffer.getChannelData(0)[t]=e)),2===o.buffer.numberOfChannels&&o.buffer.getChannelData(1).slice(e*s,e*s+s).forEach(((e,t)=>n.buffer.getChannelData(1)[t]=e)),i?l.push(n):$e.push(n),Me.push(a)}l.length&&(ht()?ye.acceptDroppedChainItems(l):$e.splice(at(t)+1,0,...l)),en()},Nt=async(e,t,n)=>{let i,r;const a=document.querySelector("#splitOptions .slice-group"),o=document.querySelectorAll("#splitOptions .slice-group button"),s=document.getElementById("convertChainButton");if(s.style.display="none","custom"===t){const e=await u("prompt","Enter the number of slices to equally chop this sample",{inputType:"number"});"number"==typeof parseInt(e)&&(t=parseInt(e))}"ot"===t&&a.dataset.id&&(i=rt(a.dataset.id),r=ze.getByFile(i),t=r?.slices??[],s.style.display=t.length>0?"block":"none"),"transient"===t&&a.dataset.id?(i=rt(a.dataset.id),r=((e,t=.5)=>{const n=Math.floor(e.buffer.length/256);let i,r,a=[];for(let o=0;o<e.buffer.length;o++)void 0===i?Math.abs(e.buffer.getChannelData(0)[o])>t&&(i=o,o+=n):void 0===r&&(0==Math.abs(e.buffer.getChannelData(0)[o]).toFixed(3)||o+n>e.buffer.length)&&(r=o),void 0!==i&&void 0!==r&&(a.push({startPoint:i,loopPoint:-1,endPoint:r}),i=void 0,r=void 0);a=a.filter((t=>!(t.startPoint>t.startPoint+512)||new Array(512).fill(0).every(((n,i)=>Math.abs(e.buffer.getChannelData(0)[t.startPoint-i])<.03)))).map(((t,n,i)=>(t.endPoint=i[n+1]?.startPoint??(n===i.length-1?e.buffer.length:t.endPoint),t)));let o=ze.getByFileName("---sliceToTransientCached---");return o.slices=a,o.sliceCount=o.slices.length,o})(i,+n/100),t=r?.slices??[]):ze.removeByName("---sliceToTransientCached---"),o.forEach((e=>e.classList.add("button-outline"))),a.dataset.sliceCount="number"==typeof t?t??0:r?.sliceCount??0,o.forEach((e=>{+e.dataset.sel==+a.dataset.sliceCount&&!r||"ot"===e.dataset.sel&&r&&"---sliceToTransientCached---"!==r.name||"transient"===e.dataset.sel&&r&&"---sliceToTransientCached---"===r.name?e.classList.remove("button-outline"):e.classList.add("button-outline")})),jt(t,i||rt(De.dataset.id),r),i?.meta?.customSlices&&(i.meta.customSlices=!1)},zt=(e,t)=>{Bt(!1,e);const n=ot(e),i=at(e),r=$e.splice(i,1),a=Me.findIndex((t=>t===e));return Me.splice(a,1),r[0]&&(ze.removeByName(r[0].file.name),r.buffer&&delete r.buffer),n.classList.add("hide"),n.remove(),!!t||pn()},Kt=(e,t,n="meta")=>{const i=e.shiftKey||Xe.shiftKey,r=["name"];if("id"===t)if(!0===i)$e.sort((()=>crypto.randomUUID().localeCompare(crypto.randomUUID())));else{const e=Me.filter((e=>!Ne.includes(e)));Ne=[...Ne,...e],$e.sort(((e,t,n)=>(i,r)=>e.indexOf(i[t][n])>=e.indexOf(r[t][n])?1:-1)(Ne,n,t)),je=""}else if("note"===t){const e=[],i=["C","C#","Db","D","D#","Eb","E","F","F#","Gb","G","G#","Ab","A","A#","Bb","B"];[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16].forEach((t=>i.forEach((n=>e.push(`${n}${t}`))))),$e=$e.sort(((i,r)=>{const a=i[n][t],o=r[n][t];return e.indexOf(a)<e.indexOf(o)?-1:1})),je===t?($e.reverse(),je=""):je=t}else je===t?(e.ctrlKey||e.metaKey||Xe.ctrlKey?$e.sort(((e,i)=>+i[n][t].replace(/\D+/gi,"")-+e[n][t].replace(/\D+/gi,""))):$e=r.includes(t)?$e.sort(((e,i)=>i[n][t].localeCompare(e[n][t]))):$e.sort(((e,i)=>i[n][t]-e[n][t])),je=""):(e.ctrlKey||e.metaKey||Xe.ctrlKey?$e.sort(((e,i)=>+e[n][t].replace(/\D+/gi,"")-+i[n][t].replace(/\D+/gi,""))):$e=r.includes(t)?$e.sort(((e,i)=>e[n][t].localeCompare(i[n][t]))):$e.sort(((e,i)=>e[n][t]-i[n][t])),je=t);!0===i&&"id"!==t&&$e.sort(((e,t)=>t.meta.checked-e.meta.checked)),e.skipRender||en()},Wt=(e,t)=>{const n=ot(t);!document.body.classList.contains("loading")&&n&&(document.querySelector(".pop-up.show")||(De&&De.classList.remove("selected"),n.classList.add("selected"),Be=De,De=n,De.scrollIntoViewIfNeeded(!0),Jt()))},jt=(e,t,n)=>{const i="number"==typeof e?Array.from(".".repeat(e)).map(((n,i)=>({startPoint:t.buffer.length/e*i,endPoint:t.buffer.length/e*(i+1)}))):e,r=document.getElementById("sliceLines"),a=document.querySelector("#splitOptions .waveform-container").dataset.waveformWidth;let o=[];if(t&&n){let e=t.buffer.length/a;o=n.slices.map(((n,i)=>`\n                <div\n                    class="line ${-1!==(n.loopPoint??-1)?"slice-loop":""} ${1===t.meta?.otLoop&&n.startPoint>=t.meta?.otLoopStart?"file-loop-on":""} ${2===t.meta?.otLoop&&n.startPoint>=t.meta?.otLoopStart?"file-loop-pp":""}"\n                    data-idx="${i}"\n                    onclick="digichain.sliceAction(event, '${t.meta.id}', {startPoint: '${n.startPoint}', endPoint: '${n.endPoint}'})"\n                    ondblclick="this.classList[this.classList.contains('fade') ? 'remove' : 'add']('fade')"\n                    title="${n.name||"Slice "+(i+1)}"\n                    style="margin-left:${n.startPoint/e}px; width:${n.endPoint/e-n.startPoint/e}px;"\n                ></div>\n            `))}else o=i.map(((e,n)=>`\n            <div class="line" data-idx="${n}" onpointerdown="digichain.playSlice(event, '${t.meta.id}', '${e.startPoint}', '${e.endPoint}')" ondblclick="this.classList[this.classList.contains('fade') ? 'remove' : 'add']('fade')"style="margin-left:${a/i.length*n}px; width:${a/i.length}px;" title="Slice ${n+1}"></div>\n        `));r.innerHTML=o.join("")},qt=async(e,t,n,i,r)=>{const a=document.getElementById("splitOptions"),o=document.getElementById("splitFileName"),s=document.querySelector("#splitOptions .slice-group"),l=document.getElementById("sliceByOtButton"),c=document.getElementById("sliceByTransientButton");document.getElementById("transientThreshold");const f=document.querySelector("#splitOptions .waveform-container"),d=document.getElementById("splitPanelWaveform"),h=[...a.querySelectorAll("div.line.fade")].map((e=>+e.dataset.idx));let p,m,g=e.shiftKey||Xe.shiftKey||r;if((e.target.className.includes("is-")||e.target.parentElement.className.includes("is-"))&&(e.ctrlKey||e.metaKey||Xe.ctrlKey)){p=rt(t||De.dataset.id);await u("confirm",`Clear slice data for ${p.file.name}?`)&&(p.meta.slices=!1,p.meta.op1Json&&(p.meta.op1Json=!1),ze.removeByName(p.file.name),Gt(p.meta.id))}else{if(t&&(De=ot(t),s.dataset.id=t),!0===n&&(n=s.dataset.sliceCount),p=rt(t||De.dataset.id),n){if(t=t||p.meta.id,"ot"===n||!c.classList.contains("button-outline")||!l.classList.contains("button-outline")||r&&p.meta.slices?.length){const n=c.classList.contains("button-outline")?"ot":"transient";$t(e,t,g,n,h,i)}else p.meta.customSlices?$t(e,t,g,"custom",h,i):Mt(e,t,n,g,h,i);if(!i)return a.close();setTimeout((()=>l.dispatchEvent(new PointerEvent("pointerdown"))),250)}m=ze.getByFile(p),o.textContent=se("",p,!0),l.style.display=m?"inline-block":"none",l.textContent=m?`${m.sliceCount}`:"OT",Nt(0,0),ht()?.classList?.remove("show"),a.open||a.showModal(),oe(p,d,p.meta?.channel??0,{width:+f.dataset.waveformWidth,height:128}),p.meta.customSlices=!1,m?.sliceCount&&l.dispatchEvent(new PointerEvent("pointerdown")),Gt(p.meta.id)}},Zt=e=>{const t=Math.floor(e/60),n=Number(e%60).toFixed(2);return t>0?`${t}m ${Math.round(+n)}s`:`${n}s`},Ht=()=>{Xe.shiftKey=!1,Xe.ctrlKey=!1,document.body.classList.remove("shiftKey-down"),document.body.classList.remove("ctrlKey-down")},Yt=()=>{const e=$e.filter((e=>e.meta.checked)).length,t=0!==Ve,n=document.getElementById("fileNum");n.textContent=`${t?"   ":$e.length}/${e}`,n.classList[t?"add":"remove"]("gg-spinner")};function Jt(){const e=$e.filter((e=>e.meta.checked)),t=e.length;let n=a.exportChainsAsPresets&&(Ye>a.exportChainsAsPresets.length||!Ye)?a.exportChainsAsPresets.length:Ye;const i=a.splitOutExistingSlicesOnJoin?e.reduce(((e,t)=>e+(t.meta?.slices?.length?t.meta.slices.length-1:0)),0):0,r=i+t,o=$e.reduce(((e,t)=>e+ +t.meta.duration),0),s=e.reduce(((e,t)=>e+ +t.meta.duration),0);qe=0===r?0:r>0&&n>0?Math.ceil(r/n):1;const l=a.exportChainsAsPresets?" Preset":" Chain";if(document.getElementById("fileNum").textContent=`${$e.length}/${t}`+(i?` (+${i} slices)`:""),document.getElementById("fileNum").classList.remove("gg-spinner"),document.querySelector(".selection-count").textContent=` ${t||"-"} `,document.querySelector(".selection-count").dataset.selectionCount=`${t}`,document.getElementById("lengthHeaderLink").textContent=`Length (${Zt(s)}/${Zt(o)})`,0===Fe){document.querySelectorAll(".join-count").forEach(((e,t)=>{e.textContent=` ${0===qe?"-":qe}${0===t?" Spaced":""}${1===qe?l:l+"s"}`,e.dataset.joinCount=`${qe}`}));try{document.querySelectorAll("tr").forEach((e=>e.classList.remove("end-of-grid"))),a.splitOutExistingSlicesOnJoin||document.querySelectorAll("tr.checked").forEach(((e,t)=>(t+1)%n==0?e.classList.add("end-of-grid"):e.classList.remove("end-of-grid")))}catch(e){}}else{const t=(e,t=0)=>{let i={duration:0,processed:[],skipped:[],count:t},r=e.filter((e=>+e.meta.duration<Fe)),o="a"===Te?24:0===n?64:n;for(;r.length>0;)i=r.reduce(((e,t)=>(e.duration+ +t.meta.duration<=Fe*a.pitchModifier&&e.processed.length<o?(e.duration=e.duration+ +t.meta.duration,e.processed.push(t)):e.skipped.push(t),e)),i),i.count++,i.duration=0,i.processed=[],r=Array.from(i.skipped),i.skipped=[];return i.count};let i=0===e.length?0:t(e);document.querySelector(".join-count-chain").textContent=` ${0===i?"-":i}${1===i?" Chain":" Chains"}`,document.querySelector(".join-count-chain").dataset.joinCount=i;try{document.querySelectorAll("tr").forEach((e=>e.classList.remove("end-of-grid")))}catch(e){}}Ht()}function Gt(e){const t=rt(e),n=ot(e);n.innerHTML=Vt(t);const i=n.querySelector("canvas.waveform");i&&t.waveform&&i.replaceWith(t.waveform)}const Vt=(e,t="main")=>"main"===t?`\n    <tr class="file-row ${e.meta.checked?"checked":""}" data-id="${e.meta.id}"\n          onpointerdown="digichain.handleRowClick(event, '${e.meta.id}')"\n          ondragstart="digichain.rowDragStart(event)" draggable="true">\n      <td>\n          <i class="gg-more-vertical"></i>\n      </td>\n      <td class="toggle-td">\n          <button onpointerdown="digichain.toggleCheck(event, '${e.meta.id}')" class="${e.meta.checked?"":"button-outline"} check toggle-check">&nbsp;</button>\n      </td>\n      <td class="move-up-td">\n          <button title="Move up in sample list." onclick="digichain.move(event, '${e.meta.id}', -1)" class="button-clear move-up"><i class="gg-chevron-up-r has-shift-mod-i"></i></button>\n      </td>\n      <td class="move-down-td">\n          <button title="Move down in sample list." onclick="digichain.move(event, '${e.meta.id}', 1)" class="button-clear move-down"><i class="gg-chevron-down-r has-shift-mod-i"></i></button>\n      </td>\n      <td class="waveform-td">`+(e=>a.skipMiniWaveformRender?`<i onpointerdown="digichain.playFile(event, '${e.meta.id}')" class="gg-play-button waveform-btn ${e.meta.playing?"playing":""}"></i>`:`<canvas onpointerdown="digichain.playFile(event, '${e.meta.id}')" class="waveform waveform-${e.meta.id} ${e.meta.playing?"playing":""}"></canvas>`)(e)+`</td>\n      <td class="file-path-td">\n      ${(e.file.path+e.file.name).length+4>127?'<div title="This files path and name will exceed 127 chars." class="path-exceeds-127">':"<div>"}\n          <span class="file-path">${e.file.path}</span>\n          <a title="${a.shiftClickForFileDownload?"Shift+Click to d":"D"}ownload processed wav file of sample." class="wav-link" onclick="digichain.downloadFile('${e.meta.id}', true, event)">${se(e.file.name)}</a>\n          ${e.meta.dupeOf?" d":""}\n          ${e.meta.editOf?" e":""}\n          ${e.meta.isMerge?" m":""}\n          ${e.meta.sliceNumber?" s"+e.meta.sliceNumber:""}\n          <a class="wav-link-hidden" target="_blank"></a>\n          <a class="meta-link-hidden" target="_blank"></a>\n          </div>\n      </td>\n      <td class="duration-td">\n          <span>${e.meta.duration} s</span>\n      </td>\n      <td class="channel-options-td">\n          <div class="channel-options has-shift-mod" style="display: ${e.buffer.numberOfChannels>1&&1===Ie?"block":"none"}">\n          <a title="Left channel" onclick="digichain.changeChannel(event, '${e.meta.id}', 'L')" class="${"L"===e.meta.channel?"selected":""} channel-option-L">L</a>\n          <a title="Sum to mono" onclick="digichain.changeChannel(event, '${e.meta.id}', 'S')" class="${"S"===e.meta.channel?"selected":""} channel-option-S">S</a>\n          <a title="Right channel" onclick="digichain.changeChannel(event, '${e.meta.id}', 'R')" class="${"R"===e.meta.channel?"selected":""} channel-option-R">R</a>\n          <a title="Difference between Left and Right channels" onclick="digichain.changeChannel(event, '${e.meta.id}', 'D')" class="${"D"===e.meta.channel?"selected":""} channel-option-D">D</a>\n          </div>`+("a"===Te?`<div class="channel-options channel-options-stereo channel-options-stereo-opf ${e.meta.opPanAb?"op-pan-ab-true":""}" title="${1===e.buffer.numberOfChannels?"Mono sample":"Stereo sample"}" style="display: ${2===Ie?"block":"none"}"\n           ondblclick="digichain.changeOpParam(event, '${e.meta.id}', 'baltoggle')"\n           >\n              <input class="channel-balance" type="range" style="display: ${2===e.buffer.numberOfChannels?"inline-block":"none"}" min="0" max="32768" onchange="digichain.changeOpParam(event, '${e.meta.id}', 'bal')" value="${e.meta.opPan??16384}" />\n              <i class="gg-shape-circle" style="display: ${1===e.buffer.numberOfChannels?"inline-block":"none"}"></i>\n              <div style="display: ${2===e.buffer.numberOfChannels?"inline-block":"none"}">\n                <span class="op-la"></span>\n                <span class="op-rb"></span>\n              </div>\n          </div>`:`<div class="channel-options channel-options-stereo" title="${1===e.buffer.numberOfChannels?"Mono sample":"Stereo sample"+(e.meta.dualMono?" (Dual Mono)":"")}" style="display: ${2===Ie?"block":"none"}">\n              <i class="gg-shape-circle"></i>\n              <i class="gg-shape-circle stereo-circle" style="display: ${2===e.buffer.numberOfChannels?"inline-block":"none"}"></i>\n          </div>`)+`</td>\n      <td class="split-td">\n          <button title="Slice sample." onpointerdown="digichain.splitAction(event, '${e.meta.id}')" class="button-clear split gg-menu-grid-r ${ze.getByFile(e)?.cssClass}" data-slice-count="${e.meta?.slices?.length||e.meta?.op1Json?.sliceCount||""}"><i class="gg-menu-grid-r has-ctrl-mod-i"></i></button>\n      </td>\n      <td class="duplicate-td">\n          <button title="Duplicate sample." onpointerdown="digichain.duplicate(event, '${e.meta.id}')" class="button-clear duplicate"><i class="gg-duplicate has-shift-mod-i"></i></button>\n      </td>\n      <td class="toggle-edit-td">\n          <button title="Edit" onpointerdown="digichain.showEditPanel(event, '${e.meta.id}')" class="button-clear toggle-edit"><i class="gg-pen"></i></button>\n      </td>\n      <td class="remove-td">\n          <button title="Remove sample (double-click)." ondblclick="digichain.remove('${e.meta.id}')" class="button-clear remove"><i class="gg-trash"></i></button>\n      </td>\n    </tr>`:`\n<tr class="file-row" data-id="${e.meta.id}">\n  <td class="file-path-td">\n    <span class="file-path">${e.file.path}</span>\n    <span>${se(e.file.name)}</span>\n    ${e.meta.dupeOf?" d":""}\n    ${e.meta.editOf?" e":""}\n    ${e.meta.isMerge?" m":""}\n    ${e.meta.sliceNumber?" s"+e.meta.sliceNumber:""}\n    <a class="wav-link-hidden" target="_blank"></a>\n  </td>\n  <td class="duration-td">\n    <span>${e.meta.duration} s</span>\n  </td>\n  <td class="channel-options-td"">\n      <div class="channel-options" style="display: ${e.buffer.numberOfChannels>1?"block":"none"}">\n      <a title="Left channel" onclick="digichain.changeChannel(event, '${e.meta.id}', 'L', false, '#mergeList')" class="${"L"===e.meta.channel?"selected":""} channel-option-L">L</a>\n      <a title="Sum to mono" onclick="digichain.changeChannel(event, '${e.meta.id}', 'S', false, '#mergeList')" class="${"S"===e.meta.channel?"selected":""} channel-option-S">S</a>\n      <a title="Right channel" onclick="digichain.changeChannel(event, '${e.meta.id}', 'R', false, '#mergeList')" class="${"R"===e.meta.channel?"selected":""} channel-option-R">R</a>\n      <a title="Difference between Left and Right channels" onclick="digichain.changeChannel(event, '${e.meta.id}', 'D', false, '#mergeList')" class="${"D"===e.meta.channel?"selected":""} channel-option-D">D</a>\n      </div>\n      <div class="channel-options channel-options-stereo" title="Mono sample" style="display: ${1===e.buffer.numberOfChannels?"block":"none"}">\n          <i class="gg-shape-circle"></i>\n      </div>\n  </td>\n  <td class="pan-options-td ${"blend"===t?"hide":""}">\n      <div class="pan-options" style="display: block;">\n      <a title="Hard Left" onclick="digichain.changePan(event, '${e.meta.id}', 'L')" class="${"L"===e.meta.pan?"selected":""} pan-option-L">L</a>\n      <a title="Centre" onclick="digichain.changePan(event, '${e.meta.id}', 'C')" class="${"C"===e.meta.pan?"selected":""} pan-option-C">C</a>\n      <a title="Hard Right" onclick="digichain.changePan(event, '${e.meta.id}', 'R')" class="${"R"===e.meta.pan?"selected":""} pan-option-R">R</a>\n      </div>\n  </td>\n</tr>`,Xt=e=>{const t=document.querySelectorAll(".waveform");if(0===t.length)return document.querySelectorAll(".waveform-btn").forEach(((t,n)=>{e[n]&&!e[n].waveform&&(e[n].waveform=t)})),Jt();t.forEach(((t,n)=>{e[n]&&!a.skipMiniWaveformRender&&(e[n].waveform&&"CANVAS"===e[n].waveform.nodeName&&"CANVAS"===t.nodeName?(t.replaceWith(e[n].waveform),e[n].playHead&&!e[n].waveform.nextElementSibling&&e[n].waveform.parentElement.appendChild(e[n].playHead)):(oe(e[n],t,Ie>1&&e[n].buffer.numberOfChannels>1?"S":e[n].meta?.channel??0),e[n].waveform=t))})),Jt()},Qt=(e,t)=>{const n=e||rt(De.dataset.id);(e?ot(e.meta.id):De).innerHTML=Vt(n,t),Xt($e),C("")},en=(e=!1)=>{we.innerHTML=Ge?$e.map((e=>Vt(e))).join(""):'<tr><td colspan="14" style="padding: 2.5rem 1rem 0 4rem;"><p>Hiding samples list, press <code>Shift + L</code> to show.</p></td></tr>',0===$e.length&&(we.innerHTML=""),Xt($e),$e.length&&!e&&pn(),C("")},tn=(e,t,n)=>((127&e)<<7<<7)+((127&t)<<7)+(127&n);function nn(e){const t=e.match(/(_| |-)([A-Ga-g](?:#|b)?)(-?\d+)\.\w+$/);return t&&t.length>2?(t[1]+t[2]+(t[3]||"")).replace(/_|-|\./g,"").trim():""}async function rn(e,t,n,i,r){if(function(e=!1){return(a.exportWithOtFile||e)&&44100===Oe&&"w"===Te}(r)&&e&&e.length>0){let r=t.buffer.length;const o=await S(t.buffer,n);let s=e;a.useNextEvenNumberedSliceAsLoopStartForOtFile&&(s=e.map(((n,i)=>i%2==0&&{...n,l:e.at(i+1)?.s??-1,e:e.at(i+1)?.e??t.buffer.length})).filter(Boolean)),s=s.length>64?s.slice(0,64):s;let l=function(e,t,n=120,i={}){const r=new DataView(new ArrayBuffer(832)),a=6*n*4,o=t,s=+(o/44100/(60/n*4)).toFixed(2),l=+((o-(i.loopStart??0))/44100/(60/n*4)).toFixed(2);[70,79,82,77,0,0,0,0,68,80,83,49,83,77,80,65,0,0,0,0,0,2,0].forEach(((e,t)=>r.setUint8(t,e))),r.setUint32(23,a),r.setUint32(27,100*s),r.setUint32(31,100*l),r.setUint32(35,i.stretch??0),r.setUint32(39,i.loop??0),r.setUint16(43,48),r.setUint8(45,255),r.setUint32(46,0),r.setUint32(50,o),r.setUint32(54,i.loopStart??0);let c=58;for(let t=0;t<64;t++)r.setUint32(c,e[t]?.s??0),r.setUint32(c+4,e[t]?.e??0),r.setUint32(c+8,e[t]?.l??-1),c+=12;r.setUint32(826,e.length);let f=0;for(let e=16;e<r.byteLength;e++)f+=r.getUint8(e);return r.setUint16(830,f),r}(s,r,o?.match??120,{loop:a.useNextEvenNumberedSliceAsLoopStartForOtFile?1:t.meta.otLoop??0,loopStart:t.meta.otLoopStart??0}),c=n.replace(/\.[^.]*$/,".ot");if(!l)return!1;let f=new window.Blob([l],{type:"application/octet-stream"});return i&&(i.href=URL.createObjectURL(f),i.setAttribute("download",c)),{blob:f,name:c}}return!1}const an=(e,t)=>{let n=crypto.randomUUID();try{const i=(new DOMParser).parseFromString(e,"application/xml"),r=i.childNodes[0].tagName;if("RenoiseSong"===r||"RenoiseInstrument"===r){const e=t.replace("Song.xml","").replace("Instrument.xml",""),r=[...i.getElementsByTagName("Sample")];r.map((e=>({uuid:crypto.randomUUID(),name:e.getElementsByTagName("Name")[0].textContent,loopEnd:+e.getElementsByTagName("DisplayLength")[0].textContent,slices:[...e.getElementsByTagName("SliceMarker")].map((e=>+e.getElementsByTagName("SamplePosition")[0].textContent))}))).filter((e=>e.slices.length>0)).forEach((t=>{n=t.uuid,ze.push({uuid:n,name:t.name,path:e,sliceCount:t.slices.length,loopEnd:t.loopEnd,slices:t.slices.map(((e,n,i)=>({startPoint:e,endPoint:i[n+1]??t.loopEnd,loopPoint:-1})))}),Me.push(n)}))}return"Ableton"===r&&[...i.getElementsByTagName("MultiSamplePart")].forEach((e=>{const n=(e.querySelector("SampleRef FileRef RelativePath")?.getAttribute("Value")??"").split("/").at(-1),i=+(e.querySelector("SampleRef DefaultSampleRate")?.getAttribute("Value")??"44100"),r=+(e.querySelector("SampleRef DefaultDuration")?.getAttribute("Value")??"0"),a=3==+(e.querySelector("SlicingStyle")?.getAttribute("Value")??"0")?"ManualSlicePoints":"SlicePoints",o=[...new Set([...e.querySelectorAll(`${a} SlicePoint`)].map((e=>+(e.getAttribute("TimeInSeconds")||"0")*i)))];ze.push({name:n,path:t,sliceCount:o.length,loopEnd:r,slices:o.map(((e,t,n)=>({startPoint:e,endPoint:n[t+1]??r,loopPoint:-1})))})})),n}catch(e){return{uuid:n,failed:!0}}},on=(e,t,n)=>{const i=t.uuid||crypto.randomUUID(),r=e=>{const t=new Uint8Array(e);return new DataView(t.buffer).getInt32(0)};try{if(![70,79,82,77,0,0,0,0,68,80,83,49,83,77,80,65].every(((t,n)=>t===e[n])))return{uuid:i,failed:!0};let a=r([e[39],e[40],e[41],e[42]]),o=r([e[54],e[55],e[56],e[57]]),s=[],l=r([e[826],e[827],e[828],e[829]]),c=58;for(let t=0;t<l;t++)44100===Pe?s.push({startPoint:r([e[c],e[c+1],e[c+2],e[c+3]]),endPoint:r([e[c+4],e[c+5],e[c+6],e[c+7]]),loopPoint:r([e[c+8],e[c+9],e[c+10],e[c+11]])}):s.push({startPoint:Math.round(r([e[c],e[c+1],e[c+2],e[c+3]])/44100*Pe),endPoint:Math.round(r([e[c+4],e[c+5],e[c+6],e[c+7]])/44100*Pe),loopPoint:Math.round(r([e[c+8],e[c+9],e[c+10],e[c+11]])/44100*Pe)}),c+=12;return ze.push({uuid:i,name:t.name,path:n,cssClass:"is-ot-file",otLoop:a,otLoopStart:o,sliceCount:l,slices:s}),Me.push(i),i}catch(e){return{uuid:i,failed:!0}}},sn=(e,t,n,i="",r=!1,a=!0)=>{const o=n.uuid||crypto.randomUUID();let s=!1;try{let i=new DataView(t);for(let r=0;r<i.byteLength-4;r++){const a=String.fromCharCode(i.getUint8(r),i.getUint8(r+1),i.getUint8(r+2),i.getUint8(r+3));if("data"===a){const e=i.getUint32(r+4,!0);if(e&&e<i.byteLength){r=r<e?e-8:r;continue}}if("DCSD"===a||"LIST"===a){const e=i.getUint32(r+4,!0),n=new TextDecoder("utf-8");let o="";if("LIST"===a){"ISBJ"===String.fromCharCode(i.getUint8(r+8),i.getUint8(r+9),i.getUint8(r+10),i.getUint8(r+11))&&(o=atob(n.decode(t.slice(r+12,r+8+e))))}o=o||n.decode(t.slice(r+8,r+8+e));try{const e=JSON.parse(o.trimEnd());s=e.sr!==Pe?e.dcs.map((t=>({s:Math.round(t.s/e.sr*Pe),e:Math.round(t.e/e.sr*Pe),l:Math.round((t.l||-1)/e.sr*Pe),n:t.n}))):e.dcs}catch(e){}}if("cue "===a){i.getUint32(r+4,!0);const t=i.getUint32(r+8,!0);r+=12;const n=i.getUint32(24,!0),a=[];for(let e=0;e<t;e++){const e=i.getUint32(r,!0),t=i.getUint32(r+20,!0);a.push({cueId:e,cuePos:t}),r+=24}s=s||[],a.forEach(((t,i)=>s.push({s:Math.round(t.cuePos/n*Pe),e:i!==a.length-1?Math.round(a[i+1].cuePos/n*Pe):Math.round(e.length/n*Pe),l:-1,n:`Slice ${t.cueId+1}`})))}if("ORSL"===a){i.getUint32(r+4);const e=i.getUint8(r+8);r+=12;const t=[];for(let n=0;n<e;n++){const e=i.getUint8(r),n=i.getUint32(r+4,!0),a=i.getUint32(r+8,!0);t.push({sliceId:e,sliceStart:n,sliceEnd:a}),r+=32}s=[],t.forEach((e=>s.push({s:Math.round(e.sliceStart/n.sampleRate*Pe),e:Math.round(e.sliceEnd/n.sampleRate*Pe),l:-1,n:`Slice ${e.sliceId+1}`})))}}}catch(e){s=!1}try{let t;if(n.sampleRate&&n.sampleRate!==Pe){let i,r;i=new _(n.sampleRate,Pe,1,e.getChannelData(0)),i.resampler(i.inputBuffer.length),2===n.channels&&(r=new _(n.sampleRate,Pe,1,e.getChannelData(1)),r.resampler(r.inputBuffer.length)),t=Ae.createBuffer(n.channels,i.outputBuffer.length,Pe),t.copyToChannel(i.outputBuffer,0),2===n.channels&&t.copyToChannel(r.outputBuffer,1)}if(Array.isArray(s)){s.forEach((n=>n.e=-1===n.e?(t||e).length:n.e));const n=[];s.forEach((e=>!(n.findIndex((t=>t.s===e.s))>-1)&&n.push(e))),s=n}const l=ze.getByFileName(n.name);let c=0,f=0;return l&&l.slices&&l.slices.length>0&&(s=n.name.endsWith(".flac")?l.slices.map(((n,i)=>({s:n.startPoint/l.loopEnd*(t||e).length,e:n.endPoint/l.loopEnd*(t||e).length,l:n.loopPoint}))):l.slices.map(((e,t)=>({s:e.startPoint,e:e.endPoint,l:e.loopPoint,n:e.name||`OT slice ${t+1}`}))),c=l.otLoop,f=l.otLoopStart,ze.removeByName(n.name)),Array.isArray(s)&&(s=s.filter((e=>e.s<e.e))),$e[r?"unshift":"push"]({file:{lastModified:n.lastModified,name:le($e,n.name),filename:n.name,path:i.replace(n.name,""),size:n.size,type:n.type},buffer:t||e,meta:{sourceBitDepth:n.bitDepth,sourceSampleRate:n.sampleRate,length:(t||e).length,duration:Number((t||e).length/Pe).toFixed(3),startFrame:0,endFrame:(t||e).length,checked:a,id:o,channel:(t||e).numberOfChannels>1?"L":"",dualMono:!1,slices:s.length>0&&s,otLoop:c,otLoopStart:f,opPan:16384,opPanAb:!1,opPitch:0,note:nn(n.name)}}),Me.push(o),o}catch(e){return console.log(e),{uuid:o,failed:!0}}},ln=(e,t)=>{e=e.filter((e=>!1!==e)),Ne=[...new Set(Ne)],e.every((e=>Me.includes(e)))?(Kt({skipRender:!0},"id"),Ve=0,en()):(Yt(),setTimeout((()=>ln(e)),1e3))},cn=(e,t)=>{let n=e/t*100;document.getElementById("loadingText").style.backgroundImage=`linear-gradient(90deg, #cf8600 ${n}%, #606c76 ${n+1}%, #606c76 100%)`},fn=async(e,t)=>{C("Loading samples");if(nt())return;const n=Qe();n&&await n;const i=(t=[...t]).find((e=>"dcsd"===e?.name?.split(".")?.reverse()[0].toLowerCase()));if(i){if(await u("confirm",`Would you like to restore the session:<br>\n          '${i.name}'?\n          <br><br>\n          (Items currently in the list will be removed).`,{okLabel:"Restore",cancelLabel:"Cancel"}))return(async e=>{const t=new JSZip;C("Restoring Session"),await t.loadAsync(e);let n=await(t.file("settings")?.async("uint8array"));n=window.msgpack.decode(n),Pe=n.workingSR,await tt(n.lastUsedAudioConfig,!0),et(n.sliceOptions);let i=await(t.file("unsorted")?.async("uint8array"));i=window.msgpack.decode(i),Me=i;let r=await(t.file("importOrder")?.async("uint8array"));r=window.msgpack.decode(r),Ne=r;let a=await(t.file("opExportData")?.async("uint8array"));a&&(a=window.msgpack.decode(a),a.samples&&a.opDataConfig&&X(a.samples,a.opDataConfig));let o=await(t.file("files")?.async("uint8array"));o=window.msgpack.decode(o),$e=o.map((e=>it(e))),en(!0),pn(),C("")})(i)}let r=[...t].filter((e=>["zip","dtprj","xrns","xrni"].includes(e?.name?.split(".")?.reverse()[0].toLowerCase())));if(r.length>0)return void r.forEach(((n,i)=>{const o=new JSZip;let s=1;t[t.findIndex((e=>e===n))]=!1,o.loadAsync(n).then((()=>{const l=Object.keys(o.files).length,c=a.importFileLimit&&Object.keys(o.files).filter((e=>_e.includes(e.split(".").at(-1).toLowerCase()))).length;if(c+$e.length>Ce)return loadingEl.textContent=`skipping zip '${n.name}', files (${c}) will exceed 750 file import limit...`,void(i===r.length-1&&setTimeout((()=>fn(e,t)),3e3));for(let a in o.files)o.files[a].async("blob").then((o=>{o.name=a.split("/").at(-1),o.fullPath=`${n.name}/${a}`,o.fromArchive=n.name,t.push(o),o.uuid=crypto.randomUUID(),_e.some((e=>o.name.toLowerCase().endsWith(e)))&&Ne.push(o.uuid),i===r.length-1&&s===l&&fn(e,t),s++}))}))}));let o=[...t].filter((e=>_e.includes(e?.name?.split(".")?.reverse()[0].toLowerCase()))),s=[...t].filter((e=>["ot","xml","adv"].includes(e?.name?.split(".")?.reverse()[0].toLowerCase())));var l;(e.shiftKey||Xe.shiftKey)&&(l=o,o=[...l].sort((e=>crypto.randomUUID().localeCompare(crypto.randomUUID()))).filter(((e,t)=>t<(Ye>0?Ye:256)||e.fromArchive))),a.importFileLimit&&o.length>Ce&&(o=o.filter(((e,t)=>t<Ce||e.fromArchive)));for(const e of s){if(s.indexOf(e),e.name.endsWith(".adv")){try{const[t]=await Promise.all([e.arrayBuffer()]),n=pako.inflate(t),i=new TextDecoder("utf-8").decode(n);an(i,e.fullPath)}catch(t){loadingEl.textContent=`skipping unreadable file '${e.name}'.`}continue}const t=new FileReader;t.onload=function(t){if(e.uuid=crypto.randomUUID(),e.fullPath=e.fullPath||"",e.name.toLowerCase().endsWith(".ot")){const n=t.target.result,i=n.byteLength,r=new Uint8Array(n,0,i);on(r,e,e.fullPath)}if(e.name.toLowerCase().endsWith(".xml")){const n=t.target.result;an(n,e.fullPath)}},e.name.toLowerCase().endsWith(".ot")?t.readAsArrayBuffer(e):t.readAsText(e)}if(0===o.length)return en();let c=[];const d=(e,t)=>{c.every((e=>Me.includes(e)))&&Ve>=o.length-1&&setTimeout((()=>ln(c)),1e3)};let h={encountered:!1,text:"",count:0};o.forEach(((e,t)=>{const n=new FileReader;n.onload=async function(n){try{e.uuid=e.uuid||crypto.randomUUID(),_e.some((t=>e.name.toLowerCase().endsWith(t)))&&Ne.push(e.uuid),e.fullPath=e.fullPath||"";const i=n.target.result;if(e.name.toLowerCase().endsWith(".syx")||e.name.toLowerCase().endsWith(".aif")||e.name.toLowerCase().endsWith(".pti")){const n=i.byteLength,r=new Uint8Array(i,0,n);let a;c.push(e.uuid),e.name.toLowerCase().endsWith(".aif")&&(a=await(async(e,t,n,i="",r=!1)=>{const a=n.uuid||crypto.randomUUID();try{let t=new DataView(e),o={},s=["FORM","COMM","APPL","SSND"];const l=(n,i)=>{switch(n){case"FORM":o.form={offset:i,id:String.fromCharCode(t.getUint8(i),t.getUint8(i+1),t.getUint8(i+2),t.getUint8(i+3)),fileSize:t.getUint32(i+4),type:String.fromCharCode(t.getUint8(i+8),t.getUint8(i+9),t.getUint8(i+10),t.getUint8(i+11))};break;case"COMM":o.comm={offset:i,id:String.fromCharCode(t.getUint8(i),t.getUint8(i+1),t.getUint8(i+2),t.getUint8(i+3)),size:t.getUint32(i+4),channels:t.getUint16(i+8),frames:t.getUint32(i+10),bitDepth:t.getUint16(i+14),sampleRate:(e=>{const n=[];for(let i=e;i<e+10;i++)n.push(t.getUint8(i));return v(n)})(i+16)};break;case"APPL":const n=new TextDecoder("utf-8"),r=2147483646/(44100*(2===o.comm.channels?20:12));o.json={id:String.fromCharCode(t.getUint8(i),t.getUint8(i+1),t.getUint8(i+2),t.getUint8(i+3)),size:t.getUint32(i+4),scale:r};let a=n.decode(e.slice(i+12,o.json.size+i+8));o.json.data=JSON.parse(a.replace(/\]\}(.|\n)+/gi,"]}").trimEnd());break;case"SSND":o.buffer=e.slice(i+4),o.bufferDv=new DataView(o.buffer)}};for(let e=0;e<t.byteLength-4;e++){const n=String.fromCharCode(t.getUint8(e),t.getUint8(e+1),t.getUint8(e+2),t.getUint8(e+3));s.includes(n)&&(l(n,e),s=s.filter((e=>e!==n)))}if(16!=+o.comm.bitDepth)return C(`Skipping unsupported ${o.comm.bitDepth}bit aif file '${n.name}'...`),delete o.buffer,delete o.bufferDv,t=!1,e=!1,{uuid:a,failed:!0};const c=4,f=o.comm.bitDepth/8,u=[];for(let e=0;e<o.comm.channels;e++)u.push(new Float32Array(o.comm.frames));for(let e=0;e<o.comm.channels;e++){let t=u[e];for(let n=0;n<o.comm.frames;n++){let i=c;i+=(n*o.comm.channels+e)*f;let r=o.bufferDv.getInt16(i,"AIFC"===o.form.type),a=1<<o.comm.bitDepth-1;r>=a&&(r|=~(a-1)),t[n]=r/a,0===n&&(t[n]=0)}}let d,h;d=new _(o.comm.sampleRate,Pe,1,u[0]),d.resampler(d.inputBuffer.length),2===o.comm.channels&&(h=new _(o.comm.sampleRate,Pe,1,u[1]),h.resampler(h.inputBuffer.length));const p=Ae.createBuffer(o.comm.channels,d.outputBuffer.length,Pe);if(2===o.comm.channels)for(let e=0;e<d.outputBuffer.length;e++)p.getChannelData(0)[e]=d.outputBuffer[e],p.getChannelData(1)[e]=h.outputBuffer[e];else for(let e=0;e<d.outputBuffer.length;e++)p.getChannelData(0)[e]=d.outputBuffer[e];const m=e=>e/o.json.scale;o.json&&o.json.data.start&&(o.json.data.start=o.json.data.start.map(((e,t)=>Math.floor(m(e,t)/44100*Pe)))),o.json&&o.json.data.end&&(o.json.data.end=o.json.data.end.map(((e,t)=>Math.floor(m(e,t)/44100*Pe))));const g={file:{lastModified:n.lastModified,name:le($e,n.name),filename:n.name,path:i.replace(n.name,""),size:n.size,type:n.type},buffer:p,meta:{length:p.length,duration:Number(p.length/Pe).toFixed(3),startFrame:0,endFrame:p.length,op1Json:!!o.json&&o.json.data,channel:p.numberOfChannels>1?"L":"",checked:!0,id:a,slices:!1,note:nn(n.name)}},b=ze.getByFile(g);return b&&g.meta.op1Json&&(g.meta.op1Json.sliceCount=b.sliceCount),$e[r?"unshift":"push"](g),Me.push(a),a}catch(e){return{uuid:a,failed:!0}}})(i,0,e,e.fullPath)),e.name.toLowerCase().endsWith(".syx")&&(a=((e,t,n="",i=!1)=>{const r=t.uuid||crypto.randomUUID();try{if(240!==e[0]||126!==e[1]||1!==e[3]||247!==e[20])return{uuid:r,failed:!0};const a=e[6],o=10*Math.ceil(1e8/tn(e[9],e[8],e[7])),s=tn(e[12],e[11],e[10]);let l=tn(e[15],e[14],e[13]),c=tn(e[18],e[17],e[16])+1;const f=e[19];if(127===f&&(l=c=s),o<4e3||o>96e3)return!1;if(16!==a)return!1;let u=e.findIndex(((t,n)=>240===t&&126===e[n+1]&&2===e[n+3]&&247===e[n+126])),d=0,h=[];for(;d<s;){for(let t=u+5;t<u+125&&d<s;t+=3)h[d++]=(e[t]<<9|e[t+1]<<2|e[t+2]>>5)-32768;u+=127}const p=new _(o,Pe,1,h.filter((e=>void 0!==e)));p.resampler(p.inputBuffer.length);const m=Ae.createBuffer(1,p.outputBuffer.length-p.outputBuffer.length/120*5,Pe);return p.outputBuffer.filter((e=>void 0!==e)).forEach(((e,t)=>m.getChannelData(0)[t]=e/32767)),$e[i?"unshift":"push"]({file:{lastModified:t.lastModified,name:le($e,t.name),filename:t.name,path:n.replace(t.name,""),size:t.size,type:t.type},buffer:m,meta:{length:p.outputBuffer.length,loopStart:l,loopEnd:c,loopType:f,duration:Number(p.outputBuffer.length/Pe).toFixed(3),startFrame:0,endFrame:p.outputBuffer.length,checked:!0,id:r,slices:!1,note:nn(t.name)}}),Me.push(r),r}catch(e){return{uuid:r,failed:!0}}})(r,e,e.fullPath)),e.name.toLowerCase().endsWith(".pti")&&(a=await(async(e,t,n,i="")=>{const r=n.uuid||crypto.randomUUID();try{const a=(44100!==Pe?new AudioContext({sampleRate:44100,latencyHint:"interactive"}):Ae).createBuffer(1,t.length-4,44100);for(let e=0;e<t.length-4;e++){const n=t[e]/32768;a.getChannelData(0)[e]=n<0?Math.max(-1,n):Math.min(n,1)}let o;if(44100!==Pe){let e;e=new _(44100,Pe,1,a.getChannelData(0)),e.resampler(e.inputBuffer.length);const t=Ae.createBuffer(1,e.outputBuffer.length,Pe);for(let n=0;n<e.outputBuffer.length;n++)t.getChannelData(0)[n]=e.outputBuffer[n]}let s=new DataView(e);const l=s.getUint8(376);let c=[];for(let e=280;e<280+2*l;e+=2)c.push(s.getUint16(e,!0));c=c.map((e=>e/65535*(o||a).length)),c=c.map(((e,t)=>({s:e,e:t!==l-1?c[t+1]:(o||a).length,l:-1,n:`Slice ${t+1}`})));const f={file:{lastModified:n.lastModified,name:le($e,n.name),filename:n.name,path:i.replace(n.name,""),size:n.size,type:n.type},buffer:o||a,meta:{length:(o||a).length,duration:Number((o||a).length/Pe).toFixed(3),startFrame:0,endFrame:(o||a).length,channel:(o||a).numberOfChannels>1?"L":"",checked:!0,id:r,slices:c.length>1&&c,note:nn(n.name)}};return $e.push(f),Me.push(r),r}catch(e){return{uuid:r,failed:!0}}})(i,new Int16Array(i,392),e,e.fullPath)),a.failed&&c.splice(c.findIndex((e=>e===a.uuid)),1),cn(t+1,o.length),d(0,o.length)}if(e.name.toLowerCase().endsWith(".wav")||"audio/wav"===e.type||e.name.toLowerCase().endsWith(".flac")||e.name.toLowerCase().endsWith(".webm")||e.name.toLowerCase().endsWith(".m4a")||e.name.toLowerCase().endsWith(".mp3")){c.push(e.uuid);const n=i.slice(0);if(e.name.toLowerCase().endsWith(".wav")||"audio/wav"===e.type){let t=new DataView(i);for(let n=0;n<t.byteLength-4;n++){const i=String.fromCharCode(t.getUint8(n),t.getUint8(n+1),t.getUint8(n+2),t.getUint8(n+3));if(n>t.byteLength||"PAD "===i)break;if("fmt "===i){if(e.channels=t.getUint16(n+10,!0),e.sampleRate=t.getUint32(n+12,!0),e.bitDepth=t.getUint16(n+22,!0),!(e.channels<1||0===e.sampleRate||e.bitDepth>32))break;delete e.channels,delete e.sampleRate,delete e.bitDepth}}}await(Pe!==e.sampleRate?new AudioContext({sampleRate:e.sampleRate,latencyHint:"interactive"}):Ae).decodeAudioData(i,(i=>{let r=sn(i,n,e,e.fullPath);r.failed&&c.splice(c.findIndex((e=>e===r.uuid)),1),cn(t+1,o.length),d(0,o.length)}),(n=>{c.splice(c.findIndex((t=>t===e.uuid)),1),cn(t+1,o.length),d(0,o.length)}))}}catch(n){h.encountered=!0,h.count++,e.fromArchive&&(h.text="There was an error extracting files from the zip archive, not all zip files are readable.\n\n            Please use store or deflate compression methods, and generate files with either 7zip as zip, or Windows Explorer."),h.encountered&&h.text&&t===o.length-1&&f(h.text+` (failed: ${h.count})`,15e3)}Ve++,Yt()},n.readAsArrayBuffer(e)})),digichain.importInt&&clearInterval(digichain.importInt),digichain.importInt=setInterval((()=>{document.body.classList.contains("loading")||(o.forEach(((e,t)=>delete o[t])),o=[],s=[],c=[],clearInterval(digichain.importInt))}),1e4)},un=async e=>{if(e.preventDefault(),Qe(),De?.classList?.contains("is-dragging")){let t=Re||e.target;if(e.target?.classList?.remove("is-dragging"),Re?.classList?.remove("drag-offset"),document.getElementById("opExportPanel").classList.contains("show"))return;for(;t&&!t.classList.contains("file-row");)t=t.parentElement||document.body,t="THEAD"===t.nodeName?document.querySelector("tr.file-row"):t,t=t===document.body?document.querySelector("tr.file-row:last-of-type"):t;if(t){const e=De.dataset.id;let n=at(e),i=at(t.dataset.id),r=$e.splice(n,1)[0];$e.splice(i<=n?i:i-1,0,r),en(),De=ot(e),De.classList.add("selected"),De.scrollIntoViewIfNeeded(!0)}}else{if(e?.dataTransfer?.items?.length&&"string"===e?.dataTransfer?.items[0].kind)try{return void e?.dataTransfer?.items[0].getAsString((async e=>{let t=await fetch(e);if(!t.url.includes(".wav"))return;let n=await t.arrayBuffer();const i=n.slice(0);await Ae.decodeAudioData(n,(e=>sn(e,i,{lastModified:(new Date).getTime(),name:t.url.split("/").reverse()[0],size:Le*Pe*(n.length/Pe)/8*n.numberOfChannels/1024,type:"audio/wav"},"",!0))),en()}))}catch(e){}if(e?.dataTransfer?.items?.length){let t=[],n=e.dataTransfer.items.length;t.count=0;const i=e=>{if(e.isFile)e.file((n=>{n.fullPath=e.fullPath.replace("/",""),n.uuid=crypto.randomUUID(),_e.some((e=>n.name.toLowerCase().endsWith(e)))&&Ne.push(n.uuid),t.push(n)})),t.count++,n--;else if(e.isDirectory){const t=e.createReader(),r=()=>t.readEntries((e=>{n+=e.length;for(const t of e)i(t);n--,e.length>0&&r()}));r()}};for(const t of e.dataTransfer.items){const e=t.getAtEntry?t.getAtEntry():t.webkitGetAsEntry();e&&i(e)}let r=setInterval((()=>{n<=0&&t.count===t.length&&(clearInterval(r),fn(e,t))}),500)}}};async function dn(){await Ee.close(),await indexedDB.deleteDatabase("digichain"),a.retainSessionState&&hn(!0)}function hn(e=!1,t){if(!a.retainSessionState)return dn();xe=indexedDB.open("digichain",1),xe.onsuccess=async()=>{Ee=xe.result;const n=Qe();n&&await n,e||(C("Restoring Session"),function(e=!1){if(!a.retainSessionState)return bt();const t=Ee.transaction(["state"],"readonly").objectStore("state");let n=t.get("unsorted"),i=t.get("importOrder");n.onsuccess=()=>{n.result&&(Me=n.result),bt()},i.onsuccess=()=>{i.result&&(Ne=i.result)};let r=t.get("opExportData");r.onsuccess=()=>{if(r.result){const e=window.msgpack.decode(r.result);X(e.samples,e.opDataConfig)}};let o=t.get("files");o.onsuccess=async()=>{if(o.result&&o.result.length>0){if(!e){if(!await u("confirm",`There are ${o.result.length} files from your last session, would you like to restore them?`,{kind:"info",okLabel:"Restore",cancelLabel:"Discard"}))return mn(),void C("")}$e=o.result.map((e=>it(e))),en(!0)}else C("")}}()),t&&t()},xe.onupgradeneeded=e=>{Ee=e.target.result,Ee.createObjectStore("state")}}async function pn(e=!1){if(!a.retainSessionState)return new Promise((e=>e(!0)));if(!Ee||!xe||"done"!==xe.readyState)return hn(!0,(()=>pn())),new Promise((e=>e(!0)));const t=Ee.transaction(["state"],"readwrite",{durability:"relaxed"}).objectStore("state");return t.put(window.msgpack.encode(X(!1,!1,!0)),"opExportData"),e?void 0:(Ne=Ne.filter((e=>Me.includes(e))),t.put(Me,"unsorted"),t.put(Ne,"importOrder"),new Promise((e=>{t.put($e.map((t=>(t===$e.at(-1)&&setTimeout((()=>e(!0)),2e3),d(t)))),"files")})))}function mn(){Ee.transaction(["state"],"readwrite",{durability:"relaxed"}).objectStore("state").clear(),dn()}async function gn(e="digichain_session",t=!1){const n=new JSZip,i={compression:"DEFLATE",compressionOptions:{level:9}},r=(t?$e:$e.filter((e=>e.meta.checked))).map((e=>d(e))),o={lastUsedAudioConfig:a.lastUsedAudioConfig,workingSR:Pe,sliceOptions:Je};n.file("files",window.msgpack.encode(r),i),n.file("unsorted",window.msgpack.encode(Me),i),n.file("importOrder",window.msgpack.encode(Ne),i),n.file("settings",window.msgpack.encode(o),i);const s=X(!1,!1,!0);s.samples.length>0&&n.file("opExportData",window.msgpack.encode(s),i);const l=`${e}.dcsd`,c=window.__TAURI__?async e=>{const t=await e.arrayBuffer();await window.__TAURI__.fs.writeFile(l,t,{baseDir:window.__TAURI__.fs.BaseDirectory.Download,create:!0}),C(""),f(`'${l}.dcsd'<br>session file created.`,1e4)}:e=>{const t=document.getElementById("getJoined");t.href=URL.createObjectURL(e),t.setAttribute("download",l),t.click(),C(""),f(`'${l}.dcsd'<br>session file created.`,1e4)};n.generateAsync({type:"blob",compression:"DEFLATE"}).then(c)}"launchQueue"in window&&window.launchQueue.setConsumer((e=>{e.files&&e.files.length&&fn({},e.files)}));try{(()=>{try{const e=navigator.userAgent.match(/\d+\.\d+\.\d+\.\d+/);if(e&&e[0]&&+e[0].split(".")[0]<114)return f("Chromium browser versions below 114.x.x are not supported.",3e4);const t=navigator.userAgent.match(/Version\/\d+\.\d+\.\d+/);if(t&&t[0]&&+t[0].match(/\d+\.\d+/)<16.3)return f("Safari browser versions below 16.3 are not supported.",3e4);const n=navigator.userAgent.match(/Firefox\/\d+\.\d+/);if(n&&n[0]&&+n[0].match(/\d+\.\d+/)<115)return f("Firefox browser versions below 115.x are not supported.",3e4)}catch(e){}})(),ve.addEventListener("change",(async()=>fn({shiftKey:Xe.shiftKey},ve.files)),!1),ve.addEventListener("click",(async e=>{(e.ctrlKey||e.metaKey||Xe.ctrlKey)&&(e.preventDefault(),e.stopPropagation(),await(async()=>{const e=Qe();e&&await e;const t=Dt(),n=De?at(De.dataset.id)+1:$e.length;$e.splice(n,0,t),Me.push(t.meta.id),en()})())}),!1),document.body.addEventListener("dragover",(e=>{if(e.preventDefault(),De&&De.classList.contains("is-dragging")&&!document.getElementById("opExportPanel").classList.contains("show")){const t=document.elementsFromPoint(e.clientX,e.clientY).filter((e=>"TD"===e.tagName)).map((e=>e.parentElement)).find((e=>e!==De&&e.classList.contains("file-row")));t&&t!==Re&&(t.classList.add("drag-offset"),Re?.classList?.remove("drag-offset"),Re=t)}}),!1),document.body.addEventListener("drop",un,!1),window.__TAURI__&&window.__TAURI__.event.listen("tauri://drag-drop",un),document.body.addEventListener("keyup",(e=>{Ht()})),addEventListener(navigator.vendor.startsWith("Apple")?"unload":"beforeunload",(e=>{$e.length||dn(),Ae?.close()})),window.addEventListener("contextmenu",(e=>{e.shiftKey||e.preventDefault()})),document.body.addEventListener("keydown",(e=>{const t=["Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0"],n=["ArrowDown","ArrowUp","Escape","Enter","KeyD","KeyE","KeyG","KeyH","KeyI","KeyL","KeyP","KeyR","KeyS","KeyX",...t];if(document.body.classList.contains("show-help")&&(document.body.dataset.keysPressed=[e.shiftKey?"shift":"",e.ctrlKey||e.metaKey?"ctrl/cmd":"",1===e.key.length?e.key:""].filter(Boolean).join(" + ")),e.shiftKey&&document.body.classList.add("shiftKey-down"),(e.ctrlKey||e.metaKey)&&document.body.classList.add("ctrlKey-down"),"Escape"===e.code)return!$e.length||e.shiftKey||Xe.shiftKey||$e.filter((e=>e.meta.playing&&e.meta.id)).forEach((e=>Bt(!1,e.meta.id))),document.querySelector("#dcDialog").open?void e.preventDefault():(e.preventDefault(),(()=>{De?.focus(),document.querySelectorAll(".pop-up").forEach((e=>e.classList.remove("show"))),document.querySelectorAll(".dialog-pop-up").forEach((e=>!!e.open&&e.close())),Bt(!1,ye.getLastItem()),en();try{De=ot(De.dataset.id),De.classList.add("selected"),De.scrollIntoViewIfNeeded(!0)}catch(e){}})());if("INPUT"!==document.activeElement.nodeName||!1!==document.activeElement.disabled){if(e.shiftKey&&("KeyK"===e.code||"Slash"===e.code)){const t=document.getElementById("keyboardShortcuts");return t.open?t.close():t.showModal(),void e.preventDefault()}if([...document.querySelectorAll(".pop-up")].some((e=>e.classList.contains("show")))||document.querySelectorAll("dialog[open]").length>0)return document.getElementById("editPanel").open&&("KeyP"===e.code?e.altKey?digichain.editor.editorPlayFile(e,!1,!0):digichain.editor.editorPlayFile(e):1!==Ie||"KeyL"!==e.code&&"KeyR"!==e.code&&"KeyS"!==e.code&&"KeyD"!==e.code?"KeyN"===e.code?digichain.editor.sliceCreate(e):"KeyU"===e.code?digichain.editor.sliceUpdate(e):"KeyX"===e.code&&digichain.editor.sliceRemove(e):digichain.editor.changeChannel(e,e.code.replace("Key",""))),void e.preventDefault();if(t.includes(e.code)){let t=+e.code.charAt(e.code.length-1);const n=$e.filter((e=>e.meta.checked));t=0===t?9:t-1,"Digit0"===e.code||e.metaKey&&e.altKey||e.preventDefault(),n[t]&&(e.altKey?Bt(!1,n[t].meta.id):Pt(!1,n[t].meta.id,e.shiftKey||Xe.shiftKey)),e.shiftKey&&(e.metaKey||e.ctrlKey)&&(document.body.classList.remove("shiftKey-down"),document.body.classList.remove("ctrlKey-down"))}if(!("ArrowDown"!==e.code||De&&De.isConnected))return De=document.querySelector("#fileList tr"),void e.preventDefault();if($e.length&&"KeyI"===e.code)return e.preventDefault(),void(0!==$e.length&&($e.forEach((e=>e.meta.checked=!e.meta.checked)),en()));if($e.length&&"KeyE"===e.code){const t=document.getElementById("editPanel");return(e.shiftKey||Xe.shiftKey)&&setTimeout((()=>{if(t.open){const e=document.getElementById("editFileName"),t=document.getElementById("editFilePath");e.removeAttribute("readonly"),t.removeAttribute("readonly"),e.focus()}}),100),e.preventDefault(),!!De&&dt(De.dataset.id)}if("KeyH"===e.code&&(e.shiftKey||Xe.shiftKey)&&(e.preventDefault(),st()),"KeyL"===e.code&&(e.shiftKey||Xe.shiftKey)&&(e.preventDefault(),lt()),"KeyG"===e.code&&(e.shiftKey||Xe.shiftKey)&&(e.preventDefault(),document.body.classList.contains("grid-view")?document.body.classList.remove("grid-view"):document.body.classList.add("grid-view")),n.includes(e.code)&&De&&De?.isConnected)if("ArrowDown"===e.code&&De.nextElementSibling){if(!e.shiftKey&&!Xe.shiftKey)return e.preventDefault(),Wt(0,De.nextElementSibling.dataset.id);e.preventDefault();let t=at(De.dataset.id),n=$e.splice(t,1)[0];$e.splice(t+1,0,n),De.nextElementSibling.after(De),De.scrollIntoViewIfNeeded(!0),Jt()}else if("ArrowUp"===e.code&&De.previousElementSibling){if(!e.shiftKey&&!Xe.shiftKey)return Wt(0,De.previousElementSibling.dataset.id);e.preventDefault();let t=at(De.dataset.id),n=$e.splice(t,1)[0];$e.splice(t-1,0,n),De.previousElementSibling.before(De),De.scrollIntoViewIfNeeded(!0),Jt()}else"Enter"===e.code?(e.preventDefault(),Lt(e,De.dataset.id)):"KeyP"===e.code?(e.preventDefault(),e.altKey?Bt(!1,De.dataset.id):Pt(e,De.dataset.id)):1!==Ie||"KeyL"!==e.code&&"KeyR"!==e.code&&"KeyS"!==e.code&&"KeyD"!==e.code||(e.preventDefault(),rt(De.dataset.id).meta.channel&&(e.preventDefault(),It(e,De.dataset.id,e.code.replace("Key",""))))}})),yt(a.pitchModifier,!0),document.querySelector(".touch-buttons").classList[a.showTouchModifierKeys?"remove":"add"]("hidden"),null===a.darkModeTheme&&(a.darkModeTheme=window.matchMedia("(prefers-color-scheme: dark)").matches),document.querySelector(".logo h3").dataset.version=document.querySelector("meta[name=version]").content,document.body.classList[a.darkModeTheme?"remove":"add"]("light"),document.body.classList[a.normalizeContrast?"add":"remove"]("normalize-contrast"),a.restoreLastUsedAudioConfig?tt(a.lastUsedAudioConfig,!0):(document.getElementById("audioConfigOptions").value=a.defaultAudioConfigText,W({audioCtx:Ae,masterSR:Pe,masterChannels:Ie,masterBitDepth:Le})),kt(),_t("updateResampleChainsToList",".toggle-top-list"),St(a.exportChainsAsPresets),setTimeout((()=>st()),250),hn(),document.getElementById("modifierKeyctrlKey").textContent=-1!==navigator.userAgent.indexOf("Mac")?"CMD":"CTRL"}catch(e){let t="An unexpected error was encountered, please refresh the page. ";navigator.brave&&(t+="If you are using Brave browser, please disable Brave Shields for digichain.brianbar.net."),f(t,3e4),console.log(e)}window.digichain={sliceOptions:()=>Je,lastSelectedFile:()=>rt(De?.dataset?.id),saveSession:gn,saveSessionUiCall:function(){const e=document.getElementById("exportSettingsPanel"),t=document.querySelector("#sessionFileName").value,n="yes"===document.querySelector("#sessionIncludeUnselected").dataset.sessionUnselected;return t?n&&0===$e.length||!n&&0===$e.filter((e=>e.meta.checked)).length?f("Session must include at least one file."):(C("Exporting Session"),gn(t,n),void(e.open&&e.close())):f("Please specify a session file name.")},changeAudioConfig:tt,removeSelected:function(){return ze.removeSelected(),$e.filter((e=>e.meta.checked)).forEach((e=>zt(e.meta.id,!0))),$e=$e.filter((e=>!e.meta.checked)),Me=Me.filter((e=>$e.find((t=>t.meta.id===e)))),Ne=Ne.filter((e=>Me.includes(e))),Jt(),0!==$e.length&&0!==Me.length||($e.forEach((e=>!!e.buffer&&delete e.buffer)),$e=[],Me=[],Ne=[]),en(),pn()},toggleSelectedActionsList:function(){const e=document.querySelector(".selected-actions-button-list");e.style.display="none"===e.style.display?"flex":"none"},trimRightSelected:function(e){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const t=$e.filter((e=>e.meta.checked));t.forEach(((n,i)=>{ye.trimRight(e,n,!1),i===t.length-1&&C("")})),en()}),250)},roughStretchSelected:function(e){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const t=$e.filter((e=>e.meta.checked));t.forEach(((n,i)=>{ye.roughStretch(e,n,!1),i===t.length-1&&C("")})),en()}),250)},truncateSelected:async function(e){let t=3;if(e.shiftKey||Xe.shiftKey){const e=await u("prompt","Please enter a custom length in seconds to truncate the selected samples to...");if(!e||isNaN(e))return;t=Math.abs(+e)||3}$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const n=$e.filter((e=>e.meta.checked));n.forEach(((i,r)=>{ye.truncate(e,i,!1,t),r===n.length-1&&C("")})),en()}),250)},normalizeSelected:function(e){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const t=$e.filter((e=>e.meta.checked));t.forEach(((n,i)=>{ye.normalize(e,n,!1),i===t.length-1&&C("")})),en()}),250)},reverseSelected:function(e){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const t=$e.filter((e=>e.meta.checked));t.forEach(((n,i)=>{ye.reverse(e,n,!1),i===t.length-1&&C("")})),en()}),250)},shiftSelected:function(e){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const t=$e.filter((e=>e.meta.checked));t.forEach(((n,i)=>{ye.shift(e,n,!1),i===t.length-1&&C("")})),en()}),250)},invertSelected:function(e){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const t=$e.filter((e=>e.meta.checked));t.forEach(((n,i)=>{ye.invert(e,n,!1),i===t.length-1&&C("")})),en()}),250)},flipChannelsSelected:function(e){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const t=$e.filter((e=>e.meta.checked));t.forEach(((n,i)=>{ye.flipChannels(e,n,!1),i===t.length-1&&C("")})),en()}),250)},pitchUpSelected:function(e){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const t=$e.filter((e=>e.meta.checked));t.forEach(((n,i)=>{ye.perSamplePitch(e,2,-12,n,!1),i===t.length-1&&C("")})),en()}),250)},doubleSelected:gt,pingPongSelected:function(e){gt(e,!0)},fuzzSelected:function(e){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const e=$e.filter((e=>e.meta.checked));e.forEach(((t,n)=>{ye.fade("fuzz",t,!1),n===e.length-1&&C("")})),en()}),250)},crushSelected:async function(e){let t=25;if(e.shiftKey||Xe.shiftKey){const e=await u("prompt","Please enter a custom crush amount (25 is the default, above 127 will sound the same)...");e&&!isNaN(e)&&(t=Math.abs(+e))}t=Math.min(Math.floor(Math.abs(t)),127),$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((async()=>{const n=$e.filter((e=>e.meta.checked));await new Promise((i=>n.forEach(((r,a)=>{ye.perSamplePitch(e,1,1,r,!1,t,8),a===n.length-1&&i(!0)})))),await new Promise((t=>setTimeout((()=>n.forEach(((i,r)=>{ye.normalize(e,i,!1),r===n.length-1&&(C(""),t(!0))}))),1e3))),en()}),250)},fadeSelected:function(e,t){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const e=$e.filter((e=>e.meta.checked));e.forEach(((n,i)=>{let r=0,a=n.buffer.length<256?n.buffer.length:256;"out"===t&&(r=n.buffer.length<256?0:n.buffer.length-256,a=n.buffer.length),ye.fade(t,n,!1,r,a,!0),i===e.length-1&&C("")})),en()}),250)},stretchSelected:async function(e,t=!1){let n=$e.filter((e=>e.meta.checked)).sort(((e,t)=>t.buffer.length-e.buffer.length));!0===t&&n.reverse();let i=n[0].buffer.length;if(e.shiftKey||Xe.shiftKey){const t=e.ctrlKey||e.metaKey||Xe.ctrlKey?"samples":"seconds",n=await u("prompt",`Please enter a custom length in ${t} to stretch the selected samples to...`);n&&(["x","*"].includes(n[0])?i=e=>Math.floor(e*+n.replace(/[^0-9.]/g,"")):["/","%",""].includes(n[0])?i=e=>Math.floor(e/+n.replace(/[^0-9.]/g,"")):isNaN(n)||(i=Math.floor(Math.abs(+n)*("seconds"===t?Pe:1))))}$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const t=$e.filter((e=>e.meta.checked));t.forEach(((n,r)=>{"function"==typeof i?ye.stretch(e,n,!1,i(n.buffer.length)):ye.stretch(e,n,!1,i),r===t.length-1&&C("")})),en()}),250)},shortenNameSelected:function(e,t=!1){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const e=$e.filter((e=>e.meta.checked));let n={},i=[];t||(n={},i=$e.map((e=>(n[e.meta.id]={path:e.file.path.split("/").map((e=>e.substring(0,12))).join("/"),name:e.file.name.substring(0,12)+(e.meta.note?`-${e.meta.note}`:"")},n[e.meta.id].joined=`${n[e.meta.id].path}${n[e.meta.id].name}`,{name:n[e.meta.id].joined,available:!0})))),e.forEach(((r,a)=>{if(r.file.origPath=r.file.origPath||r.file.path,r.file.origName=r.file.origName||r.file.name,t)r.file.path=r.file.origPath,r.file.name=r.file.origName;else{const e=n[r.meta.id],t=i.filter((t=>t.name===e.joined&&t.available));r.file.path=e.path,r.file.name=1===t.length?e.name:e.name+`-${t.length}`,t[0].available=!1}a===e.length-1&&C("")})),en()}),250)},sanitizeNameSelected:function(e,t=!1){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const n=$e.filter((e=>e.meta.checked));ye.sanitizeName(e,$e,n,t),en()}),250)},serializeSelected:function(e,t="LR"){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const n=$e.filter((e=>e.meta.checked&&2===e.buffer.numberOfChannels));n.forEach(((i,r)=>{ye.serialize(e,i,!1,t),r===n.length-1&&C("")})),en()}),250)},deserializeSelected:function(e,t="LR"){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const n=$e.filter((e=>e.meta.checked&&1===e.buffer.numberOfChannels));n.forEach(((i,r)=>{ye.deserialize(e,i,!1,t),r===n.length-1&&C("")})),en()}),250)},condenseSelected:async function(e){$e.forEach((e=>e.meta.checked?e.source?.stop():""));let t=await u("prompt","Please enter the LOWER threshold (decimal value between 0 and 1)...");if(!t||isNaN(t))return;t=Math.abs(+t);let n=await u("prompt","Please enter the UPPER threshold (decimal value between 0 and 1)...");n&&!isNaN(n)&&(n=Math.abs(+n),C("Processing"),setTimeout((()=>{const i=$e.filter((e=>e.meta.checked));i.forEach(((r,a)=>{ye.thresholdCondense(e,r,!1,+t,+n),a===i.length-1&&C("")})),en()}),250))},nudgeCrossingsSelected:function(e){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const t=$e.filter((e=>e.meta.checked));t.forEach(((n,i)=>{ye.nudgeCrossings(e,n,!1),i===t.length-1&&C("")})),en()}),250)},clearSlicesSelected:async function(e){$e.forEach((e=>e.meta.checked?e.source?.stop():"")),await u("confirm","Clear slice data for all selected samples?")&&(C("Processing"),setTimeout((()=>{$e.filter((e=>e.meta.checked)).forEach((e=>{e.meta.slices=!1,e.meta.op1Json&&(e.meta.op1Json=!1),ze.removeByName(e.file.name)})),en()}),250))},padWithZeroSelected:async function(e,t=!1){let n=0;if(e.shiftKey||Xe.shiftKey){const e=await u("prompt","Please enter a custom length in seconds to pad the selected samples to...");e&&!isNaN(e)&&(n=Math.floor(Math.abs(+e)*Pe))}$e.forEach((e=>e.meta.checked?e.source?.stop():"")),C("Processing"),setTimeout((()=>{const t=$e.filter((e=>e.meta.checked));t.forEach(((i,r)=>{ye.padWithZero(e,i,n,!1),r===t.length-1&&C("")})),en()}),250)},showMergePanel:xt,showBlendPanel:At,sort:Kt,selectedHeaderClick:e=>{if(e.ctrlKey||e.metaKey||Xe.ctrlKey){const e=$e.every((e=>e.meta.checked));$e.forEach((t=>t.meta.checked=!e)),en()}else Kt(e,"checked")},renderList:en,renderRow:Qt,joinAll:function(e,t){if(0!==$e.length&&0!==$e.filter((e=>e.meta.checked)).length){if(0!==Fe){if(0===$e.filter((e=>e.meta.duration<Fe)).length)return}C("Processing"),setTimeout((()=>Rt(e,t)),500)}},performMergeUiCall:function(){const e=document.getElementById("mergePanel");C("Processing"),0!==$e.filter((e=>e.meta.checked)).length&&(e.close(),setTimeout((()=>function(e){let t=e[0];e.forEach((e=>t=t.buffer.length>e.buffer.length?t:e));let n={file:{...t.file},buffer:Ae.createBuffer(2,t.buffer.length,Pe),meta:{...t.meta,channel:"L",isMerge:!0,editOf:"",id:crypto.randomUUID(),checked:!1},waveform:!1};for(let e=0;e<n.buffer.length;e++)n.buffer.getChannelData(0)[e]=0,n.buffer.getChannelData(1)[e]=0;e.forEach(((t,i)=>{const r="L"===t.meta.pan?0:1;let a=t.buffer.getChannelData(0);if(2===t.buffer.numberOfChannels&&(a=Et(t.buffer,t.meta?.channel)),"C"===t.meta.pan)for(let e=0;e<t.buffer.length;e++)n.buffer.getChannelData(0)[e]=(n.buffer.getChannelData(0)[e]+(a[e]||0))/2,n.buffer.getChannelData(1)[e]=(n.buffer.getChannelData(1)[e]+(a[e]||0))/2;else{const e=n.buffer.getChannelData(r);for(let i=0;i<t.buffer.length;i++)n.buffer.getChannelData(r)[i]=0===e[i]?a[i]||0:(e[i]+(a[i]||0))/2}i===e.length-1&&($e.unshift(n),Me.push(n.meta.id),C(""),en())}))}(Ke)),100))},performBlendUiCall:function(){const e=+document.getElementById("blendLength").value,t=document.getElementById("mergePanel");C("Processing"),0!==$e.filter((e=>e.meta.checked)).length&&e&&(t.close(),setTimeout((()=>function(e,t){const n=e.map(((n,i)=>Math.floor(t/e.length)+(i===e.length-1?t%e.length:0)));let i=`${se(e.at(0).file.name)}-${se(e.at(-1).file.name)}_blend`,r=Ae.createBuffer(1,e.reduce(((e,t,i)=>e+t.buffer.length*n[i]),0),Pe),a={file:{name:i,filename:`${i}.wav`,path:"",type:"audio/wav"},buffer:r,meta:{length:r.length,duration:Number(r.length/Pe).toFixed(3),startFrame:0,endFrame:r.length,isBlend:!0,editOf:"",id:crypto.randomUUID(),checked:!1},waveform:!1};for(let e=0;e<a.buffer.length;e++)a.buffer.getChannelData(0)[e]=0;let o=0;e.forEach(((t,i)=>{const r=i===e.length-1?e[0]:e[i+1];let s=2===t.buffer.numberOfChannels?Et(t.buffer,t.meta?.channel):t.buffer.getChannelData(0),l=2===r.buffer.numberOfChannels?Et(r.buffer,r.meta?.channel):r.buffer.getChannelData(0);for(let e=0;e<n[i];e++)for(let t=0;t<s.length;t++)a.buffer.getChannelData(0)[o]=(s[t]||0)+(e+1)/n[i]*((l[t]||0)-(s[t]||0)),o++;i===e.length-1&&($e.unshift(a),Me.push(a.meta.id),C(""),en())}))}(Ke,e)),100))},selectSliceAmount:Ut,toggleCheck:Lt,move:(e,t,n)=>{const i=at(t);let r,a=1===n?i+1:i-1;-1===a&&(a=$e.length-1),a>=$e.length&&(a=0),r=$e.splice(i,1)[0],e.shiftKey||Xe.shiftKey?i>a?$e.splice(0,0,r):$e.splice($e.length,0,r):$e.splice(a,0,r),en()},playFile:Pt,playSlice:Ot,sliceAction:function(e,t,n){const i=rt(t),r=e.target.closest(".line");if((e.ctrlKey||e.metaKey||Xe.ctrlKey)&&(e.shiftKey||Xe.shiftKey))return document.getElementById("splitOptions").querySelectorAll("div.line").forEach((e=>{e.classList.remove("file-loop-on"),e.classList.remove("file-loop-pp")})),document.getElementById("sliceLines"),i.meta.otLoop=parseInt(i.meta?.otLoop)<2?i.meta.otLoop+1:0,void(0===i.meta.otLoop?i.meta.otLoopStart=0:([...document.getElementById("splitOptions").querySelectorAll("div.line")].slice(+r.dataset.idx).forEach((e=>e.classList.add(1===i.meta.otLoop?"file-loop-on":"file-loop-pp"))),i.meta.otLoopStart=+n.startPoint));if((e.ctrlKey||e.metaKey||Xe.ctrlKey)&&Ot(e,t,+n.startPoint,+n.endPoint,n.loop),e.shiftKey||Xe.shiftKey){const e=i.meta.slices[+r.dataset.idx];e&&(r.classList.toggle("slice-loop"),e.l=-1===e.l?e.s:-1)}},stopPlayFile:Bt,downloadFile:mt,downloadAll:async function(e){const t=$e.filter((e=>e.meta.checked)),n=e.shiftKey||Xe.shiftKey,i=[],r=document.getElementById("getJoined"),o="a"===Te;if(0===t.length)return;if(t.length>5&&!a.zipDownloads){if(!await u("confirm",`You are about to download ${t.length} files, that will show ${t.length} pop-ups one after each other..\n\nAre you ready for that??`,{kind:"info",okLabel:"Absolutely"}))return}if(C("Processing"),a.zipDownloads&&(t.length>1||window.__TAURI__)){const e=new JSZip;for(const i of t){const t=await pt(i,r,o,!0);let a="";if(a="a"===Te?a.replace(".wav",".aif"):a,n){a=se("",i,!1,!0),a="a"===Te?a.replace(".wav",".aif"):a,e.file(a,t.blob,{binary:!0});let n=await rn(i.meta.slices??[],i,a);n&&e.file(n.name,n.blob,{binary:!0})}else{let n=se("",i,!1);n="a"===Te?n.replace(".wav",".aif"):n,e.file(i.file.path+n,t.blob,{binary:!0});let r=await rn(i.meta.slices??[],i,n);r&&e.file(i.file.path+r.name,r.blob,{binary:!0})}}const i=`digichain_${Date.now()}.zip`;return void(window.__TAURI__?e.generateAsync({type:"uint8array"}).then((async e=>{await window.__TAURI__.fs.writeFile(i,e,{baseDir:window.__TAURI__.fs.BaseDirectory.Download,create:!0}),C(""),window.__TAURI__.dialog.message(`Saved to the Downloads folder as '${i}'.`)})):e.generateAsync({type:"blob"}).then((e=>{const t=document.getElementById("getJoined");t.href=URL.createObjectURL(e),t.setAttribute("download",i),t.click(),C("")})))}for(const e of t){(await mt(e.meta.id)).forEach((e=>i.push(e)))}const s=setInterval((()=>{const e=i.shift();e?.click(),0===i.length&&e&&(clearInterval(s),C(""))}),500)},changeChannel:It,changePan:(e,t,n)=>{const i=ot(t,"#mergeList").querySelector(".pan-option-"+n);rt(t).meta.pan=n,ot(t,"#mergeList").querySelectorAll(".pan-options a").forEach((e=>e.classList.remove("selected"))),i.classList.add("selected")},duplicate:Ft,remove:zt,handleRowClick:Wt,rowDragStart:e=>{if(e.target?.classList?.contains("file-row")){const t=document.getElementById("opExportPanel");!navigator.vendor.startsWith("Apple")&&t.classList.contains("show")&&(t.style.transform="translateX(-9999px)",setTimeout((()=>t.style.transform="translateX(0)"),0)),e.target.classList.add("is-dragging"),De=e.target,async function(e,t){const n="a"===Te;let i=rt(t),r={href:"",setAttribute:function(e,t){this.fileName=t}};await pt(i,r,n,!0),e.dataTransfer.setData("DownloadURL",`audio/x-wav:${r.fileName}:${r.href}`)}(e,e.target.dataset.id)}},splitAction:qt,splitEvenly:Mt,splitFromFile:function(e){const t=document.querySelector(".slice-from-file-buttons"),n=document.querySelectorAll(".slice-from-file-buttons button");if(!e.target?.files?.length)return;const i=new FileReader;i.onload=function(e){if(!e.target.result)return;const i=JSON.parse(e.target.result);i.clips&&(Ze=i.clips.map((e=>({track:e.ch+1,startPoint:Math.round(e.start/44100*Pe),endPoint:Math.round(e.stop/44100*Pe)}))),Ze.trackSlices={},Ze.forEach((e=>Ze.trackSlices[`t${e.track}`]=(Ze.trackSlices[`t${e.track}`]??0)+1)),t.classList.remove("hidden"),n.forEach(((e,t)=>e.textContent=`${Ze.trackSlices[`t${t+1}`]}`)))},i.readAsText(e.target.files[0])},splitSizeAction:Nt,splitFromTrack:function(e,t){const n=document.querySelector("#splitOptions .slice-group"),i=rt(n.dataset.id);i.meta.customSlices={slices:Ze.filter((e=>e.track===t))},i.meta.customSlices.sliceCount=i.meta.customSlices.slices.length,jt(i.meta.customSlices.length,i,i.meta.customSlices)},convertChain:function(e,t=!1){const n=[...document.getElementById("splitOptions").querySelectorAll("div.line.fade")].map((e=>+e.dataset.idx)),i=Ft(e,De.dataset.id,!0);if(i.item.meta.slices=(i.item.meta.slices?i.item.meta.slices:ze.getByFileInDcFormat(rt(De.dataset.id))).filter(((e,t)=>!n.includes(t))),t&&0!==Ye)for(;i.item.meta.slices.length<Ye;)i.item.meta.slices.push(JSON.parse(JSON.stringify(i.item.meta.slices.at(-1))));const r=i.item.meta.slices.map((e=>e.e-e.s)),a=Math.max(...r);let o=i.item.meta.slices.map((e=>{const t=new AudioBuffer({numberOfChannels:i.item.buffer.numberOfChannels,length:e.e-e.s,sampleRate:i.item.buffer.sampleRate});for(let n=0;n<t.numberOfChannels;n++)for(let r=0;r<t.length;r++)t.getChannelData(n)[r]=i.item.buffer.getChannelData(n)[e.s+r]||0;return{buffer:t,meta:{}}}));t||o.forEach((t=>{ye.trimRight(e,t,!1)}));const s=t?o.length*a:o.reduce(((e,t)=>e+t.buffer.length),0),l=new AudioBuffer({numberOfChannels:i.item.buffer.numberOfChannels,length:s,sampleRate:i.item.buffer.sampleRate});1===l.numberOfChannels&&p(l,o,a,t),2===l.numberOfChannels&&m(l,o,a,t);let c=0;o.forEach(((e,n)=>{const r=t?a:e.buffer.length;i.item.meta.slices&&(i.item.meta.slices[n].s=c,i.item.meta.slices[n].e=c+r),c+=r})),i.item.buffer=l,i.item.meta={...i.item.meta,length:l.length,duration:Number(l.length/Pe).toFixed(3),startFrame:0,endFrame:l.length},delete i.item.meta.op1Json,i.callback(i.item,i.fileIdx),ut()},toggleModifier:e=>{"shiftKey"!==e&&"ctrlKey"!==e&&"metaKey"!==e||(Xe[e="metaKey"===e?"ctrlKey":e]=!Xe[e],document.getElementById("modifierKey"+e).classList[Xe[e]?"add":"remove"]("active"),document.body.classList[Xe[e]?"add":"remove"](e+"-mod-down"))},toggleListVisibility:lt,toggleOptionsPanel:st,showExportSettingsPanel:Ct,showEditPanel:dt,closeEditPanel:()=>{const e=document.getElementById("editPanel");if(e.open&&e.close(),$e.forEach((e=>delete e.meta.editing)),digichain.stopPlayFile(!1,digichain.editor.getLastItem()),document.querySelector("#opExportPanel.show"))return digichain.showEditPanel(event,!1,"opExport");digichain.renderList()},closeSplitOptions:ut,createOtMetaFile:async function(){const e=document.getElementById("splitOptions"),t=ot(De.dataset.id).querySelector(".meta-link-hidden"),n=rt(De.dataset.id),i=[...e.querySelectorAll("div.line.fade")].map((e=>+e.dataset.idx)),r=ze.getByFileInDcFormat(n).filter(((e,t)=>!i.includes(t)));await rn(r,n,n.file.name,t,!0)&&t.click()},pitchExports:yt,toggleSetting:vt,toggleSecondsPerFile:wt,updateSpacedChainMode:kt,updateUiButtonAction:_t,updateExportChainsAsPresets:St,changeOpParam:function(e,t,n,i){const r=ot(t),a=rt(t);if("bal"===n){e.draggable=!1,e.preventDefault(),r.querySelector(".channel-options-stereo-opf .channel-balance");let t=+e.target.value??16384;t-=t%1024,a.meta.opPan=t}return"baltoggle"===n&&(a.meta.opPanAb=!a.meta.opPanAb,r.querySelector(".channel-options-stereo-opf").classList[a.meta.opPanAb?"add":"remove"]("op-pan-ab-true")),!1},toggleHelp:function(){const e=document.querySelector(".toggle-help-panel"),t=document.body.classList.contains("show-help");if(document.body.classList[t?"remove":"add"]("show-help"),document.querySelector(".help-text").classList[t?"add":"remove"]("hidden"),e.classList[t?"add":"remove"]("fade"),e.dataset.interval&&(clearInterval(+e.dataset.interval),e.dataset.interval=null),!t){const t=setInterval((()=>{const e=document.querySelector(".help-text"),t=document.activeElement;e.textContent=t.title,e.classList[t.title?"remove":"add"]("fade")}),500);e.dataset.interval=`${t}`}},toggleChainNamePanel:function(){const e=document.getElementById("chainFileNameListPanel");e.open?e.close():e.showModal(),e.open&&ft()},changeChainName:async function(e,t,n){let i;if("remove-all"===n){return e.preventDefault(),await u("confirm","Are you sure you want to remove all the chain names below?",{kind:"warning",okLabel:"Remove All"})&&(We=[]),ft()}if(i=void 0===t?{name:"",used:!1}:We[t],t>-1&&"remove"===n){return e.preventDefault(),await u("confirm",`Are you sure you want to remove the chain name '${i.name}'?`,{kind:"warning",okLabel:"Remove"})&&We.splice(t,1),ft()}if(t>-1&&"reuse"===n)return e.preventDefault(),i.used=!1,ft();let r=await u("prompt","Please enter a name for the chain, names must be unique",{defaultValue:i.name});r&&(i.name=r,void 0===t&&-1===We.findIndex((e=>e.name.toLowerCase()===r.toLowerCase()))&&We.push(i),ft())},generateChainNames:function(){We=[...new Set($e.filter((e=>e.file.path)).map((e=>e.file.path)))].map((e=>({name:e.replace(/\W+/gi,""),used:!1}))),ft()},removeMetaFile:function(e){const t=rt(e);t&&(ze.removeByName(t.file.filename),t.meta.op1Json&&delete t.meta.op1Json)},getSlicesFromMetaFile:function(e){return ze.getByFileInDcFormat(e)},setAudioOptionsFromCommonConfig:function(e){const t=e.target.value;if("none"===t)return;const n=[48e3,"m",16,"w",...Se];let i=t?t.match(/^\d+|[ms]|\d+|[wa]/g):n;document.getElementById(`acoContainer${i[3]}`).click(),document.getElementById("settingsSampleRate").value=+i[0],document.getElementById(`acoChannel${i[1]}`).click(),document.getElementById(`acoBitDepth${i[2]}`).click(),i.slice(4).forEach(((e,t)=>t>0?document.getElementById("gridSize"+ +t).value=+e:"")),0===$e.length&&(document.getElementById("settingsWorkingSampleRate").value=+i[0])},bufferRateResampler:it,showWelcome:bt,editor:ye};
