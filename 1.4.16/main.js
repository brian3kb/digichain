"use strict";function e(e=[],t,n=!1){const a=e?.length?{attack:new Array(24).fill(0),drum_version:2,dyna_env:[0,8192,0,8192,0,0,0,0],end:new Array(24).fill(0),fx_active:!1,fx_params:[8e3,8e3,8e3,8e3,8e3,8e3,8e3,8e3],fx_type:"delay",lfo_active:!1,lfo_params:[16e3,16e3,16e3,16e3,0,0,0,0],lfo_type:"tremolo",mtime:1682173750,name:"DigiChain Kit",octave:0,original_folder:"digichain",pan:new Array(24).fill(16384),pan_ab:new Array(24).fill(!1),pitch:new Array(24).fill(0),playmode:new Array(24).fill(5119),reverse:new Array(24).fill(12e3),start:new Array(24).fill(0),stereo:2===t,type:"drum",volume:new Array(24).fill(8192)}:{adsr:[64,10746,32767,1e4,4e3,64,4e3,18021],base_freq:440,fade:0,fx_active:!1,fx_params:[8e3,8e3,8e3,8e3,8e3,8e3,8e3,8e3],fx_type:"delay",knobs:[0,0,0,8600,12e3,0,0,8192],lfo_active:!1,lfo_params:[16e3,0,0,16e3,0,0,0,0],lfo_type:"tremolo",mtime:1683144375,name:"DigiChain Sample",octave:0,original_folder:"DigiChain",stereo:2===t,synth_version:3,type:"sampler"};if(n)return a;const i=JSON.parse(JSON.stringify(a));if(!e?.length||0===e?.length)return i;const r=2===t?2434:4058,o=e.map(((e,t)=>({p:e.p,pab:e.pab,st:e.st>24576?24576:e.st<-24576?-24576:e.st,s:Math.floor(e.s*r+13*t),e:Math.floor(e.e*r+13*t)})));for(let e=0;e<24;e++){let t=o.shift();i.pan[e]=t.p,i.pan_ab[e]=t.pab,i.pitch[e]=t.st,i.start[e]=t.s,i.end[e]=t.e,o.push(t)}return i}function t(e,t,n=!1,a,i,r){let o=n?a.createBuffer(i,e.length,r):new Float32Array(e.length);if("S"===t&&e.numberOfChannels>1)for(let t=0;t<e.length;t++)(n?o.getChannelData(0):o)[t]=(e.getChannelData(0)[t]+e.getChannelData(1)[t])/2;else if("D"===t&&e.numberOfChannels>1)for(let t=0;t<e.length;t++)(n?o.getChannelData(0):o)[t]=(e.getChannelData(0)[t]-e.getChannelData(1)[t])/2;else{const a="R"===t&&e.numberOfChannels>1?1:0;for(let t=0;t<e.length;t++)(n?o.getChannelData(0):o)[t]=e.getChannelData(a)[t]}return o}function n(e,n,a,i,r){let o=0;n.forEach(((n,s)=>{const l=i?a:n.buffer.length;let c=t(n.buffer,n?.meta?.channel);if(r&&(s+1)%2==0)for(let t=0;t<l;t++)e.getChannelData(0)[o]=c[l-t]||0,o++;else for(let t=0;t<l;t++)e.getChannelData(0)[o]=c[t]||0,o++}))}function a(e,t,n,a,i){let r=0;t.forEach(((t,o)=>{const s=a?n:t.buffer.length;let l=[new Float32Array(t.buffer.length),new Float32Array(t.buffer.length)];for(let e=0;e<t.buffer.length;e++)l[0][e]=t.buffer.getChannelData(0)[e],l[1][e]=t.buffer.getChannelData(2===t.buffer.numberOfChannels?1:0)[e];if(i&&(o+1)%2==0)for(let t=0;t<s;t++)e.getChannelData(0)[r]=l[0][s-t]||0,e.getChannelData(1)[r]=l[1][s-t]||0,r++;else for(let t=0;t<s;t++)e.getChannelData(0)[r]=l[0][t]||0,e.getChannelData(1)[r]=l[1][t]||0,r++}))}function i(e,t){const n=e.length;if(!t||0===t)return e;const a=+t;for(let t=1;t<n-1;t++){const n=(e[t-1]+e[t+1])/2;Math.abs(e[t]-n)>a&&(e[t]=n)}return e}function r(t,n,a,r,o,d=!1,u=!1,h=1,f=!1,m=!0,p=!1){const g=(JSON.parse(localStorage.getItem("treatDualMonoStereoAsMono"))??!0)&&!n.editing&&!n.bypassStereoAsDualMono;let b;!n.editing&&n.renderAt&&(b=function(e,t,n){const a=e.renderAt||n,i=new AudioContext({sampleRate:a,latencyHint:"interactive"});return digichain.bufferRateResampler({file:{sampleRate:a},meta:e,buffer:t},a,i)}(n,t,a),a=b.buffer.sampleRate,n=b.meta,t=b.buffer);let y,v=t.numberOfChannels,w=n?.float32||32===r?3:1;if(a*=h,n.channel&&1===o){if(v=1,"L"===n.channel&&(y=t.getChannelData(0)),"R"===n.channel&&(y=t.getChannelData(1)),"S"===n.channel){y=new Float32Array(t.length);for(let e=0;e<t.length;e++)y[e]=(t.getChannelData(0)[e]+t.getChannelData(1)[e])/2}if("D"===n.channel){y=new Float32Array(t.length);for(let e=0;e<t.length;e++)y[e]=(t.getChannelData(0)[e]-t.getChannelData(1)[e])/2}y=i(y,d)}else 2!==v||n.dualMono&&g?(v=1,y=i(t.getChannelData(0),d)):y=l(i(t.getChannelData(0),d),i(t.getChannelData(1),d));return u?s(y,a,v,e(n?.slices,v)):function(e,t,n,a,i,r,o,s=1,l=!1,d=!0,u=!1){const h=o&&Array.isArray(o)&&0!==o.length&&(o.length>1||1===o.length&&(0!==o[0].s||o[0].e<r));let f,m=i/8,p=a*m,g=[],b=36+e.length*m,y=44+e.length*m,v=0,w=h?1===s?o:o.map((e=>({n:e.n,s:Math.round(e.s/s),e:Math.round(e.e/s),l:e.l&&-1!==e.l?Math.round(e.l/s):-1}))):[];h&&(l&&(g=`{"sr": ${n}, "dcs":`+JSON.stringify(w)+"}",g=btoa(g),g=g.padEnd(g.length+g.length%4," "),y+=g.length+12,b+=g.length+12),d&&(v=12+24*o.length,y+=v,b+=v));f=new ArrayBuffer(y);let _=new DataView(f);c(_,0,"RIFF"),_.setUint32(4,b,!0),c(_,8,"WAVE"),c(_,12,"fmt "),_.setUint32(16,16,!0),_.setUint16(20,t,!0),_.setUint16(22,a,!0),_.setUint32(24,n,!0),_.setUint32(28,n*p,!0),_.setUint16(32,p,!0),_.setUint16(34,i,!0),c(_,36,"data"),_.setUint32(40,e.length*m,!0),16===i?function(e,t,n){for(let a=0;a<n.length;a++,t+=2){const i=Math.max(-1,Math.min(1,n[a]));e.setInt16(t,i<0?32768*i:32767*i,!0)}}(_,44,e):24===i?function(e,t,n){for(let a=0;a<n.length;a++,t+=3){const i=Math.floor(8388608*n[a]+.5);e.setInt24(t,i,!0)}}(_,44,e):8===i?function(e,t,n){for(let a=0;a<n.length;a++,t++){const i=Math.floor(127*Math.max(-1,Math.min(1,n[a]))+128);e.setInt8(t,i)}}(_,44,e):function(e,t,n){for(let a=0;a<n.length;a++,t+=4)e.setFloat32(t,n[a],!0)}(_,44,e);if(h&&(l&&(c(_,_.byteLength-(g.length+12)-v,"LIST"),_.setUint32(_.byteLength-(g.length+8)-v,g.length+4,!0),c(_,_.byteLength-(g.length+4)-v,"ISBJ"),c(_,_.byteLength-g.length-v,g)),d)){c(_,_.byteLength-v,"cue "),_.setUint32(_.byteLength-v+4,v-8,!0),_.setUint32(_.byteLength-v+8,o.length,!0);for(let e=0;e<o.length;e++){const t=12+24*e;_.setUint32(_.byteLength-v+t,e,!0),_.setUint32(_.byteLength-v+t+4,0,!0),c(_,_.byteLength-v+t+8,"data"),_.setUint32(_.byteLength-v+t+12,0,!0),_.setUint32(_.byteLength-v+t+16,0,!0),_.setUint32(_.byteLength-v+t+20,w[e].s,!0)}}return{buffer:f,sampleRate:n}}(y,w,a,v,r,t.length,n?.slices,h,f,m,p)}function o(e){const t={8e3:[64,11,250,0,0,0,0,0,0,0],11025:[64,12,172,68,0,0,0,0,0,0],16e3:[64,12,250,0,0,0,0,0,0,0],22050:[64,13,172,68,0,0,0,0,0,0],32e3:[64,13,250,0,0,0,0,0,0,0],37800:[64,14,147,168,0,0,0,0,0,0],44056:[64,14,172,24,0,0,0,0,0,0],44100:[64,14,172,68,0,0,0,0,0,0],47250:[64,14,184,146,0,0,0,0,0,0],48e3:[64,14,187,128,0,0,0,0,0,0],5e4:[64,14,195,80,0,0,0,0,0,0],50400:[64,14,196,224,0,0,0,0,0,0],88200:[64,15,172,68,0,0,0,0,0,0],96e3:[64,15,187,128,0,0,0,0,0,0],176400:[64,16,172,68,0,0,0,0,0,0],192e3:[64,16,187,128,0,0,0,0,0,0],352800:[64,17,172,68,0,0,0,0,0,0],2822400:[64,20,172,68,0,0,0,0,0,0],5644800:[64,21,172,68,0,0,0,0,0,0]};if("number"==typeof e)return t[e]??!1;if(Array.isArray(e)&&10===e.length)for(let n in t)if(t[n].every(((t,n)=>t===e[n])))return+n}function s(e,t,n,a){let i=JSON.parse(JSON.stringify(a));function r(e,t,n){let a=2*e.length,r=a+8,s=4162+a-8,l=new ArrayBuffer(4162+2*e.length),d=new DataView(l);c(d,0,"FORM"),d.setInt32(4,s),c(d,8,"AIFF"),c(d,12,"COMM"),d.setInt32(16,18),d.setInt16(20,n),d.setInt32(22,e.length/n),d.setInt16(26,16),function(e,t,n=44100){const a=o(n);for(let n=0;n<10;n++)e.setUint8(t+n,a[n])}(d,28,t),c(d,38,"APPL"),d.setInt32(42,4100),c(d,46,"op-1"),function(e,t,n){const a=JSON.stringify(t)+"\n",i=a.length%2==0?a:a+"\n";let r=4100-i.length-4;c(e,n,i),n+=i.length,r>0&&new Array(r).fill(32).forEach((t=>{e.setUint8(n,t),n++}))}(d,i,50);let u=4146;c(d,u,"SSND"),d.setInt32(u+4,r),d.setInt32(u+8,0),d.setInt32(u+12,0),u+=16;for(let t=0;t<e.length;t++){let n=Math.round(32767*e[t]);d.setInt16(u,n),u+=2}return{buffer:l,sampleRate:t}}return i.stereo=2===n,e.numberOfChannels?new DataView(function(e){const t=e.numberOfChannels,n=e.sampleRate;let a;return a=2===t?l(e.getChannelData(0),e.getChannelData(1)):e.getChannelData(0),r(a,n,t)}(e)):r(e,t,n)}function l(e,t){for(var n=e.length+t.length,a=new Float32Array(n),i=0,r=0;i<n;)a[i++]=e[r],a[i++]=t[r],r++;return a}function c(e,t,n){for(let a=0;a<n.length;a++)e.setUint8(t+a,n.charCodeAt(a))}function d(e,t,n,a){if(this.fromSampleRate=+e,this.toSampleRate=+t,this.channels=0|n,"object"!=typeof a)throw new Error("inputBuffer is not an object.");if(!(a instanceof Array||a instanceof Float32Array||a instanceof Float64Array))throw new Error("inputBuffer is not an array or a float32 or a float64 array.");this.inputBuffer=a,this.initialize()}function u(e,t=""){return new Promise(((n,a)=>{const i=new window.OfflineAudioContext(2,1323e3,44100);i.oncomplete=function(e){const t=e.renderedBuffer,a=function(e){const t=[];return e.forEach(((n,a)=>{for(let i=1;a+i<e.length&&i<10;i++){const r={tempo:2646e3/(e[a+i].position-n.position),count:1};for(;r.tempo<90;)r.tempo*=2;for(;r.tempo>180;)r.tempo/=2;r.tempo=Math.round(r.tempo),t.some((e=>e.tempo===r.tempo?e.count++:0))||t.push(r)}})),t}(function(e){let t=22050,n=e[0].length/t,a=[];for(let i=0;i<n;i++){let n=0;for(let a=i*t;a<(i+1)*t;a++){let t=Math.max(Math.abs(e[0][a]),Math.abs(e[1][a]));(!n||t>n.volume)&&(n={position:a,volume:t})}a.push(n)}return a.sort(((e,t)=>t.volume-e.volume)),a=a.splice(0,.5*a.length),a.sort(((e,t)=>e.position-t.position)),a}([t.getChannelData(0),t.getChannelData(1)])).sort((function(e,t){return t.count-e.count})).splice(0,5);n({match:Math.round(a[1].tempo>a[0].tempo?a[1].tempo:a[0].tempo),alternatives:a})},function(e){const a=t.match(/(?:^|[\s-_])(\d+)(?![0-9])/g);if(a&&a[0]){const e=parseInt(a[0].replace(/[^0-9]/g,""));if(e&&e>0)return void n({match:e,alternatives:[]})}const r=i.createBufferSource();r.buffer=e;const o=i.createBiquadFilter();o.type="lowpass",o.frequency.value=150,o.Q.value=1,r.connect(o);const s=i.createBiquadFilter();s.type="highpass",s.frequency.value=100,s.Q.value=1,o.connect(s),s.connect(i.destination),r.start(0),i.startRendering()}(e)}))}DataView.prototype.setInt24=function(e,t,n){this.setInt8(e,255&t,n),this.setInt16(e+1,t>>8,n)},d.prototype.initialize=function(){if(!(this.fromSampleRate>0&&this.toSampleRate>0&&this.channels>0))throw new Error("Invalid settings specified for the resampler.");this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1,this.outputBuffer=this.inputBuffer):(this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.initializeBuffers())},d.prototype.compileLinearInterpolationFunction=function(){for(var e="var outputOffset = 0;    if (bufferLength > 0) {        var buffer = this.inputBuffer;        var weight = this.lastWeight;        var firstWeight = 0;        var secondWeight = 0;        var sourceOffset = 0;        var outputOffset = 0;        var outputBuffer = this.outputBuffer;        for (; weight < 1; weight += "+this.ratioWeight+") {            secondWeight = weight % 1;            firstWeight = 1 - secondWeight;",t=0;t<this.channels;++t)e+="outputBuffer[outputOffset++] = (this.lastOutput["+t+"] * firstWeight) + (buffer["+t+"] * secondWeight);";e+="}        weight -= 1;        for (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; sourceOffset < bufferLength;) {            secondWeight = weight % 1;            firstWeight = 1 - secondWeight;";for(t=0;t<this.channels;++t)e+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(t>0?" + "+t:"")+"] * firstWeight) + (buffer[sourceOffset + "+(this.channels+t)+"] * secondWeight);";e+="weight += "+this.ratioWeight+";            sourceOffset = Math.floor(weight) * "+this.channels+";        }";for(t=0;t<this.channels;++t)e+="this.lastOutput["+t+"] = buffer[sourceOffset++];";e+="this.lastWeight = weight % 1;    }    return outputOffset;",this.resampler=Function("bufferLength",e)},d.prototype.compileMultiTapFunction=function(){for(var e="var outputOffset = 0;    if (bufferLength > 0) {        var buffer = this.inputBuffer;        var weight = 0;",t=0;t<this.channels;++t)e+="var output"+t+" = 0;";for(e+="var actualPosition = 0;        var amountToNext = 0;        var alreadyProcessedTail = !this.tailExists;        this.tailExists = false;        var outputBuffer = this.outputBuffer;        var currentPosition = 0;        do {            if (alreadyProcessedTail) {                weight = "+this.ratioWeight+";",t=0;t<this.channels;++t)e+="output"+t+" = 0;";for(e+="}            else {                weight = this.lastWeight;",t=0;t<this.channels;++t)e+="output"+t+" = this.lastOutput["+t+"];";for(e+="alreadyProcessedTail = true;            }            while (weight > 0 && actualPosition < bufferLength) {                amountToNext = 1 + actualPosition - currentPosition;                if (weight >= amountToNext) {",t=0;t<this.channels;++t)e+="output"+t+" += buffer[actualPosition++] * amountToNext;";for(e+="currentPosition = actualPosition;                    weight -= amountToNext;                }                else {",t=0;t<this.channels;++t)e+="output"+t+" += buffer[actualPosition"+(t>0?" + "+t:"")+"] * weight;";for(e+="currentPosition += weight;                    weight = 0;                    break;                }            }            if (weight <= 0) {",t=0;t<this.channels;++t)e+="outputBuffer[outputOffset++] = output"+t+" / "+this.ratioWeight+";";for(e+="}            else {                this.lastWeight = weight;",t=0;t<this.channels;++t)e+="this.lastOutput["+t+"] = output"+t+";";e+="this.tailExists = true;                break;            }        } while (actualPosition < bufferLength);    }    return outputOffset;",this.resampler=Function("bufferLength",e)},d.prototype.bypassResampler=function(e){return e},d.prototype.initializeBuffers=function(){var e=Math.ceil(this.inputBuffer.length*this.toSampleRate/this.fromSampleRate/this.channels*1.0000004768371582)*this.channels+this.channels;try{this.outputBuffer=new Float32Array(e),this.lastOutput=new Float32Array(this.channels)}catch(e){this.outputBuffer=[],this.lastOutput=[]}},CanvasRenderingContext2D.prototype.clear=CanvasRenderingContext2D.prototype.clear||function(e){e&&(this.save(),this.setTransform(1,0,0,1,0,0)),this.clearRect(0,0,this.canvas.width,this.canvas.height),this.beginPath(),e&&this.restore()},Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;const t=this.parentElement,n=window.getComputedStyle(t,null),a=parseInt(n.getPropertyValue("border-top-width")),i=parseInt(n.getPropertyValue("border-left-width")),r=this.offsetTop-t.offsetTop<t.scrollTop,o=this.offsetTop-t.offsetTop+this.clientHeight-a>t.scrollTop+t.clientHeight,s=this.offsetLeft-t.offsetLeft<t.scrollLeft,l=this.offsetLeft-t.offsetLeft+this.clientWidth-i>t.scrollLeft+t.clientWidth,c=r&&!o;(r||o)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-a+this.clientHeight/2),(s||l)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-i+this.clientWidth/2),(r||o||s||l)&&!e&&this.scrollIntoView(c)}),function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=e()}((function(){return function e(t,n,a){function i(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[o]={exports:{}};t[o][0].call(d.exports,(function(e){return i(t[o][1][e]||e)}),d,d.exports,e,t,n,a)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<a.length;o++)i(a[o]);return i}({1:[function(e,t,n){var a=e("./utils"),i=e("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t,n,i,o,s,l,c,d=[],u=0,h=e.length,f=h,m="string"!==a.getTypeOf(e);u<e.length;)f=h-u,i=m?(t=e[u++],n=u<h?e[u++]:0,u<h?e[u++]:0):(t=e.charCodeAt(u++),n=u<h?e.charCodeAt(u++):0,u<h?e.charCodeAt(u++):0),o=t>>2,s=(3&t)<<4|n>>4,l=1<f?(15&n)<<2|i>>6:64,c=2<f?63&i:64,d.push(r.charAt(o)+r.charAt(s)+r.charAt(l)+r.charAt(c));return d.join("")},n.decode=function(e){var t,n,a,o,s,l,c=0,d=0,u="data:";if(e.substr(0,5)===u)throw new Error("Invalid base64 input, it looks like a data url.");var h,f=3*(e=e.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(e.charAt(e.length-1)===r.charAt(64)&&f--,e.charAt(e.length-2)===r.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=i.uint8array?new Uint8Array(0|f):new Array(0|f);c<e.length;)t=r.indexOf(e.charAt(c++))<<2|(o=r.indexOf(e.charAt(c++)))>>4,n=(15&o)<<4|(s=r.indexOf(e.charAt(c++)))>>2,a=(3&s)<<6|(l=r.indexOf(e.charAt(c++))),h[d++]=t,64!==s&&(h[d++]=n),64!==l&&(h[d++]=a);return h}},{"./support":30,"./utils":32}],2:[function(e,t,n){var a=e("./external"),i=e("./stream/DataWorker"),r=e("./stream/Crc32Probe"),o=e("./stream/DataLengthProbe");function s(e,t,n,a,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=a,this.compressedContent=i}s.prototype={getContentWorker:function(){var e=new i(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new i(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},s.createWorkerFrom=function(e,t,n){return e.pipe(new r).pipe(new o("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new o("compressedSize")).withStreamInfo("compression",t)},t.exports=s},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,n){var a=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new a("STORE compression")},uncompressWorker:function(){return new a("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,n){var a=e("./utils"),i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==a.getTypeOf(e)?function(e,t,n,a){var r=i,o=0+n;e^=-1;for(var s=0;s<o;s++)e=e>>>8^r[255&(e^t[s])];return-1^e}(0|t,e,e.length):function(e,t,n,a){var r=i,o=0+n;e^=-1;for(var s=0;s<o;s++)e=e>>>8^r[255&(e^t.charCodeAt(s))];return-1^e}(0|t,e,e.length):0}},{"./utils":32}],5:[function(e,t,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,t,n){var a;a="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:a}},{lie:37}],7:[function(e,t,n){var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako"),r=e("./utils"),o=e("./stream/GenericWorker"),s=a?"uint8array":"array";function l(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}n.magic="\b\0",r.inherits(l,o),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(r.transformTo(s,e.data),!1)},l.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},n.compressWorker=function(e){return new l("Deflate",e)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,n){function a(e,t){var n,a="";for(n=0;n<t;n++)a+=String.fromCharCode(255&e),e>>>=8;return a}function i(e,t,n,i,o,d){var u,h,f=e.file,m=e.compression,p=d!==s.utf8encode,g=r.transformTo("string",d(f.name)),b=r.transformTo("string",s.utf8encode(f.name)),y=f.comment,v=r.transformTo("string",d(y)),w=r.transformTo("string",s.utf8encode(y)),_=b.length!==f.name.length,k=w.length!==y.length,S="",C="",x="",E=f.dir,L=f.date,D={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(D.crc32=e.crc32,D.compressedSize=e.compressedSize,D.uncompressedSize=e.uncompressedSize);var I=0;t&&(I|=8),p||!_&&!k||(I|=2048);var O=0,B=0;E&&(O|=16),"UNIX"===o?(B=798,O|=function(e,t){var n=e;return e||(n=t?16893:33204),(65535&n)<<16}(f.unixPermissions,E)):(B=20,O|=function(e){return 63&(e||0)}(f.dosPermissions)),u=L.getUTCHours(),u<<=6,u|=L.getUTCMinutes(),u<<=5,u|=L.getUTCSeconds()/2,h=L.getUTCFullYear()-1980,h<<=4,h|=L.getUTCMonth()+1,h<<=5,h|=L.getUTCDate(),_&&(C=a(1,1)+a(l(g),4)+b,S+="up"+a(C.length,2)+C),k&&(x=a(1,1)+a(l(v),4)+w,S+="uc"+a(x.length,2)+x);var A="";return A+="\n\0",A+=a(I,2),A+=m.magic,A+=a(u,2),A+=a(h,2),A+=a(D.crc32,4),A+=a(D.compressedSize,4),A+=a(D.uncompressedSize,4),A+=a(g.length,2),A+=a(S.length,2),{fileRecord:c.LOCAL_FILE_HEADER+A+g+S,dirRecord:c.CENTRAL_FILE_HEADER+a(B,2)+A+a(v.length,2)+"\0\0\0\0"+a(O,4)+a(i,4)+g+S+v}}var r=e("../utils"),o=e("../stream/GenericWorker"),s=e("../utf8"),l=e("../crc32"),c=e("../signature");function d(e,t,n,a){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=a,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(d,o),d.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,a=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,o.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-a-1))/n:100}}))},d.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=i(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=i(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:function(e){return c.DATA_DESCRIPTOR+a(e.crc32,4)+a(e.compressedSize,4)+a(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e,i=function(e,t,n,i,o){var s=r.transformTo("string",o(i));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+a(e,2)+a(e,2)+a(t,4)+a(n,4)+a(s.length,2)+s}(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},d.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(e){var t=this._sources;if(!o.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},d.prototype.lock=function(){o.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,n){var a=e("../compressions"),i=e("./ZipFileWorker");n.generateWorker=function(e,t,n){var r=new i(t.streamFiles,n,t.platform,t.encodeFileName),o=0;try{e.forEach((function(e,n){o++;var i=function(e,t){var n=e||t,i=a[n];if(!i)throw new Error(n+" is not a valid compression method !");return i}(n.options.compression,t.compression),s=n.options.compressionOptions||t.compressionOptions||{},l=n.dir,c=n.date;n._compressWorker(i,s).withStreamInfo("file",{name:e,dir:l,date:c,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(r)})),r.entriesCount=o}catch(e){r.error(e)}return r}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,n){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new a;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(a.prototype=e("./object")).loadAsync=e("./load"),a.support=e("./support"),a.defaults=e("./defaults"),a.version="3.10.1",a.loadAsync=function(e,t){return(new a).loadAsync(e,t)},a.external=e("./external"),t.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,n){var a=e("./utils"),i=e("./external"),r=e("./utf8"),o=e("./zipEntries"),s=e("./stream/Crc32Probe"),l=e("./nodejsUtils");function c(e){return new i.Promise((function(t,n){var a=e.decompressed.getContentWorker().pipe(new s);a.on("error",(function(e){n(e)})).on("end",(function(){a.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var n=this;return t=a.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),l.isNode&&l.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var n=new o(t);return n.load(e),n})).then((function(e){var n=[i.Promise.resolve(e)],a=e.files;if(t.checkCRC32)for(var r=0;r<a.length;r++)n.push(c(a[r]));return i.Promise.all(n)})).then((function(e){for(var i=e.shift(),r=i.files,o=0;o<r.length;o++){var s=r[o],l=s.fileNameStr,c=a.resolve(s.fileNameStr);n.file(c,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:t.createFolders}),s.dir||(n.file(c).unsafeOriginalName=l)}return i.zipComment.length&&(n.comment=i.zipComment),n}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,n){var a=e("../utils"),i=e("../stream/GenericWorker");function r(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}a.inherits(r,i),r.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},r.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,n){var a=e("readable-stream").Readable;function i(e,t,n){a.call(this,t),this._helper=e;var i=this;e.on("data",(function(e,t){i.push(e)||i._helper.pause(),n&&n(t)})).on("error",(function(e){i.emit("error",e)})).on("end",(function(){i.push(null)}))}e("../utils").inherits(i,a),i.prototype._read=function(){this._helper.resume()},t.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,t,n){t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,n){function a(e,t,n){var a,i=r.getTypeOf(t),s=r.extend(n||{},l);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),"string"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(e=p(e)),s.createFolders&&(a=m(e))&&g.call(this,a,!0);var u="string"===i&&!1===s.binary&&!1===s.base64;n&&void 0!==n.binary||(s.binary=!u),(t instanceof c&&0===t.uncompressedSize||s.dir||!t||0===t.length)&&(s.base64=!1,s.binary=!0,t="",s.compression="STORE",i="string");var b;b=t instanceof c||t instanceof o?t:h.isNode&&h.isStream(t)?new f(e,t):r.prepareContent(e,t,s.binary,s.optimizedBinaryString,s.base64);var y=new d(e,b,s);this.files[e]=y}var i=e("./utf8"),r=e("./utils"),o=e("./stream/GenericWorker"),s=e("./stream/StreamHelper"),l=e("./defaults"),c=e("./compressedObject"),d=e("./zipObject"),u=e("./generate"),h=e("./nodejsUtils"),f=e("./nodejs/NodejsStreamInputAdapter"),m=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},p=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},g=function(e,t){return t=void 0!==t?t:l.createFolders,e=p(e),this.files[e]||a.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function b(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,a;for(t in this.files)a=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,a)},filter:function(e){var t=[];return this.forEach((function(n,a){e(n,a)&&t.push(a)})),t},file:function(e,t,n){if(1!==arguments.length)return e=this.root+e,a.call(this,e,t,n),this;if(b(e)){var i=e;return this.filter((function(e,t){return!t.dir&&i.test(e)}))}var r=this.files[this.root+e];return r&&!r.dir?r:null},folder:function(e){if(!e)return this;if(b(e))return this.filter((function(t,n){return n.dir&&e.test(t)}));var t=this.root+e,n=g.call(this,t),a=this.clone();return a.root=n.name,a},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter((function(t,n){return n.name.slice(0,e.length)===e})),a=0;a<n.length;a++)delete this.files[n[a].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if((n=r.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");r.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var a=n.comment||this.comment||"";t=u.generateWorker(this,n,a)}catch(e){(t=new o("error")).error(e)}return new s(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=y},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,n){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,n){var a=e("./DataReader");function i(e){a.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(i,a),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),a=e.charCodeAt(2),i=e.charCodeAt(3),r=this.length-4;0<=r;--r)if(this.data[r]===t&&this.data[r+1]===n&&this.data[r+2]===a&&this.data[r+3]===i)return r-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),a=e.charCodeAt(2),i=e.charCodeAt(3),r=this.readData(4);return t===r[0]&&n===r[1]&&a===r[2]&&i===r[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,t,n){var a=e("../utils");function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return a.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=i},{"../utils":32}],19:[function(e,t,n){var a=e("./Uint8ArrayReader");function i(e){a.call(this,e)}e("../utils").inherits(i,a),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,n){var a=e("./DataReader");function i(e){a.call(this,e)}e("../utils").inherits(i,a),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,t,n){var a=e("./ArrayReader");function i(e){a.call(this,e)}e("../utils").inherits(i,a),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,n){var a=e("../utils"),i=e("../support"),r=e("./ArrayReader"),o=e("./StringReader"),s=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=a.getTypeOf(e);return a.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new s(e):i.uint8array?new l(a.transformTo("uint8array",e)):new r(a.transformTo("array",e)):new o(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,n){var a=e("./GenericWorker"),i=e("../utils");function r(e){a.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(r,a),r.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,n){var a=e("./GenericWorker"),i=e("../crc32");function r(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(r,a),r.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,n){var a=e("../utils"),i=e("./GenericWorker");function r(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}a.inherits(r,i),r.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},t.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,n){var a=e("../utils"),i=e("./GenericWorker");function r(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=a.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}a.inherits(r,i),r.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,n){function a(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}a.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=a},{}],29:[function(e,t,n){var a=e("../utils"),i=e("./ConvertWorker"),r=e("./GenericWorker"),o=e("../base64"),s=e("../support"),l=e("../external"),c=null;if(s.nodestream)try{c=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function d(e,t,n){var o=t;switch(t){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=t,this._mimeType=n,a.checkSupport(o),this._worker=e.pipe(new i(o)),e.lock()}catch(e){this._worker=new r("error"),this._worker.error(e)}}d.prototype={accumulate:function(e){return function(e,t){return new l.Promise((function(n,i){var r=[],s=e._internalType,l=e._outputType,c=e._mimeType;e.on("data",(function(e,n){r.push(e),t&&t(n)})).on("error",(function(e){r=[],i(e)})).on("end",(function(){try{var e=function(e,t,n){switch(e){case"blob":return a.newBlob(a.transformTo("arraybuffer",t),n);case"base64":return o.encode(t);default:return a.transformTo(e,t)}}(l,function(e,t){var n,a=0,i=null,r=0;for(n=0;n<t.length;n++)r+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(i=new Uint8Array(r),n=0;n<t.length;n++)i.set(t[n],a),a+=t[n].length;return i;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(s,r),c);n(e)}catch(e){i(e)}r=[]})).resume()}))}(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,(function(e){t.call(n,e.data,e.meta)})):this._worker.on(e,(function(){a.delay(t,arguments,n)})),this},resume:function(){return a.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(a.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var a=new ArrayBuffer(0);try{n.blob=0===new Blob([a],{type:"application/zip"}).size}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(a),n.blob=0===i.getBlob("application/zip").size}catch(e){n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch(e){n.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,n){for(var a=e("./utils"),i=e("./support"),r=e("./nodejsUtils"),o=e("./stream/GenericWorker"),s=new Array(256),l=0;l<256;l++)s[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(){o.call(this,"utf-8 decode"),this.leftOver=null}function d(){o.call(this,"utf-8 encode")}s[254]=s[254]=1,n.utf8encode=function(e){return i.nodebuffer?r.newBufferFrom(e,"utf-8"):function(e){var t,n,a,r,o,s=e.length,l=0;for(r=0;r<s;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<s&&56320==(64512&(a=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(a-56320),r++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=i.uint8array?new Uint8Array(l):new Array(l),r=o=0;o<l;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<s&&56320==(64512&(a=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(a-56320),r++),n<128?t[o++]=n:(n<2048?t[o++]=192|n>>>6:(n<65536?t[o++]=224|n>>>12:(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63),t[o++]=128|n>>>6&63),t[o++]=128|63&n);return t}(e)},n.utf8decode=function(e){return i.nodebuffer?a.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,n,i,r,o=e.length,l=new Array(2*o);for(t=n=0;t<o;)if((i=e[t++])<128)l[n++]=i;else if(4<(r=s[i]))l[n++]=65533,t+=r-1;else{for(i&=2===r?31:3===r?15:7;1<r&&t<o;)i=i<<6|63&e[t++],r--;1<r?l[n++]=65533:i<65536?l[n++]=i:(i-=65536,l[n++]=55296|i>>10&1023,l[n++]=56320|1023&i)}return l.length!==n&&(l.subarray?l=l.subarray(0,n):l.length=n),a.applyFromCharCode(l)}(e=a.transformTo(i.uint8array?"uint8array":"array",e))},a.inherits(c,o),c.prototype.processChunk=function(e){var t=a.transformTo(i.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var r=t;(t=new Uint8Array(r.length+this.leftOver.length)).set(this.leftOver,0),t.set(r,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var o=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;0<=n&&128==(192&e[n]);)n--;return n<0||0===n?t:n+s[e[n]]>t?n:t}(t),l=t;o!==t.length&&(i.uint8array?(l=t.subarray(0,o),this.leftOver=t.subarray(o,t.length)):(l=t.slice(0,o),this.leftOver=t.slice(o,t.length))),this.push({data:n.utf8decode(l),meta:e.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=c,a.inherits(d,o),d.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,n){var a=e("./support"),i=e("./base64"),r=e("./nodejsUtils"),o=e("./external");function s(e){return e}function l(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}e("setimmediate"),n.newBlob=function(e,t){n.checkSupport("blob");try{return new Blob([e],{type:t})}catch(n){try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return a.append(e),a.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(e,t,n){var a=[],i=0,r=e.length;if(r<=n)return String.fromCharCode.apply(null,e);for(;i<r;)"array"===t||"nodebuffer"===t?a.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+n,r)))):a.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+n,r)))),i+=n;return a.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return a.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return a.nodebuffer&&1===String.fromCharCode.apply(null,r.allocBuffer(1)).length}catch(e){return!1}}()}};function d(e){var t=65536,a=n.getTypeOf(e),i=!0;if("uint8array"===a?i=c.applyCanBeUsed.uint8array:"nodebuffer"===a&&(i=c.applyCanBeUsed.nodebuffer),i)for(;1<t;)try{return c.stringifyByChunk(e,a,t)}catch(e){t=Math.floor(t/2)}return c.stringifyByChar(e)}function u(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}n.applyFromCharCode=d;var h={};h.string={string:s,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return h.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,r.allocBuffer(e.length))}},h.array={string:d,array:s,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r.newBufferFrom(e)}},h.arraybuffer={string:function(e){return d(new Uint8Array(e))},array:function(e){return u(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:s,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r.newBufferFrom(new Uint8Array(e))}},h.uint8array={string:d,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:s,nodebuffer:function(e){return r.newBufferFrom(e)}},h.nodebuffer={string:d,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return h.nodebuffer.uint8array(e).buffer},uint8array:function(e){return u(e,new Uint8Array(e.length))},nodebuffer:s},n.transformTo=function(e,t){if(t=t||"",!e)return t;n.checkSupport(e);var a=n.getTypeOf(t);return h[a][e](t)},n.resolve=function(e){for(var t=e.split("/"),n=[],a=0;a<t.length;a++){var i=t[a];"."===i||""===i&&0!==a&&a!==t.length-1||(".."===i?n.pop():n.push(i))}return n.join("/")},n.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":a.nodebuffer&&r.isBuffer(e)?"nodebuffer":a.uint8array&&e instanceof Uint8Array?"uint8array":a.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(e){if(!a[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t,n,a="";for(n=0;n<(e||"").length;n++)a+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return a},n.delay=function(e,t,n){setImmediate((function(){e.apply(n||null,t||[])}))},n.inherits=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},n.prepareContent=function(e,t,r,s,c){return o.Promise.resolve(t).then((function(e){return a.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new o.Promise((function(t,n){var a=new FileReader;a.onload=function(e){t(e.target.result)},a.onerror=function(e){n(e.target.error)},a.readAsArrayBuffer(e)})):e})).then((function(t){var d=n.getTypeOf(t);return d?("arraybuffer"===d?t=n.transformTo("uint8array",t):"string"===d&&(c?t=i.decode(t):r&&!0!==s&&(t=function(e){return l(e,a.uint8array?new Uint8Array(e.length):new Array(e.length))}(t))),t):o.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,n){var a=e("./reader/readerFor"),i=e("./utils"),r=e("./signature"),o=e("./zipEntry"),s=e("./support");function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var a=this.reader.readString(4)===t;return this.reader.setIndex(n),a},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=s.uint8array?"uint8array":"array",n=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,a=this.zip64EndOfCentralSize-44;0<a;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var a=t-n;if(0<a)this.isSignature(t,r.CENTRAL_FILE_HEADER)||(this.reader.zero=a);else if(a<0)throw new Error("Corrupted zip: missing "+Math.abs(a)+" bytes.")},prepareReader:function(e){this.reader=a(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,t,n){var a=e("./reader/readerFor"),i=e("./utils"),r=e("./compressedObject"),o=e("./crc32"),s=e("./utf8"),l=e("./compressions"),c=e("./support");function d(e,t){this.options=e,this.loadOptions=t}d.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(Object.prototype.hasOwnProperty.call(l,t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=a(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,n,a,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<i;)t=e.readInt(2),n=e.readInt(2),a=e.readData(n),this.extraFields[t]={id:t,length:n,value:a};e.setIndex(i)},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var a=this.findExtraFieldUnicodeComment();if(null!==a)this.fileCommentStr=a;else{var r=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(r)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=a(e.value);return 1!==t.readInt(1)||o(this.fileName)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=a(e.value);return 1!==t.readInt(1)||o(this.fileComment)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null}},t.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,n){function a(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}}var i=e("./stream/StreamHelper"),r=e("./stream/DataWorker"),o=e("./utf8"),s=e("./compressedObject"),l=e("./stream/GenericWorker");a.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var a="string"===(n=e.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker();var r=!this._dataBinary;r&&!a&&(t=t.pipe(new o.Utf8EncodeWorker)),!r&&a&&(t=t.pipe(new o.Utf8DecodeWorker))}catch(e){(t=new l("error")).error(e)}return new i(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof s&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new o.Utf8EncodeWorker)),s.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof s?this._data.getContentWorker():this._data instanceof l?this._data:new r(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<c.length;u++)a.prototype[c[u]]=d;t.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,n){(function(e){var n,a,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var r=0,o=new i(d),s=e.document.createTextNode("");o.observe(s,{characterData:!0}),n=function(){s.data=r=++r%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var l=new e.MessageChannel;l.port1.onmessage=d,n=function(){l.port2.postMessage(0)}}var c=[];function d(){var e,t;a=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}a=!1}t.exports=function(e){1!==c.push(e)||a||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,n){var a=e("immediate");function i(){}var r={},o=["REJECTED"],s=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(e,t,n){a((function(){var a;try{a=t(n)}catch(a){return r.reject(e,a)}a===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,a)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function a(t){n||(n=!0,r.reject(e,t))}function i(t){n||(n=!0,r.resolve(e,t))}var o=m((function(){t(i,a)}));"error"===o.status&&a(o.value)}function m(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=c).prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){throw n}))}))},c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);return this.state!==l?u(n,this.state===s?e:t,this.outcome):this.queue.push(new d(n,e,t)),n},d.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){r.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},r.resolve=function(e,t){var n=m(h,t);if("error"===n.status)return r.reject(e,n.value);var a=n.value;if(a)f(e,a);else{e.state=s,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},r.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,a=e.queue.length;++n<a;)e.queue[n].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:r.resolve(new this(i),e)},c.reject=function(e){var t=new this(i);return r.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,a=!1;if(!n)return this.resolve([]);for(var o=new Array(n),s=0,l=-1,c=new this(i);++l<n;)d(e[l],l);return c;function d(e,i){t.resolve(e).then((function(e){o[i]=e,++s!==n||a||(a=!0,r.resolve(c,o))}),(function(e){a||(a=!0,r.reject(c,e))}))}},c.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,n=!1;if(!t)return this.resolve([]);for(var a,o=-1,s=new this(i);++o<t;)a=e[o],this.resolve(a).then((function(e){n||(n=!0,r.resolve(s,e))}),(function(e){n||(n=!0,r.reject(s,e))}));return s}},{immediate:36}],38:[function(e,t,n){var a={};(0,e("./lib/utils/common").assign)(a,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=a},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,n){var a=e("./zlib/deflate"),i=e("./utils/common"),r=e("./utils/strings"),o=e("./zlib/messages"),s=e("./zlib/zstream"),l=Object.prototype.toString,c=0,d=-1,u=0,h=8;function f(e){if(!(this instanceof f))return new f(e);this.options=i.assign({level:d,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==c)throw new Error(o[n]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){var m;if(m="string"==typeof t.dictionary?r.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=a.deflateSetDictionary(this.strm,m))!==c)throw new Error(o[n]);this._dict_set=!0}}function m(e,t){var n=new f(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}f.prototype.push=function(e,t){var n,o,s=this.strm,d=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=r.string2buf(e):"[object ArrayBuffer]"===l.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(d),s.next_out=0,s.avail_out=d),1!==(n=a.deflate(s,o))&&n!==c)return this.onEnd(n),!(this.ended=!0);0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(r.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((0<s.avail_in||0===s.avail_out)&&1!==n);return 4===o?(n=a.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c):2!==o||(this.onEnd(c),!(s.avail_out=0))},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=f,n.deflate=m,n.deflateRaw=function(e,t){return(t=t||{}).raw=!0,m(e,t)},n.gzip=function(e,t){return(t=t||{}).gzip=!0,m(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,n){var a=e("./zlib/inflate"),i=e("./utils/common"),r=e("./utils/strings"),o=e("./zlib/constants"),s=e("./zlib/messages"),l=e("./zlib/zstream"),c=e("./zlib/gzheader"),d=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=a.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(s[n]);this.header=new c,a.inflateGetHeader(this.strm,this.header)}function h(e,t){var n=new u(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}u.prototype.push=function(e,t){var n,s,l,c,u,h,f=this.strm,m=this.options.chunkSize,p=this.options.dictionary,g=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?f.input=r.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?f.input=new Uint8Array(e):f.input=e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new i.Buf8(m),f.next_out=0,f.avail_out=m),(n=a.inflate(f,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(h="string"==typeof p?r.string2buf(p):"[object ArrayBuffer]"===d.call(p)?new Uint8Array(p):p,n=a.inflateSetDictionary(this.strm,h)),n===o.Z_BUF_ERROR&&!0===g&&(n=o.Z_OK,g=!1),n!==o.Z_STREAM_END&&n!==o.Z_OK)return this.onEnd(n),!(this.ended=!0);f.next_out&&(0!==f.avail_out&&n!==o.Z_STREAM_END&&(0!==f.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=r.utf8border(f.output,f.next_out),c=f.next_out-l,u=r.buf2string(f.output,l),f.next_out=c,f.avail_out=m-c,c&&i.arraySet(f.output,f.output,l,c,0),this.onData(u)):this.onData(i.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(g=!0)}while((0<f.avail_in||0===f.avail_out)&&n!==o.Z_STREAM_END);return n===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(n=a.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(f.avail_out=0))},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=u,n.inflate=h,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},n.ungzip=h},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,n){var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var a in n)n.hasOwnProperty(a)&&(e[a]=n[a])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,a,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+a),i);else for(var r=0;r<a;r++)e[i+r]=t[n+r]},flattenChunks:function(e){var t,n,a,i,r,o;for(t=a=0,n=e.length;t<n;t++)a+=e[t].length;for(o=new Uint8Array(a),t=i=0,n=e.length;t<n;t++)r=e[t],o.set(r,i),i+=r.length;return o}},r={arraySet:function(e,t,n,a,i){for(var r=0;r<a;r++)e[i+r]=t[n+r]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,r))},n.setTyped(a)},{}],42:[function(e,t,n){var a=e("./common"),i=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){r=!1}for(var o=new a.Buf8(256),s=0;s<256;s++)o[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function l(e,t){if(t<65537&&(e.subarray&&r||!e.subarray&&i))return String.fromCharCode.apply(null,a.shrinkBuf(e,t));for(var n="",o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}o[254]=o[254]=1,n.string2buf=function(e){var t,n,i,r,o,s=e.length,l=0;for(r=0;r<s;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<s&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new a.Buf8(l),r=o=0;o<l;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<s&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?t[o++]=n:(n<2048?t[o++]=192|n>>>6:(n<65536?t[o++]=224|n>>>12:(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63),t[o++]=128|n>>>6&63),t[o++]=128|63&n);return t},n.buf2binstring=function(e){return l(e,e.length)},n.binstring2buf=function(e){for(var t=new a.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,a,i,r,s=t||e.length,c=new Array(2*s);for(n=a=0;n<s;)if((i=e[n++])<128)c[a++]=i;else if(4<(r=o[i]))c[a++]=65533,n+=r-1;else{for(i&=2===r?31:3===r?15:7;1<r&&n<s;)i=i<<6|63&e[n++],r--;1<r?c[a++]=65533:i<65536?c[a++]=i:(i-=65536,c[a++]=55296|i>>10&1023,c[a++]=56320|1023&i)}return l(c,a)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;0<=n&&128==(192&e[n]);)n--;return n<0||0===n?t:n+o[e[n]]>t?n:t}},{"./common":41}],43:[function(e,t,n){t.exports=function(e,t,n,a){for(var i=65535&e|0,r=e>>>16&65535|0,o=0;0!==n;){for(n-=o=2e3<n?2e3:n;r=r+(i=i+t[a++]|0)|0,--o;);i%=65521,r%=65521}return i|r<<16|0}},{}],44:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,n){var a=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,i){var r=a,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^r[255&(e^t[s])];return-1^e}},{}],46:[function(e,t,n){var a,i=e("../utils/common"),r=e("./trees"),o=e("./adler32"),s=e("./crc32"),l=e("./messages"),c=0,d=0,u=-2,h=2,f=8,m=286,p=30,g=19,b=2*m+1,y=15,v=3,w=258,_=w+v+1,k=42,S=113;function C(e,t){return e.msg=l[t],t}function x(e){return(e<<1)-(4<e?9:0)}function E(e){for(var t=e.length;0<=--t;)e[t]=0}function L(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function D(e,t){r._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,L(e.strm)}function I(e,t){e.pending_buf[e.pending++]=t}function O(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function B(e,t){var n,a,i=e.max_chain_length,r=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-_?e.strstart-(e.w_size-_):0,c=e.window,d=e.w_mask,u=e.prev,h=e.strstart+w,f=c[r+o-1],m=c[r+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(n=t)+o]===m&&c[n+o-1]===f&&c[n]===c[r]&&c[++n]===c[r+1]){r+=2,n++;do{}while(c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&r<h);if(a=w-(h-r),r=h-w,o<a){if(e.match_start=t,s<=(o=a))break;f=c[r+o-1],m=c[r+o]}}}while((t=u[t&d])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function A(e){var t,n,a,r,l,c,d,u,h,f,m=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=m+(m-_)){for(i.arraySet(e.window,e.window,m,m,0),e.match_start-=m,e.strstart-=m,e.block_start-=m,t=n=e.hash_size;a=e.head[--t],e.head[t]=m<=a?a-m:0,--n;);for(t=n=m;a=e.prev[--t],e.prev[t]=m<=a?a-m:0,--n;);r+=m}if(0===e.strm.avail_in)break;if(c=e.strm,d=e.window,u=e.strstart+e.lookahead,f=void 0,(h=r)<(f=c.avail_in)&&(f=h),n=0===f?0:(c.avail_in-=f,i.arraySet(d,c.input,c.next_in,f,u),1===c.state.wrap?c.adler=o(c.adler,d,f,u):2===c.state.wrap&&(c.adler=s(c.adler,d,f,u)),c.next_in+=f,c.total_in+=f,f),e.lookahead+=n,e.lookahead+e.insert>=v)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+v-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<v)););}while(e.lookahead<_&&0!==e.strm.avail_in)}function R(e,t){for(var n,a;;){if(e.lookahead<_){if(A(e),e.lookahead<_&&t===c)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=v&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+v-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-_&&(e.match_length=B(e,n)),e.match_length>=v)if(a=r._tr_tally(e,e.strstart-e.match_start,e.match_length-v),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=v){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+v-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else a=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(D(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<v-1?e.strstart:v-1,4===t?(D(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(D(e,!1),0===e.strm.avail_out)?1:2}function P(e,t){for(var n,a,i;;){if(e.lookahead<_){if(A(e),e.lookahead<_&&t===c)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=v&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+v-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=v-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-_&&(e.match_length=B(e,n),e.match_length<=5&&(1===e.strategy||e.match_length===v&&4096<e.strstart-e.match_start)&&(e.match_length=v-1)),e.prev_length>=v&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-v,a=r._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-v),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+v-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=v-1,e.strstart++,a&&(D(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((a=r._tr_tally(e,0,e.window[e.strstart-1]))&&D(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=r._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<v-1?e.strstart:v-1,4===t?(D(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(D(e,!1),0===e.strm.avail_out)?1:2}function F(e,t,n,a,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=a,this.func=i}function T(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=f,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*b),this.dyn_dtree=new i.Buf16(2*(2*p+1)),this.bl_tree=new i.Buf16(2*(2*g+1)),E(this.dyn_ltree),E(this.dyn_dtree),E(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(y+1),this.heap=new i.Buf16(2*m+1),E(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*m+1),E(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function z(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=h,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?k:S,e.adler=2===t.wrap?0:1,t.last_flush=c,r._tr_init(t),d):C(e,u)}function $(e){var t=z(e);return t===d&&function(e){e.window_size=2*e.w_size,E(e.head),e.max_lazy_match=a[e.level].max_lazy,e.good_match=a[e.level].good_length,e.nice_match=a[e.level].nice_length,e.max_chain_length=a[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=v-1,e.match_available=0,e.ins_h=0}(e.state),t}function N(e,t,n,a,r,o){if(!e)return u;var s=1;if(-1===t&&(t=6),a<0?(s=0,a=-a):15<a&&(s=2,a-=16),r<1||9<r||n!==f||a<8||15<a||t<0||9<t||o<0||4<o)return C(e,u);8===a&&(a=9);var l=new T;return(e.state=l).strm=e,l.wrap=s,l.gzhead=null,l.w_bits=a,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+v-1)/v),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=n,$(e)}a=[new F(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(A(e),0===e.lookahead&&t===c)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var a=e.block_start+n;if((0===e.strstart||e.strstart>=a)&&(e.lookahead=e.strstart-a,e.strstart=a,D(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-_&&(D(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(D(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(D(e,!1),e.strm.avail_out),1)})),new F(4,4,8,4,R),new F(4,5,16,8,R),new F(4,6,32,32,R),new F(4,4,16,16,P),new F(8,16,32,32,P),new F(8,16,128,128,P),new F(8,32,128,256,P),new F(32,128,258,1024,P),new F(32,258,258,4096,P)],n.deflateInit=function(e,t){return N(e,t,f,15,8,0)},n.deflateInit2=N,n.deflateReset=$,n.deflateResetKeep=z,n.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?u:(e.state.gzhead=t,d):u},n.deflate=function(e,t){var n,i,o,l;if(!e||!e.state||5<t||t<0)return e?C(e,u):u;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return C(e,0===e.avail_out?-5:u);if(i.strm=e,n=i.last_flush,i.last_flush=t,i.status===k)if(2===i.wrap)e.adler=0,I(i,31),I(i,139),I(i,8),i.gzhead?(I(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),I(i,255&i.gzhead.time),I(i,i.gzhead.time>>8&255),I(i,i.gzhead.time>>16&255),I(i,i.gzhead.time>>24&255),I(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),I(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(I(i,255&i.gzhead.extra.length),I(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(I(i,0),I(i,0),I(i,0),I(i,0),I(i,0),I(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),I(i,3),i.status=S);else{var h=f+(i.w_bits-8<<4)<<8;h|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(h|=32),h+=31-h%31,i.status=S,O(i,h),0!==i.strstart&&(O(i,e.adler>>>16),O(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),L(e),o=i.pending,i.pending!==i.pending_buf_size));)I(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),L(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,I(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),L(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,I(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&L(e),i.pending+2<=i.pending_buf_size&&(I(i,255&e.adler),I(i,e.adler>>8&255),e.adler=0,i.status=S)):i.status=S),0!==i.pending){if(L(e),0===e.avail_out)return i.last_flush=-1,d}else if(0===e.avail_in&&x(t)<=x(n)&&4!==t)return C(e,-5);if(666===i.status&&0!==e.avail_in)return C(e,-5);if(0!==e.avail_in||0!==i.lookahead||t!==c&&666!==i.status){var m=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(A(e),0===e.lookahead)){if(t===c)return 1;break}if(e.match_length=0,n=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(D(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(D(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(D(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,a,i,o,s=e.window;;){if(e.lookahead<=w){if(A(e),e.lookahead<=w&&t===c)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=v&&0<e.strstart&&(a=s[i=e.strstart-1])===s[++i]&&a===s[++i]&&a===s[++i]){o=e.strstart+w;do{}while(a===s[++i]&&a===s[++i]&&a===s[++i]&&a===s[++i]&&a===s[++i]&&a===s[++i]&&a===s[++i]&&a===s[++i]&&i<o);e.match_length=w-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=v?(n=r._tr_tally(e,1,e.match_length-v),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(D(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(D(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(D(e,!1),0===e.strm.avail_out)?1:2}(i,t):a[i.level].func(i,t);if(3!==m&&4!==m||(i.status=666),1===m||3===m)return 0===e.avail_out&&(i.last_flush=-1),d;if(2===m&&(1===t?r._tr_align(i):5!==t&&(r._tr_stored_block(i,0,0,!1),3===t&&(E(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),L(e),0===e.avail_out))return i.last_flush=-1,d}return 4!==t?d:i.wrap<=0?1:(2===i.wrap?(I(i,255&e.adler),I(i,e.adler>>8&255),I(i,e.adler>>16&255),I(i,e.adler>>24&255),I(i,255&e.total_in),I(i,e.total_in>>8&255),I(i,e.total_in>>16&255),I(i,e.total_in>>24&255)):(O(i,e.adler>>>16),O(i,65535&e.adler)),L(e),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?d:1)},n.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==k&&69!==t&&73!==t&&91!==t&&103!==t&&t!==S&&666!==t?C(e,u):(e.state=null,t===S?C(e,-3):d):u},n.deflateSetDictionary=function(e,t){var n,a,r,s,l,c,h,f,m=t.length;if(!e||!e.state)return u;if(2===(s=(n=e.state).wrap)||1===s&&n.status!==k||n.lookahead)return u;for(1===s&&(e.adler=o(e.adler,t,m,0)),n.wrap=0,m>=n.w_size&&(0===s&&(E(n.head),n.strstart=0,n.block_start=0,n.insert=0),f=new i.Buf8(n.w_size),i.arraySet(f,t,m-n.w_size,n.w_size,0),t=f,m=n.w_size),l=e.avail_in,c=e.next_in,h=e.input,e.avail_in=m,e.next_in=0,e.input=t,A(n);n.lookahead>=v;){for(a=n.strstart,r=n.lookahead-(v-1);n.ins_h=(n.ins_h<<n.hash_shift^n.window[a+v-1])&n.hash_mask,n.prev[a&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=a,a++,--r;);n.strstart=a,n.lookahead=v-1,A(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=v-1,n.match_available=0,e.next_in=c,e.input=h,e.avail_in=l,n.wrap=s,d},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,n){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,n){t.exports=function(e,t){var n,a,i,r,o,s,l,c,d,u,h,f,m,p,g,b,y,v,w,_,k,S,C,x,E;n=e.state,a=e.next_in,x=e.input,i=a+(e.avail_in-5),r=e.next_out,E=e.output,o=r-(t-e.avail_out),s=r+(e.avail_out-257),l=n.dmax,c=n.wsize,d=n.whave,u=n.wnext,h=n.window,f=n.hold,m=n.bits,p=n.lencode,g=n.distcode,b=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{m<15&&(f+=x[a++]<<m,m+=8,f+=x[a++]<<m,m+=8),v=p[f&b];t:for(;;){if(f>>>=w=v>>>24,m-=w,0==(w=v>>>16&255))E[r++]=65535&v;else{if(!(16&w)){if(0==(64&w)){v=p[(65535&v)+(f&(1<<w)-1)];continue t}if(32&w){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}_=65535&v,(w&=15)&&(m<w&&(f+=x[a++]<<m,m+=8),_+=f&(1<<w)-1,f>>>=w,m-=w),m<15&&(f+=x[a++]<<m,m+=8,f+=x[a++]<<m,m+=8),v=g[f&y];n:for(;;){if(f>>>=w=v>>>24,m-=w,!(16&(w=v>>>16&255))){if(0==(64&w)){v=g[(65535&v)+(f&(1<<w)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(k=65535&v,m<(w&=15)&&(f+=x[a++]<<m,(m+=8)<w&&(f+=x[a++]<<m,m+=8)),l<(k+=f&(1<<w)-1)){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=w,m-=w,(w=r-o)<k){if(d<(w=k-w)&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=h,(S=0)===u){if(S+=c-w,w<_){for(_-=w;E[r++]=h[S++],--w;);S=r-k,C=E}}else if(u<w){if(S+=c+u-w,(w-=u)<_){for(_-=w;E[r++]=h[S++],--w;);if(S=0,u<_){for(_-=w=u;E[r++]=h[S++],--w;);S=r-k,C=E}}}else if(S+=u-w,w<_){for(_-=w;E[r++]=h[S++],--w;);S=r-k,C=E}for(;2<_;)E[r++]=C[S++],E[r++]=C[S++],E[r++]=C[S++],_-=3;_&&(E[r++]=C[S++],1<_&&(E[r++]=C[S++]))}else{for(S=r-k;E[r++]=E[S++],E[r++]=E[S++],E[r++]=E[S++],2<(_-=3););_&&(E[r++]=E[S++],1<_&&(E[r++]=E[S++]))}break}}break}}while(a<i&&r<s);a-=_=m>>3,f&=(1<<(m-=_<<3))-1,e.next_in=a,e.next_out=r,e.avail_in=a<i?i-a+5:5-(a-i),e.avail_out=r<s?s-r+257:257-(r-s),n.hold=f,n.bits=m}},{}],49:[function(e,t,n){var a=e("../utils/common"),i=e("./adler32"),r=e("./crc32"),o=e("./inffast"),s=e("./inftrees"),l=0,c=-2,d=1,u=852,h=592;function f(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function p(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=d,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new a.Buf32(u),t.distcode=t.distdyn=new a.Buf32(h),t.sane=1,t.back=-1,l):c}function g(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,p(e)):c}function b(e,t){var n,a;return e&&e.state?(a=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?c:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=n,a.wbits=t,g(e))):c}function y(e,t){var n,a;return e?(a=new m,(e.state=a).window=null,(n=b(e,t))!==l&&(e.state=null),n):c}var v,w,_=!0;function k(e){if(_){var t;for(v=new a.Buf32(512),w=new a.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,v,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,w,0,e.work,{bits:5}),_=!1}e.lencode=v,e.lenbits=9,e.distcode=w,e.distbits=5}function S(e,t,n,i){var r,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new a.Buf8(o.wsize)),i>=o.wsize?(a.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(i<(r=o.wsize-o.wnext)&&(r=i),a.arraySet(o.window,t,n-i,r,o.wnext),(i-=r)?(a.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}n.inflateReset=g,n.inflateReset2=b,n.inflateResetKeep=p,n.inflateInit=function(e){return y(e,15)},n.inflateInit2=y,n.inflate=function(e,t){var n,u,h,m,p,g,b,y,v,w,_,C,x,E,L,D,I,O,B,A,R,P,F,T,z=0,$=new a.Buf8(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return c;12===(n=e.state).mode&&(n.mode=13),p=e.next_out,h=e.output,b=e.avail_out,m=e.next_in,u=e.input,g=e.avail_in,y=n.hold,v=n.bits,w=g,_=b,P=l;e:for(;;)switch(n.mode){case d:if(0===n.wrap){n.mode=13;break}for(;v<16;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}if(2&n.wrap&&35615===y){$[n.check=0]=255&y,$[1]=y>>>8&255,n.check=r(n.check,$,2,0),v=y=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&y)){e.msg="unknown compression method",n.mode=30;break}if(v-=4,R=8+(15&(y>>>=4)),0===n.wbits)n.wbits=R;else if(R>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<R,e.adler=n.check=1,n.mode=512&y?10:12,v=y=0;break;case 2:for(;v<16;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}if(n.flags=y,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=y>>8&1),512&n.flags&&($[0]=255&y,$[1]=y>>>8&255,n.check=r(n.check,$,2,0)),v=y=0,n.mode=3;case 3:for(;v<32;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}n.head&&(n.head.time=y),512&n.flags&&($[0]=255&y,$[1]=y>>>8&255,$[2]=y>>>16&255,$[3]=y>>>24&255,n.check=r(n.check,$,4,0)),v=y=0,n.mode=4;case 4:for(;v<16;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}n.head&&(n.head.xflags=255&y,n.head.os=y>>8),512&n.flags&&($[0]=255&y,$[1]=y>>>8&255,n.check=r(n.check,$,2,0)),v=y=0,n.mode=5;case 5:if(1024&n.flags){for(;v<16;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}n.length=y,n.head&&(n.head.extra_len=y),512&n.flags&&($[0]=255&y,$[1]=y>>>8&255,n.check=r(n.check,$,2,0)),v=y=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(g<(C=n.length)&&(C=g),C&&(n.head&&(R=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),a.arraySet(n.head.extra,u,m,C,R)),512&n.flags&&(n.check=r(n.check,u,C,m)),g-=C,m+=C,n.length-=C),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===g)break e;for(C=0;R=u[m+C++],n.head&&R&&n.length<65536&&(n.head.name+=String.fromCharCode(R)),R&&C<g;);if(512&n.flags&&(n.check=r(n.check,u,C,m)),g-=C,m+=C,R)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===g)break e;for(C=0;R=u[m+C++],n.head&&R&&n.length<65536&&(n.head.comment+=String.fromCharCode(R)),R&&C<g;);if(512&n.flags&&(n.check=r(n.check,u,C,m)),g-=C,m+=C,R)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;v<16;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}if(y!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}v=y=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;v<32;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}e.adler=n.check=f(y),v=y=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=p,e.avail_out=b,e.next_in=m,e.avail_in=g,n.hold=y,n.bits=v,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){y>>>=7&v,v-=7&v,n.mode=27;break}for(;v<3;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}switch(n.last=1&y,v-=1,3&(y>>>=1)){case 0:n.mode=14;break;case 1:if(k(n),n.mode=20,6!==t)break;y>>>=2,v-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}y>>>=2,v-=2;break;case 14:for(y>>>=7&v,v-=7&v;v<32;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&y,v=y=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(C=n.length){if(g<C&&(C=g),b<C&&(C=b),0===C)break e;a.arraySet(h,u,m,C,p),g-=C,m+=C,b-=C,p+=C,n.length-=C;break}n.mode=12;break;case 17:for(;v<14;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}if(n.nlen=257+(31&y),y>>>=5,v-=5,n.ndist=1+(31&y),y>>>=5,v-=5,n.ncode=4+(15&y),y>>>=4,v-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;v<3;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}n.lens[N[n.have++]]=7&y,y>>>=3,v-=3}for(;n.have<19;)n.lens[N[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,F={bits:n.lenbits},P=s(0,n.lens,0,19,n.lencode,0,n.work,F),n.lenbits=F.bits,P){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;D=(z=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,I=65535&z,!((L=z>>>24)<=v);){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}if(I<16)y>>>=L,v-=L,n.lens[n.have++]=I;else{if(16===I){for(T=L+2;v<T;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}if(y>>>=L,v-=L,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}R=n.lens[n.have-1],C=3+(3&y),y>>>=2,v-=2}else if(17===I){for(T=L+3;v<T;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}v-=L,R=0,C=3+(7&(y>>>=L)),y>>>=3,v-=3}else{for(T=L+7;v<T;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}v-=L,R=0,C=11+(127&(y>>>=L)),y>>>=7,v-=7}if(n.have+C>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;C--;)n.lens[n.have++]=R}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,F={bits:n.lenbits},P=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,F),n.lenbits=F.bits,P){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,F={bits:n.distbits},P=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,F),n.distbits=F.bits,P){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(6<=g&&258<=b){e.next_out=p,e.avail_out=b,e.next_in=m,e.avail_in=g,n.hold=y,n.bits=v,o(e,_),p=e.next_out,h=e.output,b=e.avail_out,m=e.next_in,u=e.input,g=e.avail_in,y=n.hold,v=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;D=(z=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,I=65535&z,!((L=z>>>24)<=v);){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}if(D&&0==(240&D)){for(O=L,B=D,A=I;D=(z=n.lencode[A+((y&(1<<O+B)-1)>>O)])>>>16&255,I=65535&z,!(O+(L=z>>>24)<=v);){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}y>>>=O,v-=O,n.back+=O}if(y>>>=L,v-=L,n.back+=L,n.length=I,0===D){n.mode=26;break}if(32&D){n.back=-1,n.mode=12;break}if(64&D){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&D,n.mode=22;case 22:if(n.extra){for(T=n.extra;v<T;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}n.length+=y&(1<<n.extra)-1,y>>>=n.extra,v-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;D=(z=n.distcode[y&(1<<n.distbits)-1])>>>16&255,I=65535&z,!((L=z>>>24)<=v);){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}if(0==(240&D)){for(O=L,B=D,A=I;D=(z=n.distcode[A+((y&(1<<O+B)-1)>>O)])>>>16&255,I=65535&z,!(O+(L=z>>>24)<=v);){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}y>>>=O,v-=O,n.back+=O}if(y>>>=L,v-=L,n.back+=L,64&D){e.msg="invalid distance code",n.mode=30;break}n.offset=I,n.extra=15&D,n.mode=24;case 24:if(n.extra){for(T=n.extra;v<T;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}n.offset+=y&(1<<n.extra)-1,y>>>=n.extra,v-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===b)break e;if(C=_-b,n.offset>C){if((C=n.offset-C)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}x=C>n.wnext?(C-=n.wnext,n.wsize-C):n.wnext-C,C>n.length&&(C=n.length),E=n.window}else E=h,x=p-n.offset,C=n.length;for(b<C&&(C=b),b-=C,n.length-=C;h[p++]=E[x++],--C;);0===n.length&&(n.mode=21);break;case 26:if(0===b)break e;h[p++]=n.length,b--,n.mode=21;break;case 27:if(n.wrap){for(;v<32;){if(0===g)break e;g--,y|=u[m++]<<v,v+=8}if(_-=b,e.total_out+=_,n.total+=_,_&&(e.adler=n.check=n.flags?r(n.check,h,_,p-_):i(n.check,h,_,p-_)),_=b,(n.flags?y:f(y))!==n.check){e.msg="incorrect data check",n.mode=30;break}v=y=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;v<32;){if(0===g)break e;g--,y+=u[m++]<<v,v+=8}if(y!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}v=y=0}n.mode=29;case 29:P=1;break e;case 30:P=-3;break e;case 31:return-4;default:return c}return e.next_out=p,e.avail_out=b,e.next_in=m,e.avail_in=g,n.hold=y,n.bits=v,(n.wsize||_!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&S(e,e.output,e.next_out,_-e.avail_out)?(n.mode=31,-4):(w-=e.avail_in,_-=e.avail_out,e.total_in+=w,e.total_out+=_,n.total+=_,n.wrap&&_&&(e.adler=n.check=n.flags?r(n.check,h,_,e.next_out-_):i(n.check,h,_,e.next_out-_)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==w&&0===_||4===t)&&P===l&&(P=-5),P)},n.inflateEnd=function(e){if(!e||!e.state)return c;var t=e.state;return t.window&&(t.window=null),e.state=null,l},n.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?c:((n.head=t).done=!1,l):c},n.inflateSetDictionary=function(e,t){var n,a=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?c:11===n.mode&&i(1,t,a,0)!==n.check?-3:S(e,t,a,a)?(n.mode=31,-4):(n.havedict=1,l):c},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,n){var a=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,l,c,d,u,h){var f,m,p,g,b,y,v,w,_,k=h.bits,S=0,C=0,x=0,E=0,L=0,D=0,I=0,O=0,B=0,A=0,R=null,P=0,F=new a.Buf16(16),T=new a.Buf16(16),z=null,$=0;for(S=0;S<=15;S++)F[S]=0;for(C=0;C<l;C++)F[t[n+C]]++;for(L=k,E=15;1<=E&&0===F[E];E--);if(E<L&&(L=E),0===E)return c[d++]=20971520,c[d++]=20971520,h.bits=1,0;for(x=1;x<E&&0===F[x];x++);for(L<x&&(L=x),S=O=1;S<=15;S++)if(O<<=1,(O-=F[S])<0)return-1;if(0<O&&(0===e||1!==E))return-1;for(T[1]=0,S=1;S<15;S++)T[S+1]=T[S]+F[S];for(C=0;C<l;C++)0!==t[n+C]&&(u[T[t[n+C]]++]=C);if(y=0===e?(R=z=u,19):1===e?(R=i,P-=257,z=r,$-=257,256):(R=o,z=s,-1),S=x,b=d,I=C=A=0,p=-1,g=(B=1<<(D=L))-1,1===e&&852<B||2===e&&592<B)return 1;for(;;){for(v=S-I,_=u[C]<y?(w=0,u[C]):u[C]>y?(w=z[$+u[C]],R[P+u[C]]):(w=96,0),f=1<<S-I,x=m=1<<D;c[b+(A>>I)+(m-=f)]=v<<24|w<<16|_|0,0!==m;);for(f=1<<S-1;A&f;)f>>=1;if(0!==f?(A&=f-1,A+=f):A=0,C++,0==--F[S]){if(S===E)break;S=t[n+u[C]]}if(L<S&&(A&g)!==p){for(0===I&&(I=L),b+=x,O=1<<(D=S-I);D+I<E&&!((O-=F[D+I])<=0);)D++,O<<=1;if(B+=1<<D,1===e&&852<B||2===e&&592<B)return 1;c[p=A&g]=L<<24|D<<16|b-d|0}}return 0!==A&&(c[b+A]=S-I<<24|64<<16|0),h.bits=L,0}},{"../utils/common":41}],51:[function(e,t,n){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,n){var a=e("../utils/common");function i(e){for(var t=e.length;0<=--t;)e[t]=0}var r=256,o=286,s=30,l=15,c=16,d=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],u=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],m=new Array(576);i(m);var p=new Array(60);i(p);var g=new Array(512);i(g);var b=new Array(256);i(b);var y=new Array(29);i(y);var v,w,_,k=new Array(s);function S(e,t,n,a,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=a,this.max_length=i,this.has_stree=e&&e.length}function C(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function x(e){return e<256?g[e]:g[256+(e>>>7)]}function E(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function L(e,t,n){e.bi_valid>c-n?(e.bi_buf|=t<<e.bi_valid&65535,E(e,e.bi_buf),e.bi_buf=t>>c-e.bi_valid,e.bi_valid+=n-c):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function D(e,t,n){L(e,n[2*t],n[2*t+1])}function I(e,t){for(var n=0;n|=1&e,e>>>=1,n<<=1,0<--t;);return n>>>1}function O(e,t,n){var a,i,r=new Array(l+1),o=0;for(a=1;a<=l;a++)r[a]=o=o+n[a-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=I(r[s]++,s))}}function B(e){var t;for(t=0;t<o;t++)e.dyn_ltree[2*t]=0;for(t=0;t<s;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function A(e){8<e.bi_valid?E(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function R(e,t,n,a){var i=2*t,r=2*n;return e[i]<e[r]||e[i]===e[r]&&a[t]<=a[n]}function P(e,t,n){for(var a=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&R(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!R(t,a,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=a}function F(e,t,n){var a,i,o,s,l=0;if(0!==e.last_lit)for(;a=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],i=e.pending_buf[e.l_buf+l],l++,0===a?D(e,i,t):(D(e,(o=b[i])+r+1,t),0!==(s=d[o])&&L(e,i-=y[o],s),D(e,o=x(--a),n),0!==(s=u[o])&&L(e,a-=k[o],s)),l<e.last_lit;);D(e,256,t)}function T(e,t){var n,a,i,r=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==r[2*n]?(e.heap[++e.heap_len]=d=n,e.depth[n]=0):r[2*n+1]=0;for(;e.heap_len<2;)r[2*(i=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=d,n=e.heap_len>>1;1<=n;n--)P(e,r,n);for(i=c;n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],P(e,r,1),a=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=a,r[2*i]=r[2*n]+r[2*a],e.depth[i]=(e.depth[n]>=e.depth[a]?e.depth[n]:e.depth[a])+1,r[2*n+1]=r[2*a+1]=i,e.heap[1]=i++,P(e,r,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,a,i,r,o,s,c=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,m=t.stat_desc.extra_base,p=t.stat_desc.max_length,g=0;for(r=0;r<=l;r++)e.bl_count[r]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)p<(r=c[2*c[2*(a=e.heap[n])+1]+1]+1)&&(r=p,g++),c[2*a+1]=r,d<a||(e.bl_count[r]++,o=0,m<=a&&(o=f[a-m]),s=c[2*a],e.opt_len+=s*(r+o),h&&(e.static_len+=s*(u[2*a+1]+o)));if(0!==g){do{for(r=p-1;0===e.bl_count[r];)r--;e.bl_count[r]--,e.bl_count[r+1]+=2,e.bl_count[p]--,g-=2}while(0<g);for(r=p;0!==r;r--)for(a=e.bl_count[r];0!==a;)d<(i=e.heap[--n])||(c[2*i+1]!==r&&(e.opt_len+=(r-c[2*i+1])*c[2*i],c[2*i+1]=r),a--)}}(e,t),O(r,d,e.bl_count)}function z(e,t,n){var a,i,r=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(n+1)+1]=65535,a=0;a<=n;a++)i=o,o=t[2*(a+1)+1],++s<l&&i===o||(s<c?e.bl_tree[2*i]+=s:0!==i?(i!==r&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,r=i,c=(s=0)===o?(l=138,3):i===o?(l=6,3):(l=7,4))}function $(e,t,n){var a,i,r=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),a=0;a<=n;a++)if(i=o,o=t[2*(a+1)+1],!(++s<l&&i===o)){if(s<c)for(;D(e,i,e.bl_tree),0!=--s;);else 0!==i?(i!==r&&(D(e,i,e.bl_tree),s--),D(e,16,e.bl_tree),L(e,s-3,2)):s<=10?(D(e,17,e.bl_tree),L(e,s-3,3)):(D(e,18,e.bl_tree),L(e,s-11,7));r=i,c=(s=0)===o?(l=138,3):i===o?(l=6,3):(l=7,4)}}i(k);var N=!1;function M(e,t,n,i){L(e,0+(i?1:0),3),function(e,t,n,i){A(e),E(e,n),E(e,~n),a.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}n._tr_init=function(e){N||(function(){var e,t,n,a,i,r=new Array(l+1);for(a=n=0;a<28;a++)for(y[a]=n,e=0;e<1<<d[a];e++)b[n++]=a;for(b[n-1]=a,a=i=0;a<16;a++)for(k[a]=i,e=0;e<1<<u[a];e++)g[i++]=a;for(i>>=7;a<s;a++)for(k[a]=i<<7,e=0;e<1<<u[a]-7;e++)g[256+i++]=a;for(t=0;t<=l;t++)r[t]=0;for(e=0;e<=143;)m[2*e+1]=8,e++,r[8]++;for(;e<=255;)m[2*e+1]=9,e++,r[9]++;for(;e<=279;)m[2*e+1]=7,e++,r[7]++;for(;e<=287;)m[2*e+1]=8,e++,r[8]++;for(O(m,287,r),e=0;e<s;e++)p[2*e+1]=5,p[2*e]=I(e,5);v=new S(m,d,257,o,l),w=new S(p,u,0,s,l),_=new S(new Array(0),h,0,19,7)}(),N=!0),e.l_desc=new C(e.dyn_ltree,v),e.d_desc=new C(e.dyn_dtree,w),e.bl_desc=new C(e.bl_tree,_),e.bi_buf=0,e.bi_valid=0,B(e)},n._tr_stored_block=M,n._tr_flush_block=function(e,t,n,a){var i,o,s=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<r;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),T(e,e.l_desc),T(e,e.d_desc),s=function(e){var t;for(z(e,e.dyn_ltree,e.l_desc.max_code),z(e,e.dyn_dtree,e.d_desc.max_code),T(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*f[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?M(e,t,n,a):4===e.strategy||o===i?(L(e,2+(a?1:0),3),F(e,m,p)):(L(e,4+(a?1:0),3),function(e,t,n,a){var i;for(L(e,t-257,5),L(e,n-1,5),L(e,a-4,4),i=0;i<a;i++)L(e,e.bl_tree[2*f[i]+1],3);$(e,e.dyn_ltree,t-1),$(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),F(e,e.dyn_ltree,e.dyn_dtree)),B(e),a&&A(e)},n._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(b[n]+r+1)]++,e.dyn_dtree[2*x(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){L(e,2,3),D(e,256,m),function(e){16===e.bi_valid?(E(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,n){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,n){(function(e){!function(e,t){if(!e.setImmediate){var n,a,i,r,o=1,s={},l=!1,c=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,n="[object process]"==={}.toString.call(e.process)?function(e){process.nextTick((function(){h(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?(r="setImmediate$"+Math.random()+"$",e.addEventListener?e.addEventListener("message",f,!1):e.attachEvent("onmessage",f),function(t){e.postMessage(r+t,"*")}):e.MessageChannel?((i=new MessageChannel).port1.onmessage=function(e){h(e.data)},function(e){i.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(a=c.documentElement,function(e){var t=c.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,a.removeChild(t),t=null},a.appendChild(t)}):function(e){setTimeout(h,0,e)},d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),a=0;a<t.length;a++)t[a]=arguments[a+1];var i={callback:e,args:t};return s[o]=i,n(o),o++},d.clearImmediate=u}function u(e){delete s[e]}function h(e){if(l)setTimeout(h,0,e);else{var n=s[e];if(n){l=!0;try{!function(e){var n=e.callback,a=e.args;switch(a.length){case 0:n();break;case 1:n(a[0]);break;case 2:n(a[0],a[1]);break;case 3:n(a[0],a[1],a[2]);break;default:n.apply(t,a)}}(n)}finally{u(e),l=!1}}}}function f(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(r)&&h(+t.data.slice(r.length))}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)}));const h=document.getElementById("editPanel"),f=document.getElementById("editableItems"),m=document.getElementById("editorPanelContent"),p=document.getElementById("opExportPanel"),g=document.getElementById("opExportPanelContent"),b=document.querySelector(".right-buttons");let y,v,w=1,_={start:0,end:0,step:0,selStart:!0},k=!1,S=!1,C=[],x=[];function E(e){v=e}function L(t,n,a="sample",i=[]){if(v=n,x=i,"sample"===a)return y&&y.meta&&(y.meta.editing=!1),y=t,w=1,_.end=y.buffer.length,_.start=0,_.step=y.buffer.length/(1024*w),_.selStart=!0,k=v.masterChannels>1,y.meta.editing=!0,void D();"opExport"===a&&(C=t,C.json=C.json||e([],v.masterChannels,!0),function(){const e={black:[1,3,5,8,10,13,15,17,20,22],white:[0,2,4,6,7,9,11,12,14,16,18,19,21,23]};g.innerHTML=`\n    <div>\n    <div class="op-keys row">\n            <div class="white-keys float-right">${e.white.reduce(((e,t)=>e+I("white",t)),"")}</div>\n        <div class="black-keys float-right">${e.black.reduce(((e,t)=>e+I("black",t)),"")}</div>\n    </div><br>\n      <div class="op-buttons row">\n        <button class="button float-right" onclick="digichain.editor.buildOpKit()">Build Kit</button>\n      </div>\n    </div>\n  `}(),p.classList.add("show"),b.classList.add("fade"))}function D(){f.innerHTML=`\n      <div class="input-set">\n      <label for="editFileName" class="before-input">File Name</label>\n      <input type="text" onkeyup="digichain.editor.updateFile(event)" placeholder="Sample file name" id="editFileName" value="${R("",y,!0)}" readonly>\n      <button class="button-clear" onpointerdown="digichain.editor.toggleReadOnlyInput('editFileName')"><i class="gg-pen"></i></button>\n    </div><br>\n    <div class="input-set">\n    <label for="editFilePath" class="before-input">File Path</label>\n      <input type="text" onkeyup="digichain.editor.updateFile(event)" placeholder="File path of the sample (if known)" id="editFilePath" value="${y.file.path}" id="editFilePath" list="folderOptions" readonly>\n      <datalist id="folderOptions">\n        ${x.map((e=>'<option value="'+e+'">')).join("")}\n      </datalist>\n      <button class="button-clear" onpointerdown="digichain.editor.toggleReadOnlyInput('editFilePath')"><i class="gg-pen"></i></button>\n    </div>\n  `,function(e){y=e===y?y:e;const t='\n  <canvas class="edit-panel-waveform"\n        oncontextmenu="return false;"\n        onpointerdown="digichain.editor.changeSelectionPoint(event)"\n        ></canvas>\n  ';m.innerHTML=`\n<div class="slice-options input-set">\n  <label for="sliceSelection" class="before-input">Slice</label>\n  <select title="Choose a slice marker to edit." name="sliceSelection" id="sliceSelection" onchange="digichain.editor.sliceSelect(event);"></select>\n<div style="display: inline-block; margin-top: .2rem; padding-left: .5rem;">\n  <button title="Update the slice marker start/end points." onpointerdown="digichain.editor.sliceUpdate(event);" class="button-outline">Update Slice</button>\n  <button title="Remove the current slice marker." onpointerdown="digichain.editor.sliceRemove(event);" class="button-outline">Remove Slice</button>\n  <button title="Add the current range as a new slice marker." onpointerdown="digichain.editor.sliceCreate(event);" class="button-outline">New Slice</button>\n  <button title="Snap selections to zero crossings?" onpointerdown="digichain.editor.toggleSnapToZero(event);" class="button ${S?"":"button-outline"}">Snap to Zero</button>\n    <button title="Detect BPM from selection." onpointerdown="digichain.editor.detectBpm(event);" class="button button-clear"> BPM</button>\n</div>\n</div>\n<div class="above-waveform-buttons">\n  <div class="sample-selection-buttons text-align-left float-left">\n      <button title="Clicking on the waveform will set the selection start point." onpointerdown="digichain.editor.setSelStart(true);" class="button check btn-select-start">Start</button>\n    <button title="Clicking on the waveform will set the selection end point." onpointerdown="digichain.editor.setSelStart(false);" class="button-outline check btn-select-end">End</button>\n      <button title="Reset the waveform selection to the whole sample." onpointerdown="digichain.editor.resetSelectionPoints();" class="button-outline check">All</button>\n  </div>\n  <div class="channel-options editor-channel-options float-right" style="border: 0.1rem solid #d79c4e; display: ${y.buffer.numberOfChannels>1&&1===v.masterChannels?"inline-block":"none"}">\n            <a title="Left channel" onpointerdown="digichain.editor.changeChannel(event, 'L')" class="${"L"===y.meta.channel?"selected":""} channel-option-L">L</a>\n            <a title="Sum to mono" onpointerdown="digichain.editor.changeChannel(event, 'S')" class="${"S"===y.meta.channel?"selected":""} channel-option-S">S</a>\n            <a title="Right channel" onpointerdown="digichain.editor.changeChannel(event, 'R')" class="${"R"===y.meta.channel?"selected":""} channel-option-R">R</a>\n            <a title="Difference between Left and Right channels" onpointerdown="digichain.editor.changeChannel(event, 'D')" class="${"D"===y.meta.channel?"selected":""} channel-option-D">D</a>\n  </div>\n</div>\n\n  <div class="playback-controls text-align-right float-left" style="position: absolute;">\n    <button title="Play selection" onpointerdown="digichain.editor.editorPlayFile(event);" class="button-clear check"><i class="gg-play-button"></i></button>\n    <button title="Loop playback of selection" onpointerdown="digichain.editor.editorPlayFile(event, true);" class="button-clear check"><i class="gg-repeat"></i></button>\n    <button title="Stop playback" onpointerdown="digichain.editor.editorPlayFile(event, false, true);" class="button-clear check"><i class="gg-play-stop"></i></button>\n  </div>\n  <div class="zoom-level text-align-right float-right">\n    <button title="Zoom out waveform view." class="zoom-out button-outline check" style="width:2.5rem;" onpointerdown="digichain.editor.zoomLevel('editor', .5)">-</button>\n    <button title="Reset zoom level waveform view."  class="zoom-reset button-outline check" onpointerdown="digichain.editor.zoomLevel('editor', 1)">1x</button>\n    <button title="Zoom in on waveform view."  class="zoom-in button-outline check" style="width:2.5rem;" onpointerdown="digichain.editor.zoomLevel('editor', 2)">+</button>\n  </div>\n\n </div>\n  <div class="waveform-container">\n    <div>\n    ${Array.from(".".repeat(Math.floor((v.masterChannels+y.buffer.numberOfChannels)/2))).reduce(((e,n)=>e+t),"")}\n      <div id="editLines">\n        <div class="edit-line"></div>\n      </div>\n    </div>\n  </div>\n\n  <div class="sample-op-buttons">\n  <div class="edit-btn-group float-left">\n\n  <button title="Normalize the volume of the sample." class="normalize button button-outline" onclick="digichain.editor.normalize(event)">Normalize</button>\n\n  <button title="Reverses the sample playback" class="reverse button button-outline" onclick="digichain.editor.reverse(event)">Reverse</button>\n  <button title="Crop the sample to the selected area." class="trim-right button button-outline" onclick="digichain.editor.truncate(event)">Crop</button>\n  <button title="Fade in the selected audio." class="fade-in button button-outline" onclick="digichain.editor.fade('in')">Fade In</button>\n  <button title="Silence the selected audio." class="silence button button-outline" onclick="digichain.editor.fade()">Silence</button>\n  <button title="Increase the gain of the selected audio." class="louder button button-outline" onclick="digichain.editor.adjustGain(event, 1.1)">Louder</button>\n  <button title="Decrease the gain of the selected audio." class="quieter button button-outline" onclick="digichain.editor.adjustGain(event, 0.9)">Quieter</button>\n  <button title="Fade out the selected audio." class="fade-out button button-outline" onclick="digichain.editor.fade('out')">Fade Out</button>\n</div>\n<div class="edit-btn-group float-right">\n    <div class="edit-pitch-btn-group pitch-semi-tones">\n    <button title="Lower pitch by 12 semi-tones" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, .5, 12)">-12</button>\n    <button title="Lower pitch by 1 semi-tone" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2**(-1/12), 1)">-1</button>\n    &nbsp;<a href="javascript:;" onclick="digichain.editor.togglePitchSemitoneCents(event, 'cent')" title="Click to toggle between semi-tones and cents."> Pitch (semitones) </a>&nbsp;\n    <button title="Increase pitch by 1 semi-tone" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2**(1/12), -1)">+1</button>\n    <button title="Increase pitch by 12 semi-tones" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2, -12)">+12</button>\n    </div>\n    <div class="edit-pitch-btn-group pitch-cents hide">\n    <button title="Lower pitch by 10 cents" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2**(-1/120), 1)">-10</button>\n    <button title="Lower pitch by 1 cent" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2**(-1/1200), 1)">-1</button>\n    &nbsp;<a href="javascript:;" onclick="digichain.editor.togglePitchSemitoneCents(event, 'semi')" title="Click to toggle between semi-tones and cents." style="display: inline-block; width: 13rem;"> Pitch (cents) </a>&nbsp;\n    <button title="Increase pitch by 1 cent" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2**(1/1200), 1)">+1</button>\n    <button title="Increase pitch by 10 cents" class="pitch button-outline check" onclick="digichain.editor.perSamplePitch(event, 2**(1/120), 1)">+10</button>\n    </div>\n    <br>\n      <button title="Trims any zero valued audio from the end of the sample. Shift+click to trim both left and right." class="trim-right button button-outline" onclick="digichain.editor.trimRight(event)">Trim Right</button>\n      <button class="trim-right button button-outline hide ${y.buffer.numberOfChannels>1?"":"hide"}" onclick="digichain.editor.interpolate(event)">Interpolate</button>\n  </div>\n</div>\n  <span class="edit-info">\n    Normalize, Silence, Louder, Quieter, Fade In, Fade Out, Crop, and Reverse affect the selected part of the sample; Trim Right and Pitch Adjustments affect the whole sample.<br>\n    Note: sample operations are destructive, applied immediately, no undo. Pitch adjustments are done via sample-rate, cumulative changes will affect sample quality.\n  </span>\n  <div class="file-nav-buttons">\n    <button title="Edit previous file" class="prev-file button button-clear check" onpointerdown="digichain.editor.changeSelectedFile(event, -1)">Prev</button>\n    <button title="Edit next file" class="next-file button button-clear check" onpointerdown="digichain.editor.changeSelectedFile(event, 1)">Next</button>\n  </div>\n  `}(y),z(),h.open||h.showModal(),O(),B()}function I(e,t){return`\n    <div class="op-key ${e} key-${t}"\n         ondragenter="this.classList.add('drag-over')"\n         ondragleave="this.classList.remove('drag-over')"\n         ondrop="this.classList.remove('drag-over')"\n         >\n        <div class="left-a"\n           ondragenter="this.classList.add('drag-over')"\n           ondragleave="this.classList.remove('drag-over')"\n           ondrop="this.classList.remove('drag-over')"\n        >L</div>\n        <div class="right-b"\n           ondragenter="this.classList.add('drag-over')"\n           ondragleave="this.classList.remove('drag-over')"\n           ondrop="this.classList.remove('drag-over')"\n        >R</div>\n    </div>\n  `}function O(){const e=document.querySelector("#sliceSelection"),t=digichain.getSlicesFromMetaFile(y);Array.isArray(t)&&(e.innerHTML=t.reduce(((e,t,n)=>e+`\n        <option value="${n}">${n+1}</option>\n    `),'<option value="-1">None</option>'));const n=t.findIndex((e=>e.s===_.start&&e.e===_.end));-1!==n&&(e.value=n)}function B(e=1){const t=1024*e,n=document.querySelector(".edit-panel-waveform"),a=document.querySelectorAll(".edit-panel-waveform");k?a.forEach(((n,i)=>{A(y,n,i,{width:t,height:128/a.length,multiplier:e})})):A(y,n,-1,{width:t,height:128,multiplier:e})}function A(e,n,a,i){let r,o=[],s=Math.floor(e.buffer.length/32);if(s=e.buffer.length>512?(s>4096?4096:s)*(2*(i?.multiplier||0)||1):e.buffer.length,s=s>e.buffer.length?e.buffer.length:s,r=0===a||1===a?e.buffer.getChannelData(a):t(e.buffer,Number.isInteger(a)?e.meta?.channel:a),e.buffer.numberOfChannels>1){let t=[];for(let n=0;n<e.buffer.length;n+=Math.floor(e.buffer.length/s))o.push(r[n]),t.push((e.buffer.getChannelData(0)[n]-e.buffer.getChannelData(1)[n])/2);e.meta.dualMono=t.every((e=>0===e))}else for(let t=0;t<e.buffer.length;t+=Math.floor(e.buffer.length/s))o.push(r[t]);!function(e,t,n,a){const i=(e,t,n,a,i)=>{e.lineWidth=1,e.strokeStyle="#a8a8a8",e.beginPath(),n=i?n:-n,e.moveTo(t,0),e.lineTo(t,n),e.lineTo(t+a,0),e.stroke()},r=0;n.width=a?.width||150,n.height=a?.height||60;const o=n.getContext("2d");o.translate(0,n.offsetHeight/2+r);const s=n.offsetWidth/e.length;for(let t=0;t<e.length;t++){const a=s*t;let l=e[t]/2*n.offsetHeight-r;l<0?l=0:l>n.offsetHeight/2&&(l=l>n.offsetHeight/2),i(o,a,l,s,(t+1)%2)}}(o,e.meta.id,n,i)}function R(e,t,n,a){let i=t?`${t.file.name.replace(/\.[^.]*$/,"")}${t.meta?.dupeOf?"-d":""}${t.meta?.sliceNumber?"-s"+t.meta.sliceNumber:""}.wav`:e.replace(/\.syx$|\.wav$|\.aif$|\.flac$|\.webm$|\.m4a$|\.pti$/,"");return i=a&&t.file.path?`${t.file.path.replace(/\//gi,"-")}`+i:i,n?i.replace(/\.[^.]*$/,""):i}function P(e,t){const n=t.split("."),a=n.pop(),i=n.join("."),r=e.filter((e=>(e.file.name||e.file.filename).includes(i))).length;return r>0?`${i}-${r+1}.${a}`:t}function F(){return Math.round(_.start/_.step)}function T(){const e=Math.floor((_.end-_.start)/_.step),t=1024*w-F();return e>t?t:e}function z(){const e=document.querySelector("#editLines .edit-line"),t=T()>=1024*w?1024*w:T();e.style.marginLeft=`${F()}px`,e.style.width=`${t}px`,e.classList[0==+(y.buffer.getChannelData(0)[_.start]??1).toFixed(4)?"add":"remove"]("start-is-zero-crossing"),e.classList[0==+(y.buffer.getChannelData(0)[_.end]??1).toFixed(4)?"add":"remove"]("end-is-zero-crossing"),_.start&&0!==_.start||e.classList.remove("start-is-zero-crossing"),_.end&&_.end!==y.buffer.length||e.classList.remove("end-is-zero-crossing")}function $(e=!1){if(S){if(e){for(let e=_.end??y.buffer.length;y.buffer.length>e;e--)if(0==+y.buffer.getChannelData(0)[e].toFixed(4)||0===e){_.end=e;break}}else for(let e=_.start??0;e<y.buffer.length;e++)if(0==+y.buffer.getChannelData(0)[e].toFixed(4)||e===y.buffer.length){_.start=e;break}_.start=_.start<0?0:_.start,_.end=_.end>y.buffer.length?y.buffer.length:_.end}}function N(){_.start=0,_.end=y.buffer.length,_.selStart=!0,z()}function M(e,t,n=!0,a=.003,i=!1){!n&&t&&(_.start=0,_.end=t.buffer.length),t=t||y,e.shiftKey&&(i=!0);let r=[],o=[0],s=t.buffer.length;for(let e=0;e<t.buffer.numberOfChannels;e++){r.push(t.buffer.length);let n=t.buffer.getChannelData(e);for(let i=t.buffer.length;i>0;i--)if(Math.abs(n[i])>a&&void 0!==n[i]&&null!==n[i]){r[e]=i+1;break}}if(s=+Math.max(...r),i){for(let e=0;e<t.buffer.numberOfChannels;e++){let n=t.buffer.getChannelData(e);for(let t=0;t<s;t++)if(Math.abs(n[t])>a&&void 0!==n[t]&&null!==n[t]){o[e]=t+1;break}}s-=+Math.max(...o)}const l=v.audioCtx.createBuffer(t.buffer.numberOfChannels,s,v.masterSR);let c=+Math.max(...o);for(let e=0;e<t.buffer.numberOfChannels;e++)for(let n=0;n<l.length;n++)l.getChannelData(e)[n]=t.buffer.getChannelData(e)[n+c];t.buffer=l,t.meta={...t.meta,length:l.length,duration:Number(l.length/v.masterSR).toFixed(3),startFrame:0,endFrame:l.length},t.meta.slices&&t.meta.slices.length>0&&(t.meta.slices=!1),n&&L(y,v,"sample",x),t.waveform=!1}function U(e,t,n=!0,a,i=!1){!n&&t&&(_.start=0,_.end=t.buffer.length);const r=(t=t||y).buffer.length,o=a/r,s=v.audioCtx.createBuffer(t.buffer.numberOfChannels,a,v.masterSR);for(let e=0;e<t.buffer.numberOfChannels;e++)for(let n=0;n<a;n++){const a=n/o,i=Math.floor(a),l=Math.ceil(a),c=a-i;s.getChannelData(e)[n]=l>=r?t.buffer.getChannelData(e)[i]:(1-c)*t.buffer.getChannelData(e)[i]+c*t.buffer.getChannelData(e)[l]}if(i)return s;t.buffer=s,t.meta={...t.meta,length:s.length,duration:Number(s.length/v.masterSR).toFixed(3),startFrame:0,endFrame:s.length,note:!1,editing:!1,slices:!!t.meta.slices&&t.meta.slices.map((e=>({...e,n:e.n,s:Math.round(e.s*o),e:Math.round(e.e*o)})))},n&&(B(w),_.end=Math.abs(Math.round(_.end*o)),_.start=Math.abs(Math.round(_.start*o)),_.step=t.buffer.length/(1024*w),z(),t.waveform=!1)}const K={updateFile:function(e){const t=e.target;t&&("editFileName"===t.id&&(y.file.name=t.value),"editFilePath"===t.id&&(y.file.path=t.value))},changeSelectedFile:function(e,t=1){const n=document.querySelector("#fileList tr.selected")?.[1===t?"nextElementSibling":"previousElementSibling"];n&&"TR"===n.tagName&&(digichain.handleRowClick({},n.dataset.id),digichain.showEditPanel({},n.dataset.id))},toggleReadOnlyInput:function(e){const t=document.getElementById(e);t.readOnly?t.removeAttribute("readonly"):t.setAttribute("readonly",!0)},togglePitchSemitoneCents:function(e,t){const n=document.querySelector(".pitch-semi-tones"),a=document.querySelector(".pitch-cents");n.classList["cent"===t?"add":"remove"]("hide"),a.classList["semi"===t?"add":"remove"]("hide")},zoomLevel:function(e,t){if("editor"===e){const e=document.querySelector("#editLines .edit-line");1!==t&&(t*=w);const n=y.buffer.length/(1024*t);if(1024*t<1024||1024*t>32768||n<1)return alert("Unable to zoom any further");B(t),_.step=n,w=t,z(),e.scrollIntoViewIfNeeded()}},changeSelectionPoint:function(e,t=!1){e.preventDefault();const n=JSON.parse(JSON.stringify(_)),a=1024*w;if(e.shiftKey||t||!_.selStart){let t=0;e.offsetX<=a&&e.offsetX>-1?t=Math.round(e.offsetX*_.step):e.offsetX>a&&(t=y.buffer.length),_.end=t,(e.ctrlKey||e.metaKey)&&(_.start=n.end),_.start=_.start>=_.end?_.end-1:_.start,$(!0)}else{let t=0;e.offsetX<=a&&e.offsetX>-1?t=Math.round(e.offsetX*_.step):e.offsetX>a&&(t=y.buffer.length),_.start=t,(e.ctrlKey||e.metaKey)&&(_.end=n.start),_.end=_.end<=_.start?_.start+1:_.end,$()}_.end=_.end>=y.buffer.length?y.buffer.length:_.end,_.start=_.start>=_.end?_.end-1:_.start,z()},resetSelectionPoints:N,setSelStart:function(e){const t=document.querySelector(".btn-select-start"),n=document.querySelector(".btn-select-end");_.selStart=Math.abs(Math.round(e)),t.classList[e?"remove":"add"]("button-outline"),n.classList[e?"add":"remove"]("button-outline")},editorPlayFile:function e(t,n=!1,a=!1){let i=_.start/v.masterSR,r=_.end/v.masterSR-i;i=i<0?0:i,r=r>y.buffer.length?y.buffer.length:r,clearTimeout(e.nextLoop),!a&&h.open?(digichain.playFile({editor:!0},y.meta.id,!1,i,r),n&&(e.nextLoop=setTimeout((()=>e(t,n)),1e3*r))):digichain.stopPlayFile(t,y.meta.id)},adjustGain:function(e,t,n,a=!0){!a&&n&&(_.start=0,_.end=n.buffer.length),n=n||y;let i=0;for(let e=0;e<n.buffer.numberOfChannels;e++)for(let a=_.start;a<_.end;a++)n.buffer.getChannelData(e)[a]&&(n.buffer.getChannelData(e)[a]=n.buffer.getChannelData(e)[a]*t),i=Math.max(Math.abs(e[a]),i);i=i||1,n.meta.peak=i,a&&B(w),n.waveform=!1},normalize:function(e,t,n=!0,a=!1){!n&&t&&(_.start=0,_.end=t.buffer.length),t=t||y;let i=0;for(let e=0;e<t.buffer.numberOfChannels;e++){let n=t.buffer.getChannelData(e);for(let e=_.start;e<_.end;e++)i=Math.max(Math.abs(n[e]),i)}if(i=i||1,t.meta.peak=i,a)return i;for(let e=0;e<t.buffer.numberOfChannels;e++)for(let n=_.start;n<_.end;n++)t.buffer.getChannelData(e)[n]&&t.buffer.getChannelData(e)[n]/i!=0&&(t.buffer.getChannelData(e)[n]=t.buffer.getChannelData(e)[n]/i);n&&B(w),t.waveform=!1},fade:function(e,t,n=!0,a=0,i=0,r=!1){!n&&t&&(_.start=a,_.end=i>0?i:t.buffer.length),(t=t||y).buffer.numberOfChannels,t.buffer.sampleRate;const o=_.end-_.start;for(let n=0;n<t.buffer.numberOfChannels;n++){let a=t.buffer.getChannelData(n);if("out"===e){r&&(a[_.end]=0);for(let e=_.start;e<_.end;e++)a[e]=a[e]*((o-(e-_.start))/o)}else if("in"===e){r&&(a[_.start]=0);for(let e=_.end;e>_.start;e--)a[e]=a[e]/((o-(e-_.end))/o)}else if("fuzz"===e)for(let e=_.start;e<_.end;e++){const t=(o+e)/o/(a[e]+.001)*Math.random();a[e]=Math.abs(t)>1?a[e]+.001:t}else for(let e=_.end;e>_.start;e--)a[e]=0}n&&B(w),t.waveform=!1},trimRight:M,thresholdCondense:function(e,t,n=!0,a=.003,i=1){!n&&t&&(_.start=0,_.end=t.buffer.length),t=t||y;const r=v.audioCtx.createBuffer(t.buffer.numberOfChannels,t.buffer.length,v.masterSR);for(let e=0;e<t.buffer.numberOfChannels;e++){let n=t.buffer.getChannelData(e),o=_.start;for(let s=_.start;s<t.buffer.length;s++){const l=Math.abs(n[s-1>0?s-1:0]),c=Math.abs(n[s]),d=Math.abs(n[s+1<t.buffer.length?s+1:t.buffer.length]);(c>a&&c<i||0===d.toFixed(4)||0===l.toFixed(4))&&(r.getChannelData(e)[o]=c,o++)}}t.buffer=r,M(e,t,n,0,!1)},truncate:function(e,t,n=!0,a=3){const i=JSON.parse(localStorage.getItem("attemptToFindCrossingPoint"))??!1;if(!n&&t&&(_.start=0,_.end=v.masterSR*a),t=t||y,i)for(let e=_.start-Math.floor(_.start/4*3);e<_.end;e++)t.buffer.getChannelData(0)[_.end-e]!==_.start||t.buffer.numberOfChannels>1&&t.buffer.getChannelData(1)[_.end-e]!==_.start||(_.end=_.end-e);let r=_.end-_.start;if(r>t.buffer.length)return;const o=v.audioCtx.createBuffer(t.buffer.numberOfChannels,r,v.masterSR);for(let e=0;e<t.buffer.numberOfChannels;e++){let n=0;for(let a=_.start;a<_.end;a++)o.getChannelData(e)[n]=t.buffer.getChannelData(e)[a],n++}t.buffer=o,t.meta={...t.meta,length:o.length,duration:Number(o.length/v.masterSR).toFixed(3),startFrame:0,endFrame:o.length},t.meta.slices&&(t.meta.slices=!1),digichain.removeMetaFile(t.meta.id),n&&L(y,v,"sample",x),t.waveform=!1},interpolate:function(e,t,n=!0){!n&&t&&(_.start=0,_.end=t.buffer.length),t=t||y;const a=v.audioCtx.createBuffer(1,t.buffer.length,v.masterSR);for(let e=0;e<t.buffer.length;e++){const n=e+2<t.buffer.length?(t.buffer.getChannelData(e%2)[e]+t.buffer.getChannelData(e%2)[e+2])/2:t.buffer.getChannelData(e%2)[e];a.getChannelData(0)[e]=n}t.buffer=a,t.meta.channel="L",k=!1,n&&(t.meta.editing=!1,h.close(),digichain.stopPlayFile(!1,digichain.editor.getLastItem()),setTimeout((()=>digichain.showEditPanel(e,t.meta.id)),250)),t.waveform=!1},perSamplePitch:function(e,t,n,a,i=!0,o=1,s){(a||y).meta.editing=!0,e.shiftKey?U(e,a,i,(a||y).buffer.length/t):function(e,t,n,a,i=!0,o=1,s){if((a=a||y).buffer.length<1024&&t>1)return alert("Sample too small to be pitched up further.");const l=v.masterSR*t;let c;if(1!==o){c=v.audioCtx.createBuffer(a.buffer.numberOfChannels,a.buffer.length,v.masterSR);for(let e=0;e<a.buffer.numberOfChannels;e++)for(let t=0;t<a.buffer.length;t++)c.getChannelData(e)[t]=a.buffer.getChannelData(e)[t]/o}const u=r(c||a.buffer,{...a.meta,bypassStereoAsDualMono:!0},l,s||32,a.buffer.numberOfChannels,.4).buffer,h=new window.Blob([new DataView(u)],{type:"audio/wav"});(async()=>{let e=await fetch(URL.createObjectURL(h)),r=await e.arrayBuffer();await new AudioContext({sampleRate:l,latencyHint:"interactive"}).decodeAudioData(r,(e=>{let r,o,s;if(o=new d(l,v.masterSR,1,e.getChannelData(0)),o.resampler(o.inputBuffer.length),2===a.buffer.numberOfChannels&&(s=new d(l,v.masterSR,1,e.getChannelData(1)),s.resampler(s.inputBuffer.length)),r=v.audioCtx.createBuffer(a.buffer.numberOfChannels,o.outputBuffer.length,v.masterSR),2===a.buffer.numberOfChannels)for(let e=0;e<o.outputBuffer.length;e++)r.getChannelData(0)[e]=o.outputBuffer[e],r.getChannelData(1)[e]=s.outputBuffer[e];else for(let e=0;e<o.outputBuffer.length;e++)r.getChannelData(0)[e]=o.outputBuffer[e];a.buffer=r,a.meta={...a.meta,opPitch:(a.meta.opPitch??0)+512*n,length:r.length,duration:Number(r.length/v.masterSR).toFixed(3),startFrame:0,endFrame:r.length,note:!1,editing:!1,slices:!!a.meta.slices&&a.meta.slices.map((e=>({...e,n:e.n,s:Math.round(e.s/t),e:Math.round(e.e/t)})))},i&&(B(w),_.end=Math.abs(Math.round(_.end/t)),_.start=Math.abs(Math.round(_.start/t)),_.step=a.buffer.length/(1024*w),z(),a.waveform=!1)}))})()}(0,t,n,a,i,o,s)},double:function(e,t,n=!1,a=!0){!a&&t&&(_.start=0,_.end=t.buffer.length),t=t||y;const i=v.audioCtx.createBuffer(t.buffer.numberOfChannels,2*t.buffer.length,v.masterSR);for(let e=0;e<t.buffer.numberOfChannels;e++){let a=0;for(let n=_.start;n<_.end;n++)i.getChannelData(e)[a]=t.buffer.getChannelData(e)[n],a++;let r=t.buffer.getChannelData(e).slice(_.start,_.end);n&&(r=r.reverse());for(let t=_.start;t<_.end;t++)i.getChannelData(e)[a]=r[t],a++}t.buffer=i,t.meta={...t.meta,length:i.length,duration:Number(i.length/v.masterSR).toFixed(3),startFrame:0,endFrame:i.length},t.meta.slices&&(t.meta.slices=!1),t.meta.op1Json&&(t.meta.op1Json=!1),a&&L(y,v,"sample",x),t.waveform=!1},stretch:U,roughStretch:function(e,t,n=!0,a=2,r=!1){!n&&t&&(_.start=0,_.end=t.buffer.length),t=t||y;let o=4*v.masterSR;o=o>t.buffer.length/16?Math.floor(t.buffer.length/16):o;let s=Math.floor(o/4),l=Math.ceil(t.buffer.length/s),c=[];for(let e=0;e<t.buffer.numberOfChannels;e++)c.push([]);for(let e=0;e<l;e++)for(let n=0;n<t.buffer.numberOfChannels;n++){const a=t.buffer.getChannelData(n).slice(e*s,e*s+o);let i=new Float32Array(a.length);for(let e=0;e<a.length;e++)i[e]=a[e],i[e]=i[e]>1?1:i[e],i[e]=i[e]<-1?-1:i[e];c[n].push(i)}const d=Math.round(t.buffer.length*a),u=v.audioCtx.createBuffer(t.buffer.numberOfChannels,d,v.masterSR);for(let e=0;e<l;e++){let n=e*(o/2);for(let a=0;a<t.buffer.numberOfChannels;a++)for(let t=0;t<c[a][e].length;t++)u.getChannelData(a)[n+t]?u.getChannelData(a)[n+t]=[n+t-2,n+t-1,n+t,n+t+1,n+t+2].reduce(((t,n)=>t+(u.getChannelData(a)[n]??0+c[a][e][n]??0)),0)/5:u.getChannelData(a)[n+t]=c[a][e][t]}if(r){let a=U(e,t,n,u.length,!0);for(let e=0;e<u.numberOfChannels;e++){for(let t=0;t<u.length;t++)u.getChannelData(e)[t]=(u.getChannelData(e)[t]+a.getChannelData(e)[t])/2;const t=i(u.getChannelData(e),.4);u.copyToChannel(t,e)}}else for(let e=0;e<u.numberOfChannels;e++){const t=i(u.getChannelData(e),.4);u.copyToChannel(t,e)}t.buffer=u,t.meta={...t.meta,length:u.length,duration:Number(u.length/v.masterSR).toFixed(3),startFrame:0,endFrame:u.length},t.meta.slices&&t.meta.slices.length>0&&(t.meta.slices[t.meta.slices.length-1].e=t.buffer.length),n&&L(y,v,"sample",x),t.waveform=!1},nudgeCrossings:function(e,t,n=!0){!n&&t&&(_.start=0,_.end=t.buffer.length),t=t||y;for(let e=0;e<t.buffer.numberOfChannels;e++){let n=t.buffer.getChannelData(e);for(let a=_.start;a<_.end;a++)t.buffer.getChannelData(e)[a]=0===n[a]?.003:n[a]}t.meta={...t.meta},0===_.start&&_.end===t.buffer.length&&(t.meta.slices=!!t.meta.slices&&t.meta.slices.map((e=>({...e,n:e.n,s:_.end-e.e,e:_.end-e.s})))),n&&B(w),t.waveform=!1},padWithZero:function(e,t,n=!0){!n&&t&&(_.start=0,_.end=t.buffer.length),t=t||y;const a=v.audioCtx.createBuffer(t.buffer.numberOfChannels,t.buffer.length+2,v.masterSR);for(let e=0;e<t.buffer.numberOfChannels;e++){let n=0,i=t.buffer.getChannelData(e).slice(_.start,_.end);a.getChannelData(e)[n]=0,n++;for(let t=_.start;t<_.end;t++)a.getChannelData(e)[n]=i[t],n++;a.getChannelData(e)[n]=0}t.buffer=a,t.meta={...t.meta,length:a.length,duration:Number(a.length/v.masterSR).toFixed(3),startFrame:0,endFrame:a.length},t.meta.slices&&(t.meta.slices=!1),t.meta.op1Json&&(t.meta.op1Json=!1),n&&L(y,v,"sample",x),t.waveform=!1},buildOpKit:function(){const e=document.querySelector(".aif-link-hidden"),t=s(C[0].buffer,C.json);let n=new window.Blob([t],{type:"audio/aiff"});e.href=URL.createObjectURL(n),e.setAttribute("download","test-kit.aif"),e.click()},sliceUpdate:function(e){const t=document.querySelector("#sliceSelection");if(-1==+t.value)return;const n=digichain.getSlicesFromMetaFile(y),a=n.at(+t.value);a.s=_.start,a.e=_.end,a.l=-1,digichain.removeMetaFile(y.meta.id),y.meta.slices=n},sliceCreate:function(e){const t=digichain.getSlicesFromMetaFile(y);t.push({n:"",s:_.start,e:_.end,l:-1}),digichain.removeMetaFile(y.meta.id),y.meta.slices=t,O(),document.querySelector("#sliceSelection").value=t.length>0?t.length-1:-1},sliceRemove:function(e){const t=document.querySelector("#sliceSelection");if(-1==+t.value)return;const n=digichain.getSlicesFromMetaFile(y);y.meta.slices=n.filter(((e,n)=>n!==+t.value)),digichain.removeMetaFile(y.meta.id),y.meta.slices=!!y.meta.slices.length&&y.meta.slices,t.value=-1,_.start=0,_.end=y.buffer.length,z(),O()},sliceSelect:function(e){const t=document.querySelector("#sliceSelection"),n=document.querySelector("#editLines .edit-line");if(-1==+t.value)return N();const a=digichain.getSlicesFromMetaFile(y).at(+t.value);_.start=a.s,_.end=a.e,z(),n.scrollIntoViewIfNeeded()},toggleSnapToZero:function(e){const t=e.target;S=!S,t.classList[S?"remove":"add"]("button-outline")},detectBpm:async function(e){const t=e.target,n=y.buffer.getChannelData(0).slice(_.start,_.end),a=v.audioCtx.createBuffer(1,n.length,v.masterSR);a.getChannelData(0).set(n);const i=await u(a);y.tempo=i?.match||!1,t.textContent=`${y.tempo||""} BPM`},changeChannel:function(e,t){y.meta.channel=t,D()},getLastItem:()=>y?.meta?.id,reverse:function(e,t,n=!0){!n&&t&&(_.start=0,_.end=t.buffer.length),t=t||y;for(let e=0;e<t.buffer.numberOfChannels;e++){let n=t.buffer.getChannelData(e).slice(_.start,_.end).reverse(),a=0;for(let i=_.start;i<_.end;i++)t.buffer.getChannelData(e)[i]=n[a],a++}t.meta={...t.meta},0===_.start&&_.end===t.buffer.length&&(t.meta.slices=!!t.meta.slices&&t.meta.slices.map((e=>({...e,n:e.n,s:_.end-e.e,e:_.end-e.s})))),n&&B(w),t.waveform=!1},shift:function(e,t,n=!0){!n&&t&&(_.start=0,_.end=t.buffer.length),t=t||y;for(let e=0;e<t.buffer.numberOfChannels;e++){let n=t.buffer.getChannelData(e).slice(0),a=Math.floor(_.end/2);for(let i=_.start;i<_.end;i++)t.buffer.getChannelData(e)[i]=n[a],a++,a=a>_.end?0:a}t.meta={...t.meta},0===_.start&&_.end===t.buffer.length&&(t.meta.slices=!!t.meta.slices&&t.meta.slices.map((e=>({...e,n:e.n,s:_.end-e.e,e:_.end-e.s})))),n&&B(w),t.waveform=!1},serialize:function(e,n,a=!0,i="LR"){!a&&n&&(_.start=0,_.end=n.buffer.length),n=n||y;const r=v.audioCtx.createBuffer(1,n.buffer.length*i.split("").length,v.masterSR);let o=0;i.split("").forEach((e=>{const a=t(n.buffer,e);for(let e=_.start;e<_.end;e++)r.getChannelData(0)[o]=a[e],o++})),n.buffer=r,n.meta={...n.meta,length:r.length,duration:Number(r.length/v.masterSR).toFixed(3),startFrame:0,endFrame:r.length},n.meta.slices&&(n.meta.slices=!1),n.meta.op1Json&&(n.meta.op1Json=!1),a&&L(y,v,"sample",x),n.waveform=!1},deserialize:function(e,t,n=!0,a="LR"){!n&&t&&(_.start=0,_.end=Math.floor(t.buffer.length/a.split("").length)),t=t||y;const i=v.audioCtx.createBuffer(2,_.end,v.masterSR);let r=0;a.split("").forEach(((e,n)=>{const a=t.buffer.getChannelData(0);for(let e=_.start;e<_.end;e++)i.getChannelData(n)[e]=a[r],r++})),t.buffer=i,t.meta={...t.meta,length:i.length,duration:Number(i.length/v.masterSR).toFixed(3),startFrame:0,endFrame:i.length},t.meta.slices&&(t.meta.slices=!1),t.meta.op1Json&&(t.meta.op1Json=!1),n&&L(y,v,"sample",x),t.waveform=!1}},W=document.getElementById("uploadInput"),j=document.getElementById("fileList"),q=document.getElementById("infoIndicator"),H=["syx","wav","flac","aif","webm","m4a","pti","mp3"],Z=[0,4,8,16,32,64,128],J=750;
/*!
DigiChain v1.4.15-latest [ https://digichain.brianbar.net/ ]
<https://github.com/brian3kb/digichain>

(c) 2023 Brian Barnett <me [at] brianbar.net>
[ @brian3kb ]
Licenced under GPLv3 <https://github.com/brian3kb/digichain/blob/main/LICENSE>

DigiChain bundled resources:
[MIT license] JSZip  : <https://github.com/Stuk/jszip/blob/main/LICENSE.markdown>
[MIT license] Pako : <https://github.com/nodeca/pako/blob/main/LICENSE>
[MIT license] Modified version of Audiobuffer-to-wav : <https://github.com/Experience-Monks/audiobuffer-to-wav/blob/master/LICENSE.md>
[MIT license] Modified version of Audiobuffer-to-aiff : <https://github.com/hunjunior/audiobuffer-to-aiff/blob/master/LICENSE>

Brian referenced the following during development:
[BSD-3] MIDI-SDS, for how the Machine Drum stores audio data in syx files : <https://github.com/eh2k/uwedit/blob/master/core/MidiSDS.cpp> / <https://github.com/eh2k/uwedit/blob/master/LICENSE.txt>
[Unlicense] OctaChainer, how to read/write .ot binary files correctly : <https://github.com/KaiDrange/OctaChainer/blob/master/otwriter.cpp> / <https://github.com/KaiDrange/OctaChainer/blob/master/License.txt>
Tips and Tricks on drawing array buffers to the canvas element: <https://css-tricks.com/making-an-audio-waveform-visualizer-with-vanilla-javascript/>
[MIT License] Basic beat detection : https://github.com/JMPerez/beats-audio-api/blob/gh-pages/script.js / http://joesul.li/van/beat-detection-using-web-audio/
*/let G,V,Y,X,Q,ee=48e3,te=48e3,ne=16,ae=1,ie="w",re=JSON.parse(localStorage.getItem("supportedSampleRates"))??function(){let e=[8e3,48e3];try{new AudioContext({sampleRate:1}),e=[1,96e3]}catch(t){const n=t.toString().match(/\[(.*?)\]/g);n?.length&&(e=n[0].split(",").map((e=>+e.replace(/\D+/g,""))))}return e[1]=e[1]>96e3?96e3:e[1],localStorage.setItem("supportedSampleRates",JSON.stringify(e)),e}(),oe=localStorage.getItem("lastUsedAudioConfig")??"48000m16w",se=JSON.parse(localStorage.getItem("restoreLastUsedAudioConfig"))??!0,le=JSON.parse(localStorage.getItem("retainSessionState"))??!0,ce=JSON.parse(localStorage.getItem("pitchModifier"))??1,de=JSON.parse(localStorage.getItem("reverseEvenSamplesInChains"))??!1,ue=JSON.parse(localStorage.getItem("playWithPopMarker"))??0,he=JSON.parse(localStorage.getItem("zipDownloads"))??!0,fe=!1,me=JSON.parse(localStorage.getItem("embedCuePoints"))??!0,pe=JSON.parse(localStorage.getItem("embedOrslData"))??!1,ge=JSON.parse(localStorage.getItem("showTouchModifierKeys"))??!1,be=JSON.parse(localStorage.getItem("exportWithOtFile"))??!1,ye=JSON.parse(localStorage.getItem("darkModeTheme"))??!0,ve=JSON.parse(localStorage.getItem("normalizeContrast"))??!1,we=JSON.parse(localStorage.getItem("importFileLimit"))??!0,_e=JSON.parse(localStorage.getItem("skipMiniWaveformRender"))??!1,ke=JSON.parse(localStorage.getItem("attemptToFindCrossingPoint"))??!1,Se=JSON.parse(localStorage.getItem("deClick"))??.4,Ce=JSON.parse(localStorage.getItem("treatDualMonoStereoAsMono"))??!0,xe=JSON.parse(localStorage.getItem("shiftClickForFileDownload"))??!1,Ee=0,Le=[],De=[],Ie=[],Oe=[],Be=[],Ae=[],Re="",Pe=[],Fe=[],Te=0,ze=Array.from(Z);Array.from(ze);let $e=!0,Ne={shiftKey:!1,ctrlKey:!1};function Me(){Y&&Y.sampleRate===ee||(Y=new AudioContext({sampleRate:ee,latencyHint:"interactive"}),E({audioCtx:Y,masterSR:ee,masterChannels:ae,masterBitDepth:ne}))}async function Ue(e="",t=!1){const n=document.getElementById("exportSettingsPanel"),a=document.getElementById("audioConfigOptions"),i=document.getElementById("audioValuesFromCommonSelect"),r=(i?.selectedOptions??[])[0]?.dataset?.device,o=[48e3,"m",16,"w",...Z];let s=e?e.match(/^\d+|[ms]|\d+|[wa]/g):o;s=11===s.length?s:o;let l=e&&11===s.length?{sr:+s[0],c:s[1],bd:+s[2],f:s[3],go:s.slice(4)}:{sr:+document.getElementById("settingsSampleRate").value,c:1==+document.getElementById("channelsGroup").dataset.channels?"m":"s",bd:+document.getElementById("bitDepthGroup").dataset.bitDepth,f:document.getElementById("targetContainerGroup").dataset.container,go:[0,...[...document.querySelectorAll(".acoSliceGridOption")].map((e=>+e.value))]},c=+(document.getElementById("settingsWorkingSampleRate")?.value||localStorage.getItem("workingSampleRate")||48e3);if(it("embedCuePoints",!0,!0),i&&(it("exportWithOtFile","ot"===r,!0),i.value="none"),"a"===l.f&&(l.sr=44100,l.bd=16),l.sr<re[0]||l.sr>re[1])return alert(`ERROR: The sample rate ${l.sr}Hz is not supported by your browser.\n\nPlease select a sample rate between ${re[0]}Hz and ${re[1]}Hz`),!1;if(c<re[0]||c>re[1])return alert(`ERROR: The sample rate ${c}Hz is not supported by your browser.\n\nPlease select a sample rate between ${re[0]}Hz and ${re[1]}Hz`),!1;if(Le.length>0&&c!==ee){if(!confirm("Frequently changing audio working sample rate can degrade the audio quality, particularly in the transients and higher frequencies.\n\n Do you want to continue?"))return!1}document.body.classList.add("loading");const d=`${"a"===l.f?"AIF ":""}${l.sr/1e3}kHz/${l.bd}BIT ${"m"===l.c?"MONO":"STEREO"}`;a.value=d;const u=`${l.sr}${l.c}${l.bd}${l.f}${l.go.join("-")}`;oe=u,localStorage.setItem("lastUsedAudioConfig",u),localStorage.setItem("workingSampleRate",`${c}`);let h=!1;c===ee||t||(h=!0),ee=c,te=l.sr,ne=l.bd,ae="m"===l.c?1:2,ie=l.f,ze=l.go.map((e=>+e)),document.body.dataset.targetSr=te,ze.forEach(((e,t)=>gt(document.querySelector(`.master-slices .sel-${t}`),e,!0))),bt({shiftKey:!1,target:document.querySelector('.master-slices [class*="sel-"].check:not(.button-outline)')},ze[+document.querySelector('.master-slices [class*="sel-"].check:not(.button-outline)')?.dataset?.sel??0]),t||Me(),Ee=0,Ee="opz"===r?12:Ee,Ee="op1f"===r?20:Ee,Ee="opxy"===r?40:Ee,rt(!1,Ee||0),E({audioCtx:Y,masterSR:ee,masterChannels:ae,masterBitDepth:ne}),Le.length>0&&Le.filter((e=>e.buffer.numberOfChannels>1)).forEach((e=>e.waveform=!1)),h&&(Le=Le.map((e=>We(e)))),n.open&&n.close(),Pt()}function Ke(){return"closed"===Y.state?(document.body.classList.remove("loading"),alert("ERROR: The Audio Context has been closed, please refresh the browser tab."),!0):(["interrupted","suspended"].includes(Y.state)&&Y.resume(),!1)}function We(e,t,n){let a,i,r=e.buffer.channel0||e.buffer.getChannelData(0),o=2===e.buffer.numberOfChannels&&(e.buffer.channel1||e.buffer.getChannelData(1));if(t=t||ee,e.buffer.sampleRate!==t){let s,l;s=new d(e.buffer.sampleRate,t,1,r),s.resampler(s.inputBuffer.length),2===e.buffer.numberOfChannels&&(l=new d(e.buffer.sampleRate,t,1,o),l.resampler(l.inputBuffer.length)),a=(n??Y).createBuffer(e.buffer.numberOfChannels,s.outputBuffer.length,t),a.copyToChannel(s.outputBuffer,0),2===e.buffer.numberOfChannels&&a.copyToChannel(l.outputBuffer,1),Array.isArray(e.meta.slices)&&(i=e.meta.slices.map((n=>({...n,s:Math.round(n.s/e.buffer.sampleRate*t),e:n.e===e.buffer.length?Math.round(s.outputBuffer.length):Math.round(n.e/e.buffer.sampleRate*t),l:n.l&&n.l>-1?Math.round(n.l/e.buffer.sampleRate*t):-1}))))}else a=(n??Y).createBuffer(e.buffer.numberOfChannels,e.buffer.length,t),a.copyToChannel(r,0),2===e.buffer.numberOfChannels&&a.copyToChannel(o,1);return{file:e.file,meta:{...e.meta,slices:Array.isArray(i)?i:e.meta.slices||!1,length:a.length,duration:Number(a.length/t).toFixed(3)},buffer:a}}Oe.getByFileName=function(e){let t=this.find((t=>t.name.replace(/\.[^.]*$/,"")===e.replace(/\.[^.]*$/,"")));return!t&&e.endsWith(".flac")&&(t=this.find((t=>e.includes(`(${t.name})`)))),"---sliceToTransientCached---"!==e||t||(t={uuid:crypto.randomUUID(),name:"---sliceToTransientCached---",sliceCount:0,slices:[]},Oe.push(t)),t},Oe.getByFile=function(e){if(e.meta.slicedFrom)return!1;const t=this.find((t=>t.name.replace(/\.[^.]*$/,"")===e.file.name.replace(/\.[^.]*$/,"")));if(t)return t;if(e.meta.op1Json&&e.meta.op1Json.start){let t=e.meta.op1Json.start.map(((t,n)=>({startPoint:t,endPoint:e.meta.op1Json.end[n],p:e.meta.op1Json.pan[n],pab:e.meta.op1Json.pan_ab[n],st:e.meta.op1Json.pitch[n]}))).reduce(((e,t,n)=>(e?.pos&&e.pos>-1?t.endPoint>e.pos&&(e.result.push(t),e.pos=t.endPoint):(e.pos=e.pos??t.endPoint,e.result.push(t)),e)),{result:[]}).result;return{uuid:e.meta.uuid,name:e.file.name,path:e.file.path,cssClass:"is-op-file",sliceCount:t.length,slices:t}}return e.meta.customSlices?{uuid:e.meta.uuid,name:e.file.name,path:e.file.path,cssClass:"is-dc-file",sliceCount:e.meta.customSlices.sliceCount,slices:e.meta.customSlices.slices}:e.meta.slices?{uuid:e.meta.uuid,name:e.file.name,path:e.file.path,cssClass:"is-dc-file",otLoop:e.meta.otLoop??0,otLoopStart:e.meta.otLoopStart??0,sliceCount:e.meta.slices.length,slices:e.meta.slices.map((e=>({startPoint:e.s,endPoint:e.e,loopPoint:e.l??-1,name:e.n||e.name||"",p:e.p??16384,pab:e.pab??!1,st:e.st??0})))}:void 0},Oe.getByFileInDcFormat=function(e){return("---sliceToTransientCached---"===e?Oe.getByFileName("---sliceToTransientCached---"):Oe.getByFile(e)||{slices:[]}).slices.map((e=>{let t={s:e.startPoint,e:e.endPoint,l:e.loopPoint,n:e.name||""};return["p","pab","st"].forEach((n=>{e[n]||(t[n]=e[n])})),t}))},Oe.removeSelected=function(){Le.forEach((e=>{const t=this.findIndex((t=>t===this.getByFileName(e.file.name)));e.meta.checked&&-1!==t&&this.splice(t,1)}))},Oe.removeByName=function(e){const t=this.findIndex((t=>t===this.getByFileName(e)));-1!==t&&(this.splice(t,1),De=De.filter((e=>e!==t)))};const je=e=>Le.find((t=>t.meta.id===e)),qe=e=>Le.findIndex((t=>t.meta.id===e)),He=(e,t="#masterList")=>document.querySelector(`${t} tr[data-id="${e}"]`),Ze=()=>{const e=document.getElementById("allOptionsPanel"),t=document.getElementById("toggleOptionsButton");e.classList.contains("hidden")?e.classList.remove("hidden"):e.classList.add("hidden"),e.classList.contains("hidden")?t.classList.add("collapsed"):t.classList.remove("collapsed")},Je=()=>{$e=!$e,Pt(!0)};function Ge(e=!1){const t=Ae.filter((e=>!e.used)).length;return e?t:t>0}function Ve(e){const t=document.querySelector(".chain-name-toggle");let n=Ae.filter((e=>!e.used))[0];return n.used=!0,t.dataset.count=`${Ge()?Ge(!0):""}`,t.classList[t.dataset.count?"remove":"add"]("fade"),`${n.name}--[${e}].wav`}function Ye(){const e=document.querySelector(".chain-name-toggle"),t=document.getElementById("chainFileNameListPanel").querySelector(".content"),n=Ae.sort(((e,t)=>e.used-t.used)).reduce(((e,t,n)=>e+`\n        <tr>\n        <td\n            class="chain-file-name-option ${t.used?"used":""}"\n            onpointerdown="digichain.changeChainName(event, ${n})"\n        >${t.name} </td>\n        <td>\n        <button title="Remove this name from the list." class="remove-chain float-right button-clear" onpointerdown="digichain.changeChainName(event, ${n}, 'remove')"><i class="gg-remove"></i></button>\n        <button title="Reset this name so it can be reused for a sample chain name." class="reuse-chain p-0 float-right button-clear ${t.used?"":"hidden"}" onpointerdown="digichain.changeChainName(event, ${n}, 'reuse')"><i class="gg-undo"></i></button>\n        </td>\n        </tr>\n`),"");e.dataset.count=`${Ge()?Ge(!0):""}`,e.classList[e.dataset.count?"remove":"add"]("fade"),t.innerHTML=`\n    <div class="row">\n      <div class="column mh-60vh">\n          <table>\n              <tr>\n                  <th class="p-0"><h5>Sample Chain Names</h5></th>\n                  <th class="p-0"><button title="Remove all names from the list." class="remove-chain float-right button-clear" style="transform: translateX(-0.5rem);" onpointerdown="digichain.changeChainName(event, -1, 'remove-all')"><i class="gg-remove"></i></button></th>\n              </tr>\n              <tbody>\n                  ${n}\n              </tbody>\n          </table>\n      </div>\n    </div>\n    <div style="padding-top:1rem;">\n        <button title="Generates a list of filenames based on the folder path of the files in the list. This will replace all other names in the sample names list." class="button-outline float-left" onpointerdown="digichain.generateChainNames()">Generate</button>\n        <button title="Add a name to use for sample chains, if the list is empty, or all the names have already been used, the DigiChain default naming convention will be used. (Names must be unique, caps are ignored.)" class="button float-right" onpointerdown="digichain.changeChainName(event)">Add Name</button>\n    </div>\n    `}function Xe(e){const t=document.getElementById("splitOptions");t.open&&t.close(),ut(e,X.dataset.id)}const Qe=(e,t,n="sample")=>{let a,i;"opExport"===n?(Fe=Le.filter((e=>e.meta.checked)),a=Fe):(t&&"opExport"!==n&&(X=He(t)),i=[...new Set(Le.map((e=>e.file.path)))],a=je(t||X.dataset.id)),L(a,{audioCtx:Y,masterSR:ee,masterChannels:ae,masterBitDepth:ne},n,i)};async function et(e,t,n,a,i){let o,s,l,c=R("",e,!1,!0);if(c="a"===ie?c.replace(".wav",".aif"):c,e.meta.slices=e.meta.slices||Oe.getByFileInDcFormat(e),o=r(e.buffer,{...e.meta,renderAt:!!a&&te},ee,i||ne,ae,Se,n&&1===ce,ce,fe,me,pe),s=o.sampleRate,o=o.buffer,l=new window.Blob([new DataView(o)],{type:n&&1===ce?"audio/aiff":"audio/wav"}),1!==ce){let t=await fetch(URL.createObjectURL(l)),c=await t.arrayBuffer(),d=await Y.decodeAudioData(c),u={...e.meta};u.slices=u.slices.map((e=>({...e,n:e.n,s:Math.round(e.s/ce),e:Math.round(e.e/ce),l:-1===(!e.l||e.l)?-1:Math.round(e.l/ce)}))),o=r(d,{...u,renderAt:!!a&&te},ee,i||ne,ae,Se,n,1,fe,me,pe),s=o.sampleRate,o=o.buffer,l=new window.Blob([new DataView(o)],{type:n?"audio/aiff":"audio/wav"})}return t.href=URL.createObjectURL(l),t.setAttribute("download",c),{blob:l,sampleRate:s}}async function tt(e,t=!1,n={}){const a=He(e).querySelector(".wav-link-hidden"),i=He(e).querySelector(".meta-link-hidden"),r=je(e),o="a"===ie;await et(r,a,o,!0);let s=await zt(r.meta.slices??[],r,r.file.name,i);return t&&(!xe||xe&&n.shiftKey)&&(a.click(),s&&i.click()),[a,i]}function nt(e,t=!1){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const n=Le.filter((e=>e.meta.checked));n.forEach(((a,i)=>{K.double(e,a,t,!1),i===n.length-1&&document.body.classList.remove("loading")})),Pt()}),250)}function at(e,t){const n={2:1,4:2,8:3};if([.25,.5,1,2,4,8].includes(+e)){if(ce=+e,localStorage.setItem("pitchModifier",ce),q.textContent=1===ce?"":`All exported samples will be pitched up ${n[ce]} octave${ce>2?"s":""}`,t)return;It(),ot()}return e}function it(e,t,n){"zipDl"===e&&(he=t??!he,localStorage.setItem("zipDownloads",he)),"treatDualMonoStereoAsMono"===e&&(Ce=t??!Ce,localStorage.setItem("treatDualMonoStereoAsMono",Ce)),"shiftClickForFileDownload"===e&&(xe=t??!xe,localStorage.setItem("shiftClickForFileDownload",xe)),"embedSliceData"===e&&(fe=t??!fe,localStorage.setItem("embedSliceData",fe)),"embedCuePoints"===e&&(me=t??!me,localStorage.setItem("embedCuePoints",me)),"embedOrslData"===e&&(pe=t??!pe,localStorage.setItem("embedOrslData",pe)),"exportWithOtFile"===e&&(be=t??!be,localStorage.setItem("exportWithOtFile",be)),"importFileLimit"===e&&(we=t??!we,localStorage.setItem("importFileLimit",we)),"skipMiniWaveformRender"===e&&(_e=t??!_e,localStorage.setItem("skipMiniWaveformRender",_e)),"reverseEvenSamplesInChains"===e&&(de=t??!de,localStorage.setItem("reverseEvenSamplesInChains",de)),"attemptToFindCrossingPoint"===e&&(ke=t??!ke,localStorage.setItem("attemptToFindCrossingPoint",ke)),"darkModeTheme"===e&&(ye=t??!ye,localStorage.setItem("darkModeTheme",ye),document.body.classList[ye?"remove":"add"]("light")),"normalizeContrast"===e&&(ve=t??!ve,localStorage.setItem("normalizeContrast",ve),document.body.classList[ve?"add":"remove"]("normalize-contrast")),"restoreLastUsedAudioConfig"===e&&(se=t??!se,localStorage.setItem("restoreLastUsedAudioConfig",se)),"retainSessionState"===e&&(le=t??!le,localStorage.setItem("retainSessionState",le),le?Wt(!0):qt()),"showTouchModifierKeys"===e&&(ge=t??!ge,localStorage.setItem("showTouchModifierKeys",ge),document.querySelector(".touch-buttons").classList[ge?"remove":"add"]("hidden")),"playWithPopMarker"===e&&(ue=t,Le.forEach((e=>e.meta.peak=void 0)),localStorage.setItem("playWithPopMarker",ue)),"deClick"===e&&(Se=t,localStorage.setItem("deClick",Se)),n||ot()}function rt(e,t){const n=document.querySelector(".toggle-seconds-per-file"),a=document.querySelector(".toggle-seconds-per-file span");(e.ctrlKey||e.metaKey||Ne.ctrlKey)&&(t=function(e,t,n=!1){let a=t;return n||(a=prompt(`Change max seconds per file "${t}" to what new value?`,t)),a&&!isNaN(a)&&(a=Math.abs(Math.ceil(+a)),Ee=+a,e.textContent=a),+a}(a,Ee)||t),Ee=void 0!==t?t:0===Ee?2===ae?20:12:0,0===Ee?(n.classList.remove("on"),a.innerText="off"):(n.classList.add("on"),a.innerText=`${Ee}s`,bt({shiftKey:!0,target:document.querySelector(".slice-grid-off")},0)),It()}function ot(e="settings"){const t=document.querySelector("#exportSettingsPanel"),n=document.querySelector("#exportSettingsPanel .content");n.innerHTML="settings"===e?`\n  <div class="export-options">\n  <span class="${"settings"!==e?"active":""}" onpointerdown="digichain.showExportSettingsPanel('audio')">Audio Config</span>\n  <span class="${"settings"===e?"active":""}">Settings</span>\n  </div>\n  <span class="settings-info">All settings here will persist when the app re-opens.</span>\n  <table style="padding-top:0;">\n  <thead>\n  <tr>\n  <th width="68%"></th>\n  <th></th>\n</tr>\n</thead>\n  <tbody>\n  <tr>\n  <td><span>Pitch up exported files by octave &nbsp;&nbsp;&nbsp;</span></td>\n  <td>    <button onpointerdown="digichain.pitchExports(1)" class="check ${1===ce?"button":"button-outline"}">OFF</button>\n  <button onpointerdown="digichain.pitchExports(2)" class="check ${2===ce?"button":"button-outline"}">1</button>\n  <button onpointerdown="digichain.pitchExports(4)" class="check ${4===ce?"button":"button-outline"}">2</button>\n  <button onpointerdown="digichain.pitchExports(8)" class="check ${8===ce?"button":"button-outline"}">3</button><br></td>\n</tr>\n<tr>\n<td><span>Reverse all even samples in a chain? &nbsp;&nbsp;&nbsp;</span></td>\n<td><button onpointerdown="digichain.toggleSetting('reverseEvenSamplesInChains')"\n title="When enabled, all even samples in chains will be reversed (back-to-back mode)."\n class="check ${de?"button":"button-outline"}">${de?"YES":"NO"}</button></td>\n</tr>\n<tr>\n<td><span>Restore the last used Sample Rate/Bit Depth/Channel? &nbsp;&nbsp;&nbsp;</span></td>\n<td><button onpointerdown="digichain.toggleSetting('restoreLastUsedAudioConfig')" class="check ${se?"button":"button-outline"}">${se?"YES":"NO"}</button></td>\n</tr>\n<tr>\n<td><span>Retain session data between browser refreshes? &nbsp;&nbsp;&nbsp;</span></td>\n<td><button onpointerdown="digichain.toggleSetting('retainSessionState')" class="check ${le?"button":"button-outline"}">${le?"YES":"NO"}</button></td>\n</tr>\n  <tr>\n  <td><span>Play pop markers when playing back samples?&nbsp;&nbsp;&nbsp;</span></td>\n  <td>\n  <button onpointerdown="digichain.toggleSetting('playWithPopMarker', 0)" class="check ${0===ue?"button":"button-outline"}">OFF</button>\n  <button title="0db prevents DT normalization." onpointerdown="digichain.toggleSetting('playWithPopMarker', 1)" class="check ${1===ue?"button":"button-outline"}">0db</button>\n  <button title="Peak sets pop to loudest sample peak." onpointerdown="digichain.toggleSetting('playWithPopMarker', 2)" class="check ${2===ue?"button":"button-outline"}">Peak</button>\n  </td>\n  </tr>\n  <td><span>Try to match start/end sample when cropping/truncating?&nbsp;&nbsp;&nbsp;</span></td>\n<td><button title="Could give shorter length samples than specified but can help\n   reduce clicks on looping cropped/truncated samples" onpointerdown="digichain.toggleSetting('attemptToFindCrossingPoint')" class="check ${ke?"button":"button-outline"}">${ke?"YES":"NO"}</button></td>\n</tr>\n    <tr>\n  <td><span>De-click exported samples?<br>Helps when importing non-wav files of a different<br>sample rate than the export file, or small buffered audio interfaces. &nbsp;&nbsp;&nbsp;</span></td>\n  <td>\n  <button onpointerdown="digichain.toggleSetting('deClick', 0)" class="check ${0==+Se?"button":"button-outline"}">OFF</button>\n  <button onpointerdown="digichain.toggleSetting('deClick', 0.1)" class="check ${.1==+Se?"button":"button-outline"}">&gt;10%</button>\n  <button onpointerdown="digichain.toggleSetting('deClick', 0.2)" class="check ${.2==+Se?"button":"button-outline"}">&gt;20%</button>\n  <button onpointerdown="digichain.toggleSetting('deClick', 0.3)" class="check ${.3==+Se?"button":"button-outline"}">&gt;30%</button>\n  <button onpointerdown="digichain.toggleSetting('deClick', 0.4)" class="check ${.4==+Se?"button":"button-outline"}">&gt;40%</button>\n  <button onpointerdown="digichain.toggleSetting('deClick', 0.5)" class="check ${.5==+Se?"button":"button-outline"}">&gt;50%</button>\n  <button onpointerdown="digichain.toggleSetting('deClick', 0.75)" class="check ${.75==+Se?"button":"button-outline"}">&gt;75%</button>\n  </td>\n  </tr>\n<tr>\n<td><span>Download multi-file/joined downloads as one zip file? &nbsp;&nbsp;&nbsp;</span></td>\n<td><button onpointerdown="digichain.toggleSetting('zipDl')" class="check ${he?"button":"button-outline"}">${he?"YES":"NO"}</button></td>\n</tr>\n<tr>\n<td><span>When exporting stereo, export dual mono files as mono? &nbsp;&nbsp;&nbsp;</span></td>\n<td><button title="Often, stereo files are just the same mono audio data on both channels, if this is the case, export the file as mono." onpointerdown="digichain.toggleSetting('treatDualMonoStereoAsMono')" class="check ${Ce?"button":"button-outline"}">${Ce?"YES":"NO"}</button></td>\n</tr>\n<tr style="display: none;">\n<td><span>Embed slice information in exported wav files?&nbsp;&nbsp;&nbsp;</span></td>\n<td><button title="Embed the slice information into the wav file in DigiChain format, this includes start, end points and the source file name for the slice." onpointerdown="digichain.toggleSetting('embedSliceData')" class="check ${fe?"button":"button-outline"}">${fe?"YES":"NO"}</button></td>\n</tr>\n<tr>\n<td><span>Embed slice information as CUE points in exported wav files?&nbsp;&nbsp;&nbsp;</span></td>\n<td><button title="Embed slice data as wav CUE point markers, compatible with DirtyWave M8 slice sampler. The end points will extend to the start point of the next sample, or the end of the wav file for the last slice." onpointerdown="digichain.toggleSetting('embedCuePoints')" class="check ${me?"button":"button-outline"}">${me?"YES":"NO"}</button></td>\n</tr>\n\x3c!--<tr>\n<td><span>Embed slice information as Lofi-12 XT points in exported wav files?<br>(Applied only to 12/24 kHz wav exports) &nbsp;&nbsp;&nbsp;</span></td>\n<td><button title="Embed slice data in wav file header in the Sonicware custom format for the Lofi-12 XT sampler." onpointerdown="digichain.toggleSetting('embedOrslData')" class="check ${pe?"button":"button-outline"}">${pe?"YES":"NO"}</button></td>\n</tr>--\x3e\n<tr>\n<td><span>Create accompanying .ot metadata file?<br>(Applied only to 44.1 kHz 16/24 [non-aif] audio contexts) &nbsp;&nbsp;&nbsp;</span></td>\n<td><button onpointerdown="digichain.toggleSetting('exportWithOtFile')" class="check ${be?"button":"button-outline"}">${be?"YES":"NO"}</button></td>\n</tr>\n<tr>\n<td><span>Limit imports to maximum of 750 files?&nbsp;&nbsp;&nbsp;</span></td>\n<td><button title="Enforces a limit of 750 files per import, to help prevent crashes on nested folders of many files - disabling may result in slow-downs or timeouts." onpointerdown="digichain.toggleSetting('importFileLimit')" class="check ${we?"button":"button-outline"}">${we?"YES":"NO"}</button></td>\n</tr>\n<tr>\n<td><span>Skip rendering the mini audio waveform in the list?&nbsp;&nbsp;&nbsp;</span></td>\n<td><button title="When processing large lists of files, skiping the renderings of the waveform can improve the responsiveness of the browse as no canvas element per row will be rendered." onpointerdown="digichain.toggleSetting('skipMiniWaveformRender')" class="check ${_e?"button":"button-outline"}">${_e?"YES":"NO"}</button></td>\n</tr>\n<tr>\n<td><span>Show Shift/Ctrl modifier touch buttons?&nbsp;&nbsp;&nbsp;</span></td>\n<td><button onpointerdown="digichain.toggleSetting('showTouchModifierKeys')" class="check ${ge?"button":"button-outline"}">${ge?"YES":"NO"}</button></td>\n</tr>\n<tr>\n<td><span>Shift+Click to download single files from the list?&nbsp;&nbsp;&nbsp;</span></td>\n<td><button onpointerdown="digichain.toggleSetting('shiftClickForFileDownload')" class="check ${xe?"button":"button-outline"}">${xe?"YES":"NO"}</button></td>\n</tr>\n<tr>\n<td><span>Use Dark theme as the default? (No = Light theme)&nbsp;&nbsp;&nbsp;</span></td>\n<td><button onpointerdown="digichain.toggleSetting('darkModeTheme')" class="check ${ye?"button":"button-outline"}">${ye?"YES":"NO"}</button></td>\n</tr>\n<tr>\n<td><span>Normalize text/waveform color contrast? &nbsp;&nbsp;&nbsp;</span></td>\n<td><button onpointerdown="digichain.toggleSetting('normalizeContrast')" class="check ${ve?"button":"button-outline"}">${ve?"YES":"NO"}</button></td>\n</tr>\n</tbody>\n</table>\n`:`\n  <div class="export-options">\n    <span class="${"settings"!==e?"active":""}">Audio Config</span>\n    <span class="${"settings"===e?"active":""}" onpointerdown="digichain.showExportSettingsPanel()">Settings</span>\n  </div>\n  <table style="padding-top:0;" id="settingAudioConfig">\n  <thead>\n  <tr>\n  <th style="border: none;"></th>\n  <th style="border: none;"></th>\n</tr>\n</thead>\n  <tbody>\n    <tr>\n      <td style="border: none;"><span>Working Sample Rate (Hz)&nbsp;&nbsp;&nbsp;</span></td>\n      <td style="border: none;">\n          <div class="input-set" id="settingsWorkingSampleRateGroup" style="display: flex; align-items: flex-start;">\n              <input type="number" placeholder="Sample Rate between ${re.toString()}Hz"\n              onfocus="(() => {this.placeholder = this.value; this.value = '';})()"\n              onblur="(() => { this.value = this.value || this.placeholder; this.placeholder = this.dataset.placeholder;})()"\n              id="settingsWorkingSampleRate" value="${ee}" data-sample-rate="${ee}" list="commonSR"\n              data-placeholder="Sample Rate between ${re.toString()}"\n              min="${re[0]}" max="${re[1]}">\n              <datalist id="commonSR">\n                ${[12e3,24e3,32e3,44100,48e3].map((e=>'<option value="'+e+'">')).join("")}\n              </datalist>\n              <button title="Restore currently active working sample rate" class="button-clear" onpointerdown="(() => {const i = document.getElementById('settingsWorkingSampleRate'); i.value = i.dataset.sampleRate;})()"><i class="gg-undo"></i></button>\n          </div>\n      </td>\n  </tr>\n    <tr><td colspan="2"><span><small>Caution: Changing the working sample rate will resample any files currently in the list to the specified sample rate.</small></span><br><br></td></tr>\n  <tr>\n      <td style="border: none;"><span>Target Sample Rate (Hz)&nbsp;&nbsp;&nbsp;</span></td>\n      <td style="border: none;">\n          <div class="input-set ${"a"===ie?"disabled":""}" id="settingsSampleRateGroup" style="display: flex; align-items: flex-start;">\n              <input type="number" placeholder="Sample Rate between ${re.toString()}Hz"\n              ${"a"===ie?'disabled="disabled"':""}\n              onfocus="(() => {this.placeholder = this.value; this.value = '';})()"\n              onblur="(() => { this.value = this.value || this.placeholder; this.placeholder = this.dataset.placeholder;})()"\n              id="settingsSampleRate" value="${te}" data-sample-rate="${te}" list="commonSR"\n              data-placeholder="Sample Rate between ${re.toString()}"\n              min="${re[0]}" max="${re[1]}">\n              <datalist id="commonSR">\n                ${[12e3,24e3,32e3,44100,48e3].map((e=>'<option value="'+e+'">')).join("")}\n              </datalist>\n              <button title="Restore currently active sample rate" class="button-clear" onpointerdown="(() => {const i = document.getElementById('settingsSampleRate'); i.value = i.dataset.sampleRate;})()"><i class="gg-undo"></i></button>\n          </div>\n      </td>\n  </tr>\n  <tr><td colspan="2"></td></tr>\n\n  <tr>\n  <td><span>Bit Depth&nbsp;&nbsp;&nbsp;</span></td>\n  <td>\n  <div style="padding: 1.5rem 0;" class="${"a"===ie?"disabled":""}" id="bitDepthGroup" data-bit-depth="${ne}" onclick="((event, el) => {\n      el.dataset.bitDepth = event.target.dataset.bitDepth || el.dataset.bitDepth;\n  el.querySelectorAll('button').forEach(b => b.classList = b.dataset.bitDepth === el.dataset.bitDepth ? 'check button' : 'check button-outline')\n  })(event, this);">\n      <button id="acoBitDepth8" data-bit-depth="8" class="check button${8!==ne?"-outline":""}">8 Bit</button>\n      <button id="acoBitDepth16" data-bit-depth="16" class="check button${16!==ne?"-outline":""}">16 Bit</button>\n      <button id="acoBitDepth24" data-bit-depth="24" class="check button${24!==ne?"-outline":""}">24 Bit</button>\n     <button id="acoBitDepth32" data-bit-depth="32" class="check button${32!==ne?"-outline":""}">32 Bit</button>\n </div>\n  </td>\n  </tr>\n  <tr>\n      <td><span>Channels&nbsp;&nbsp;&nbsp;</span></td>\n      <td>\n        <div style="padding: 1.5rem 0;" id="channelsGroup" data-channels="${ae}" onclick="((event, el) => {\n      el.dataset.channels = event.target.dataset.channels || el.dataset.channels;\n  el.querySelectorAll('button').forEach(b => b.classList = b.dataset.channels === el.dataset.channels ? 'check button' : 'check button-outline')\n  })(event, this);">\n        <button id="acoChannelm" data-channels="1" class="check button${1!==ae?"-outline":""}">MONO</button>\n          <button id="acoChannels" data-channels="2" class="check button${2!==ae?"-outline":""}">STEREO</button>\n          </div>\n      </td>\n  </tr>\n\n  <tr>\n      <td style="border: none;"><span>Container&nbsp;&nbsp;&nbsp;</span></td>\n      <td style="border: none;">\n        <div style="padding: 1.5rem 0;" id="targetContainerGroup" data-container="${ie}" onclick="((event, el) => {\n      el.dataset.container = event.target.dataset.container || el.dataset.container;\n  el.querySelectorAll('button').forEach(b => b.classList = b.dataset.container === el.dataset.container ? 'check button' : 'check button-outline');\n  if (el.dataset.container === 'a') {\n      document.getElementById('acoBitDepth16').click();\n      document.getElementById('bitDepthGroup').classList.add('disabled');\n      document.getElementById('settingsSampleRate').value = 44100;\n      document.getElementById('settingsSampleRate').disabled = true;\n      document.getElementById('settingsSampleRateGroup').classList.add('disabled');\n  } else {\n        document.getElementById('bitDepthGroup').classList.remove('disabled');\n        document.getElementById('settingsSampleRate').disabled = false\n        document.getElementById('settingsSampleRateGroup').classList.remove('disabled');\n  }\n  })(event, this);">\n        <button id="acoContainerw" data-container="w" class="check button${"w"===ie?"":"-outline"}">WAV</button>\n          <button id="acoContainera" data-container="a" class="check button${"a"===ie?"":"-outline"}">AIF</button>\n          </div>\n      </td>\n  </tr>\n    <tr><td colspan="3"><span><small>Note: Choosing AIF will set the sample rate to 44100 and the bit depth to 16 bit.</small></span><br><br></td></tr>\n\n  <tr>\n\n  <tr>\n    <td><span>Slice Grid Options&nbsp;&nbsp;&nbsp;</span></td>\n    <td>\n        <div id="sliceGridGroup">\n           ${[1,2,3,4,5,6].map(((e,t)=>'<input id="gridSize'+e+'" placeholder="" type="number" class="acoSliceGridOption" onfocus="(() => {this.placeholder = this.value; this.value = \'\';})()" onblur="(() => { this.value = this.value || this.placeholder;})()" list="commonGridSizes" value="'+ze[t+1]+'">')).join("")}\n           <datalist id="commonGridSizes">\n                ${[2,4,8,10,12,15,16,24,30,32,48,60,64,128].map((e=>'<option value="'+e+'">')).join("")}\n           </datalist>\n        </div>\n    </td>\n  </tr>\n\n  <td style="border-bottom: none;">\n    <a class="button" style="margin: 2.5rem 2rem;" onpointerdown="digichain.changeAudioConfig()">Apply Audio Settings</a>\n  </td>\n  <td style="border-bottom: none;">\n    <select id="audioValuesFromCommonSelect" class="btn-audio-config" style="margin: 0 2rem; max-width: 25rem; float: right;" onchange="digichain.setAudioOptionsFromCommonConfig(event)">\n        <option value="none" disabled selected>Common Configurations</option>\n        <option value="48000m16w0-4-8-16-32-64-128">Digitakt</option>\n        <option value="48000s16w0-4-8-16-32-64-128">Digitakt II</option>\n        <option value="44100s16w0-4-8-16-32-64-128" data-device="m8">Dirtywave M8</option>\n        <option value="48000m16w0-8-10-12-15-30-60">Model:Samples</option>\n        <option value="44100s16w0-4-8-16-32-48-64" data-device="ot">Octatrack (16bit)</option>\n        <option value="44100s24w0-4-8-16-32-48-64" data-device="ot">Octatrack (24bit)</option>\n        <option value="44100s16a0-4-8-12-16-20-24" data-device="op1f">OP-1 Field</option>\n        <option value="44100m16a0-4-8-12-16-20-24" data-device="opz">OP-1 / OP-Z</option>\n        <option value="44100s16w0-4-8-12-16-20-24" data-device="opxy">OP-XY</option>\n        <option value="44100m16w0-4-8-16-24-32-48">Polyend Tracker</option>\n        <option value="44100s16w0-4-8-16-24-32-48">Polyend Tracker Mini</option>\n        <option value="48000m16w0-8-10-12-15-30-60">Rytm</option>\n        <option value="12000m16w0-2-4-8-10-12-15">Sonicware Lofi-12 XT 12kHz</option>\n        <option value="24000m16w0-2-4-8-10-12-15">Sonicware Lofi-12 XT 24kHz</option>\n        <option value="46875m16w0-3-4-6-8-9-12">TE EP-133 / EP-1320 (mono)</option>\n        <option value="46875s16w0-3-4-6-8-9-12">TE EP-133 / EP-1320 (stereo)</option>\n    </select>\n  </td>\n  </tr>\n  <tr><td colspan="2"  style="border: none;">&nbsp;</td></tr>\n</tbody>\n</table>\n`,t.open||t.showModal()}function st(e,n,a=!1){return t(e,n,a,Y,ae,ee)}function lt(){const e=document.getElementById("mergePanel"),t=document.getElementById("mergePanelContent");if(Be=Le.filter((e=>e.meta.checked)).map((e=>(e.meta.pan=e.meta.pan||"C",e))),Be.length<2)return alert("Merge requires more than one file to be selected.");t.innerHTML='\n   <div class="row">\n   <div class="column mh-60vh">\n     <table id="mergeList">\n      <thead>\n        <tr>\n        <th>Filename</th>\n        <th>Duration</th>\n        <th>Mono Channel Choice</th>\n        <th>Panning</th>\n        </tr>\n      </thead>\n    <tbody>\n'+Be.map((e=>Bt(e,"merge"))).join("")+'</tbody>\n   </table>\n </div>\n</div>\n<span class="merge-info">Merging flattens each source sample to mono based on the mixdown choice and pans that mono file hard left/right or centers. If you want to retain a stereo files stereo field in the merge, duplicate it first and choose its L/R mix.</span>\n<button class="float-right" onclick="digichain.performMergeUiCall()">Merge Files</button>\n',e.open||e.showModal()}function ct(){const e=document.getElementById("mergePanel"),t=document.getElementById("mergePanelContent");if(Be=Le.filter((e=>e.meta.checked)).map((e=>(e.meta.pan=e.meta.pan||"C",e))),Be.length<2)return alert("Blend requires more than one file to be selected.");t.innerHTML='\n   <div class="row">\n   <div class="column mh-60vh">\n     <table id="mergeList">\n      <thead>\n        <tr>\n        <th>Filename</th>\n        <th>Duration</th>\n        <th>Mono Channel Choice</th>\n        </tr>\n      </thead>\n    <tbody>\n'+Be.map((e=>Bt(e,"blend"))).join("")+`</tbody>\n   </table>\n </div>\n</div>\n<div class="row" style="padding-left: 1rem; padding-top: 2rem;">\n<label for="blendLength">Blend length: </label>\n<select class="btn-audio-config" style="max-width: 100px;margin-left: 1rem;margin-top: -.75rem;" name="blendLength" id="blendLength">\n${[16,32,64,128,256,512,1024,2048,4096].reduce(((e,t)=>e+'<option value="'+t+'"'+(64===t?'selected="selected">':">")+t+"</option>"),"")}\n</select>\n</div>\n<span class="merge-info">EXPERIMENTAL: Blend interpolates between the selected samples by the number of steps specified. Works best when the selected files are approximately the same durations.</span>\n<button class="float-right" onclick="digichain.performBlendUiCall()">Blend Files</button>\n`,e.open||e.showModal()}async function dt(e,t=!1,i=[],r=0,o=!1,s=!1){if(0!==Le.length){(o||e.shiftKey||Ne.shiftKey)&&(o=!0);try{he&&!o&&Le.filter((e=>e.meta.checked)).length>1&&(s=s||new JSZip);let l,c,d,u=i.length>0?i:Le.filter((e=>e.meta.checked)),h=0;if(0===Ee){if(l=u.splice(0,Te>0?Te:u.length),i=Array.from(u),u=l,t&&0!==Te&&0!==u.length)for(;u.length!==Te;)u.push(u[u.length-1]);d=u.reduce(((e,t)=>e>t.buffer.length?e:t.buffer.length),0),h=u.reduce(((e,n)=>e+=t?d:n.buffer.length),0)}else{u=u.filter((e=>e.meta.duration<Ee));let e="a"===ie?24:0===Te?64:Te;const t=u.reduce(((t,n)=>(t.duration+ +n.meta.duration<=Ee*ce&&t.processed.length<e?(t.duration=t.duration+ +n.meta.duration,t.totalLength=t.totalLength+ +n.meta.length,t.processed.push(n)):t.skipped.push(n),t)),{duration:0,totalLength:0,processed:[],skipped:[]});h=t.totalLength,i=t.skipped,u=t.processed}c=[];let f=0;for(let e=0;e<u.length;e++){const n=u[e].meta.slices||Oe.getByFileInDcFormat(u[e]);if(n.length)if(c.length>0){const e=JSON.parse(JSON.stringify(n));e.forEach((e=>{e.s=e.s+f,e.e=e.e+f})),c=[...c,...e]}else c=[...c,...n];else c.push({s:f,e:f+(t?d:+u[e].buffer.length),n:u[e].file.name,p:u[e].meta.opPan??16384,pab:u[e].meta.opPanAb??!1,st:u[e].meta.opPitch??0});f+=t?d:+u[e].buffer.length}c.forEach((e=>{e.s=e.s>h?h:e.s,e.e=e.e>h?h:e.e})),c=c.filter((e=>e.s<e.e));const m=Y.createBuffer(ae,h,ee);for(let e=0;e<ae;e++)for(let t=0;t<h;t++)m.getChannelData(e)[t]=0;1===ae&&n(m,u,d,t,de),2===ae&&a(m,u,d,t,de);const p=document.getElementById("getJoined"),g=u[0].file.path?`${(u[0].file.path||"").replace(/\//gi,"-")}`:"",b={file:{name:Ge()?Ve(u.length):1===u.length?`${g}chain-${t?"spaced-":""}${R("",u[0],!0)}-${r+1}--${u.length}.wav`:`${g}chain-${t?"spaced-":""}${r+1}--${u.length}.wav`},buffer:m,meta:{slices:c}};if(o){const e=await et(b,p,!1,!1,8===ne?8:32),t=new FileReader;t.readAsArrayBuffer(e.blob),t.fileCount=r,t.onload=async t=>{const n=t.target.result.slice(0);await(ee!==(e.sampleRate||ee)?new AudioContext({sampleRate:e.sampleRate,latencyHint:"interactive"}):Y).decodeAudioData(t.target.result,(t=>{$t(t,n,{lastModified:(new Date).getTime(),name:b.file.name,embedSliceData:fe,sampleRate:e.sampleRate||ee,channels:t.numberOfChannels,size:(8===ne?8:32)*(e.sampleRate||ee)*(t.length/(e.sampleRate||ee))/8*t.numberOfChannels/1024,type:"audio/wav"},"",!0,!1),Pt()}))}}else{const e="a"===ie;if(s){const t=await et(b,p,e,!0);b.file.name="a"===ie?b.file.name.replace(".wav",".aif"):b.file.name,s.file(b.file.name,t.blob,{binary:!0});let n=await zt(b.meta.slices??[],b,b.file.name);n&&s.file(n.name,n.blob,{binary:!0})}else{await et(b,p,e,!0),p.click(),await zt(b.meta.slices??[],b,b.file.name,p)&&p.click()}}i.length>0?(r++,dt(e,t,i,r,o,s)):(s&&s.generateAsync({type:"blob"}).then((e=>{p.href=URL.createObjectURL(e),p.setAttribute("download","digichain_files.zip"),p.click()})),Pt())}catch(e){let t="An unexpected error was encountered while building the sample chain(s).";e&&(t+=`\n\n "${e.toString?e.toString():JSON.stringify(e)}"`),document.getElementById("loadingText").textContent="Unexpected Error",alert(t),setTimeout((()=>document.body.classList.remove("loading")),3e3),console.log(e)}}}const ut=(e,t)=>{const n=je(t||X?.dataset?.id);if(!n)return;try{n?.source?.stop()}catch(e){}if(n.meta.playing&&!0!==n.meta.playing){const[e,t]=n.meta.playing.split("_");window["clear"+e](+t),n.meta.playing=!1,n.playHead?.remove(),n.playHead=!1}n.waveform?.classList?.remove("playing"),!0===n.meta.playing&&(n.meta.playing=!1);let a=n.playHead||n.waveform?.parentElement?.querySelector(".play-head");a&&a.remove()},ht=(e,t,n,a,i)=>{const r=je(t||X.dataset.id);let o;n=n||e.shiftKey||Ne.shiftKey||!1,ut(!1,t||r.meta.id);if(Ke())return;r.source=Y.createBufferSource();let s=r.meta.channel&&1===ae?st(r.buffer,r.meta.channel,!0):r.buffer;if(ue&&!e?.editor){const t=Y.createBuffer(1,8,ee),n=Y.createBuffer(s.numberOfChannels,s.length+2*t.length,ee),a=t.getChannelData(0);let i;i=2===ue?r.meta.peak??K.normalize(e,r,!1,!0):1,new Array(t.length).fill(0).forEach(((e,n)=>t.getChannelData(0)[n]=i));for(let e=0;e<s.numberOfChannels;e++){const i=s.getChannelData(e);n.copyToChannel(a,e),n.copyToChannel(i,e,t.length),n.copyToChannel(a,e,t.length+i.length)}s=n}r.source.buffer=s,r.source.connect(Y.destination),r.source.loop=n,t&&!e?.editor&&e.target&&e.target!==r.waveform&&(r.waveform=e.target),t&&!e?.editor&&r.waveform&&"BUTTON"!==r.waveform.nodeName&&(o=document.createElement("span"),o.classList.add("play-head"),o.style.animationDuration=`${r.meta.duration}s`,r.waveform.parentElement.appendChild(o),r.playHead=o),r.source.start(0,a||0,i),t&&!e?.editor&&(r.waveform?.classList?.add("playing"),o?(o.style.animationIterationCount=r.source.loop?"infinite":"unset",r.source.loop?r.meta.playing="Interval_"+setInterval((()=>{const e=r.waveform?.parentElement?.querySelector(".play-head");if(e){const t=e.cloneNode(!0);e.remove(),r.waveform.parentElement.appendChild(t)}else ut(!1,r.meta.id)}),1e3*r.meta.duration):r.meta.playing="Timeout_"+setTimeout((()=>{ut(!1,r.meta.id)}),1e3*r.meta.duration)):r.source.loop&&(r.meta.playing=r.source.loop||"Timeout_"+setTimeout((()=>{ut(!1,r.meta.id)}),1e3*r.meta.duration)))},ft=(e,t,n,a,i)=>{if(e.ctrlKey||e.metaKey||Ne.ctrlKey){const r=n/ee;ht(e,t,i,r,a/ee-r)}};const mt=(e,t,n=!1,a=!1)=>{try{const i=He(t),r=He(t).querySelector(".toggle-check"),o=je(t);if(e.preventDefault(),!e.shiftKey&&!Ne.shiftKey||a)o.meta.checked=!o.meta.checked,r.classList[o.meta.checked?"remove":"add"]("button-outline"),i.classList[o.meta.checked?"add":"remove"]("checked"),!o.meta.checked&&n&&o.source?.stop();else{const n=qe(Q.dataset.id),a=qe(t),i=Math.min(n,a),r=Math.max(n,a);for(let t=i;t<=r;t++){const n=He(Le[t].meta.id),a=!(e.ctrlKey||e.metaKey||Ne.ctrlKey);Le[t].meta.checked=a,n.querySelector(".toggle-check").classList[a?"remove":"add"]("button-outline"),n.classList[a?"add":"remove"]("checked")}}Re="",It()}catch(e){It()}},pt=(e,t,n,a=!0,i="#masterList")=>{He(t,i).querySelector(".channel-option-"+n);const r=je(t);if((e.shiftKey||Ne.shiftKey)&&a){return confirm(`Confirm setting all selected samples that are stereo to ${{L:"audio from the Left channel",R:"audio from the Right channel",S:"Sum both channels of audio to mono",D:"Difference between Left and Right channels"}[n]}?`)&&Le.filter((e=>e.meta.checked&&e.buffer.numberOfChannels>1)).forEach((e=>{e.meta.channel=n,r.waveform=!1})),!Ne.shiftKey&&document.body.classList.contains("shiftKey-down")&&document.body.classList.remove("shiftKey-down"),Pt()}if(r.meta.channel=n,"#masterList"===i)return r.waveform=!1,Rt(r);document.getElementById("mergePanel").open&&document.getElementById("blendLength")?ct():lt()},gt=(e,t,n=!1)=>{let a=t;return n||(a=prompt(`Temporarily change slice value "${t}" to what new value?`,t)),a&&!isNaN(a)&&(a=Math.abs(Math.ceil(+a)),ze[e.dataset.sel]=+a,e.textContent=a),+a},bt=(e,t)=>{if(e.target){if(e.ctrlKey||e.metaKey||Ne.ctrlKey)return 0===t?(Z.forEach(((e,t)=>gt(document.querySelector(`.master-slices .sel-${t}`),e,!0))),ze=Array.from(Z),bt({shiftKey:!0},0)):bt({shiftKey:!0},gt(e.target,t));if(Te=t,ze.forEach(((e,n)=>{const a=document.querySelector(`.master-slices .sel-${n}`);e===t?a.classList.remove("button-outline"):a.classList.add("button-outline")})),It(),0===t&&Le.forEach((e=>e.source?.stop())),e.shiftKey||Ne.shiftKey){Le.forEach((e=>e.meta.checked=!1));for(let n=0;n<(t<Le.length?t:Le.length);n++)mt(e,Le[n].meta.id,!0,!0);Pt()}}},yt=(e,t,n=!1)=>{const a=je(t),i=qe(t)+1,r={file:{...a.file}};r.buffer=new AudioBuffer({numberOfChannels:a.buffer.numberOfChannels,length:a.buffer.length,sampleRate:a.buffer.sampleRate});for(let e=0;e<a.buffer.numberOfChannels;e++){const t=a.buffer.getChannelData(e);r.buffer.getChannelData(e).set(t)}if(r.meta=JSON.parse(JSON.stringify(a.meta)),r.waveform=!1,r.meta.playing=!1,r.meta.id=crypto.randomUUID(),r.file.name=P(Le,r.file.name),n)return r.meta.editOf=t,{item:r,fileIdx:i,callback:(t,n)=>{Le.splice(e.shiftKey||Ne.shiftKey?Le.length:n,0,t),De.push(t.meta.id),Pt()}};r.meta.dupeOf=t,Le.splice(e.shiftKey||Ne.shiftKey?Le.length:i,0,r),De.push(r.meta.id),Pt()};const vt=(e,t,n=!1,a="ot",i=[],r=!1)=>{const o=je(t),s=[];let l;if(l="transient"===a?Oe.getByFileName("---sliceToTransientCached---"):"ot"===a?Oe.getByFile(o):!!o.meta.customSlices&&o.meta.customSlices,l){if(r)return o.meta.slices=Oe.getByFileInDcFormat("transient"===a?"---sliceToTransientCached---":o).filter(((e,t)=>!i.includes(t))),Oe.removeByName("transient"===a?"---sliceToTransientCached---":o.file.filename),o.meta.slices=o.meta.slices.length>0&&o.meta.slices,o.meta.op1Json=!1,void Et(e,t);for(let e=0;e<l.sliceCount;e++){if(i.includes(e))continue;const t=l.slices[e].endPoint-l.slices[e].startPoint;if(t<5)continue;const a=Y.createBuffer(o.buffer.numberOfChannels,t,ee),r={},c=crypto.randomUUID();r.buffer=a,r.file={...o.file},l.slices[e].name&&(r.file.name=l.slices[e].name),r.meta={length:a.length,duration:Number(a.length/ee).toFixed(3),startFrame:0,endFrame:a.length,checked:!0,id:c,sliceNumber:`${o.meta.sliceNumber?o.meta.sliceNumber+"-":""}${e+1}`,slicedFrom:o.meta.id,channel:a.numberOfChannels>1?"L":"",opPan:l.slices[e].p??16384,opPanAb:l.slices[e].pab??!1,opPitch:l.slices[e].st??0},r.meta.customSlices=!1,r.meta.op1Json=!1,r.meta.slices=!1,o.buffer.getChannelData(0).slice(l.slices[e].startPoint,l.slices[e].endPoint).forEach(((e,t)=>r.buffer.getChannelData(0)[t]=e)),2===o.buffer.numberOfChannels&&o.buffer.getChannelData(1).slice(l.slices[e].startPoint,l.slices[e].endPoint).forEach(((e,t)=>r.buffer.getChannelData(1)[t]=e)),n?s.push(r):Le.push(r),De.push(c)}s.length&&Le.splice(qe(t)+1,0,...s),Pt()}},wt=(e,t,n,a=!1,i=[],r=!1)=>{const o=je(t),s=o.buffer.length/n,l=[];if(r)return o.meta.slices=Array.from(".".repeat(n)).map(((e,t)=>({s:Math.round(o.buffer.length/n*t),e:Math.round(o.buffer.length/n*(t+1)),n:"",l:-1}))).filter(((e,t)=>!i.includes(t))),Oe.removeByName(o.file.filename),o.meta.slices=o.meta.slices.length>0&&o.meta.slices,void Et(e,t);for(let e=0;e<n;e++){if(i.includes(e))continue;const t=Y.createBuffer(o.buffer.numberOfChannels,s,o.buffer.sampleRate),n={},r=crypto.randomUUID();n.buffer=t,n.file={...o.file},n.meta={length:t.length,duration:Number(t.length/ee).toFixed(3),startFrame:0,endFrame:t.length,checked:!0,id:r,sliceNumber:`${o.meta.sliceNumber?o.meta.sliceNumber+"-":""}${e+1}`,slicedFrom:o.meta.id,channel:t.numberOfChannels>1?"L":""},o.buffer.getChannelData(0).slice(e*s,e*s+s).forEach(((e,t)=>n.buffer.getChannelData(0)[t]=e)),2===o.buffer.numberOfChannels&&o.buffer.getChannelData(1).slice(e*s,e*s+s).forEach(((e,t)=>n.buffer.getChannelData(1)[t]=e)),a?l.push(n):Le.push(n),De.push(r)}l.length&&Le.splice(qe(t)+1,0,...l),Pt()},_t=(e,t,n)=>{let a,i;const r=document.querySelector("#splitOptions .slice-group"),o=document.querySelectorAll("#splitOptions .slice-group button"),s=document.getElementById("convertChainButton");if(s.style.display="none","custom"===t){const e=prompt("Enter the number of slices to equally chop this sample");"number"==typeof parseInt(e)&&(t=parseInt(e))}"ot"===t&&r.dataset.id&&(a=je(r.dataset.id),i=Oe.getByFile(a),t=i?.slices??[],s.style.display=t.length>0?"block":"none"),"transient"===t&&r.dataset.id?(a=je(r.dataset.id),i=((e,t=.5)=>{const n=Math.floor(e.buffer.length/256);let a,i,r=[];for(let o=0;o<e.buffer.length;o++)void 0===a?Math.abs(e.buffer.getChannelData(0)[o])>t&&(a=o,o+=n):void 0===i&&(0==Math.abs(e.buffer.getChannelData(0)[o]).toFixed(3)||o+n>e.buffer.length)&&(i=o),void 0!==a&&void 0!==i&&(r.push({startPoint:a,loopPoint:-1,endPoint:i}),a=void 0,i=void 0);r=r.filter((t=>!(t.startPoint>t.startPoint+512)||new Array(512).fill(0).every(((n,a)=>Math.abs(e.buffer.getChannelData(0)[t.startPoint-a])<.03)))).map(((t,n,a)=>(t.endPoint=a[n+1]?.startPoint??(n===a.length-1?e.buffer.length:t.endPoint),t)));let o=Oe.getByFileName("---sliceToTransientCached---");return o.slices=r,o.sliceCount=o.slices.length,o})(a,+n/100),t=i?.slices??[]):Oe.removeByName("---sliceToTransientCached---"),o.forEach((e=>e.classList.add("button-outline"))),r.dataset.sliceCount="number"==typeof t?t??0:i?.sliceCount??0,o.forEach(((e,t)=>{+e.dataset.sel==+r.dataset.sliceCount&&!i||"ot"===e.dataset.sel&&i&&"---sliceToTransientCached---"!==i.name||"transient"===e.dataset.sel&&i&&"---sliceToTransientCached---"===i.name?e.classList.remove("button-outline"):e.classList.add("button-outline")})),xt(t,a||je(X.dataset.id),i),a?.meta?.customSlices&&(a.meta.customSlices=!1)},kt=e=>{ut(!1,e);const t=He(e),n=qe(e),a=Le.splice(n,1),i=De.findIndex((t=>t===e));De.splice(i,1),a[0]&&(Oe.removeByName(a[0].file.name),a.buffer&&delete a.buffer),t.classList.add("hide"),t.remove(),jt()},St=(e,t,n="meta")=>{const a=e.shiftKey||Ne.shiftKey,i=["name"];if("id"===t)if(!0===a)Le.sort((()=>crypto.randomUUID().localeCompare(crypto.randomUUID())));else{const e=De.filter((e=>!Ie.includes(e)));Ie=[...Ie,...e],Le.sort(((e,t,n)=>(a,i)=>e.indexOf(a[t][n])>=e.indexOf(i[t][n])?1:-1)(Ie,n,t)),Re=""}else if("note"===t){const e=[],a=["C","C#","Db","D","D#","Eb","E","F","F#","Gb","G","G#","Ab","A","A#","Bb","B"];[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16].forEach((t=>a.forEach((n=>e.push(`${n}${t}`))))),Le=Le.sort(((a,i)=>{const r=a[n][t],o=i[n][t];return e.indexOf(r)<e.indexOf(o)?-1:1})),Re===t?(Le.reverse(),Re=""):Re=t}else Re===t?(e.ctrlKey||e.metaKey||Ne.ctrlKey?Le.sort(((e,a)=>+a[n][t].replace(/\D+/gi,"")-+e[n][t].replace(/\D+/gi,""))):Le=i.includes(t)?Le.sort(((e,a)=>a[n][t].localeCompare(e[n][t]))):Le.sort(((e,a)=>a[n][t]-e[n][t])),Re=""):(e.ctrlKey||e.metaKey||Ne.ctrlKey?Le.sort(((e,a)=>+e[n][t].replace(/\D+/gi,"")-+a[n][t].replace(/\D+/gi,""))):Le=i.includes(t)?Le.sort(((e,a)=>e[n][t].localeCompare(a[n][t]))):Le.sort(((e,a)=>e[n][t]-a[n][t])),Re=t);!0===a&&"id"!==t&&Le.sort(((e,t)=>t.meta.checked-e.meta.checked)),e.skipRender||Pt()},Ct=(e,t)=>{const n=He(t);document.querySelector(".pop-up.show")||(X&&X.classList.remove("selected"),n.classList.add("selected"),Q=X,X=n,X.scrollIntoViewIfNeeded(!0),It())},xt=(e,t,n)=>{const a="number"==typeof e?Array.from(".".repeat(e)).map(((n,a)=>({startPoint:t.buffer.length/e*a,endPoint:t.buffer.length/e*(a+1)}))):e,i=document.getElementById("sliceLines"),r=document.querySelector("#splitOptions .waveform-container").dataset.waveformWidth;let o=[];if(t&&n){let e=t.buffer.length/r;o=n.slices.map(((n,a)=>`\n                <div\n                    class="line ${-1!==(n.loopPoint??-1)?"slice-loop":""} ${1===t.meta?.otLoop&&n.startPoint>=t.meta?.otLoopStart?"file-loop-on":""} ${2===t.meta?.otLoop&&n.startPoint>=t.meta?.otLoopStart?"file-loop-pp":""}"\n                    data-idx="${a}"\n                    onclick="digichain.sliceAction(event, '${t.meta.id}', {startPoint: '${n.startPoint}', endPoint: '${n.endPoint}'})"\n                    ondblclick="this.classList[this.classList.contains('fade') ? 'remove' : 'add']('fade')"\n                    title="${n.name||"Slice "+(a+1)}"\n                    style="margin-left:${n.startPoint/e}px; width:${n.endPoint/e-n.startPoint/e}px;"\n                ></div>\n            `))}else o=a.map(((e,n)=>`\n            <div class="line" data-idx="${n}" onpointerdown="digichain.playSlice(event, '${t.meta.id}', '${e.startPoint}', '${e.endPoint}')" ondblclick="this.classList[this.classList.contains('fade') ? 'remove' : 'add']('fade')"style="margin-left:${r/a.length*n}px; width:${r/a.length}px;" title="Slice ${n+1}"></div>\n        `));i.innerHTML=o.join("")},Et=(e,t,n,a)=>{const i=document.getElementById("splitOptions"),r=document.getElementById("splitFileName"),o=document.querySelector("#splitOptions .slice-group"),s=document.getElementById("sliceByOtButton"),l=document.getElementById("sliceByTransientButton");document.getElementById("transientThreshold");const c=document.querySelector("#splitOptions .waveform-container"),d=document.getElementById("splitPanelWaveform"),u=[...i.querySelectorAll("div.line.fade")].map((e=>+e.dataset.idx));let h,f,m=e.shiftKey||Ne.shiftKey;if((e.target.className.includes("is-")||e.target.parentElement.className.includes("is-"))&&(e.ctrlKey||e.metaKey||Ne.ctrlKey)){h=je(t||X.dataset.id);confirm(`Clear slice data for ${h.file.name}?`)&&(h.meta.slices=!1,h.meta.op1Json&&(h.meta.op1Json=!1),Oe.removeByName(h.file.name),Ot(h.meta.id))}else{if(t&&(X=He(t),o.dataset.id=t),!0===n&&(n=o.dataset.sliceCount),h=je(t||X.dataset.id),n){if(t=t||h.meta.id,"ot"!==n&&l.classList.contains("button-outline")&&s.classList.contains("button-outline"))h.meta.customSlices?vt(e,t,m,"custom",u,a):wt(e,t,n,m,u,a);else{const n=l.classList.contains("button-outline")?"ot":"transient";vt(e,t,m,n,u,a)}if(!a)return i.close();setTimeout((()=>s.dispatchEvent(new PointerEvent("pointerdown"))),250)}f=Oe.getByFile(h),r.textContent=R("",h,!0),s.style.display=f?"inline-block":"none",s.textContent=f?`${f.sliceCount}`:"OT",_t(0,0),i.open||i.showModal(),A(h,d,h.meta?.channel??0,{width:+c.dataset.waveformWidth,height:128}),h.meta.customSlices=!1,f?.sliceCount&&s.dispatchEvent(new PointerEvent("pointerdown")),Ot(h.meta.id)}},Lt=e=>{const t=Math.floor(e/60),n=Number(e%60).toFixed(2);return t>0?`${t}m ${Math.round(+n)}s`:`${n}s`},Dt=()=>{Ne.shiftKey=!1,Ne.ctrlKey=!1,document.body.classList.remove("shiftKey-down"),document.body.classList.remove("ctrlKey-down")},It=()=>{const e=Le.filter((e=>e.meta.checked)),t=e.length,n=Le.reduce(((e,t)=>e+ +t.meta.duration),0),a=e.reduce(((e,t)=>e+ +t.meta.duration),0),i=0===t?0:t>0&&Te>0?Math.ceil(t/Te):1;if(document.getElementById("fileNum").textContent=`${Le.length}/${t}`,document.querySelector(".selection-count").textContent=` ${t||"-"} `,document.querySelector(".selection-count").dataset.selectionCount=t,document.getElementById("lengthHeaderLink").textContent=`Length (${Lt(a)}/${Lt(n)})`,0===Ee){document.querySelectorAll(".join-count").forEach(((e,t)=>{e.textContent=` ${0===i?"-":i}${0===t?" Spaced":""}${1===i?" Chain":" Chains"}`,e.dataset.joinCount=i}));try{document.querySelectorAll("tr").forEach((e=>e.classList.remove("end-of-grid"))),document.querySelectorAll("tr.checked").forEach(((e,t)=>(t+1)%Te==0?e.classList.add("end-of-grid"):e.classList.remove("end-of-grid")))}catch(e){}}else{const t=(e,t=0)=>{let n={duration:0,processed:[],skipped:[],count:t},a=e.filter((e=>+e.meta.duration<Ee)),i="a"===ie?24:0===Te?64:Te;for(;a.length>0;)n=a.reduce(((e,t)=>(e.duration+ +t.meta.duration<=Ee*ce&&e.processed.length<i?(e.duration=e.duration+ +t.meta.duration,e.processed.push(t)):e.skipped.push(t),e)),n),n.count++,n.duration=0,n.processed=[],a=Array.from(n.skipped),n.skipped=[];return n.count};let n=0===e.length?0:t(e);document.querySelector(".join-count-chain").textContent=` ${0===n?"-":n}${1===n?" Chain":" Chains"}`,document.querySelector(".join-count-chain").dataset.joinCount=n;try{document.querySelectorAll("tr").forEach((e=>e.classList.remove("end-of-grid")))}catch(e){}}Dt()};function Ot(e){const t=je(e),n=He(e);n.innerHTML=Bt(t),n.querySelector("canvas.waveform").replaceWith(t.waveform)}const Bt=(e,t="main")=>"main"===t?`\n    <tr class="file-row ${e.meta.checked?"checked":""}" data-id="${e.meta.id}"\n          onpointerdown="digichain.handleRowClick(event, '${e.meta.id}')"\n          ondragstart="digichain.rowDragStart(event)" draggable="true">\n      <td>\n          <i class="gg-more-vertical"></i>\n      </td>\n      <td class="toggle-td">\n          <button onpointerdown="digichain.toggleCheck(event, '${e.meta.id}')" class="${e.meta.checked?"":"button-outline"} check toggle-check">&nbsp;</button>\n      </td>\n      <td class="move-up-td">\n          <button title="Move up in sample list." onclick="digichain.move(event, '${e.meta.id}', -1)" class="button-clear move-up"><i class="gg-chevron-up-r has-shift-mod-i"></i></button>\n      </td>\n      <td class="move-down-td">\n          <button title="Move down in sample list." onclick="digichain.move(event, '${e.meta.id}', 1)" class="button-clear move-down"><i class="gg-chevron-down-r has-shift-mod-i"></i></button>\n      </td>\n      <td class="waveform-td">`+(e=>_e?`<i onpointerdown="digichain.playFile(event, '${e.meta.id}')" class="gg-play-button waveform-btn ${e.meta.playing?"playing":""}"></i>`:`<canvas onpointerdown="digichain.playFile(event, '${e.meta.id}')" class="waveform waveform-${e.meta.id} ${e.meta.playing?"playing":""}"></canvas>`)(e)+`</td>\n      <td class="file-path-td">\n      ${(e.file.path+e.file.name).length+4>127?'<div title="This files path and name will exceed 127 chars." class="path-exceeds-127">':"<div>"}\n          <span class="file-path">${e.file.path}</span>\n          <a title="${xe?"Shift+Click to d":"D"}ownload processed wav file of sample." class="wav-link" onclick="digichain.downloadFile('${e.meta.id}', true, event)">${R(e.file.name)}</a>\n          ${e.meta.dupeOf?" d":""}\n          ${e.meta.editOf?" e":""}\n          ${e.meta.isMerge?" m":""}\n          ${e.meta.sliceNumber?" s"+e.meta.sliceNumber:""}\n          <a class="wav-link-hidden" target="_blank"></a>\n          <a class="meta-link-hidden" target="_blank"></a>\n          </div>\n      </td>\n      <td class="duration-td">\n          <span>${e.meta.duration} s</span>\n      </td>\n      <td class="channel-options-td">\n          <div class="channel-options has-shift-mod" style="display: ${e.buffer.numberOfChannels>1&&1===ae?"block":"none"}">\n          <a title="Left channel" onclick="digichain.changeChannel(event, '${e.meta.id}', 'L')" class="${"L"===e.meta.channel?"selected":""} channel-option-L">L</a>\n          <a title="Sum to mono" onclick="digichain.changeChannel(event, '${e.meta.id}', 'S')" class="${"S"===e.meta.channel?"selected":""} channel-option-S">S</a>\n          <a title="Right channel" onclick="digichain.changeChannel(event, '${e.meta.id}', 'R')" class="${"R"===e.meta.channel?"selected":""} channel-option-R">R</a>\n          <a title="Difference between Left and Right channels" onclick="digichain.changeChannel(event, '${e.meta.id}', 'D')" class="${"D"===e.meta.channel?"selected":""} channel-option-D">D</a>\n          </div>`+("a"===ie?`<div class="channel-options channel-options-stereo channel-options-stereo-opf ${e.meta.opPanAb?"op-pan-ab-true":""}" title="${1===e.buffer.numberOfChannels?"Mono sample":"Stereo sample"}" style="display: ${2===ae?"block":"none"}"\n           ondblclick="digichain.changeOpParam(event, '${e.meta.id}', 'baltoggle')"\n           >\n              <input class="channel-balance" type="range" style="display: ${2===e.buffer.numberOfChannels?"inline-block":"none"}" min="0" max="32768" onchange="digichain.changeOpParam(event, '${e.meta.id}', 'bal')" value="${e.meta.opPan??16384}" />\n              <i class="gg-shape-circle" style="display: ${1===e.buffer.numberOfChannels?"inline-block":"none"}"></i>\n              <div style="display: ${2===e.buffer.numberOfChannels?"inline-block":"none"}">\n                <span class="op-la"></span>\n                <span class="op-rb"></span>\n              </div>\n          </div>`:`<div class="channel-options channel-options-stereo" title="${1===e.buffer.numberOfChannels?"Mono sample":"Stereo sample"+(e.meta.dualMono?" (Dual Mono)":"")}" style="display: ${2===ae?"block":"none"}">\n              <i class="gg-shape-circle"></i>\n              <i class="gg-shape-circle stereo-circle" style="display: ${2===e.buffer.numberOfChannels?"inline-block":"none"}"></i>\n          </div>`)+`</td>\n      <td class="split-td">\n          <button title="Slice sample." onpointerdown="digichain.splitAction(event, '${e.meta.id}')" class="button-clear split gg-menu-grid-r ${Oe.getByFile(e)?.cssClass}" data-slice-count="${e.meta?.slices?.length||e.meta?.op1Json?.sliceCount||""}"><i class="gg-menu-grid-r has-ctrl-mod-i"></i></button>\n      </td>\n      <td class="duplicate-td">\n          <button title="Duplicate sample." onpointerdown="digichain.duplicate(event, '${e.meta.id}')" class="button-clear duplicate"><i class="gg-duplicate has-shift-mod-i"></i></button>\n      </td>\n      <td class="toggle-edit-td">\n          <button title="Edit" onpointerdown="digichain.showEditPanel(event, '${e.meta.id}')" class="button-clear toggle-edit"><i class="gg-pen"></i></button>\n      </td>\n      <td class="remove-td">\n          <button title="Remove sample (double-click)." ondblclick="digichain.remove('${e.meta.id}')" class="button-clear remove"><i class="gg-trash"></i></button>\n      </td>\n    </tr>`:`\n<tr class="file-row" data-id="${e.meta.id}">\n  <td class="file-path-td">\n    <span class="file-path">${e.file.path}</span>\n    <span>${R(e.file.name)}</span>\n    ${e.meta.dupeOf?" d":""}\n    ${e.meta.editOf?" e":""}\n    ${e.meta.isMerge?" m":""}\n    ${e.meta.sliceNumber?" s"+e.meta.sliceNumber:""}\n    <a class="wav-link-hidden" target="_blank"></a>\n  </td>\n  <td class="duration-td">\n    <span>${e.meta.duration} s</span>\n  </td>\n  <td class="channel-options-td"">\n      <div class="channel-options" style="display: ${e.buffer.numberOfChannels>1?"block":"none"}">\n      <a title="Left channel" onclick="digichain.changeChannel(event, '${e.meta.id}', 'L', false, '#mergeList')" class="${"L"===e.meta.channel?"selected":""} channel-option-L">L</a>\n      <a title="Sum to mono" onclick="digichain.changeChannel(event, '${e.meta.id}', 'S', false, '#mergeList')" class="${"S"===e.meta.channel?"selected":""} channel-option-S">S</a>\n      <a title="Right channel" onclick="digichain.changeChannel(event, '${e.meta.id}', 'R', false, '#mergeList')" class="${"R"===e.meta.channel?"selected":""} channel-option-R">R</a>\n      <a title="Difference between Left and Right channels" onclick="digichain.changeChannel(event, '${e.meta.id}', 'D', false, '#mergeList')" class="${"D"===e.meta.channel?"selected":""} channel-option-D">D</a>\n      </div>\n      <div class="channel-options channel-options-stereo" title="Mono sample" style="display: ${1===e.buffer.numberOfChannels?"block":"none"}">\n          <i class="gg-shape-circle"></i>\n      </div>\n  </td>\n  <td class="pan-options-td ${"blend"===t?"hide":""}">\n      <div class="pan-options" style="display: block;">\n      <a title="Hard Left" onclick="digichain.changePan(event, '${e.meta.id}', 'L')" class="${"L"===e.meta.pan?"selected":""} pan-option-L">L</a>\n      <a title="Centre" onclick="digichain.changePan(event, '${e.meta.id}', 'C')" class="${"C"===e.meta.pan?"selected":""} pan-option-C">C</a>\n      <a title="Hard Right" onclick="digichain.changePan(event, '${e.meta.id}', 'R')" class="${"R"===e.meta.pan?"selected":""} pan-option-R">R</a>\n      </div>\n  </td>\n</tr>`,At=e=>{const t=document.querySelectorAll(".waveform");if(0===t.length)return document.querySelectorAll(".waveform-btn").forEach(((t,n)=>{e[n]&&!e[n].waveform&&(e[n].waveform=t)})),It();t.forEach(((t,n)=>{e[n]&&(e[n].waveform?(t.replaceWith(e[n].waveform),e[n].playHead&&!e[n].waveform.nextElementSibling&&e[n].waveform.parentElement.appendChild(e[n].playHead)):(A(e[n],t,ae>1&&e[n].buffer.numberOfChannels>1?"S":e[n].meta?.channel??0),e[n].waveform=t))})),It()},Rt=(e,t)=>{const n=e||je(X.dataset.id);(e?He(e.meta.id):X).innerHTML=Bt(n,t),At(Le),document.body.classList.remove("loading")},Pt=(e=!1)=>{j.innerHTML=$e?Le.map((e=>Bt(e))).join(""):'<tr><td colspan="14" style="padding: 2.5rem 1rem 0 4rem;"><p>Hiding samples list, press <code>Shift + L</code> to show.</p></td></tr>',0===Le.length&&(j.innerHTML=""),document.body.classList.remove("loading"),At(Le),Le.length&&!e&&jt()},Ft=(e,t,n)=>((127&e)<<7<<7)+((127&t)<<7)+(127&n);function Tt(e){const t=e.match(/(_| |-)([A-Ga-g](?:#|b)?)(-?\d+)\.\w+$/);return t&&t.length>2?(t[1]+t[2]+(t[3]||"")).replace(/_|-|\./g,"").trim():""}async function zt(e,t,n,a,i){if(function(e=!1){return(be||e)&&44100===te&&"w"===ie}(i)&&e&&e.length>0){let i=t.buffer.length;const r=await u(t.buffer,n);let o=function(e,t,n=120,a={}){const i=new DataView(new ArrayBuffer(832)),r=6*n*4,o=t,s=+(o/44100/(60/n*4)).toFixed(2),l=+((o-(a.loopStart??0))/44100/(60/n*4)).toFixed(2);[70,79,82,77,0,0,0,0,68,80,83,49,83,77,80,65,0,0,0,0,0,2,0].forEach(((e,t)=>i.setUint8(t,e))),i.setUint32(23,r),i.setUint32(27,100*s),i.setUint32(31,100*l),i.setUint32(35,a.stretch??0),i.setUint32(39,a.loop??0),i.setUint16(43,48),i.setUint8(45,255),i.setUint32(46,0),i.setUint32(50,o),i.setUint32(54,a.loopStart??0);let c=58;for(let t=0;t<64;t++)i.setUint32(c,e[t]?.s??0),i.setUint32(c+4,e[t]?.e??0),i.setUint32(c+8,e[t]?.l??-1),c+=12;i.setUint32(826,e.length);let d=0;for(let e=16;e<i.byteLength;e++)d+=i.getUint8(e);return i.setUint16(830,d),i}(e.length>64?e.slice(0,64):e,i,r?.match??120,{loop:t.meta.otLoop??0,loopStart:t.meta.otLoopStart??0}),s=n.replace(/\.[^.]*$/,".ot");if(!o)return!1;let l=new window.Blob([o],{type:"application/octet-stream"});return a&&(a.href=URL.createObjectURL(l),a.setAttribute("download",s)),{blob:l,name:s}}return!1}const $t=(e,t,n,a="",i=!1,r=!0)=>{const o=n.uuid||crypto.randomUUID();let s=!1;try{let e=new DataView(t);for(let a=0;a<e.byteLength-4;a++){const i=String.fromCharCode(e.getUint8(a),e.getUint8(a+1),e.getUint8(a+2),e.getUint8(a+3));if("data"===i){const t=e.getUint32(a+4,!0);if(t&&t<e.byteLength){a=a<t?t-8:a;continue}}if("DCSD"===i||"LIST"===i){const n=e.getUint32(a+4,!0),r=new TextDecoder("utf-8");let o="";if("LIST"===i){"ISBJ"===String.fromCharCode(e.getUint8(a+8),e.getUint8(a+9),e.getUint8(a+10),e.getUint8(a+11))&&(o=atob(r.decode(t.slice(a+12,a+8+n))))}o=o||r.decode(t.slice(a+8,a+8+n));try{const e=JSON.parse(o.trimEnd());s=e.sr!==ee?e.dcs.map((t=>({s:Math.round(t.s/e.sr*ee),e:Math.round(t.e/e.sr*ee),l:Math.round((t.l||-1)/e.sr*ee),n:t.n}))):e.dcs}catch(e){}}if("cue "===i){e.getUint32(a+4,!0);const t=e.getUint32(a+8,!0);a+=12;const n=e.getUint32(24,!0),i=[];for(let n=0;n<t;n++){const t=e.getUint32(a,!0),n=e.getUint32(a+20,!0);i.push({cueId:t,cuePos:n}),a+=24}s=s||[],i.forEach(((e,t)=>s.push({s:Math.round(e.cuePos/n*ee),e:Math.round((t!==i.length-1?i[t+1].cuePos:-1)/n*ee),l:-1,n:`Cue ${e.cueId+1}`})))}if("ORSL"===i){e.getUint32(a+4);const t=e.getUint8(a+8);a+=12;const i=[];for(let n=0;n<t;n++){const t=e.getUint8(a),n=e.getUint32(a+4,!0),r=e.getUint32(a+8,!0);i.push({sliceId:t,sliceStart:n,sliceEnd:r}),a+=32}s=[],i.forEach((e=>s.push({s:Math.round(e.sliceStart/n.sampleRate*ee),e:Math.round(e.sliceEnd/n.sampleRate*ee),l:-1,n:`Slice ${e.sliceId+1}`})))}}}catch(e){s=!1}try{let t;if(n.sampleRate&&n.sampleRate!==ee){let a,i;a=new d(n.sampleRate,ee,1,e.getChannelData(0)),a.resampler(a.inputBuffer.length),2===n.channels&&(i=new d(n.sampleRate,ee,1,e.getChannelData(1)),i.resampler(i.inputBuffer.length)),t=Y.createBuffer(n.channels,a.outputBuffer.length,ee),t.copyToChannel(a.outputBuffer,0),2===n.channels&&t.copyToChannel(i.outputBuffer,1)}if(Array.isArray(s)){s.forEach((n=>n.e=-1===n.e?(t||e).length:n.e));const n=[];s.forEach((e=>!(n.findIndex((t=>t.s===e.s))>-1)&&n.push(e))),s=n}const l=Oe.getByFileName(n.name);let c=0,u=0;return l&&l.slices&&l.slices.length>0&&(s=n.name.endsWith(".flac")?l.slices.map(((n,a)=>({s:n.startPoint/l.loopEnd*(t||e).length,e:n.endPoint/l.loopEnd*(t||e).length,l:n.loopPoint}))):l.slices.map(((e,t)=>({s:e.startPoint,e:e.endPoint,l:e.loopPoint,n:e.name||`OT slice ${t+1}`}))),c=l.otLoop,u=l.otLoopStart,Oe.removeByName(n.name)),Array.isArray(s)&&(s=s.filter((e=>e.s<e.e))),Le[i?"unshift":"push"]({file:{lastModified:n.lastModified,name:P(Le,n.name),filename:n.name,path:a.replace(n.name,""),size:n.size,type:n.type},buffer:t||e,meta:{sourceBitDepth:n.bitDepth,sourceSampleRate:n.sampleRate,length:(t||e).length,duration:Number((t||e).length/ee).toFixed(3),startFrame:0,endFrame:(t||e).length,checked:r,id:o,channel:(t||e).numberOfChannels>1?"L":"",dualMono:!1,slices:s.length>0&&s,otLoop:c,otLoopStart:u,opPan:16384,opPanAb:!1,opPitch:0,note:Tt(n.name)}}),De.push(o),o}catch(e){return console.log(e),{uuid:o,failed:!0}}},Nt=(e,t)=>{e=e.filter((e=>!1!==e)),Ie=[...new Set(Ie)],e.every((e=>De.includes(e)))?(St({skipRender:!0},"id"),Pt()):setTimeout((()=>Nt(e)),1e3)},Mt=(e,t)=>{let n=e/t*100;document.getElementById("loadingText").style.backgroundImage=`linear-gradient(90deg, #cf8600 ${n}%, #606c76 ${n+1}%, #606c76 100%)`},Ut=(e,t)=>{const n=document.getElementById("loadingText");n.textContent="Loading samples",document.body.classList.add("loading"),Me();if(Ke())return;t=[...t];let a=[...t].filter((e=>["zip","dtprj","xrns"].includes(e?.name?.split(".")?.reverse()[0].toLowerCase())));if(a.length>0)return void a.forEach(((i,r)=>{const o=new JSZip;let s=1;t[t.findIndex((e=>e===i))]=!1,o.loadAsync(i).then((()=>{const l=Object.keys(o.files).length,c=we&&Object.keys(o.files).filter((e=>H.includes(e.split(".").at(-1).toLowerCase()))).length;if(c+Le.length>J)return n.textContent=`skipping zip '${i.name}', files (${c}) will exceed 750 file import limit...`,void(r===a.length-1&&setTimeout((()=>Ut(e,t)),3e3));for(let n in o.files)o.files[n].async("blob").then((o=>{o.name=n.split("/").at(-1),o.fullPath=`${i.name}/${n}`,o.fromArchive=i.name,t.push(o),o.uuid=crypto.randomUUID(),H.some((e=>o.name.toLowerCase().endsWith(e)))&&Ie.push(o.uuid),r===a.length-1&&s===l&&Ut(e,t),s++}))}))}));let i=[...t].filter((e=>H.includes(e?.name?.split(".")?.reverse()[0].toLowerCase()))),r=[...t].filter((e=>["ot","xml"].includes(e?.name?.split(".")?.reverse()[0].toLowerCase())));var s;if((e.shiftKey||Ne.shiftKey)&&(s=i,i=[...s].sort((e=>crypto.randomUUID().localeCompare(crypto.randomUUID()))).filter(((e,t)=>t<(Te>0?Te:256)||e.fromArchive))),we&&i.length>J&&(i=i.filter(((e,t)=>t<J||e.fromArchive))),r.forEach(((e,t)=>{const n=new FileReader;n.onload=function(t){if(e.uuid=crypto.randomUUID(),e.fullPath=e.fullPath||"",e.name.toLowerCase().endsWith(".ot")){const n=t.target.result,a=n.byteLength;((e,t,n)=>{const a=t.uuid||crypto.randomUUID(),i=e=>{const t=new Uint8Array(e);return new DataView(t.buffer).getInt32(0)};try{if(![70,79,82,77,0,0,0,0,68,80,83,49,83,77,80,65].every(((t,n)=>t===e[n])))return{uuid:a,failed:!0};let r=i([e[39],e[40],e[41],e[42]]),o=i([e[54],e[55],e[56],e[57]]),s=[],l=i([e[826],e[827],e[828],e[829]]),c=58;for(let t=0;t<l;t++)44100===ee?s.push({startPoint:i([e[c],e[c+1],e[c+2],e[c+3]]),endPoint:i([e[c+4],e[c+5],e[c+6],e[c+7]]),loopPoint:i([e[c+8],e[c+9],e[c+10],e[c+11]])}):s.push({startPoint:Math.round(i([e[c],e[c+1],e[c+2],e[c+3]])/44100*ee),endPoint:Math.round(i([e[c+4],e[c+5],e[c+6],e[c+7]])/44100*ee),loopPoint:Math.round(i([e[c+8],e[c+9],e[c+10],e[c+11]])/44100*ee)}),c+=12;return Oe.push({uuid:a,name:t.name,path:n,cssClass:"is-ot-file",otLoop:r,otLoopStart:o,sliceCount:l,slices:s}),De.push(a),a}catch(e){return{uuid:a,failed:!0}}})(new Uint8Array(n,0,a),e,e.fullPath)}if(e.name.toLowerCase().endsWith(".xml")){((e,t)=>{let n=crypto.randomUUID();try{const a=(new DOMParser).parseFromString(e,"application/xml");if("RenoiseSong"===a.childNodes[0].tagName){const e=t.replace("Song.xml","");[...a.getElementsByTagName("Sample")].map((e=>({uuid:crypto.randomUUID(),name:e.getElementsByTagName("Name")[0].textContent,loopEnd:+e.getElementsByTagName("DisplayLength")[0].textContent,slices:[...e.getElementsByTagName("SliceMarker")].map((e=>+e.getElementsByTagName("SamplePosition")[0].textContent))}))).filter((e=>e.slices.length>0)).forEach((t=>{n=t.uuid,Oe.push({uuid:n,name:t.name,path:e,sliceCount:t.slices.length,loopEnd:t.loopEnd,slices:t.slices.map(((e,n,a)=>({startPoint:e,endPoint:a[n+1]??t.loopEnd,loopPoint:-1})))}),De.push(n)}))}return n}catch(e){return{uuid:n,failed:!0}}})(t.target.result,e.fullPath)}},e.name.toLowerCase().endsWith(".ot")?n.readAsArrayBuffer(e):n.readAsText(e)})),0===i.length)return Pt();const l=(e,t)=>{c.every((e=>De.includes(e)))&&setTimeout((()=>Nt(c)),1e3)};let c=[],u={encountered:!1,text:"",count:0};i.forEach(((e,t)=>{const n=new FileReader;n.onload=async function(n){try{e.uuid=e.uuid||crypto.randomUUID(),H.some((t=>e.name.toLowerCase().endsWith(t)))&&Ie.push(e.uuid),e.fullPath=e.fullPath||"";const a=n.target.result;if(e.name.toLowerCase().endsWith(".syx")||e.name.toLowerCase().endsWith(".aif")||e.name.toLowerCase().endsWith(".pti")){const n=a.byteLength,r=new Uint8Array(a,0,n);let s;c.push(e.uuid),e.name.toLowerCase().endsWith(".aif")&&(s=await(async(e,t,n,a="",i=!1)=>{const r=n.uuid||crypto.randomUUID();try{let t=new DataView(e),s={},l=["FORM","COMM","APPL","SSND"];const c=(n,a)=>{switch(n){case"FORM":s.form={offset:a,id:String.fromCharCode(t.getUint8(a),t.getUint8(a+1),t.getUint8(a+2),t.getUint8(a+3)),fileSize:t.getUint32(a+4),type:String.fromCharCode(t.getUint8(a+8),t.getUint8(a+9),t.getUint8(a+10),t.getUint8(a+11))};break;case"COMM":s.comm={offset:a,id:String.fromCharCode(t.getUint8(a),t.getUint8(a+1),t.getUint8(a+2),t.getUint8(a+3)),size:t.getUint32(a+4),channels:t.getUint16(a+8),frames:t.getUint32(a+10),bitDepth:t.getUint16(a+14),sampleRate:(e=>{const n=[];for(let a=e;a<e+10;a++)n.push(t.getUint8(a));return o(n)})(a+16)};break;case"APPL":const n=new TextDecoder("utf-8");let i=2===s.comm.channels?2434:4058;s.json={id:String.fromCharCode(t.getUint8(a),t.getUint8(a+1),t.getUint8(a+2),t.getUint8(a+3)),size:t.getUint32(a+4),scale:i};let r=n.decode(e.slice(a+12,s.json.size+a+8));s.json.data=JSON.parse(r.replace(/\]\}(.|\n)+/gi,"]}").trimEnd());break;case"SSND":s.buffer=e.slice(a+4),s.bufferDv=new DataView(s.buffer)}};for(let e=0;e<t.byteLength-4;e++){const n=String.fromCharCode(t.getUint8(e),t.getUint8(e+1),t.getUint8(e+2),t.getUint8(e+3));l.includes(n)&&(c(n,e),l=l.filter((e=>e!==n)))}if(16!=+s.comm.bitDepth)return document.getElementById("loadingText").textContent=`Skipping unsupported ${s.comm.bitDepth}bit aif file '${n.name}'...`,delete s.buffer,delete s.bufferDv,t=!1,e=!1,{uuid:r,failed:!0};const u=4,h=s.comm.bitDepth/8,f=[];for(let e=0;e<s.comm.channels;e++)f.push(new Float32Array(s.comm.frames));for(let e=0;e<s.comm.channels;e++){let t=f[e];for(let n=0;n<s.comm.frames;n++){let a=u;a+=(n*s.comm.channels+e)*h;let i=s.bufferDv.getInt16(a,"AIFC"===s.form.type),r=1<<s.comm.bitDepth-1;i>=r&&(i|=~(r-1)),t[n]=i/r,0===n&&(t[n]=0)}}let m,p;m=new d(s.comm.sampleRate,ee,1,f[0]),m.resampler(m.inputBuffer.length),2===s.comm.channels&&(p=new d(s.comm.sampleRate,ee,1,f[1]),p.resampler(p.inputBuffer.length));const g=Y.createBuffer(s.comm.channels,m.outputBuffer.length,ee);if(2===s.comm.channels)for(let e=0;e<m.outputBuffer.length;e++)g.getChannelData(0)[e]=m.outputBuffer[e],g.getChannelData(1)[e]=p.outputBuffer[e];else for(let e=0;e<m.outputBuffer.length;e++)g.getChannelData(0)[e]=m.outputBuffer[e];const b=(e,t)=>e/s.json.scale-13*t;s.json&&s.json.data.start&&(s.json.data.start=s.json.data.start.map(((e,t)=>Math.floor(b(e,t)/44100*ee)))),s.json&&s.json.data.end&&(s.json.data.end=s.json.data.end.map(((e,t)=>Math.floor(b(e,t)/44100*ee))));const y={file:{lastModified:n.lastModified,name:P(Le,n.name),filename:n.name,path:a.replace(n.name,""),size:n.size,type:n.type},buffer:g,meta:{length:g.length,duration:Number(g.length/ee).toFixed(3),startFrame:0,endFrame:g.length,op1Json:!!s.json&&s.json.data,channel:g.numberOfChannels>1?"L":"",checked:!0,id:r,slices:!1,note:Tt(n.name)}},v=Oe.getByFile(y);return v&&y.meta.op1Json&&(y.meta.op1Json.sliceCount=v.sliceCount),Le[i?"unshift":"push"](y),De.push(r),r}catch(e){return{uuid:r,failed:!0}}})(a,0,e,e.fullPath)),e.name.toLowerCase().endsWith(".syx")&&(s=((e,t,n="",a=!1)=>{const i=t.uuid||crypto.randomUUID();try{if(240!==e[0]||126!==e[1]||1!==e[3]||247!==e[20])return{uuid:i,failed:!0};const r=e[6],o=10*Math.ceil(1e8/Ft(e[9],e[8],e[7])),s=Ft(e[12],e[11],e[10]);let l=Ft(e[15],e[14],e[13]),c=Ft(e[18],e[17],e[16])+1;const u=e[19];if(127===u&&(l=c=s),o<4e3||o>96e3)return!1;if(16!==r)return!1;let h=e.findIndex(((t,n)=>240===t&&126===e[n+1]&&2===e[n+3]&&247===e[n+126])),f=0,m=[];for(;f<s;){for(let t=h+5;t<h+125&&f<s;t+=3)m[f++]=(e[t]<<9|e[t+1]<<2|e[t+2]>>5)-32768;h+=127}const p=new d(o,ee,1,m.filter((e=>void 0!==e)));p.resampler(p.inputBuffer.length);const g=Y.createBuffer(1,p.outputBuffer.length-p.outputBuffer.length/120*5,ee);return p.outputBuffer.filter((e=>void 0!==e)).forEach(((e,t)=>g.getChannelData(0)[t]=e/32767)),Le[a?"unshift":"push"]({file:{lastModified:t.lastModified,name:P(Le,t.name),filename:t.name,path:n.replace(t.name,""),size:t.size,type:t.type},buffer:g,meta:{length:p.outputBuffer.length,loopStart:l,loopEnd:c,loopType:u,duration:Number(p.outputBuffer.length/ee).toFixed(3),startFrame:0,endFrame:p.outputBuffer.length,checked:!0,id:i,slices:!1,note:Tt(t.name)}}),De.push(i),i}catch(e){return{uuid:i,failed:!0}}})(r,e,e.fullPath)),e.name.toLowerCase().endsWith(".pti")&&(s=await(async(e,t,n,a="")=>{const i=n.uuid||crypto.randomUUID();try{const r=(44100!==ee?new AudioContext({sampleRate:44100,latencyHint:"interactive"}):Y).createBuffer(1,t.length-4,44100);for(let e=0;e<t.length-4;e++){const n=t[e]/32768;r.getChannelData(0)[e]=n<0?Math.max(-1,n):Math.min(n,1)}let o;if(44100!==ee){let e;e=new d(44100,ee,1,r.getChannelData(0)),e.resampler(e.inputBuffer.length);const t=Y.createBuffer(1,e.outputBuffer.length,ee);for(let n=0;n<e.outputBuffer.length;n++)t.getChannelData(0)[n]=e.outputBuffer[n]}let s=new DataView(e);const l=s.getUint8(376);let c=[];for(let e=280;e<280+2*l;e+=2)c.push(s.getUint16(e,!0));c=c.map((e=>e/65535*(o||r).length)),c=c.map(((e,t)=>({s:e,e:t!==l-1?c[t+1]:(o||r).length,l:-1,n:`Slice ${t+1}`})));const u={file:{lastModified:n.lastModified,name:P(Le,n.name),filename:n.name,path:a.replace(n.name,""),size:n.size,type:n.type},buffer:o||r,meta:{length:(o||r).length,duration:Number((o||r).length/ee).toFixed(3),startFrame:0,endFrame:(o||r).length,channel:(o||r).numberOfChannels>1?"L":"",checked:!0,id:i,slices:c.length>1&&c,note:Tt(n.name)}};return Le.push(u),De.push(i),i}catch(e){return{uuid:i,failed:!0}}})(a,new Int16Array(a,392),e,e.fullPath)),s.failed&&c.splice(c.findIndex((e=>e===s.uuid)),1),Mt(t+1,i.length),l(0,i.length)}if(e.name.toLowerCase().endsWith(".wav")||"audio/wav"===e.type||e.name.toLowerCase().endsWith(".flac")||e.name.toLowerCase().endsWith(".webm")||e.name.toLowerCase().endsWith(".m4a")||e.name.toLowerCase().endsWith(".mp3")){c.push(e.uuid);const n=a.slice(0);if(e.name.toLowerCase().endsWith(".wav")||"audio/wav"===e.type){let t=new DataView(a);for(let n=0;n<t.byteLength-4;n++){const a=String.fromCharCode(t.getUint8(n),t.getUint8(n+1),t.getUint8(n+2),t.getUint8(n+3));if(n>t.byteLength||"PAD "===a)break;if("fmt "===a){if(e.channels=t.getUint16(n+10,!0),e.sampleRate=t.getUint32(n+12,!0),e.bitDepth=t.getUint16(n+22,!0),!(e.channels<1||0===e.sampleRate||e.bitDepth>32))break;delete e.channels,delete e.sampleRate,delete e.bitDepth}}}await(ee!==e.sampleRate?new AudioContext({sampleRate:e.sampleRate,latencyHint:"interactive"}):Y).decodeAudioData(a,(a=>{let r=$t(a,n,e,e.fullPath);r.failed&&c.splice(c.findIndex((e=>e===r.uuid)),1),Mt(t+1,i.length),l(0,i.length)}),(n=>{c.splice(c.findIndex((t=>t===e.uuid)),1),Mt(t+1,i.length),l(0,i.length)}))}}catch(n){u.encountered=!0,u.count++,e.fromArchive&&(u.text="There was an error extracting files from the zip archive, not all zip files are readable.\n\n            Please use store or deflate compression methods, and generate files with either 7zip as zip, or Windows Explorer."),u.encountered&&u.text&&t===i.length-1&&alert(u.text+` (failed: ${u.count})`)}},n.readAsArrayBuffer(e)})),digichain.importInt&&clearInterval(digichain.importInt),digichain.importInt=setInterval((()=>{document.body.classList.contains("loading")||(i.forEach(((e,t)=>delete i[t])),i=[],r=[],c=[],clearInterval(digichain.importInt))}),1e4)},Kt=e=>{if(e.preventDefault(),Me(),e?.dataTransfer?.items?.length&&"string"===e?.dataTransfer?.items[0].kind)try{return void e?.dataTransfer?.items[0].getAsString((async e=>{let t=await fetch(e);if(!t.url.includes(".wav"))return;let n=await t.arrayBuffer();const a=n.slice(0);await Y.decodeAudioData(n,(e=>$t(e,a,{lastModified:(new Date).getTime(),name:t.url.split("/").reverse()[0],size:ne*ee*(n.length/ee)/8*n.numberOfChannels/1024,type:"audio/wav"},"",!0))),Pt()}))}catch(e){}if(e?.dataTransfer?.items?.length){let t=[],n=e.dataTransfer.items.length;t.count=0;const a=e=>{if(e.isFile)e.file((n=>{n.fullPath=e.fullPath.replace("/",""),n.uuid=crypto.randomUUID(),H.some((e=>n.name.toLowerCase().endsWith(e)))&&Ie.push(n.uuid),t.push(n)})),t.count++,n--;else if(e.isDirectory){e.createReader().readEntries((e=>{n+=e.length;for(const t of e)a(t);n--}))}};for(const t of e.dataTransfer.items){const e=t.getAtEntry?t.getAtEntry():t.webkitGetAsEntry();e&&a(e)}let i=setInterval((()=>{n<=0&&t.count===t.length&&(clearInterval(i),Ut(e,t))}),500)}else{let t=e.target;if(document.getElementById("opExportPanel").classList.contains("show"))return;for(;t&&!t.classList.contains("file-row");)t=t.parentElement||document.body,t="THEAD"===t.nodeName?document.querySelector("tr.file-row"):t,t=t===document.body?document.querySelector("tr.file-row:last-of-type"):t;if(t){let e=qe(X.dataset.id),n=qe(t.dataset.id),a=Le.splice(e,1)[0];Le.splice(n,0,a),0===n?t.before(X):t.after(X)}}};function Wt(e=!1){le&&(V=indexedDB.open("digichain",1),V.onsuccess=()=>{G=V.result,Me(),e||(document.body.classList.add("loading"),function(e=!1){if(!le)return;const t=G.transaction(["state"],"readonly").objectStore("state");let n=t.get("unsorted"),a=t.get("importOrder");n.onsuccess=()=>{n.result&&(De=n.result)},a.onsuccess=()=>{a.result&&(Ie=a.result)};let i=t.get("files");i.onsuccess=()=>{if(i.result&&i.result.length>0){if(!e){if(!confirm(`There are ${i.result.length} files from your last session, would you like to restore them?`))return qt(),void document.body.classList.remove("loading")}Le=i.result.map((e=>We(e))),Pt(!0)}else document.body.classList.remove("loading")}}())},V.onupgradeneeded=e=>{G=e.target.result,G.createObjectStore("state")})}function jt(){if(!le)return new Promise((e=>e(!0)));const e=G.transaction(["state"],"readwrite",{durability:"relaxed"}).objectStore("state");return Ie=Ie.filter((e=>De.includes(e))),e.put(De,"unsorted"),e.put(Ie,"importOrder"),new Promise((t=>{e.put(Le.map((e=>(e===Le.at(-1)&&setTimeout((()=>t(!0)),2e3),{file:e.file,meta:e.meta,buffer:{duration:e.buffer.duration,length:e.buffer.length,numberOfChannels:e.buffer.numberOfChannels,sampleRate:e.buffer.sampleRate,channel0:e.buffer.getChannelData(0),channel1:e.buffer.numberOfChannels>1&&e.buffer.getChannelData(1)}}))),"files")}))}function qt(){G.transaction(["state"],"readwrite",{durability:"relaxed"}).objectStore("state").clear()}"launchQueue"in window&&window.launchQueue.setConsumer((e=>{e.files&&e.files.length&&Ut({},e.files)}));try{(()=>{try{const e=navigator.userAgent.match(/\d+\.\d+\.\d+\.\d+/);if(e&&e[0]&&+e[0].split(".")[0]<114)return alert("Chromium browser versions below 114.x.x are not supported.");const t=navigator.userAgent.match(/Version\/\d+\.\d+\.\d+/);if(t&&t[0]&&+t[0].match(/\d+\.\d+/)<16.3)return alert("Safari browser versions below 16.3 are not supported.");const n=navigator.userAgent.match(/Firefox\/\d+\.\d+/);if(n&&n[0]&&+n[0].match(/\d+\.\d+/)<115)return alert("Firefox browser versions below 115.x are not supported.")}catch(e){}})(),W.addEventListener("change",(()=>Ut({shiftKey:Ne.shiftKey},W.files)),!1),W.addEventListener("click",(e=>{(e.ctrlKey||e.metaKey||Ne.ctrlKey)&&(e.preventDefault(),e.stopPropagation(),(()=>{const e=crypto.randomUUID();Me();const t=Y.createBuffer(ae,8,ee);for(let e=0;e<ae;e++)for(let n=0;n<t.length;n++)t.getChannelData(e)[n]=0;const n=X?qe(X.dataset.id)+1:Le.length;Le.splice(n,0,{file:{lastModified:Date.now(),name:P(Le,"blank.wav"),filename:"blank.wav",path:"",size:0},buffer:t,meta:{length:t.length,duration:Number(t.length/ee).toFixed(3),startFrame:0,endFrame:t.length,checked:!0,id:e,channel:t.numberOfChannels>1?"L":"",dualMono:!1,slices:!1,note:""}}),De.push(e),Pt()})())}),!1),document.body.addEventListener("dragover",(e=>{e.preventDefault()}),!1),document.body.addEventListener("drop",Kt,!1),document.body.addEventListener("keyup",(e=>{Dt()})),document.body.addEventListener("keydown",(e=>{const t=["Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0"],n=["ArrowDown","ArrowUp","Escape","Enter","KeyD","KeyE","KeyG","KeyH","KeyI","KeyL","KeyP","KeyR","KeyS","KeyX",...t];if(e.shiftKey&&document.body.classList.add("shiftKey-down"),(e.ctrlKey||e.metaKey)&&document.body.classList.add("ctrlKey-down"),"Escape"===e.code)return!Le.length||e.shiftKey||Ne.shiftKey||Le.filter((e=>e.meta.playing&&e.meta.id)).forEach((e=>ut(!1,e.meta.id))),(()=>{X?.focus(),document.querySelectorAll(".pop-up").forEach((e=>e.classList.remove("show"))),ut(!1,K.getLastItem()),Pt();try{X=He(X.dataset.id),X.classList.add("selected"),X.scrollIntoViewIfNeeded(!0)}catch(e){}})();if("INPUT"!==document.activeElement.nodeName||!1!==document.activeElement.disabled)if(!e.shiftKey||"KeyK"!==e.code&&"Slash"!==e.code)if([...document.querySelectorAll(".pop-up")].some((e=>e.classList.contains("show")))||document.querySelectorAll("dialog[open]").length>0)document.getElementById("editPanel").open&&("KeyP"===e.code?e.altKey?digichain.editor.editorPlayFile(e,!1,!0):digichain.editor.editorPlayFile(e):1!==ae||"KeyL"!==e.code&&"KeyR"!==e.code&&"KeyS"!==e.code&&"KeyD"!==e.code?"KeyN"===e.code?digichain.editor.sliceCreate(e):"KeyU"===e.code?digichain.editor.sliceUpdate(e):"KeyX"===e.code&&digichain.editor.sliceRemove(e):digichain.editor.changeChannel(e,e.code.replace("Key","")));else{if(t.includes(e.code)){let t=+e.code.charAt(e.code.length-1);const n=Le.filter((e=>e.meta.checked));t=0===t?9:t-1,n[t]&&(e.altKey?ut(!1,n[t].meta.id):ht(!1,n[t].meta.id,e.shiftKey||Ne.shiftKey))}if("ArrowDown"!==e.code||X&&X.isConnected)if(Le.length&&"KeyI"===e.code)0!==Le.length&&(Le.forEach((e=>e.meta.checked=!e.meta.checked)),Pt());else{if(Le.length&&"KeyE"===e.code){const t=document.getElementById("editPanel");return(e.shiftKey||Ne.shiftKey)&&setTimeout((()=>{if(t.open){const e=document.getElementById("editFileName"),t=document.getElementById("editFilePath");e.removeAttribute("readonly"),t.removeAttribute("readonly"),e.focus()}}),100),!!X&&Qe(X.dataset.id)}if("KeyH"===e.code&&(e.shiftKey||Ne.shiftKey)&&Ze(),"KeyL"===e.code&&(e.shiftKey||Ne.shiftKey)&&Je(),"KeyG"===e.code&&(e.shiftKey||Ne.shiftKey)&&(document.body.classList.contains("grid-view")?document.body.classList.remove("grid-view"):document.body.classList.add("grid-view")),n.includes(e.code)&&X&&X?.isConnected)if("ArrowDown"===e.code&&X.nextElementSibling){if(!e.shiftKey&&!Ne.shiftKey)return Ct(0,X.nextElementSibling.dataset.id);let t=qe(X.dataset.id),n=Le.splice(t,1)[0];Le.splice(t+1,0,n),X.nextElementSibling.after(X),X.scrollIntoViewIfNeeded(!0),It()}else if("ArrowUp"===e.code&&X.previousElementSibling){if(!e.shiftKey&&!Ne.shiftKey)return Ct(0,X.previousElementSibling.dataset.id);let t=qe(X.dataset.id),n=Le.splice(t,1)[0];Le.splice(t-1,0,n),X.previousElementSibling.before(X),X.scrollIntoViewIfNeeded(!0),It()}else"Enter"===e.code?mt(e,X.dataset.id):"KeyP"===e.code?e.altKey?ut(!1,X.dataset.id):ht(e,X.dataset.id):1!==ae||"KeyL"!==e.code&&"KeyR"!==e.code&&"KeyS"!==e.code&&"KeyD"!==e.code||je(X.dataset.id).meta.channel&&pt(e,X.dataset.id,e.code.replace("Key",""))}else X=document.querySelector("#fileList tr")}else{const e=document.getElementById("keyboardShortcuts");e.open?e.close():e.showModal()}})),window.addEventListener("beforeunload",(e=>{Y?.close()})),at(ce,!0),document.querySelector(".touch-buttons").classList[ge?"remove":"add"]("hidden"),null===localStorage.getItem("darkModeTheme")&&(ye=window.matchMedia("(prefers-color-scheme: dark)").matches,localStorage.setItem("darkModeTheme",JSON.stringify(ye))),document.querySelector(".logo h3").dataset.version=document.querySelector("meta[name=version]").content,document.body.classList[ye?"remove":"add"]("light"),document.body.classList[ve?"add":"remove"]("normalize-contrast"),se?Ue(oe,!0):E({audioCtx:Y,masterSR:ee,masterChannels:ae,masterBitDepth:ne}),setTimeout((()=>Ze()),250),Wt(),document.getElementById("modifierKeyctrlKey").textContent=-1!==navigator.userAgent.indexOf("Mac")?"CMD":"CTRL"}catch(e){let t="An unexpected error was encountered, please refresh the page. ";navigator.brave&&(t+="If you are using Brave browser, please disable Brave Shields for digichain.brianbar.net."),alert(t),console.log(e)}window.digichain={sliceOptions:()=>ze,saveSession:function(){const e=new JSZip,t=Le.map((e=>({file:e.file,meta:e.meta,buffer:{duration:e.buffer.duration,length:e.buffer.length,numberOfChannels:e.buffer.numberOfChannels,sampleRate:e.buffer.sampleRate,channel0:e.buffer.getChannelData(0),channel1:e.buffer.numberOfChannels>1&&e.buffer.getChannelData(1)}}))),n={lastUsedAudioConfig:oe,workingSR:ee,sliceOptions:ze};e.file("files",JSON.stringify(t),{compression:"DEFLATE",compressionOptions:{level:9}}),e.file("unsorted",JSON.stringify(De),{compression:"DEFLATE",compressionOptions:{level:9}}),e.file("importOrder",JSON.stringify(Ie),{compression:"DEFLATE",compressionOptions:{level:9}}),e.file("settings",JSON.stringify(n),{compression:"DEFLATE",compressionOptions:{level:9}}),e.generateAsync({type:"blob",compression:"DEFLATE"}).then((e=>{const t=document.getElementById("getJoined");t.href=URL.createObjectURL(e),t.setAttribute("download","digichain_session.dcsd"),t.click(),document.body.classList.remove("loading")}))},changeAudioConfig:Ue,removeSelected:function(){Oe.removeSelected(),Le.filter((e=>e.meta.checked)).forEach((e=>kt(e.meta.id))),Le=Le.filter((e=>!e.meta.checked)),De=De.filter((e=>Le.find((t=>t.meta.id===e)))),Ie=Ie.filter((e=>De.includes(e))),It(),0!==Le.length&&0!==De.length||(Le.forEach((e=>!!e.buffer&&delete e.buffer)),Le=[],De=[],Ie=[]),jt(),Pt()},toggleSelectedActionsList:function(){const e=document.querySelector(".selected-actions-button-list");e.style.display="none"===e.style.display?"flex":"none"},trimRightSelected:function(e){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const t=Le.filter((e=>e.meta.checked));t.forEach(((n,a)=>{K.trimRight(e,n,!1),a===t.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},roughStretchSelected:function(e){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const t=Le.filter((e=>e.meta.checked));t.forEach(((n,a)=>{K.roughStretch(e,n,!1),a===t.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},truncateSelected:function(e){let t=3;if(e.shiftKey||Ne.shiftKey){const e=prompt("Please enter a custom length in seconds to truncate the selected samples to...");e&&!isNaN(e)&&(t=Math.abs(+e))}Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const n=Le.filter((e=>e.meta.checked));n.forEach(((a,i)=>{K.truncate(e,a,!1,t),i===n.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},normalizeSelected:function(e){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const t=Le.filter((e=>e.meta.checked));t.forEach(((n,a)=>{K.normalize(e,n,!1),a===t.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},reverseSelected:function(e){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const t=Le.filter((e=>e.meta.checked));t.forEach(((n,a)=>{K.reverse(e,n,!1),a===t.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},shiftSelected:function(e){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const t=Le.filter((e=>e.meta.checked));t.forEach(((n,a)=>{K.shift(e,n,!1),a===t.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},pitchUpSelected:function(e){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const t=Le.filter((e=>e.meta.checked));t.forEach(((n,a)=>{K.perSamplePitch(e,2,-12,n,!1),a===t.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},doubleSelected:nt,pingPongSelected:function(e){nt(e,!0)},fuzzSelected:function(e){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const e=Le.filter((e=>e.meta.checked));e.forEach(((t,n)=>{K.fade("fuzz",t,!1),n===e.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},crushSelected:function(e){let t=25;if(e.shiftKey||Ne.shiftKey){const e=prompt("Please enter a custom crush amount (25 is the default, above 127 will sound the same)...");e&&!isNaN(e)&&(t=Math.abs(+e))}t=Math.min(Math.floor(Math.abs(t)),127),Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((async()=>{const n=Le.filter((e=>e.meta.checked));await new Promise((a=>n.forEach(((i,r)=>{K.perSamplePitch(e,1,1,i,!1,t,8),r===n.length-1&&a(!0)})))),await new Promise((t=>setTimeout((()=>n.forEach(((a,i)=>{K.normalize(e,a,!1),i===n.length-1&&(document.body.classList.remove("loading"),t(!0))}))),1e3))),Pt()}),250)},fadeSelected:function(e,t){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const e=Le.filter((e=>e.meta.checked));e.forEach(((n,a)=>{let i=0,r=n.buffer.length<256?n.buffer.length:256;"out"===t&&(i=n.buffer.length<256?0:n.buffer.length-256,r=n.buffer.length),K.fade(t,n,!1,i,r,!0),a===e.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},stretchSelected:function(e,t=!1){let n=Le.filter((e=>e.meta.checked)).sort(((e,t)=>t.buffer.length-e.buffer.length));!0===t&&n.reverse();let a=n[0].buffer.length;if(e.shiftKey||Ne.shiftKey){const t=e.ctrlKey||e.metaKey||Ne.ctrlKey?"samples":"seconds",n=prompt(`Please enter a custom length in ${t} to stretch the selected samples to...`);n&&(["x","*"].includes(n[0])?a=e=>Math.floor(e*+n.replace(/[^0-9.]/g,"")):["/","%","÷"].includes(n[0])?a=e=>Math.floor(e/+n.replace(/[^0-9.]/g,"")):isNaN(n)||(a=Math.floor(Math.abs(+n)*("seconds"===t?ee:1))))}Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const t=Le.filter((e=>e.meta.checked));t.forEach(((n,i)=>{"function"==typeof a?K.stretch(e,n,!1,a(n.buffer.length)):K.stretch(e,n,!1,a),i===t.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},shortenNameSelected:function(e,t=!1){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const e=Le.filter((e=>e.meta.checked));let n={},a=[];t||(n={},a=Le.map((e=>(n[e.meta.id]={path:e.file.path.split("/").map((e=>e.substring(0,12))).join("/"),name:e.file.name.substring(0,12)+(e.meta.note?`-${e.meta.note}`:"")},n[e.meta.id].joined=`${n[e.meta.id].path}${n[e.meta.id].name}`,{name:n[e.meta.id].joined,available:!0})))),e.forEach(((i,r)=>{if(i.file.origPath=i.file.origPath||i.file.path,i.file.origName=i.file.origName||i.file.name,t)i.file.path=i.file.origPath,i.file.name=i.file.origName;else{const e=n[i.meta.id],t=a.filter((t=>t.name===e.joined&&t.available));i.file.path=e.path,i.file.name=1===t.length?e.name:e.name+`-${t.length}`,t[0].available=!1}r===e.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},sanitizeNameSelected:function(e,t=!1){const n=e=>e.replaceAll(/[\[\{<]/g,"(").replaceAll(/[\]\}>]/g,")").replaceAll(/[^a-zA-Z0-9\s#\-\(\)]/g,"-").replaceAll(/-{3,}/g,"-");Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const e=Le.filter((e=>e.meta.checked));let a={},i=[];t||(a={},i=Le.map((e=>(a[e.meta.id]={path:e.file.path.split("/").map((e=>n(e))).join("/"),name:n(e.file.name)+(e.meta.note?`-${e.meta.note}`:"")},a[e.meta.id].joined=`${a[e.meta.id].path}${a[e.meta.id].name}`,{name:a[e.meta.id].joined,available:!0})))),e.forEach(((n,r)=>{if(n.file.origPath=n.file.origPath||n.file.path,n.file.origName=n.file.origName||n.file.name,t)n.file.path=n.file.origPath,n.file.name=n.file.origName;else{const e=a[n.meta.id],t=i.filter((t=>t.name===e.joined&&t.available));n.file.path=e.path,n.file.name=1===t.length?e.name:e.name+`-${t.length}`,t[0].available=!1}r===e.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},serializeSelected:function(e,t="LR"){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const n=Le.filter((e=>e.meta.checked&&2===e.buffer.numberOfChannels));n.forEach(((a,i)=>{K.serialize(e,a,!1,t),i===n.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},deserializeSelected:function(e,t="LR"){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const n=Le.filter((e=>e.meta.checked&&1===e.buffer.numberOfChannels));n.forEach(((a,i)=>{K.deserialize(e,a,!1,t),i===n.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},condenseSelected:function(e){Le.forEach((e=>e.meta.checked?e.source?.stop():""));let t=prompt("Please enter the LOWER threshold (decimal value between 0 and 1)...");t&&!isNaN(t)&&(t=Math.abs(+t));let n=prompt("Please enter the UPPER threshold (decimal value between 0 and 1)...");n&&!isNaN(n)&&(n=Math.abs(+n)),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const a=Le.filter((e=>e.meta.checked));a.forEach(((i,r)=>{K.thresholdCondense(e,i,!1,+t,+n),r===a.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},nudgeCrossingsSelected:function(e){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const t=Le.filter((e=>e.meta.checked));t.forEach(((n,a)=>{K.nudgeCrossings(e,n,!1),a===t.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},padWithZeroSelected:function(e){Le.forEach((e=>e.meta.checked?e.source?.stop():"")),document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>{const t=Le.filter((e=>e.meta.checked));t.forEach(((n,a)=>{K.padWithZero(e,n,!1),a===t.length-1&&document.body.classList.remove("loading")})),Pt()}),250)},showMergePanel:lt,showBlendPanel:ct,sort:St,selectedHeaderClick:(e,t)=>{if(e.ctrlKey||e.metaKey||Ne.ctrlKey){const e=Le.every((e=>e.meta.checked));Le.forEach((t=>t.meta.checked=!e)),Pt()}else St(e,"checked")},renderList:Pt,renderRow:Rt,joinAll:function(e,t){if(0!==Le.length&&0!==Le.filter((e=>e.meta.checked)).length){if(0!==Ee){if(0===Le.filter((e=>e.meta.duration<Ee)).length)return}document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),setTimeout((()=>dt(e,t)),500)}},performMergeUiCall:function(){const e=document.getElementById("mergePanel");document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),0!==Le.filter((e=>e.meta.checked)).length&&(e.close(),setTimeout((()=>function(e){let t=e[0];e.forEach((e=>t=t.buffer.length>e.buffer.length?t:e));let n={file:{...t.file},buffer:Y.createBuffer(2,t.buffer.length,ee),meta:{...t.meta,channel:"L",isMerge:!0,editOf:"",id:crypto.randomUUID(),checked:!1},waveform:!1};for(let e=0;e<n.buffer.length;e++)n.buffer.getChannelData(0)[e]=0,n.buffer.getChannelData(1)[e]=0;e.forEach(((t,a)=>{const i="L"===t.meta.pan?0:1;let r=t.buffer.getChannelData(0);if(2===t.buffer.numberOfChannels&&(r=st(t.buffer,t.meta?.channel)),"C"===t.meta.pan)for(let e=0;e<t.buffer.length;e++)n.buffer.getChannelData(0)[e]=(n.buffer.getChannelData(0)[e]+(r[e]||0))/2,n.buffer.getChannelData(1)[e]=(n.buffer.getChannelData(1)[e]+(r[e]||0))/2;else{const e=n.buffer.getChannelData(i);for(let a=0;a<t.buffer.length;a++)n.buffer.getChannelData(i)[a]=0===e[a]?r[a]||0:(e[a]+(r[a]||0))/2}a===e.length-1&&(Le.unshift(n),De.push(n.meta.id),document.body.classList.remove("loading"),Pt())}))}(Be)),100))},performBlendUiCall:function(){const e=+document.getElementById("blendLength").value,t=document.getElementById("mergePanel");document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),0!==Le.filter((e=>e.meta.checked)).length&&e&&(t.close(),setTimeout((()=>function(e,t){const n=e.map(((n,a)=>Math.floor(t/e.length)+(a===e.length-1?t%e.length:0)));let a=`${R(e.at(0).file.name)}-${R(e.at(-1).file.name)}_blend`,i=Y.createBuffer(1,e.reduce(((e,t,a)=>e+t.buffer.length*n[a]),0),ee),r={file:{name:a,filename:`${a}.wav`,path:"",type:"audio/wav"},buffer:i,meta:{length:i.length,duration:Number(i.length/ee).toFixed(3),startFrame:0,endFrame:i.length,isBlend:!0,editOf:"",id:crypto.randomUUID(),checked:!1},waveform:!1};for(let e=0;e<r.buffer.length;e++)r.buffer.getChannelData(0)[e]=0;let o=0;e.forEach(((t,a)=>{const i=a===e.length-1?e[0]:e[a+1];let s=2===t.buffer.numberOfChannels?st(t.buffer,t.meta?.channel):t.buffer.getChannelData(0),l=2===i.buffer.numberOfChannels?st(i.buffer,i.meta?.channel):i.buffer.getChannelData(0);for(let e=0;e<n[a];e++)for(let t=0;t<s.length;t++)r.buffer.getChannelData(0)[o]=(s[t]||0)+(e+1)/n[a]*((l[t]||0)-(s[t]||0)),o++;a===e.length-1&&(Le.unshift(r),De.push(r.meta.id),document.body.classList.remove("loading"),Pt())}))}(Be,e)),100))},selectSliceAmount:bt,showInfo:function(){const e=document.querySelector("meta[name=description]").content,t=document.querySelector("meta[name=version]").content;document.querySelector("#infoPanelMd .content").innerHTML=`\n  <h3>DigiChain (${t})</h3>\n  <p>${e}</p>\n  <p class="float-right"><a href="https://brianbar.net/" target="_blank">Brian Barnett</a>\n  (<a href="https://github.com/brian3kb" target="_blank">brian3kb</a>) </p>\n`,document.querySelector("#infoPanelMd").showModal()},toggleCheck:mt,move:(e,t,n)=>{const a=qe(t);let i,r=1===n?a+1:a-1;-1===r&&(r=Le.length-1),r>=Le.length&&(r=0),i=Le.splice(a,1)[0],e.shiftKey||Ne.shiftKey?a>r?Le.splice(0,0,i):Le.splice(Le.length,0,i):Le.splice(r,0,i),Pt()},playFile:ht,playSlice:ft,sliceAction:function(e,t,n){const a=je(t),i=e.target.closest(".line");if((e.ctrlKey||e.metaKey||Ne.ctrlKey)&&(e.shiftKey||Ne.shiftKey))return document.getElementById("splitOptions").querySelectorAll("div.line").forEach((e=>{e.classList.remove("file-loop-on"),e.classList.remove("file-loop-pp")})),document.getElementById("sliceLines"),a.meta.otLoop=parseInt(a.meta?.otLoop)<2?a.meta.otLoop+1:0,void(0===a.meta.otLoop?a.meta.otLoopStart=0:([...document.getElementById("splitOptions").querySelectorAll("div.line")].slice(+i.dataset.idx).forEach(((e,t)=>e.classList.add(1===a.meta.otLoop?"file-loop-on":"file-loop-pp"))),a.meta.otLoopStart=+n.startPoint));if((e.ctrlKey||e.metaKey||Ne.ctrlKey)&&ft(e,t,+n.startPoint,+n.endPoint,n.loop),e.shiftKey||Ne.shiftKey){const e=a.meta.slices[+i.dataset.idx];e&&(i.classList.toggle("slice-loop"),e.l=-1===e.l?e.s:-1)}},stopPlayFile:ut,downloadFile:tt,downloadAll:async function(e){const t=Le.filter((e=>e.meta.checked)),n=e.shiftKey||Ne.shiftKey,a=[],i=document.getElementById("getJoined"),r="a"===ie;if(0===t.length)return;if(t.length>5&&!he){if(!confirm(`You are about to download ${t.length} files, that will show ${t.length} pop-ups one after each other..\n\nAre you ready for that??`))return}if(document.getElementById("loadingText").textContent="Processing",document.body.classList.add("loading"),he&&t.length>1){const e=new JSZip;for(const a of t){const t=await et(a,i,r,!0);let o="";if(o="a"===ie?o.replace(".wav",".aif"):o,n){o=R("",a,!1,!0),o="a"===ie?o.replace(".wav",".aif"):o,e.file(o,t.blob,{binary:!0});let n=await zt(a.meta.slices??[],a,o);n&&e.file(n.name,n.blob,{binary:!0})}else{let n=R("",a,!1);n="a"===ie?n.replace(".wav",".aif"):n,e.file(a.file.path+n,t.blob,{binary:!0});let i=await zt(a.meta.slices??[],a,n);i&&e.file(a.file.path+i.name,i.blob,{binary:!0})}}return void e.generateAsync({type:"blob"}).then((e=>{const t=document.getElementById("getJoined");t.href=URL.createObjectURL(e),t.setAttribute("download","digichain_files.zip"),t.click(),document.body.classList.remove("loading")}))}for(const e of t){(await tt(e.meta.id)).forEach((e=>a.push(e)))}const o=setInterval((()=>{const e=a.shift();e?.click(),0===a.length&&e&&(clearInterval(o),document.body.classList.remove("loading"))}),500)},changeChannel:pt,changePan:(e,t,n)=>{const a=He(t,"#mergeList").querySelector(".pan-option-"+n);je(t).meta.pan=n,He(t,"#mergeList").querySelectorAll(".pan-options a").forEach((e=>e.classList.remove("selected"))),a.classList.add("selected")},duplicate:yt,remove:kt,handleRowClick:Ct,rowDragStart:e=>{e.target?.classList?.contains("file-row")&&(X=e.target,async function(e,t){const n="a"===ie;let a=je(t),i={href:"",setAttribute:function(e,t){this.fileName=t}};await et(a,i,n,!0),e.dataTransfer.setData("DownloadURL",`audio/x-wav:${i.fileName}:${i.href}`)}(e,e.target.dataset.id))},splitAction:Et,splitEvenly:wt,splitFromFile:function(e){const t=document.querySelector(".slice-from-file-buttons"),n=document.querySelectorAll(".slice-from-file-buttons button");if(!e.target?.files?.length)return;const a=new FileReader;a.onload=function(e){if(!e.target.result)return;const a=JSON.parse(e.target.result);a.clips&&(Pe=a.clips.map((e=>({track:e.ch+1,startPoint:Math.round(e.start/44100*ee),endPoint:Math.round(e.stop/44100*ee)}))),Pe.trackSlices={},Pe.forEach((e=>Pe.trackSlices[`t${e.track}`]=(Pe.trackSlices[`t${e.track}`]??0)+1)),t.classList.remove("hidden"),n.forEach(((e,t)=>e.textContent=`${Pe.trackSlices[`t${t+1}`]}`)))},a.readAsText(e.target.files[0])},splitSizeAction:_t,splitFromTrack:function(e,t){const n=document.querySelector("#splitOptions .slice-group"),a=je(n.dataset.id);a.meta.customSlices={slices:Pe.filter((e=>e.track===t))},a.meta.customSlices.sliceCount=a.meta.customSlices.slices.length,xt(a.meta.customSlices.length,a,a.meta.customSlices)},convertChain:function(e,t=!1){const i=[...document.getElementById("splitOptions").querySelectorAll("div.line.fade")].map((e=>+e.dataset.idx)),r=yt(e,X.dataset.id,!0);if(r.item.meta.slices=(r.item.meta.slices?r.item.meta.slices:Oe.getByFileInDcFormat(je(X.dataset.id))).filter(((e,t)=>!i.includes(t))),t&&0!==Te)for(;r.item.meta.slices.length<Te;)r.item.meta.slices.push(JSON.parse(JSON.stringify(r.item.meta.slices.at(-1))));const o=r.item.meta.slices.map((e=>e.e-e.s)),s=Math.max(...o);let l=r.item.meta.slices.map((e=>{const t=new AudioBuffer({numberOfChannels:r.item.buffer.numberOfChannels,length:e.e-e.s,sampleRate:r.item.buffer.sampleRate});for(let n=0;n<t.numberOfChannels;n++)for(let a=0;a<t.length;a++)t.getChannelData(n)[a]=r.item.buffer.getChannelData(n)[e.s+a]||0;return{buffer:t,meta:{}}}));t||l.forEach((t=>{K.trimRight(e,t,!1)}));const c=t?l.length*s:l.reduce(((e,t)=>e+t.buffer.length),0),d=new AudioBuffer({numberOfChannels:r.item.buffer.numberOfChannels,length:c,sampleRate:r.item.buffer.sampleRate});1===d.numberOfChannels&&n(d,l,s,t),2===d.numberOfChannels&&a(d,l,s,t);let u=0;l.forEach(((e,n)=>{const a=t?s:e.buffer.length;r.item.meta.slices&&(r.item.meta.slices[n].s=u,r.item.meta.slices[n].e=u+a),u+=a})),r.item.buffer=d,r.item.meta={...r.item.meta,length:d.length,duration:Number(d.length/ee).toFixed(3),startFrame:0,endFrame:d.length},delete r.item.meta.op1Json,r.callback(r.item,r.fileIdx),Xe()},toggleModifier:e=>{"shiftKey"!==e&&"ctrlKey"!==e&&"metaKey"!==e||(Ne[e="metaKey"===e?"ctrlKey":e]=!Ne[e],document.getElementById("modifierKey"+e).classList[Ne[e]?"add":"remove"]("active"),document.body.classList[Ne[e]?"add":"remove"](e+"-mod-down"))},toggleListVisibility:Je,toggleOptionsPanel:Ze,showExportSettingsPanel:ot,showEditPanel:Qe,closeEditPanel:()=>{const e=document.getElementById("editPanel");e.open&&e.close(),Le.forEach((e=>delete e.meta.editing)),digichain.stopPlayFile(!1,digichain.editor.getLastItem()),digichain.renderList()},closeSplitOptions:Xe,createOtMetaFile:async function(){const e=document.getElementById("splitOptions"),t=He(X.dataset.id).querySelector(".meta-link-hidden"),n=je(X.dataset.id),a=[...e.querySelectorAll("div.line.fade")].map((e=>+e.dataset.idx)),i=Oe.getByFileInDcFormat(n).filter(((e,t)=>!a.includes(t)));await zt(i,n,n.file.name,t,!0)&&t.click()},pitchExports:at,toggleSetting:it,toggleSecondsPerFile:rt,changeOpParam:function(e,t,n,a){const i=He(t),r=je(t);if("bal"===n){e.draggable=!1,e.preventDefault(),i.querySelector(".channel-options-stereo-opf .channel-balance");let t=+e.target.value??16384;t-=t%1024,r.meta.opPan=t}return"baltoggle"===n&&(r.meta.opPanAb=!r.meta.opPanAb,i.querySelector(".channel-options-stereo-opf").classList[r.meta.opPanAb?"add":"remove"]("op-pan-ab-true")),!1},toggleHelp:function(){const e=document.querySelector(".toggle-help-panel"),t=document.body.classList.contains("show-help");if(document.body.classList[t?"remove":"add"]("show-help"),document.querySelector(".help-text").classList[t?"add":"remove"]("hidden"),e.classList[t?"add":"remove"]("fade"),e.dataset.interval&&(clearInterval(+e.dataset.interval),e.dataset.interval=null),!t){const t=setInterval((()=>{const e=document.querySelector(".help-text"),t=document.activeElement;e.textContent=t.title,e.classList[t.title?"remove":"add"]("fade")}),500);e.dataset.interval=`${t}`}},toggleChainNamePanel:function(){const e=document.getElementById("chainFileNameListPanel");e.open?e.close():e.showModal(),e.open&&Ye()},changeChainName:function(e,t,n){let a;if("remove-all"===n){return e.preventDefault(),confirm("Are you sure you want to remove all the chain names below?")&&(Ae=[]),Ye()}if(a=void 0===t?{name:"",used:!1}:Ae[t],t>-1&&"remove"===n){return e.preventDefault(),confirm(`Are you sure you want to remove the chain name '${a.name}'?`)&&Ae.splice(t,1),Ye()}if(t>-1&&"reuse"===n)return e.preventDefault(),a.used=!1,Ye();let i=prompt("Please enter a name for the chain, names must be unique",a.name);i&&(a.name=i,void 0===t&&-1===Ae.findIndex((e=>e.name.toLowerCase()===i.toLowerCase()))&&Ae.push(a),Ye())},generateChainNames:function(){Ae=[...new Set(Le.filter((e=>e.file.path)).map((e=>e.file.path)))].map((e=>({name:e.replace(/\W+/gi,""),used:!1}))),Ye()},removeMetaFile:function(e){const t=je(e);t&&(Oe.removeByName(t.file.filename),t.meta.op1Json&&delete t.meta.op1Json)},getSlicesFromMetaFile:function(e){return Oe.getByFileInDcFormat(e)},setAudioOptionsFromCommonConfig:function(e){const t=e.target.value;if("none"===t)return;const n=[48e3,"m",16,"w",...Z];let a=t?t.match(/^\d+|[ms]|\d+|[wa]/g):n;document.getElementById(`acoContainer${a[3]}`).click(),document.getElementById("settingsSampleRate").value=+a[0],document.getElementById(`acoChannel${a[1]}`).click(),document.getElementById(`acoBitDepth${a[2]}`).click(),a.slice(4).forEach(((e,t)=>t>0?document.getElementById("gridSize"+ +t).value=+e:"")),0===Le.length&&(document.getElementById("settingsWorkingSampleRate").value=+a[0])},bufferRateResampler:We,editor:K};
